/*! Chorus 2 - A web interface for Kodi. Created by Jeremy Graham - built on 28-03-2024 */

!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(f,t){function e(t,e){return e.toUpperCase()}var h=[],c=h.slice,g=h.concat,a=h.push,r=h.indexOf,n={},i=n.toString,m=n.hasOwnProperty,v={},s="1.11.1",S=function(t,e){return new S.fn.init(t,e)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,l=/^-ms-/,u=/-([\da-z])/gi;function d(t){var e=t.length,n=S.type(t);return"function"!==n&&!S.isWindow(t)&&(!(1!==t.nodeType||!e)||("array"===n||0===e||"number"==typeof e&&0<e&&e-1 in t))}S.fn=S.prototype={jquery:s,constructor:S,selector:"",length:0,toArray:function(){return c.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:c.call(this)},pushStack:function(t){var e=S.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return S.each(this,t,e)},map:function(n){return this.pushStack(S.map(this,function(t,e){return n.call(t,e,t)}))},slice:function(){return this.pushStack(c.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,n=+t+(t<0?e:0);return this.pushStack(0<=n&&n<e?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:a,sort:h.sort,splice:h.splice},S.extend=S.fn.extend=function(){var t,e,n,i,r,s,o=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[a]||{},a++),"object"==typeof o||S.isFunction(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(r=arguments[a]))for(i in r)t=o[i],o!==(n=r[i])&&(u&&n&&(S.isPlainObject(n)||(e=S.isArray(n)))?(s=e?(e=!1,t&&S.isArray(t)?t:[]):t&&S.isPlainObject(t)?t:{},o[i]=S.extend(u,s,n)):void 0!==n&&(o[i]=n));return o},S.extend({expando:"jQuery"+(s+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===S.type(t)},isArray:Array.isArray||function(t){return"array"===S.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return!S.isArray(t)&&0<=t-parseFloat(t)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isPlainObject:function(t){var e;if(!t||"object"!==S.type(t)||t.nodeType||S.isWindow(t))return!1;try{if(t.constructor&&!m.call(t,"constructor")&&!m.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}if(v.ownLast)for(e in t)return m.call(t,e);for(e in t);return void 0===e||m.call(t,e)},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?n[i.call(t)]||"object":typeof t},globalEval:function(t){t&&S.trim(t)&&(f.execScript||function(t){f.eval.call(f,t)})(t)},camelCase:function(t){return t.replace(l,"ms-").replace(u,e)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,n){var i=0,r=t.length,s=d(t);if(n){if(s)for(;i<r&&!1!==e.apply(t[i],n);i++);else for(i in t)if(!1===e.apply(t[i],n))break}else if(s)for(;i<r&&!1!==e.call(t[i],i,t[i]);i++);else for(i in t)if(!1===e.call(t[i],i,t[i]))break;return t},trim:function(t){return null==t?"":(t+"").replace(o,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(d(Object(t))?S.merge(n,"string"==typeof t?[t]:t):a.call(n,t)),n},inArray:function(t,e,n){var i;if(e){if(r)return r.call(e,t,n);for(i=e.length,n=n?n<0?Math.max(0,i+n):n:0;n<i;n++)if(n in e&&e[n]===t)return n}return-1},merge:function(t,e){for(var n=+e.length,i=0,r=t.length;i<n;)t[r++]=e[i++];if(n!=n)for(;void 0!==e[i];)t[r++]=e[i++];return t.length=r,t},grep:function(t,e,n){for(var i=[],r=0,s=t.length,o=!n;r<s;r++)!e(t[r],r)!=o&&i.push(t[r]);return i},map:function(t,e,n){var i,r=0,s=t.length,o=[];if(d(t))for(;r<s;r++)null!=(i=e(t[r],r,n))&&o.push(i);else for(r in t)null!=(i=e(t[r],r,n))&&o.push(i);return g.apply([],o)},guid:1,proxy:function(t,e){var n,i,r;if("string"==typeof e&&(r=t[e],e=t,t=r),S.isFunction(t))return n=c.call(arguments,2),(i=function(){return t.apply(e||this,n.concat(c.call(arguments)))}).guid=t.guid=t.guid||S.guid++,i},now:function(){return+new Date},support:v}),S.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){n["[object "+e+"]"]=e.toLowerCase()});var p=function(n){function h(t,e,n){var i="0x"+e-65536;return i!=i||n?e:i<0?String.fromCharCode(65536+i):String.fromCharCode(i>>10|55296,1023&i|56320)}var t,f,w,s,i,g,d,m,_,u,c,v,x,r,y,b,o,a,S,T="sizzle"+-new Date,C=n.document,E=0,p=0,l=rt(),k=rt(),M=rt(),D=function(t,e){return t===e&&(c=!0),0},O="undefined",A={}.hasOwnProperty,e=[],N=e.pop,j=e.push,R=e.push,L=e.slice,I=e.indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(this[e]===t)return e;return-1},P="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",H="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=H.replace("w","w#"),$="\\["+F+"*("+H+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+F+"*\\]",U=":("+H+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+$+")*)|.*)\\)|)",B=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),V=new RegExp("^"+F+"*,"+F+"*"),z=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),W=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),J=new RegExp(U),G=new RegExp("^"+q+"$"),X={ID:new RegExp("^#("+H+")"),CLASS:new RegExp("^\\.("+H+")"),TAG:new RegExp("^("+H.replace("w","w*")+")"),ATTR:new RegExp("^"+$),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+P+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig");try{R.apply(e=L.call(C.childNodes),C.childNodes),e[C.childNodes.length].nodeType}catch(t){R={apply:e.length?function(t,e){j.apply(t,L.call(e))}:function(t,e){for(var n=t.length,i=0;t[n++]=e[i++];);t.length=n-1}}}function it(t,e,n,i){var r,s,o,a,l,u,c,h,d,p;if((e?e.ownerDocument||e:C)!==x&&v(e),n=n||[],!t||"string"!=typeof t)return n;if(1!==(a=(e=e||x).nodeType)&&9!==a)return[];if(y&&!i){if(r=Z.exec(t))if(o=r[1]){if(9===a){if(!(s=e.getElementById(o))||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(e.ownerDocument&&(s=e.ownerDocument.getElementById(o))&&S(e,s)&&s.id===o)return n.push(s),n}else{if(r[2])return R.apply(n,e.getElementsByTagName(t)),n;if((o=r[3])&&f.getElementsByClassName&&e.getElementsByClassName)return R.apply(n,e.getElementsByClassName(o)),n}if(f.qsa&&(!b||!b.test(t))){if(h=c=T,d=e,p=9===a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(u=g(t),(c=e.getAttribute("id"))?h=c.replace(et,"\\$&"):e.setAttribute("id",h),h="[id='"+h+"'] ",l=u.length;l--;)u[l]=h+ft(u[l]);d=tt.test(t)&&dt(e.parentNode)||e,p=u.join(",")}if(p)try{return R.apply(n,d.querySelectorAll(p)),n}catch(t){}finally{c||e.removeAttribute("id")}}}return m(t.replace(B,"$1"),e,n,i)}function rt(){var i=[];return function t(e,n){return i.push(e+" ")>w.cacheLength&&delete t[i.shift()],t[e+" "]=n}}function st(t){return t[T]=!0,t}function ot(t){var e=x.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function at(t,e){for(var n=t.split("|"),i=t.length;i--;)w.attrHandle[n[i]]=e}function lt(t,e){var n=e&&t,i=n&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||1<<31)-(~t.sourceIndex||1<<31);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function ut(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function ct(n){return function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&t.type===n}}function ht(o){return st(function(s){return s=+s,st(function(t,e){for(var n,i=o([],t.length,s),r=i.length;r--;)t[n=i[r]]&&(t[n]=!(e[n]=t[n]))})})}function dt(t){return t&&typeof t.getElementsByTagName!==O&&t}for(t in f=it.support={},i=it.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},v=it.setDocument=function(t){var e,l=t?t.ownerDocument||t:C,n=l.defaultView;return l!==x&&9===l.nodeType&&l.documentElement?(r=(x=l).documentElement,y=!i(l),n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",function(){v()},!1):n.attachEvent&&n.attachEvent("onunload",function(){v()})),f.attributes=ot(function(t){return t.className="i",!t.getAttribute("className")}),f.getElementsByTagName=ot(function(t){return t.appendChild(l.createComment("")),!t.getElementsByTagName("*").length}),f.getElementsByClassName=Q.test(l.getElementsByClassName)&&ot(function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length}),f.getById=ot(function(t){return r.appendChild(t).id=T,!l.getElementsByName||!l.getElementsByName(T).length}),f.getById?(w.find.ID=function(t,e){if(typeof e.getElementById!==O&&y){var n=e.getElementById(t);return n&&n.parentNode?[n]:[]}},w.filter.ID=function(t){var e=t.replace(nt,h);return function(t){return t.getAttribute("id")===e}}):(delete w.find.ID,w.filter.ID=function(t){var n=t.replace(nt,h);return function(t){var e=typeof t.getAttributeNode!==O&&t.getAttributeNode("id");return e&&e.value===n}}),w.find.TAG=f.getElementsByTagName?function(t,e){if(typeof e.getElementsByTagName!==O)return e.getElementsByTagName(t)}:function(t,e){var n,i=[],r=0,s=e.getElementsByTagName(t);if("*"!==t)return s;for(;n=s[r++];)1===n.nodeType&&i.push(n);return i},w.find.CLASS=f.getElementsByClassName&&function(t,e){if(typeof e.getElementsByClassName!==O&&y)return e.getElementsByClassName(t)},o=[],b=[],(f.qsa=Q.test(l.querySelectorAll))&&(ot(function(t){t.innerHTML="<select msallowclip=''><option selected=''></option></select>",t.querySelectorAll("[msallowclip^='']").length&&b.push("[*^$]="+F+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||b.push("\\["+F+"*(?:value|"+P+")"),t.querySelectorAll(":checked").length||b.push(":checked")}),ot(function(t){var e=l.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&b.push("name"+F+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||b.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),b.push(",.*:")})),(f.matchesSelector=Q.test(a=r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.oMatchesSelector||r.msMatchesSelector))&&ot(function(t){f.disconnectedMatch=a.call(t,"div"),a.call(t,"[s!='']:x"),o.push("!=",U)}),b=b.length&&new RegExp(b.join("|")),o=o.length&&new RegExp(o.join("|")),e=Q.test(r.compareDocumentPosition),S=e||Q.test(r.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},D=e?function(t,e){if(t===e)return c=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!f.sortDetached&&e.compareDocumentPosition(t)===n?t===l||t.ownerDocument===C&&S(C,t)?-1:e===l||e.ownerDocument===C&&S(C,e)?1:u?I.call(u,t)-I.call(u,e):0:4&n?-1:1)}:function(t,e){if(t===e)return c=!0,0;var n,i=0,r=t.parentNode,s=e.parentNode,o=[t],a=[e];if(!r||!s)return t===l?-1:e===l?1:r?-1:s?1:u?I.call(u,t)-I.call(u,e):0;if(r===s)return lt(t,e);for(n=t;n=n.parentNode;)o.unshift(n);for(n=e;n=n.parentNode;)a.unshift(n);for(;o[i]===a[i];)i++;return i?lt(o[i],a[i]):o[i]===C?-1:a[i]===C?1:0},l):x},it.matches=function(t,e){return it(t,null,null,e)},it.matchesSelector=function(t,e){if((t.ownerDocument||t)!==x&&v(t),e=e.replace(W,"='$1']"),f.matchesSelector&&y&&(!o||!o.test(e))&&(!b||!b.test(e)))try{var n=a.call(t,e);if(n||f.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return 0<it(e,x,null,[t]).length},it.contains=function(t,e){return(t.ownerDocument||t)!==x&&v(t),S(t,e)},it.attr=function(t,e){(t.ownerDocument||t)!==x&&v(t);var n=w.attrHandle[e.toLowerCase()],i=n&&A.call(w.attrHandle,e.toLowerCase())?n(t,e,!y):void 0;return void 0!==i?i:f.attributes||!y?t.getAttribute(e):(i=t.getAttributeNode(e))&&i.specified?i.value:null},it.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},it.uniqueSort=function(t){var e,n=[],i=0,r=0;if(c=!f.detectDuplicates,u=!f.sortStable&&t.slice(0),t.sort(D),c){for(;e=t[r++];)e===t[r]&&(i=n.push(r));for(;i--;)t.splice(n[i],1)}return u=null,t},s=it.getText=function(t){var e,n="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=s(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[i++];)n+=s(e);return n},(w=it.selectors={cacheLength:50,createPseudo:st,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(nt,h),t[3]=(t[3]||t[4]||t[5]||"").replace(nt,h),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||it.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&it.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return X.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&J.test(n)&&(e=g(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(nt,h).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=l[t+" "];return e||(e=new RegExp("(^|"+F+")"+t+"("+F+"|$)"))&&l(t,function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==O&&t.getAttribute("class")||"")})},ATTR:function(n,i,r){return function(t){var e=it.attr(t,n);return null==e?"!="===i:!i||(e+="","="===i?e===r:"!="===i?e!==r:"^="===i?r&&0===e.indexOf(r):"*="===i?r&&-1<e.indexOf(r):"$="===i?r&&e.slice(-r.length)===r:"~="===i?-1<(" "+e+" ").indexOf(r):"|="===i&&(e===r||e.slice(0,r.length+1)===r+"-"))}},CHILD:function(p,t,e,f,g){var m="nth"!==p.slice(0,3),v="last"!==p.slice(-4),y="of-type"===t;return 1===f&&0===g?function(t){return!!t.parentNode}:function(t,e,n){var i,r,s,o,a,l,u=m!=v?"nextSibling":"previousSibling",c=t.parentNode,h=y&&t.nodeName.toLowerCase(),d=!n&&!y;if(c){if(m){for(;u;){for(s=t;s=s[u];)if(y?s.nodeName.toLowerCase()===h:1===s.nodeType)return!1;l=u="only"===p&&!l&&"nextSibling"}return!0}if(l=[v?c.firstChild:c.lastChild],v&&d){for(a=(i=(r=c[T]||(c[T]={}))[p]||[])[0]===E&&i[1],o=i[0]===E&&i[2],s=a&&c.childNodes[a];s=++a&&s&&s[u]||(o=a=0)||l.pop();)if(1===s.nodeType&&++o&&s===t){r[p]=[E,a,o];break}}else if(d&&(i=(t[T]||(t[T]={}))[p])&&i[0]===E)o=i[1];else for(;(s=++a&&s&&s[u]||(o=a=0)||l.pop())&&((y?s.nodeName.toLowerCase()!==h:1!==s.nodeType)||!++o||(d&&((s[T]||(s[T]={}))[p]=[E,o]),s!==t)););return(o-=g)===f||o%f==0&&0<=o/f}}},PSEUDO:function(t,s){var e,o=w.pseudos[t]||w.setFilters[t.toLowerCase()]||it.error("unsupported pseudo: "+t);return o[T]?o(s):1<o.length?(e=[t,t,"",s],w.setFilters.hasOwnProperty(t.toLowerCase())?st(function(t,e){for(var n,i=o(t,s),r=i.length;r--;)t[n=I.call(t,i[r])]=!(e[n]=i[r])}):function(t){return o(t,0,e)}):o}},pseudos:{not:st(function(t){var i=[],r=[],a=d(t.replace(B,"$1"));return a[T]?st(function(t,e,n,i){for(var r,s=a(t,null,i,[]),o=t.length;o--;)(r=s[o])&&(t[o]=!(e[o]=r))}):function(t,e,n){return i[0]=t,a(i,null,n,r),!r.pop()}}),has:st(function(e){return function(t){return 0<it(e,t).length}}),contains:st(function(e){return function(t){return-1<(t.textContent||t.innerText||s(t)).indexOf(e)}}),lang:st(function(n){return G.test(n||"")||it.error("unsupported lang: "+n),n=n.replace(nt,h).toLowerCase(),function(t){var e;do{if(e=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(e=e.toLowerCase())===n||0===e.indexOf(n+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var e=n.location&&n.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===r},focus:function(t){return t===x.activeElement&&(!x.hasFocus||x.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!w.pseudos.empty(t)},header:function(t){return K.test(t.nodeName)},input:function(t){return Y.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:ht(function(){return[0]}),last:ht(function(t,e){return[e-1]}),eq:ht(function(t,e,n){return[n<0?n+e:n]}),even:ht(function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t}),odd:ht(function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t}),lt:ht(function(t,e,n){for(var i=n<0?n+e:n;0<=--i;)t.push(i);return t}),gt:ht(function(t,e,n){for(var i=n<0?n+e:n;++i<e;)t.push(i);return t})}}).pseudos.nth=w.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[t]=ut(t);for(t in{submit:!0,reset:!0})w.pseudos[t]=ct(t);function pt(){}function ft(t){for(var e=0,n=t.length,i="";e<n;e++)i+=t[e].value;return i}function gt(o,t,e){var a=t.dir,l=e&&"parentNode"===a,u=p++;return t.first?function(t,e,n){for(;t=t[a];)if(1===t.nodeType||l)return o(t,e,n)}:function(t,e,n){var i,r,s=[E,u];if(n){for(;t=t[a];)if((1===t.nodeType||l)&&o(t,e,n))return!0}else for(;t=t[a];)if(1===t.nodeType||l){if((i=(r=t[T]||(t[T]={}))[a])&&i[0]===E&&i[1]===u)return s[2]=i[2];if((r[a]=s)[2]=o(t,e,n))return!0}}}function mt(r){return 1<r.length?function(t,e,n){for(var i=r.length;i--;)if(!r[i](t,e,n))return!1;return!0}:r[0]}function vt(t,e,n,i,r){for(var s,o=[],a=0,l=t.length,u=null!=e;a<l;a++)(s=t[a])&&(n&&!n(s,i,r)||(o.push(s),u&&e.push(a)));return o}function yt(p,f,g,m,v,t){return m&&!m[T]&&(m=yt(m)),v&&!v[T]&&(v=yt(v,t)),st(function(t,e,n,i){var r,s,o,a=[],l=[],u=e.length,c=t||function(t,e,n){for(var i=0,r=e.length;i<r;i++)it(t,e[i],n);return n}(f||"*",n.nodeType?[n]:n,[]),h=!p||!t&&f?c:vt(c,a,p,n,i),d=g?v||(t?p:u||m)?[]:e:h;if(g&&g(h,d,n,i),m)for(r=vt(d,l),m(r,[],n,i),s=r.length;s--;)(o=r[s])&&(d[l[s]]=!(h[l[s]]=o));if(t){if(v||p){if(v){for(r=[],s=d.length;s--;)(o=d[s])&&r.push(h[s]=o);v(null,d=[],r,i)}for(s=d.length;s--;)(o=d[s])&&-1<(r=v?I.call(t,o):a[s])&&(t[r]=!(e[r]=o))}}else d=vt(d===e?d.splice(u,d.length):d),v?v(null,e,d,i):R.apply(e,d)})}function bt(t){for(var i,e,n,r=t.length,s=w.relative[t[0].type],o=s||w.relative[" "],a=s?1:0,l=gt(function(t){return t===i},o,!0),u=gt(function(t){return-1<I.call(i,t)},o,!0),c=[function(t,e,n){return!s&&(n||e!==_)||((i=e).nodeType?l(t,e,n):u(t,e,n))}];a<r;a++)if(e=w.relative[t[a].type])c=[gt(mt(c),e)];else{if((e=w.filter[t[a].type].apply(null,t[a].matches))[T]){for(n=++a;n<r&&!w.relative[t[n].type];n++);return yt(1<a&&mt(c),1<a&&ft(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(B,"$1"),e,a<n&&bt(t.slice(a,n)),n<r&&bt(t=t.slice(n)),n<r&&ft(t))}c.push(e)}return mt(c)}function wt(m,v){function t(t,e,n,i,r){var s,o,a,l=0,u="0",c=t&&[],h=[],d=_,p=t||b&&w.find.TAG("*",r),f=E+=null==d?1:Math.random()||.1,g=p.length;for(r&&(_=e!==x&&e);u!==g&&null!=(s=p[u]);u++){if(b&&s){for(o=0;a=m[o++];)if(a(s,e,n)){i.push(s);break}r&&(E=f)}y&&((s=!a&&s)&&l--,t&&c.push(s))}if(l+=u,y&&u!==l){for(o=0;a=v[o++];)a(c,h,e,n);if(t){if(0<l)for(;u--;)c[u]||h[u]||(h[u]=N.call(i));h=vt(h)}R.apply(i,h),r&&!t&&0<h.length&&1<l+v.length&&it.uniqueSort(i)}return r&&(E=f,_=d),c}var y=0<v.length,b=0<m.length;return y?st(t):t}return pt.prototype=w.filters=w.pseudos,w.setFilters=new pt,g=it.tokenize=function(t,e){var n,i,r,s,o,a,l,u=k[t+" "];if(u)return e?0:u.slice(0);for(o=t,a=[],l=w.preFilter;o;){for(s in n&&!(i=V.exec(o))||(i&&(o=o.slice(i[0].length)||o),a.push(r=[])),n=!1,(i=z.exec(o))&&(n=i.shift(),r.push({value:n,type:i[0].replace(B," ")}),o=o.slice(n.length)),w.filter)!(i=X[s].exec(o))||l[s]&&!(i=l[s](i))||(n=i.shift(),r.push({value:n,type:s,matches:i}),o=o.slice(n.length));if(!n)break}return e?o.length:o?it.error(t):k(t,a).slice(0)},d=it.compile=function(t,e){var n,i=[],r=[],s=M[t+" "];if(!s){for(n=(e=e||g(t)).length;n--;)(s=bt(e[n]))[T]?i.push(s):r.push(s);(s=M(t,wt(r,i))).selector=t}return s},m=it.select=function(t,e,n,i){var r,s,o,a,l,u="function"==typeof t&&t,c=!i&&g(t=u.selector||t);if(n=n||[],1===c.length){if(2<(s=c[0]=c[0].slice(0)).length&&"ID"===(o=s[0]).type&&f.getById&&9===e.nodeType&&y&&w.relative[s[1].type]){if(!(e=(w.find.ID(o.matches[0].replace(nt,h),e)||[])[0]))return n;u&&(e=e.parentNode),t=t.slice(s.shift().value.length)}for(r=X.needsContext.test(t)?0:s.length;r--&&(o=s[r],!w.relative[a=o.type]);)if((l=w.find[a])&&(i=l(o.matches[0].replace(nt,h),tt.test(s[0].type)&&dt(e.parentNode)||e))){if(s.splice(r,1),!(t=i.length&&ft(s)))return R.apply(n,i),n;break}}return(u||d(t,c))(i,e,!y,n,tt.test(t)&&dt(e.parentNode)||e),n},f.sortStable=T.split("").sort(D).join("")===T,f.detectDuplicates=!!c,v(),f.sortDetached=ot(function(t){return 1&t.compareDocumentPosition(x.createElement("div"))}),ot(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||at("type|href|height|width",function(t,e,n){if(!n)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),f.attributes&&ot(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||at("value",function(t,e,n){if(!n&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),ot(function(t){return null==t.getAttribute("disabled")})||at(P,function(t,e,n){var i;if(!n)return!0===t[e]?e.toLowerCase():(i=t.getAttributeNode(e))&&i.specified?i.value:null}),it}(f);S.find=p,S.expr=p.selectors,S.expr[":"]=S.expr.pseudos,S.unique=p.uniqueSort,S.text=p.getText,S.isXMLDoc=p.isXML,S.contains=p.contains;var y=S.expr.match.needsContext,b=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function _(t,n,i){if(S.isFunction(n))return S.grep(t,function(t,e){return!!n.call(t,e,t)!==i});if(n.nodeType)return S.grep(t,function(t){return t===n!==i});if("string"==typeof n){if(w.test(n))return S.filter(n,t,i);n=S.filter(n,t)}return S.grep(t,function(t){return 0<=S.inArray(t,n)!==i})}S.filter=function(t,e,n){var i=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?S.find.matchesSelector(i,t)?[i]:[]:S.find.matches(t,S.grep(e,function(t){return 1===t.nodeType}))},S.fn.extend({find:function(t){var e,n=[],i=this,r=i.length;if("string"!=typeof t)return this.pushStack(S(t).filter(function(){for(e=0;e<r;e++)if(S.contains(i[e],this))return!0}));for(e=0;e<r;e++)S.find(t,i[e],n);return(n=this.pushStack(1<r?S.unique(n):n)).selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(_(this,t||[],!1))},not:function(t){return this.pushStack(_(this,t||[],!0))},is:function(t){return!!_(this,"string"==typeof t&&y.test(t)?S(t):t||[],!1).length}});var x,T=f.document,C=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(S.fn.init=function(t,e){var n,i;if(!t)return this;if("string"!=typeof t)return t.nodeType?(this.context=this[0]=t,this.length=1,this):S.isFunction(t)?void 0!==x.ready?x.ready(t):t(S):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),S.makeArray(t,this));if(!(n="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&3<=t.length?[null,t,null]:C.exec(t))||!n[1]&&e)return!e||e.jquery?(e||x).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof S?e[0]:e,S.merge(this,S.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:T,!0)),b.test(n[1])&&S.isPlainObject(e))for(n in e)S.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}if((i=T.getElementById(n[2]))&&i.parentNode){if(i.id!==n[2])return x.find(t);this.length=1,this[0]=i}return this.context=T,this.selector=t,this}).prototype=S.fn,x=S(T);var E=/^(?:parents|prev(?:Until|All))/,k={children:!0,contents:!0,next:!0,prev:!0};function M(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}S.extend({dir:function(t,e,n){for(var i=[],r=t[e];r&&9!==r.nodeType&&(void 0===n||1!==r.nodeType||!S(r).is(n));)1===r.nodeType&&i.push(r),r=r[e];return i},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}}),S.fn.extend({has:function(t){var e,n=S(t,this),i=n.length;return this.filter(function(){for(e=0;e<i;e++)if(S.contains(this,n[e]))return!0})},closest:function(t,e){for(var n,i=0,r=this.length,s=[],o=y.test(t)||"string"!=typeof t?S(t,e||this.context):0;i<r;i++)for(n=this[i];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(o?-1<o.index(n):1===n.nodeType&&S.find.matchesSelector(n,t))){s.push(n);break}return this.pushStack(1<s.length?S.unique(s):s)},index:function(t){return t?"string"==typeof t?S.inArray(this[0],S(t)):S.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(S.unique(S.merge(this.get(),S(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),S.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return S.dir(t,"parentNode")},parentsUntil:function(t,e,n){return S.dir(t,"parentNode",n)},next:function(t){return M(t,"nextSibling")},prev:function(t){return M(t,"previousSibling")},nextAll:function(t){return S.dir(t,"nextSibling")},prevAll:function(t){return S.dir(t,"previousSibling")},nextUntil:function(t,e,n){return S.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return S.dir(t,"previousSibling",n)},siblings:function(t){return S.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return S.sibling(t.firstChild)},contents:function(t){return S.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:S.merge([],t.childNodes)}},function(i,r){S.fn[i]=function(t,e){var n=S.map(this,r,t);return"Until"!==i.slice(-5)&&(e=t),e&&"string"==typeof e&&(n=S.filter(e,n)),1<this.length&&(k[i]||(n=S.unique(n)),E.test(i)&&(n=n.reverse())),this.pushStack(n)}});var D,O=/\S+/g,A={};function N(){T.addEventListener?(T.removeEventListener("DOMContentLoaded",j,!1),f.removeEventListener("load",j,!1)):(T.detachEvent("onreadystatechange",j),f.detachEvent("onload",j))}function j(){!T.addEventListener&&"load"!==event.type&&"complete"!==T.readyState||(N(),S.ready())}S.Callbacks=function(r){r="string"==typeof r?A[r]||function(t){var n=A[t]={};return S.each(t.match(O)||[],function(t,e){n[e]=!0}),n}(r):S.extend({},r);var i,e,n,s,o,a,l=[],u=!r.once&&[],c=function(t){for(e=r.memory&&t,n=!0,o=a||0,a=0,s=l.length,i=!0;l&&o<s;o++)if(!1===l[o].apply(t[0],t[1])&&r.stopOnFalse){e=!1;break}i=!1,l&&(u?u.length&&c(u.shift()):e?l=[]:h.disable())},h={add:function(){if(l){var t=l.length;!function i(t){S.each(t,function(t,e){var n=S.type(e);"function"===n?r.unique&&h.has(e)||l.push(e):e&&e.length&&"string"!==n&&i(e)})}(arguments),i?s=l.length:e&&(a=t,c(e))}return this},remove:function(){return l&&S.each(arguments,function(t,e){for(var n;-1<(n=S.inArray(e,l,n));)l.splice(n,1),i&&(n<=s&&s--,n<=o&&o--)}),this},has:function(t){return t?-1<S.inArray(t,l):!(!l||!l.length)},empty:function(){return l=[],s=0,this},disable:function(){return l=u=e=void 0,this},disabled:function(){return!l},lock:function(){return u=void 0,e||h.disable(),this},locked:function(){return!u},fireWith:function(t,e){return!l||n&&!u||(e=[t,(e=e||[]).slice?e.slice():e],i?u.push(e):c(e)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!n}};return h},S.extend({Deferred:function(t){var s=[["resolve","done",S.Callbacks("once memory"),"resolved"],["reject","fail",S.Callbacks("once memory"),"rejected"],["notify","progress",S.Callbacks("memory")]],r="pending",o={state:function(){return r},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var r=arguments;return S.Deferred(function(i){S.each(s,function(t,e){var n=S.isFunction(r[t])&&r[t];a[e[1]](function(){var t=n&&n.apply(this,arguments);t&&S.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[e[0]+"With"](this===o?i.promise():this,n?[t]:arguments)})}),r=null}).promise()},promise:function(t){return null!=t?S.extend(t,o):o}},a={};return o.pipe=o.then,S.each(s,function(t,e){var n=e[2],i=e[3];o[e[1]]=n.add,i&&n.add(function(){r=i},s[1^t][2].disable,s[2][2].lock),a[e[0]]=function(){return a[e[0]+"With"](this===a?o:this,arguments),this},a[e[0]+"With"]=n.fireWith}),o.promise(a),t&&t.call(a,a),a},when:function(t){function e(e,n,i){return function(t){n[e]=this,i[e]=1<arguments.length?c.call(arguments):t,i===r?u.notifyWith(n,i):--l||u.resolveWith(n,i)}}var r,n,i,s=0,o=c.call(arguments),a=o.length,l=1!==a||t&&S.isFunction(t.promise)?a:0,u=1===l?t:S.Deferred();if(1<a)for(r=new Array(a),n=new Array(a),i=new Array(a);s<a;s++)o[s]&&S.isFunction(o[s].promise)?o[s].promise().done(e(s,i,o)).fail(u.reject).progress(e(s,n,r)):--l;return l||u.resolveWith(i,o),u.promise()}}),S.fn.ready=function(t){return S.ready.promise().done(t),this},S.extend({isReady:!1,readyWait:1,holdReady:function(t){t?S.readyWait++:S.ready(!0)},ready:function(t){if(!0===t?!--S.readyWait:!S.isReady){if(!T.body)return setTimeout(S.ready);(S.isReady=!0)!==t&&0<--S.readyWait||(D.resolveWith(T,[S]),S.fn.triggerHandler&&(S(T).triggerHandler("ready"),S(T).off("ready")))}}}),S.ready.promise=function(t){if(!D)if(D=S.Deferred(),"complete"===T.readyState)setTimeout(S.ready);else if(T.addEventListener)T.addEventListener("DOMContentLoaded",j,!1),f.addEventListener("load",j,!1);else{T.attachEvent("onreadystatechange",j),f.attachEvent("onload",j);var n=!1;try{n=null==f.frameElement&&T.documentElement}catch(t){}n&&n.doScroll&&!function e(){if(!S.isReady){try{n.doScroll("left")}catch(t){return setTimeout(e,50)}N(),S.ready()}}()}return D.promise(t)};var R,L="undefined";for(R in S(v))break;v.ownLast="0"!==R,v.inlineBlockNeedsLayout=!1,S(function(){var t,e,n,i;(n=T.getElementsByTagName("body")[0])&&n.style&&(e=T.createElement("div"),(i=T.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(i).appendChild(e),typeof e.style.zoom!==L&&(e.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",v.inlineBlockNeedsLayout=t=3===e.offsetWidth,t&&(n.style.zoom=1)),n.removeChild(i))}),function(){var t=T.createElement("div");if(null==v.deleteExpando){v.deleteExpando=!0;try{delete t.test}catch(t){v.deleteExpando=!1}}t=null}(),S.acceptData=function(t){var e=S.noData[(t.nodeName+" ").toLowerCase()],n=+t.nodeType||1;return(1===n||9===n)&&(!e||!0!==e&&t.getAttribute("classid")===e)};var I=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,P=/([A-Z])/g;function F(t,e,n){if(void 0===n&&1===t.nodeType){var i="data-"+e.replace(P,"-$1").toLowerCase();if("string"==typeof(n=t.getAttribute(i))){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:I.test(n)?S.parseJSON(n):n)}catch(t){}S.data(t,e,n)}else n=void 0}return n}function H(t){var e;for(e in t)if(("data"!==e||!S.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function q(t,e,n,i){if(S.acceptData(t)){var r,s,o=S.expando,a=t.nodeType,l=a?S.cache:t,u=a?t[o]:t[o]&&o;if(u&&l[u]&&(i||l[u].data)||void 0!==n||"string"!=typeof e)return l[u=u||(a?t[o]=h.pop()||S.guid++:o)]||(l[u]=a?{}:{toJSON:S.noop}),"object"!=typeof e&&"function"!=typeof e||(i?l[u]=S.extend(l[u],e):l[u].data=S.extend(l[u].data,e)),s=l[u],i||(s.data||(s.data={}),s=s.data),void 0!==n&&(s[S.camelCase(e)]=n),"string"==typeof e?null==(r=s[e])&&(r=s[S.camelCase(e)]):r=s,r}}function $(t,e,n){if(S.acceptData(t)){var i,r,s=t.nodeType,o=s?S.cache:t,a=s?t[S.expando]:S.expando;if(o[a]){if(e&&(i=n?o[a]:o[a].data)){r=(e=S.isArray(e)?e.concat(S.map(e,S.camelCase)):e in i?[e]:(e=S.camelCase(e))in i?[e]:e.split(" ")).length;for(;r--;)delete i[e[r]];if(n?!H(i):!S.isEmptyObject(i))return}(n||(delete o[a].data,H(o[a])))&&(s?S.cleanData([t],!0):v.deleteExpando||o!=o.window?delete o[a]:o[a]=null)}}}S.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(t){return!!(t=t.nodeType?S.cache[t[S.expando]]:t[S.expando])&&!H(t)},data:function(t,e,n){return q(t,e,n)},removeData:function(t,e){return $(t,e)},_data:function(t,e,n){return q(t,e,n,!0)},_removeData:function(t,e){return $(t,e,!0)}}),S.fn.extend({data:function(t,e){var n,i,r,s=this[0],o=s&&s.attributes;if(void 0!==t)return"object"==typeof t?this.each(function(){S.data(this,t)}):1<arguments.length?this.each(function(){S.data(this,t,e)}):s?F(s,t,S.data(s,t)):void 0;if(this.length&&(r=S.data(s),1===s.nodeType&&!S._data(s,"parsedAttrs"))){for(n=o.length;n--;)o[n]&&0===(i=o[n].name).indexOf("data-")&&F(s,i=S.camelCase(i.slice(5)),r[i]);S._data(s,"parsedAttrs",!0)}return r},removeData:function(t){return this.each(function(){S.removeData(this,t)})}}),S.extend({queue:function(t,e,n){var i;if(t)return e=(e||"fx")+"queue",i=S._data(t,e),n&&(!i||S.isArray(n)?i=S._data(t,e,S.makeArray(n)):i.push(n)),i||[]},dequeue:function(t,e){e=e||"fx";var n=S.queue(t,e),i=n.length,r=n.shift(),s=S._queueHooks(t,e);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===e&&n.unshift("inprogress"),delete s.stop,r.call(t,function(){S.dequeue(t,e)},s)),!i&&s&&s.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return S._data(t,n)||S._data(t,n,{empty:S.Callbacks("once memory").add(function(){S._removeData(t,e+"queue"),S._removeData(t,n)})})}}),S.fn.extend({queue:function(e,n){var t=2;return"string"!=typeof e&&(n=e,e="fx",t--),arguments.length<t?S.queue(this[0],e):void 0===n?this:this.each(function(){var t=S.queue(this,e,n);S._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&S.dequeue(this,e)})},dequeue:function(t){return this.each(function(){S.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){function n(){--r||s.resolveWith(o,[o])}var i,r=1,s=S.Deferred(),o=this,a=this.length;for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)(i=S._data(o[a],t+"queueHooks"))&&i.empty&&(r++,i.empty.add(n));return n(),s.promise(e)}});function U(t,e){return t=e||t,"none"===S.css(t,"display")||!S.contains(t.ownerDocument,t)}var B=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=["Top","Right","Bottom","Left"],z=S.access=function(t,e,n,i,r,s,o){var a=0,l=t.length,u=null==n;if("object"===S.type(n))for(a in r=!0,n)S.access(t,e,a,n[a],!0,s,o);else if(void 0!==i&&(r=!0,S.isFunction(i)||(o=!0),u&&(e=o?(e.call(t,i),null):(u=e,function(t,e,n){return u.call(S(t),n)})),e))for(;a<l;a++)e(t[a],n,o?i:i.call(t[a],a,e(t[a],n)));return r?t:u?e.call(t):l?e(t[0],n):s},W=/^(?:checkbox|radio)$/i;!function(){var t=T.createElement("input"),e=T.createElement("div"),n=T.createDocumentFragment();if(e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",v.leadingWhitespace=3===e.firstChild.nodeType,v.tbody=!e.getElementsByTagName("tbody").length,v.htmlSerialize=!!e.getElementsByTagName("link").length,v.html5Clone="<:nav></:nav>"!==T.createElement("nav").cloneNode(!0).outerHTML,t.type="checkbox",t.checked=!0,n.appendChild(t),v.appendChecked=t.checked,e.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,n.appendChild(e),e.innerHTML="<input type='radio' checked='checked' name='t'/>",v.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,v.noCloneEvent=!0,e.attachEvent&&(e.attachEvent("onclick",function(){v.noCloneEvent=!1}),e.cloneNode(!0).click()),null==v.deleteExpando){v.deleteExpando=!0;try{delete e.test}catch(t){v.deleteExpando=!1}}}(),function(){var t,e,n=T.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})e="on"+t,(v[t+"Bubbles"]=e in f)||(n.setAttribute(e,"t"),v[t+"Bubbles"]=!1===n.attributes[e].expando);n=null}();var J=/^(?:input|select|textarea)$/i,G=/^key/,X=/^(?:mouse|pointer|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,K=/^([^.]*)(?:\.(.+)|)$/;function Q(){return!0}function Z(){return!1}function tt(){try{return T.activeElement}catch(t){}}function et(t){var e=nt.split("|"),n=t.createDocumentFragment();if(n.createElement)for(;e.length;)n.createElement(e.pop());return n}S.event={global:{},add:function(t,e,n,i,r){var s,o,a,l,u,c,h,d,p,f,g,m=S._data(t);if(m){for(n.handler&&(n=(l=n).handler,r=l.selector),n.guid||(n.guid=S.guid++),(o=m.events)||(o=m.events={}),(c=m.handle)||((c=m.handle=function(t){return typeof S===L||t&&S.event.triggered===t.type?void 0:S.event.dispatch.apply(c.elem,arguments)}).elem=t),a=(e=(e||"").match(O)||[""]).length;a--;)p=g=(s=K.exec(e[a])||[])[1],f=(s[2]||"").split(".").sort(),p&&(u=S.event.special[p]||{},p=(r?u.delegateType:u.bindType)||p,u=S.event.special[p]||{},h=S.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&S.expr.match.needsContext.test(r),namespace:f.join(".")},l),(d=o[p])||((d=o[p]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,i,f,c)||(t.addEventListener?t.addEventListener(p,c,!1):t.attachEvent&&t.attachEvent("on"+p,c))),u.add&&(u.add.call(t,h),h.handler.guid||(h.handler.guid=n.guid)),r?d.splice(d.delegateCount++,0,h):d.push(h),S.event.global[p]=!0);t=null}},remove:function(t,e,n,i,r){var s,o,a,l,u,c,h,d,p,f,g,m=S.hasData(t)&&S._data(t);if(m&&(c=m.events)){for(u=(e=(e||"").match(O)||[""]).length;u--;)if(p=g=(a=K.exec(e[u])||[])[1],f=(a[2]||"").split(".").sort(),p){for(h=S.event.special[p]||{},d=c[p=(i?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=s=d.length;s--;)o=d[s],!r&&g!==o.origType||n&&n.guid!==o.guid||a&&!a.test(o.namespace)||i&&i!==o.selector&&("**"!==i||!o.selector)||(d.splice(s,1),o.selector&&d.delegateCount--,h.remove&&h.remove.call(t,o));l&&!d.length&&(h.teardown&&!1!==h.teardown.call(t,f,m.handle)||S.removeEvent(t,p,m.handle),delete c[p])}else for(p in c)S.event.remove(t,p+e[u],n,i,!0);S.isEmptyObject(c)&&(delete m.handle,S._removeData(t,"events"))}},trigger:function(t,e,n,i){var r,s,o,a,l,u,c,h=[n||T],d=m.call(t,"type")?t.type:t,p=m.call(t,"namespace")?t.namespace.split("."):[];if(o=u=n=n||T,3!==n.nodeType&&8!==n.nodeType&&!Y.test(d+S.event.triggered)&&(0<=d.indexOf(".")&&(d=(p=d.split(".")).shift(),p.sort()),s=d.indexOf(":")<0&&"on"+d,(t=t[S.expando]?t:new S.Event(d,"object"==typeof t&&t)).isTrigger=i?2:3,t.namespace=p.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),e=null==e?[t]:S.makeArray(e,[t]),l=S.event.special[d]||{},i||!l.trigger||!1!==l.trigger.apply(n,e))){if(!i&&!l.noBubble&&!S.isWindow(n)){for(a=l.delegateType||d,Y.test(a+d)||(o=o.parentNode);o;o=o.parentNode)h.push(o),u=o;u===(n.ownerDocument||T)&&h.push(u.defaultView||u.parentWindow||f)}for(c=0;(o=h[c++])&&!t.isPropagationStopped();)t.type=1<c?a:l.bindType||d,(r=(S._data(o,"events")||{})[t.type]&&S._data(o,"handle"))&&r.apply(o,e),(r=s&&o[s])&&r.apply&&S.acceptData(o)&&(t.result=r.apply(o,e),!1===t.result&&t.preventDefault());if(t.type=d,!i&&!t.isDefaultPrevented()&&(!l._default||!1===l._default.apply(h.pop(),e))&&S.acceptData(n)&&s&&n[d]&&!S.isWindow(n)){(u=n[s])&&(n[s]=null),S.event.triggered=d;try{n[d]()}catch(t){}S.event.triggered=void 0,u&&(n[s]=u)}return t.result}},dispatch:function(t){t=S.event.fix(t);var e,n,i,r,s,o,a=c.call(arguments),l=(S._data(this,"events")||{})[t.type]||[],u=S.event.special[t.type]||{};if((a[0]=t).delegateTarget=this,!u.preDispatch||!1!==u.preDispatch.call(this,t)){for(o=S.event.handlers.call(this,t,l),e=0;(r=o[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,s=0;(i=r.handlers[s++])&&!t.isImmediatePropagationStopped();)t.namespace_re&&!t.namespace_re.test(i.namespace)||(t.handleObj=i,t.data=i.data,void 0!==(n=((S.event.special[i.origType]||{}).handle||i.handler).apply(r.elem,a))&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,t),t.result}},handlers:function(t,e){var n,i,r,s,o=[],a=e.delegateCount,l=t.target;if(a&&l.nodeType&&(!t.button||"click"!==t.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(!0!==l.disabled||"click"!==t.type)){for(r=[],s=0;s<a;s++)void 0===r[n=(i=e[s]).selector+" "]&&(r[n]=i.needsContext?0<=S(n,this).index(l):S.find(n,this,null,[l]).length),r[n]&&r.push(i);r.length&&o.push({elem:l,handlers:r})}return a<e.length&&o.push({elem:this,handlers:e.slice(a)}),o},fix:function(t){if(t[S.expando])return t;var e,n,i,r=t.type,s=t,o=this.fixHooks[r];for(o||(this.fixHooks[r]=o=X.test(r)?this.mouseHooks:G.test(r)?this.keyHooks:{}),i=o.props?this.props.concat(o.props):this.props,t=new S.Event(s),e=i.length;e--;)t[n=i[e]]=s[n];return t.target||(t.target=s.srcElement||T),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,o.filter?o.filter(t,s):t},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var n,i,r,s=e.button,o=e.fromElement;return null==t.pageX&&null!=e.clientX&&(r=(i=t.target.ownerDocument||T).documentElement,n=i.body,t.pageX=e.clientX+(r&&r.scrollLeft||n&&n.scrollLeft||0)-(r&&r.clientLeft||n&&n.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||n&&n.scrollTop||0)-(r&&r.clientTop||n&&n.clientTop||0)),!t.relatedTarget&&o&&(t.relatedTarget=o===t.target?e.toElement:o),t.which||void 0===s||(t.which=1&s?1:2&s?3:4&s?2:0),t}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==tt()&&this.focus)try{return this.focus(),!1}catch(t){}},delegateType:"focusin"},blur:{trigger:function(){if(this===tt()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(S.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1},_default:function(t){return S.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,n,i){var r=S.extend(new S.Event,n,{type:t,isSimulated:!0,originalEvent:{}});i?S.event.trigger(r,null,e):S.event.dispatch.call(e,r),r.isDefaultPrevented()&&n.preventDefault()}},S.removeEvent=T.removeEventListener?function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)}:function(t,e,n){var i="on"+e;t.detachEvent&&(typeof t[i]===L&&(t[i]=null),t.detachEvent(i,n))},S.Event=function(t,e){if(!(this instanceof S.Event))return new S.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Q:Z):this.type=t,e&&S.extend(this,e),this.timeStamp=t&&t.timeStamp||S.now(),this[S.expando]=!0},S.Event.prototype={isDefaultPrevented:Z,isPropagationStopped:Z,isImmediatePropagationStopped:Z,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Q,t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Q,t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Q,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,r){S.event.special[t]={delegateType:r,bindType:r,handle:function(t){var e,n=t.relatedTarget,i=t.handleObj;return n&&(n===this||S.contains(this,n))||(t.type=i.origType,e=i.handler.apply(this,arguments),t.type=r),e}}}),v.submitBubbles||(S.event.special.submit={setup:function(){if(S.nodeName(this,"form"))return!1;S.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,n=S.nodeName(e,"input")||S.nodeName(e,"button")?e.form:void 0;n&&!S._data(n,"submitBubbles")&&(S.event.add(n,"submit._submit",function(t){t._submit_bubble=!0}),S._data(n,"submitBubbles",!0))})},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&S.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){if(S.nodeName(this,"form"))return!1;S.event.remove(this,"._submit")}}),v.changeBubbles||(S.event.special.change={setup:function(){if(J.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(S.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),S.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),S.event.simulate("change",this,t,!0)})),!1;S.event.add(this,"beforeactivate._change",function(t){var e=t.target;J.test(e.nodeName)&&!S._data(e,"changeBubbles")&&(S.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||S.event.simulate("change",this.parentNode,t,!0)}),S._data(e,"changeBubbles",!0))})},handle:function(t){var e=t.target;if(this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type)return t.handleObj.handler.apply(this,arguments)},teardown:function(){return S.event.remove(this,"._change"),!J.test(this.nodeName)}}),v.focusinBubbles||S.each({focus:"focusin",blur:"focusout"},function(n,i){function r(t){S.event.simulate(i,t.target,S.event.fix(t),!0)}S.event.special[i]={setup:function(){var t=this.ownerDocument||this,e=S._data(t,i);e||t.addEventListener(n,r,!0),S._data(t,i,(e||0)+1)},teardown:function(){var t=this.ownerDocument||this,e=S._data(t,i)-1;e?S._data(t,i,e):(t.removeEventListener(n,r,!0),S._removeData(t,i))}}}),S.fn.extend({on:function(t,e,n,i,r){var s,o;if("object"==typeof t){for(s in"string"!=typeof e&&(n=n||e,e=void 0),t)this.on(s,e,n,t[s],r);return this}if(null==n&&null==i?(i=e,n=e=void 0):null==i&&("string"==typeof e?(i=n,n=void 0):(i=n,n=e,e=void 0)),!1===i)i=Z;else if(!i)return this;return 1===r&&(o=i,(i=function(t){return S().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=S.guid++)),this.each(function(){S.event.add(this,t,i,n,e)})},one:function(t,e,n,i){return this.on(t,e,n,i,1)},off:function(t,e,n){var i,r;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,S(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"!=typeof t)return!1!==e&&"function"!=typeof e||(n=e,e=void 0),!1===n&&(n=Z),this.each(function(){S.event.remove(this,t,n,e)});for(r in t)this.off(r,e,t[r]);return this},trigger:function(t,e){return this.each(function(){S.event.trigger(t,e,this)})},triggerHandler:function(t,e){var n=this[0];if(n)return S.event.trigger(t,e,n,!0)}});var nt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",it=/ jQuery\d+="(?:null|\d+)"/g,rt=new RegExp("<(?:"+nt+")[\\s/>]","i"),st=/^\s+/,ot=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,at=/<([\w:]+)/,lt=/<tbody/i,ut=/<|&#?\w+;/,ct=/<(?:script|style|link)/i,ht=/checked\s*(?:[^=]|=\s*.checked.)/i,dt=/^$|\/(?:java|ecma)script/i,pt=/^true\/(.*)/,ft=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:v.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},mt=et(T).appendChild(T.createElement("div"));function vt(t,e){var n,i,r=0,s=typeof t.getElementsByTagName!==L?t.getElementsByTagName(e||"*"):typeof t.querySelectorAll!==L?t.querySelectorAll(e||"*"):void 0;if(!s)for(s=[],n=t.childNodes||t;null!=(i=n[r]);r++)!e||S.nodeName(i,e)?s.push(i):S.merge(s,vt(i,e));return void 0===e||e&&S.nodeName(t,e)?S.merge([t],s):s}function yt(t){W.test(t.type)&&(t.defaultChecked=t.checked)}function bt(t,e){return S.nodeName(t,"table")&&S.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function wt(t){return t.type=(null!==S.find.attr(t,"type"))+"/"+t.type,t}function _t(t){var e=pt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function xt(t,e){for(var n,i=0;null!=(n=t[i]);i++)S._data(n,"globalEval",!e||S._data(e[i],"globalEval"))}function St(t,e){if(1===e.nodeType&&S.hasData(t)){var n,i,r,s=S._data(t),o=S._data(e,s),a=s.events;if(a)for(n in delete o.handle,o.events={},a)for(i=0,r=a[n].length;i<r;i++)S.event.add(e,n,a[n][i]);o.data&&(o.data=S.extend({},o.data))}}function Tt(t,e){var n,i,r;if(1===e.nodeType){if(n=e.nodeName.toLowerCase(),!v.noCloneEvent&&e[S.expando]){for(i in(r=S._data(e)).events)S.removeEvent(e,i,r.handle);e.removeAttribute(S.expando)}"script"===n&&e.text!==t.text?(wt(e).text=t.text,_t(e)):"object"===n?(e.parentNode&&(e.outerHTML=t.outerHTML),v.html5Clone&&t.innerHTML&&!S.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===n&&W.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===n?e.defaultSelected=e.selected=t.defaultSelected:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue)}}gt.optgroup=gt.option,gt.tbody=gt.tfoot=gt.colgroup=gt.caption=gt.thead,gt.th=gt.td,S.extend({clone:function(t,e,n){var i,r,s,o,a,l=S.contains(t.ownerDocument,t);if(v.html5Clone||S.isXMLDoc(t)||!rt.test("<"+t.nodeName+">")?s=t.cloneNode(!0):(mt.innerHTML=t.outerHTML,mt.removeChild(s=mt.firstChild)),!(v.noCloneEvent&&v.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||S.isXMLDoc(t)))for(i=vt(s),a=vt(t),o=0;null!=(r=a[o]);++o)i[o]&&Tt(r,i[o]);if(e)if(n)for(a=a||vt(t),i=i||vt(s),o=0;null!=(r=a[o]);o++)St(r,i[o]);else St(t,s);return 0<(i=vt(s,"script")).length&&xt(i,!l&&vt(t,"script")),i=a=r=null,s},buildFragment:function(t,e,n,i){for(var r,s,o,a,l,u,c,h=t.length,d=et(e),p=[],f=0;f<h;f++)if((s=t[f])||0===s)if("object"===S.type(s))S.merge(p,s.nodeType?[s]:s);else if(ut.test(s)){for(a=a||d.appendChild(e.createElement("div")),l=(at.exec(s)||["",""])[1].toLowerCase(),c=gt[l]||gt._default,a.innerHTML=c[1]+s.replace(ot,"<$1></$2>")+c[2],r=c[0];r--;)a=a.lastChild;if(!v.leadingWhitespace&&st.test(s)&&p.push(e.createTextNode(st.exec(s)[0])),!v.tbody)for(r=(s="table"!==l||lt.test(s)?"<table>"!==c[1]||lt.test(s)?0:a:a.firstChild)&&s.childNodes.length;r--;)S.nodeName(u=s.childNodes[r],"tbody")&&!u.childNodes.length&&s.removeChild(u);for(S.merge(p,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=d.lastChild}else p.push(e.createTextNode(s));for(a&&d.removeChild(a),v.appendChecked||S.grep(vt(p,"input"),yt),f=0;s=p[f++];)if((!i||-1===S.inArray(s,i))&&(o=S.contains(s.ownerDocument,s),a=vt(d.appendChild(s),"script"),o&&xt(a),n))for(r=0;s=a[r++];)dt.test(s.type||"")&&n.push(s);return a=null,d},cleanData:function(t,e){for(var n,i,r,s,o=0,a=S.expando,l=S.cache,u=v.deleteExpando,c=S.event.special;null!=(n=t[o]);o++)if((e||S.acceptData(n))&&(s=(r=n[a])&&l[r])){if(s.events)for(i in s.events)c[i]?S.event.remove(n,i):S.removeEvent(n,i,s.handle);l[r]&&(delete l[r],u?delete n[a]:typeof n.removeAttribute!==L?n.removeAttribute(a):n[a]=null,h.push(r))}}}),S.fn.extend({text:function(t){return z(this,function(t){return void 0===t?S.text(this):this.empty().append((this[0]&&this[0].ownerDocument||T).createTextNode(t))},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||bt(this,t).appendChild(t)})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=bt(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var n,i=t?S.filter(t,this):this,r=0;null!=(n=i[r]);r++)e||1!==n.nodeType||S.cleanData(vt(n)),n.parentNode&&(e&&S.contains(n.ownerDocument,n)&&xt(vt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++){for(1===t.nodeType&&S.cleanData(vt(t,!1));t.firstChild;)t.removeChild(t.firstChild);t.options&&S.nodeName(t,"select")&&(t.options.length=0)}return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return S.clone(this,t,e)})},html:function(t){return z(this,function(t){var e=this[0]||{},n=0,i=this.length;if(void 0===t)return 1===e.nodeType?e.innerHTML.replace(it,""):void 0;if("string"==typeof t&&!ct.test(t)&&(v.htmlSerialize||!rt.test(t))&&(v.leadingWhitespace||!st.test(t))&&!gt[(at.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(ot,"<$1></$2>");try{for(;n<i;n++)1===(e=this[n]||{}).nodeType&&(S.cleanData(vt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,S.cleanData(vt(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(n,i){n=g.apply([],n);var t,e,r,s,o,a,l=0,u=this.length,c=this,h=u-1,d=n[0],p=S.isFunction(d);if(p||1<u&&"string"==typeof d&&!v.checkClone&&ht.test(d))return this.each(function(t){var e=c.eq(t);p&&(n[0]=d.call(this,t,e.html())),e.domManip(n,i)});if(u&&(t=(a=S.buildFragment(n,this[0].ownerDocument,!1,this)).firstChild,1===a.childNodes.length&&(a=t),t)){for(r=(s=S.map(vt(a,"script"),wt)).length;l<u;l++)e=a,l!==h&&(e=S.clone(e,!0,!0),r&&S.merge(s,vt(e,"script"))),i.call(this[l],e,l);if(r)for(o=s[s.length-1].ownerDocument,S.map(s,_t),l=0;l<r;l++)e=s[l],dt.test(e.type||"")&&!S._data(e,"globalEval")&&S.contains(o,e)&&(e.src?S._evalUrl&&S._evalUrl(e.src):S.globalEval((e.text||e.textContent||e.innerHTML||"").replace(ft,"")));a=t=null}return this}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,o){S.fn[t]=function(t){for(var e,n=0,i=[],r=S(t),s=r.length-1;n<=s;n++)e=n===s?this:this.clone(!0),S(r[n])[o](e),a.apply(i,e.get());return this.pushStack(i)}});var Ct,Et,kt={};function Mt(t,e){var n,i=S(e.createElement(t)).appendTo(e.body),r=f.getDefaultComputedStyle&&(n=f.getDefaultComputedStyle(i[0]))?n.display:S.css(i[0],"display");return i.detach(),r}function Dt(t){var e=T,n=kt[t];return n||("none"!==(n=Mt(t,e))&&n||((e=((Ct=(Ct||S("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement))[0].contentWindow||Ct[0].contentDocument).document).write(),e.close(),n=Mt(t,e),Ct.detach()),kt[t]=n),n}v.shrinkWrapBlocks=function(){return null!=Et?Et:(Et=!1,(e=T.getElementsByTagName("body")[0])&&e.style?(t=T.createElement("div"),(n=T.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",e.appendChild(n).appendChild(t),typeof t.style.zoom!==L&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(T.createElement("div")).style.width="5px",Et=3!==t.offsetWidth),e.removeChild(n),Et):void 0);var t,e,n};var Ot,At,Nt,jt,Rt,Lt,It,Pt,Ft,Ht=/^margin/,qt=new RegExp("^("+B+")(?!px)[a-z%]+$","i"),$t=/^(top|right|bottom|left)$/;function Ut(e,n){return{get:function(){var t=e();if(null!=t){if(!t)return(this.get=n).apply(this,arguments);delete this.get}}}}function Bt(){var t,e,n,i;(e=T.getElementsByTagName("body")[0])&&e.style&&(t=T.createElement("div"),(n=T.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",e.appendChild(n).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",Lt=It=!1,Ft=!0,f.getComputedStyle&&(Lt="1%"!==(f.getComputedStyle(t,null)||{}).top,It="4px"===(f.getComputedStyle(t,null)||{width:"4px"}).width,(i=t.appendChild(T.createElement("div"))).style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",t.style.width="1px",Ft=!parseFloat((f.getComputedStyle(i,null)||{}).marginRight)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(i=t.getElementsByTagName("td"))[0].style.cssText="margin:0;border:0;padding:0;display:none",(Pt=0===i[0].offsetHeight)&&(i[0].style.display="",i[1].style.display="none",Pt=0===i[0].offsetHeight),e.removeChild(n))}f.getComputedStyle?(Ot=function(t){return t.ownerDocument.defaultView.getComputedStyle(t,null)},At=function(t,e,n){var i,r,s,o,a=t.style;return o=(n=n||Ot(t))?n.getPropertyValue(e)||n[e]:void 0,n&&(""!==o||S.contains(t.ownerDocument,t)||(o=S.style(t,e)),qt.test(o)&&Ht.test(e)&&(i=a.width,r=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=n.width,a.width=i,a.minWidth=r,a.maxWidth=s)),void 0===o?o:o+""}):T.documentElement.currentStyle&&(Ot=function(t){return t.currentStyle},At=function(t,e,n){var i,r,s,o,a=t.style;return null==(o=(n=n||Ot(t))?n[e]:void 0)&&a&&a[e]&&(o=a[e]),qt.test(o)&&!$t.test(e)&&(i=a.left,(s=(r=t.runtimeStyle)&&r.left)&&(r.left=t.currentStyle.left),a.left="fontSize"===e?"1em":o,o=a.pixelLeft+"px",a.left=i,s&&(r.left=s)),void 0===o?o:o+""||"auto"}),(Nt=T.createElement("div")).innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",(jt=(Rt=Nt.getElementsByTagName("a")[0])&&Rt.style)&&(jt.cssText="float:left;opacity:.5",v.opacity="0.5"===jt.opacity,v.cssFloat=!!jt.cssFloat,Nt.style.backgroundClip="content-box",Nt.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===Nt.style.backgroundClip,v.boxSizing=""===jt.boxSizing||""===jt.MozBoxSizing||""===jt.WebkitBoxSizing,S.extend(v,{reliableHiddenOffsets:function(){return null==Pt&&Bt(),Pt},boxSizingReliable:function(){return null==It&&Bt(),It},pixelPosition:function(){return null==Lt&&Bt(),Lt},reliableMarginRight:function(){return null==Ft&&Bt(),Ft}})),S.swap=function(t,e,n,i){var r,s,o={};for(s in e)o[s]=t.style[s],t.style[s]=e[s];for(s in r=n.apply(t,i||[]),e)t.style[s]=o[s];return r};var Vt=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(none|table(?!-c[ea]).+)/,Jt=new RegExp("^("+B+")(.*)$","i"),Gt=new RegExp("^([+-])=("+B+")","i"),Xt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:"0",fontWeight:"400"},Kt=["Webkit","O","Moz","ms"];function Qt(t,e){if(e in t)return e;for(var n=e.charAt(0).toUpperCase()+e.slice(1),i=e,r=Kt.length;r--;)if((e=Kt[r]+n)in t)return e;return i}function Zt(t,e){for(var n,i,r,s=[],o=0,a=t.length;o<a;o++)(i=t[o]).style&&(s[o]=S._data(i,"olddisplay"),n=i.style.display,e?(s[o]||"none"!==n||(i.style.display=""),""===i.style.display&&U(i)&&(s[o]=S._data(i,"olddisplay",Dt(i.nodeName)))):(r=U(i),(n&&"none"!==n||!r)&&S._data(i,"olddisplay",r?n:S.css(i,"display"))));for(o=0;o<a;o++)(i=t[o]).style&&(e&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=e?s[o]||"":"none"));return t}function te(t,e,n){var i=Jt.exec(e);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):e}function ee(t,e,n,i,r){for(var s=n===(i?"border":"content")?4:"width"===e?1:0,o=0;s<4;s+=2)"margin"===n&&(o+=S.css(t,n+V[s],!0,r)),i?("content"===n&&(o-=S.css(t,"padding"+V[s],!0,r)),"margin"!==n&&(o-=S.css(t,"border"+V[s]+"Width",!0,r))):(o+=S.css(t,"padding"+V[s],!0,r),"padding"!==n&&(o+=S.css(t,"border"+V[s]+"Width",!0,r)));return o}function ne(t,e,n){var i=!0,r="width"===e?t.offsetWidth:t.offsetHeight,s=Ot(t),o=v.boxSizing&&"border-box"===S.css(t,"boxSizing",!1,s);if(r<=0||null==r){if(((r=At(t,e,s))<0||null==r)&&(r=t.style[e]),qt.test(r))return r;i=o&&(v.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+ee(t,e,n||(o?"border":"content"),i,s)+"px"}function ie(t,e,n,i,r){return new ie.prototype.init(t,e,n,i,r)}S.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=At(t,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:v.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,s,o,a=S.camelCase(e),l=t.style;if(e=S.cssProps[a]||(S.cssProps[a]=Qt(l,a)),o=S.cssHooks[e]||S.cssHooks[a],void 0===n)return o&&"get"in o&&void 0!==(r=o.get(t,!1,i))?r:l[e];if("string"===(s=typeof n)&&(r=Gt.exec(n))&&(n=(r[1]+1)*r[2]+parseFloat(S.css(t,e)),s="number"),null!=n&&n==n&&("number"!==s||S.cssNumber[a]||(n+="px"),v.clearCloneStyle||""!==n||0!==e.indexOf("background")||(l[e]="inherit"),!(o&&"set"in o&&void 0===(n=o.set(t,n,i)))))try{l[e]=n}catch(t){}}},css:function(t,e,n,i){var r,s,o,a=S.camelCase(e);return e=S.cssProps[a]||(S.cssProps[a]=Qt(t.style,a)),(o=S.cssHooks[e]||S.cssHooks[a])&&"get"in o&&(s=o.get(t,!0,n)),void 0===s&&(s=At(t,e,i)),"normal"===s&&e in Yt&&(s=Yt[e]),""===n||n?(r=parseFloat(s),!0===n||S.isNumeric(r)?r||0:s):s}}),S.each(["height","width"],function(t,r){S.cssHooks[r]={get:function(t,e,n){if(e)return Wt.test(S.css(t,"display"))&&0===t.offsetWidth?S.swap(t,Xt,function(){return ne(t,r,n)}):ne(t,r,n)},set:function(t,e,n){var i=n&&Ot(t);return te(0,e,n?ee(t,r,n,v.boxSizing&&"border-box"===S.css(t,"boxSizing",!1,i),i):0)}}}),v.opacity||(S.cssHooks.opacity={get:function(t,e){return zt.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var n=t.style,i=t.currentStyle,r=S.isNumeric(e)?"alpha(opacity="+100*e+")":"",s=i&&i.filter||n.filter||"";((n.zoom=1)<=e||""===e)&&""===S.trim(s.replace(Vt,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===e||i&&!i.filter)||(n.filter=Vt.test(s)?s.replace(Vt,r):s+" "+r)}}),S.cssHooks.marginRight=Ut(v.reliableMarginRight,function(t,e){if(e)return S.swap(t,{display:"inline-block"},At,[t,"marginRight"])}),S.each({margin:"",padding:"",border:"Width"},function(r,s){S.cssHooks[r+s]={expand:function(t){for(var e=0,n={},i="string"==typeof t?t.split(" "):[t];e<4;e++)n[r+V[e]+s]=i[e]||i[e-2]||i[0];return n}},Ht.test(r)||(S.cssHooks[r+s].set=te)}),S.fn.extend({css:function(t,e){return z(this,function(t,e,n){var i,r,s={},o=0;if(S.isArray(e)){for(i=Ot(t),r=e.length;o<r;o++)s[e[o]]=S.css(t,e[o],!1,i);return s}return void 0!==n?S.style(t,e,n):S.css(t,e)},t,e,1<arguments.length)},show:function(){return Zt(this,!0)},hide:function(){return Zt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){U(this)?S(this).show():S(this).hide()})}}),((S.Tween=ie).prototype={constructor:ie,init:function(t,e,n,i,r,s){this.elem=t,this.prop=n,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=s||(S.cssNumber[n]?"":"px")},cur:function(){var t=ie.propHooks[this.prop];return t&&t.get?t.get(this):ie.propHooks._default.get(this)},run:function(t){var e,n=ie.propHooks[this.prop];return this.options.duration?this.pos=e=S.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ie.propHooks._default.set(this),this}}).init.prototype=ie.prototype,(ie.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=S.css(t.elem,t.prop,""))&&"auto"!==e?e:0:t.elem[t.prop]},set:function(t){S.fx.step[t.prop]?S.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[S.cssProps[t.prop]]||S.cssHooks[t.prop])?S.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}}).scrollTop=ie.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},S.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},S.fx=ie.prototype.init,S.fx.step={};var re,se,oe,ae,le,ue,ce,he=/^(?:toggle|show|hide)$/,de=new RegExp("^(?:([+-])=|)("+B+")([a-z%]*)$","i"),pe=/queueHooks$/,fe=[function(e,t,n){var i,r,s,o,a,l,u,c=this,h={},d=e.style,p=e.nodeType&&U(e),f=S._data(e,"fxshow");n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,c.always(function(){c.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})}));1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],u=S.css(e,"display"),"inline"===("none"===u?S._data(e,"olddisplay")||Dt(e.nodeName):u)&&"none"===S.css(e,"float")&&(v.inlineBlockNeedsLayout&&"inline"!==Dt(e.nodeName)?d.zoom=1:d.display="inline-block"));n.overflow&&(d.overflow="hidden",v.shrinkWrapBlocks()||c.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(r=t[i],he.exec(r)){if(delete t[i],s=s||"toggle"===r,r===(p?"hide":"show")){if("show"!==r||!f||void 0===f[i])continue;p=!0}h[i]=f&&f[i]||S.style(e,i)}else u=void 0;if(S.isEmptyObject(h))"inline"===("none"===u?Dt(e.nodeName):u)&&(d.display=u);else for(i in f?"hidden"in f&&(p=f.hidden):f=S._data(e,"fxshow",{}),s&&(f.hidden=!p),p?S(e).show():c.done(function(){S(e).hide()}),c.done(function(){var t;for(t in S._removeData(e,"fxshow"),h)S.style(e,t,h[t])}),h)o=ye(p?f[i]:0,i,c),i in f||(f[i]=o.start,p&&(o.end=o.start,o.start="width"===i||"height"===i?1:0))}],ge={"*":[function(t,e){var n=this.createTween(t,e),i=n.cur(),r=de.exec(e),s=r&&r[3]||(S.cssNumber[t]?"":"px"),o=(S.cssNumber[t]||"px"!==s&&+i)&&de.exec(S.css(n.elem,t)),a=1,l=20;if(o&&o[3]!==s)for(s=s||o[3],r=r||[],o=+i||1;o/=a=a||".5",S.style(n.elem,t,o+s),a!==(a=n.cur()/i)&&1!==a&&--l;);return r&&(o=n.start=+o||+i||0,n.unit=s,n.end=r[1]?o+(r[1]+1)*r[2]:+r[2]),n}]};function me(){return setTimeout(function(){re=void 0}),re=S.now()}function ve(t,e){var n,i={height:t},r=0;for(e=e?1:0;r<4;r+=2-e)i["margin"+(n=V[r])]=i["padding"+n]=t;return e&&(i.opacity=i.width=t),i}function ye(t,e,n){for(var i,r=(ge[e]||[]).concat(ge["*"]),s=0,o=r.length;s<o;s++)if(i=r[s].call(n,e,t))return i}function be(s,t,e){var n,o,i=0,r=fe.length,a=S.Deferred().always(function(){delete l.elem}),l=function(){if(o)return!1;for(var t=re||me(),e=Math.max(0,u.startTime+u.duration-t),n=1-(e/u.duration||0),i=0,r=u.tweens.length;i<r;i++)u.tweens[i].run(n);return a.notifyWith(s,[u,n,e]),n<1&&r?e:(a.resolveWith(s,[u]),!1)},u=a.promise({elem:s,props:S.extend({},t),opts:S.extend(!0,{specialEasing:{}},e),originalProperties:t,originalOptions:e,startTime:re||me(),duration:e.duration,tweens:[],createTween:function(t,e){var n=S.Tween(s,u.opts,t,e,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(n),n},stop:function(t){var e=0,n=t?u.tweens.length:0;if(o)return this;for(o=!0;e<n;e++)u.tweens[e].run(1);return t?a.resolveWith(s,[u,t]):a.rejectWith(s,[u,t]),this}}),c=u.props;for(!function(t,e){var n,i,r,s,o;for(n in t)if(r=e[i=S.camelCase(n)],s=t[n],S.isArray(s)&&(r=s[1],s=t[n]=s[0]),n!==i&&(t[i]=s,delete t[n]),(o=S.cssHooks[i])&&"expand"in o)for(n in s=o.expand(s),delete t[i],s)n in t||(t[n]=s[n],e[n]=r);else e[i]=r}(c,u.opts.specialEasing);i<r;i++)if(n=fe[i].call(u,s,c,u.opts))return n;return S.map(c,ye,u),S.isFunction(u.opts.start)&&u.opts.start.call(s,u),S.fx.timer(S.extend(l,{elem:s,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}S.Animation=S.extend(be,{tweener:function(t,e){for(var n,i=0,r=(t=S.isFunction(t)?(e=t,["*"]):t.split(" ")).length;i<r;i++)n=t[i],ge[n]=ge[n]||[],ge[n].unshift(e)},prefilter:function(t,e){e?fe.unshift(t):fe.push(t)}}),S.speed=function(t,e,n){var i=t&&"object"==typeof t?S.extend({},t):{complete:n||!n&&e||S.isFunction(t)&&t,duration:t,easing:n&&e||e&&!S.isFunction(e)&&e};return i.duration=S.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in S.fx.speeds?S.fx.speeds[i.duration]:S.fx.speeds._default,null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){S.isFunction(i.old)&&i.old.call(this),i.queue&&S.dequeue(this,i.queue)},i},S.fn.extend({fadeTo:function(t,e,n,i){return this.filter(U).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(e,t,n,i){function r(){var t=be(this,S.extend({},e),o);(s||S._data(this,"finish"))&&t.stop(!0)}var s=S.isEmptyObject(e),o=S.speed(t,n,i);return r.finish=r,s||!1===o.queue?this.each(r):this.queue(o.queue,r)},stop:function(r,t,s){function o(t){var e=t.stop;delete t.stop,e(s)}return"string"!=typeof r&&(s=t,t=r,r=void 0),t&&!1!==r&&this.queue(r||"fx",[]),this.each(function(){var t=!0,e=null!=r&&r+"queueHooks",n=S.timers,i=S._data(this);if(e)i[e]&&i[e].stop&&o(i[e]);else for(e in i)i[e]&&i[e].stop&&pe.test(e)&&o(i[e]);for(e=n.length;e--;)n[e].elem!==this||null!=r&&n[e].queue!==r||(n[e].anim.stop(s),t=!1,n.splice(e,1));!t&&s||S.dequeue(this,r)})},finish:function(o){return!1!==o&&(o=o||"fx"),this.each(function(){var t,e=S._data(this),n=e[o+"queue"],i=e[o+"queueHooks"],r=S.timers,s=n?n.length:0;for(e.finish=!0,S.queue(this,o,[]),i&&i.stop&&i.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===o&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<s;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete e.finish})}}),S.each(["toggle","show","hide"],function(t,i){var r=S.fn[i];S.fn[i]=function(t,e,n){return null==t||"boolean"==typeof t?r.apply(this,arguments):this.animate(ve(i,!0),t,e,n)}}),S.each({slideDown:ve("show"),slideUp:ve("hide"),slideToggle:ve("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,i){S.fn[t]=function(t,e,n){return this.animate(i,t,e,n)}}),S.timers=[],S.fx.tick=function(){var t,e=S.timers,n=0;for(re=S.now();n<e.length;n++)(t=e[n])()||e[n]!==t||e.splice(n--,1);e.length||S.fx.stop(),re=void 0},S.fx.timer=function(t){S.timers.push(t),t()?S.fx.start():S.timers.pop()},S.fx.interval=13,S.fx.start=function(){se=se||setInterval(S.fx.tick,S.fx.interval)},S.fx.stop=function(){clearInterval(se),se=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(i,t){return i=S.fx&&S.fx.speeds[i]||i,t=t||"fx",this.queue(t,function(t,e){var n=setTimeout(t,i);e.stop=function(){clearTimeout(n)}})},(ae=T.createElement("div")).setAttribute("className","t"),ae.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ue=ae.getElementsByTagName("a")[0],ce=(le=T.createElement("select")).appendChild(T.createElement("option")),oe=ae.getElementsByTagName("input")[0],ue.style.cssText="top:1px",v.getSetAttribute="t"!==ae.className,v.style=/top/.test(ue.getAttribute("style")),v.hrefNormalized="/a"===ue.getAttribute("href"),v.checkOn=!!oe.value,v.optSelected=ce.selected,v.enctype=!!T.createElement("form").enctype,le.disabled=!0,v.optDisabled=!ce.disabled,(oe=T.createElement("input")).setAttribute("value",""),v.input=""===oe.getAttribute("value"),oe.value="t",oe.setAttribute("type","radio"),v.radioValue="t"===oe.value;var we=/\r/g;S.fn.extend({val:function(n){var i,t,r,e=this[0];return arguments.length?(r=S.isFunction(n),this.each(function(t){var e;1===this.nodeType&&(null==(e=r?n.call(this,t,S(this).val()):n)?e="":"number"==typeof e?e+="":S.isArray(e)&&(e=S.map(e,function(t){return null==t?"":t+""})),(i=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in i&&void 0!==i.set(this,e,"value")||(this.value=e))})):e?(i=S.valHooks[e.type]||S.valHooks[e.nodeName.toLowerCase()])&&"get"in i&&void 0!==(t=i.get(e,"value"))?t:"string"==typeof(t=e.value)?t.replace(we,""):null==t?"":t:void 0}}),S.extend({valHooks:{option:{get:function(t){var e=S.find.attr(t,"value");return null!=e?e:S.trim(S.text(t))}},select:{get:function(t){for(var e,n,i=t.options,r=t.selectedIndex,s="select-one"===t.type||r<0,o=s?null:[],a=s?r+1:i.length,l=r<0?a:s?r:0;l<a;l++)if(((n=i[l]).selected||l===r)&&(v.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!S.nodeName(n.parentNode,"optgroup"))){if(e=S(n).val(),s)return e;o.push(e)}return o},set:function(t,e){for(var n,i,r=t.options,s=S.makeArray(e),o=r.length;o--;)if(i=r[o],0<=S.inArray(S.valHooks.option.get(i),s))try{i.selected=n=!0}catch(t){i.scrollHeight}else i.selected=!1;return n||(t.selectedIndex=-1),r}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(t,e){if(S.isArray(e))return t.checked=0<=S.inArray(S(t).val(),e)}},v.checkOn||(S.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var _e,xe,Se=S.expr.attrHandle,Te=/^(?:checked|selected)$/i,Ce=v.getSetAttribute,Ee=v.input;S.fn.extend({attr:function(t,e){return z(this,S.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){S.removeAttr(this,t)})}}),S.extend({attr:function(t,e,n){var i,r,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return typeof t.getAttribute===L?S.prop(t,e,n):(1===s&&S.isXMLDoc(t)||(e=e.toLowerCase(),i=S.attrHooks[e]||(S.expr.match.bool.test(e)?xe:_e)),void 0===n?i&&"get"in i&&null!==(r=i.get(t,e))?r:null==(r=S.find.attr(t,e))?void 0:r:null!==n?i&&"set"in i&&void 0!==(r=i.set(t,n,e))?r:(t.setAttribute(e,n+""),n):void S.removeAttr(t,e))},removeAttr:function(t,e){var n,i,r=0,s=e&&e.match(O);if(s&&1===t.nodeType)for(;n=s[r++];)i=S.propFix[n]||n,S.expr.match.bool.test(n)?Ee&&Ce||!Te.test(n)?t[i]=!1:t[S.camelCase("default-"+n)]=t[i]=!1:S.attr(t,n,""),t.removeAttribute(Ce?n:i)},attrHooks:{type:{set:function(t,e){if(!v.radioValue&&"radio"===e&&S.nodeName(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}}}),xe={set:function(t,e,n){return!1===e?S.removeAttr(t,n):Ee&&Ce||!Te.test(n)?t.setAttribute(!Ce&&S.propFix[n]||n,n):t[S.camelCase("default-"+n)]=t[n]=!0,n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(t,e){var s=Se[e]||S.find.attr;Se[e]=Ee&&Ce||!Te.test(e)?function(t,e,n){var i,r;return n||(r=Se[e],Se[e]=i,i=null!=s(t,e,n)?e.toLowerCase():null,Se[e]=r),i}:function(t,e,n){if(!n)return t[S.camelCase("default-"+e)]?e.toLowerCase():null}}),Ee&&Ce||(S.attrHooks.value={set:function(t,e,n){if(!S.nodeName(t,"input"))return _e&&_e.set(t,e,n);t.defaultValue=e}}),Ce||(_e={set:function(t,e,n){var i=t.getAttributeNode(n);if(i||t.setAttributeNode(i=t.ownerDocument.createAttribute(n)),i.value=e+="","value"===n||e===t.getAttribute(n))return e}},Se.id=Se.name=Se.coords=function(t,e,n){var i;if(!n)return(i=t.getAttributeNode(e))&&""!==i.value?i.value:null},S.valHooks.button={get:function(t,e){var n=t.getAttributeNode(e);if(n&&n.specified)return n.value},set:_e.set},S.attrHooks.contenteditable={set:function(t,e,n){_e.set(t,""!==e&&e,n)}},S.each(["width","height"],function(t,n){S.attrHooks[n]={set:function(t,e){if(""===e)return t.setAttribute(n,"auto"),e}}})),v.style||(S.attrHooks.style={get:function(t){return t.style.cssText||void 0},set:function(t,e){return t.style.cssText=e+""}});var ke=/^(?:input|select|textarea|button|object)$/i,Me=/^(?:a|area)$/i;S.fn.extend({prop:function(t,e){return z(this,S.prop,t,e,1<arguments.length)},removeProp:function(t){return t=S.propFix[t]||t,this.each(function(){try{this[t]=void 0,delete this[t]}catch(t){}})}}),S.extend({propFix:{for:"htmlFor",class:"className"},prop:function(t,e,n){var i,r,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return(1!==s||!S.isXMLDoc(t))&&(e=S.propFix[e]||e,r=S.propHooks[e]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(t,n,e))?i:t[e]=n:r&&"get"in r&&null!==(i=r.get(t,e))?i:t[e]},propHooks:{tabIndex:{get:function(t){var e=S.find.attr(t,"tabindex");return e?parseInt(e,10):ke.test(t.nodeName)||Me.test(t.nodeName)&&t.href?0:-1}}}}),v.hrefNormalized||S.each(["href","src"],function(t,e){S.propHooks[e]={get:function(t){return t.getAttribute(e,4)}}}),v.optSelected||(S.propHooks.selected={get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),v.enctype||(S.propFix.enctype="encoding");var De=/[\t\r\n\f]/g;S.fn.extend({addClass:function(e){var t,n,i,r,s,o,a=0,l=this.length,u="string"==typeof e&&e;if(S.isFunction(e))return this.each(function(t){S(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(O)||[];a<l;a++)if(i=1===(n=this[a]).nodeType&&(n.className?(" "+n.className+" ").replace(De," "):" ")){for(s=0;r=t[s++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");o=S.trim(i),n.className!==o&&(n.className=o)}return this},removeClass:function(e){var t,n,i,r,s,o,a=0,l=this.length,u=0===arguments.length||"string"==typeof e&&e;if(S.isFunction(e))return this.each(function(t){S(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(O)||[];a<l;a++)if(i=1===(n=this[a]).nodeType&&(n.className?(" "+n.className+" ").replace(De," "):"")){for(s=0;r=t[s++];)for(;0<=i.indexOf(" "+r+" ");)i=i.replace(" "+r+" "," ");o=e?S.trim(i):"",n.className!==o&&(n.className=o)}return this},toggleClass:function(r,e){var s=typeof r;return"boolean"==typeof e&&"string"==s?e?this.addClass(r):this.removeClass(r):S.isFunction(r)?this.each(function(t){S(this).toggleClass(r.call(this,t,this.className,e),e)}):this.each(function(){if("string"==s)for(var t,e=0,n=S(this),i=r.match(O)||[];t=i[e++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else s!==L&&"boolean"!=s||(this.className&&S._data(this,"__className__",this.className),this.className=this.className||!1===r?"":S._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",n=0,i=this.length;n<i;n++)if(1===this[n].nodeType&&0<=(" "+this[n].className+" ").replace(De," ").indexOf(e))return!0;return!1}}),S.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,n){S.fn[n]=function(t,e){return 0<arguments.length?this.on(n,null,t,e):this.trigger(n)}}),S.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)}});var Oe=S.now(),Ae=/\?/,Ne=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;S.parseJSON=function(t){if(f.JSON&&f.JSON.parse)return f.JSON.parse(t+"");var r,s=null,e=S.trim(t+"");return e&&!S.trim(e.replace(Ne,function(t,e,n,i){return r&&e&&(s=0),0===s?t:(r=n||e,s+=!i-!n,"")}))?Function("return "+e)():S.error("Invalid JSON: "+t)},S.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{f.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t))}catch(t){e=void 0}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length||S.error("Invalid XML: "+t),e};var je,Re,Le=/#.*$/,Ie=/([?&])_=[^&]*/,Pe=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Fe=/^(?:GET|HEAD)$/,He=/^\/\//,qe=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,$e={},Ue={},Be="*/".concat("*");try{Re=location.href}catch(t){(Re=T.createElement("a")).href="",Re=Re.href}function Ve(s){return function(t,e){"string"!=typeof t&&(e=t,t="*");var n,i=0,r=t.toLowerCase().match(O)||[];if(S.isFunction(e))for(;n=r[i++];)"+"===n.charAt(0)?(n=n.slice(1)||"*",(s[n]=s[n]||[]).unshift(e)):(s[n]=s[n]||[]).push(e)}}function ze(e,r,s,o){var a={},l=e===Ue;function u(t){var i;return a[t]=!0,S.each(e[t]||[],function(t,e){var n=e(r,s,o);return"string"!=typeof n||l||a[n]?l?!(i=n):void 0:(r.dataTypes.unshift(n),u(n),!1)}),i}return u(r.dataTypes[0])||!a["*"]&&u("*")}function We(t,e){var n,i,r=S.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((r[i]?t:n=n||{})[i]=e[i]);return n&&S.extend(!0,t,n),t}je=qe.exec(Re.toLowerCase())||[],S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Re,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(je[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Be,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":S.parseJSON,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?We(We(t,S.ajaxSettings),e):We(S.ajaxSettings,t)},ajaxPrefilter:Ve($e),ajaxTransport:Ve(Ue),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,i,c,h,d,p,f,r,g=S.ajaxSetup({},e),m=g.context||g,v=g.context&&(m.nodeType||m.jquery)?S(m):S.event,y=S.Deferred(),b=S.Callbacks("once memory"),w=g.statusCode||{},s={},o={},_=0,a="canceled",x={readyState:0,getResponseHeader:function(t){var e;if(2===_){if(!r)for(r={};e=Pe.exec(h);)r[e[1].toLowerCase()]=e[2];e=r[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===_?h:null},setRequestHeader:function(t,e){var n=t.toLowerCase();return _||(t=o[n]=o[n]||t,s[t]=e),this},overrideMimeType:function(t){return _||(g.mimeType=t),this},statusCode:function(t){var e;if(t)if(_<2)for(e in t)w[e]=[w[e],t[e]];else x.always(t[x.status]);return this},abort:function(t){var e=t||a;return f&&f.abort(e),l(0,e),this}};if(y.promise(x).complete=b.add,x.success=x.done,x.error=x.fail,g.url=((t||g.url||Re)+"").replace(Le,"").replace(He,je[1]+"//"),g.type=e.method||e.type||g.method||g.type,g.dataTypes=S.trim(g.dataType||"*").toLowerCase().match(O)||[""],null==g.crossDomain&&(n=qe.exec(g.url.toLowerCase()),g.crossDomain=!(!n||n[1]===je[1]&&n[2]===je[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(je[3]||("http:"===je[1]?"80":"443")))),g.data&&g.processData&&"string"!=typeof g.data&&(g.data=S.param(g.data,g.traditional)),ze($e,g,e,x),2===_)return x;for(i in(p=g.global)&&0==S.active++&&S.event.trigger("ajaxStart"),g.type=g.type.toUpperCase(),g.hasContent=!Fe.test(g.type),c=g.url,g.hasContent||(g.data&&(c=g.url+=(Ae.test(c)?"&":"?")+g.data,delete g.data),!1===g.cache&&(g.url=Ie.test(c)?c.replace(Ie,"$1_="+Oe++):c+(Ae.test(c)?"&":"?")+"_="+Oe++)),g.ifModified&&(S.lastModified[c]&&x.setRequestHeader("If-Modified-Since",S.lastModified[c]),S.etag[c]&&x.setRequestHeader("If-None-Match",S.etag[c])),(g.data&&g.hasContent&&!1!==g.contentType||e.contentType)&&x.setRequestHeader("Content-Type",g.contentType),x.setRequestHeader("Accept",g.dataTypes[0]&&g.accepts[g.dataTypes[0]]?g.accepts[g.dataTypes[0]]+("*"!==g.dataTypes[0]?", "+Be+"; q=0.01":""):g.accepts["*"]),g.headers)x.setRequestHeader(i,g.headers[i]);if(g.beforeSend&&(!1===g.beforeSend.call(m,x,g)||2===_))return x.abort();for(i in a="abort",{success:1,error:1,complete:1})x[i](g[i]);if(f=ze(Ue,g,e,x)){x.readyState=1,p&&v.trigger("ajaxSend",[x,g]),g.async&&0<g.timeout&&(d=setTimeout(function(){x.abort("timeout")},g.timeout));try{_=1,f.send(s,l)}catch(t){if(!(_<2))throw t;l(-1,t)}}else l(-1,"No Transport");function l(t,e,n,i){var r,s,o,a,l,u=e;2!==_&&(_=2,d&&clearTimeout(d),f=void 0,h=i||"",x.readyState=0<t?4:0,r=200<=t&&t<300||304===t,n&&(a=function(t,e,n){for(var i,r,s,o,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(o in a)if(a[o]&&a[o].test(r)){l.unshift(o);break}if(l[0]in n)s=l[0];else{for(o in n){if(!l[0]||t.converters[o+" "+l[0]]){s=o;break}i=i||o}s=s||i}if(s)return s!==l[0]&&l.unshift(s),n[s]}(g,x,n)),a=function(t,e,n,i){var r,s,o,a,l,u={},c=t.dataTypes.slice();if(c[1])for(o in t.converters)u[o.toLowerCase()]=t.converters[o];for(s=c.shift();s;)if(t.responseFields[s]&&(n[t.responseFields[s]]=e),!l&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=c.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(o=u[l+" "+s]||u["* "+s]))for(r in u)if((a=r.split(" "))[1]===s&&(o=u[l+" "+a[0]]||u["* "+a[0]])){!0===o?o=u[r]:!0!==u[r]&&(s=a[0],c.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}(g,a,x,r),r?(g.ifModified&&((l=x.getResponseHeader("Last-Modified"))&&(S.lastModified[c]=l),(l=x.getResponseHeader("etag"))&&(S.etag[c]=l)),204===t||"HEAD"===g.type?u="nocontent":304===t?u="notmodified":(u=a.state,s=a.data,r=!(o=a.error))):(o=u,!t&&u||(u="error",t<0&&(t=0))),x.status=t,x.statusText=(e||u)+"",r?y.resolveWith(m,[s,u,x]):y.rejectWith(m,[x,u,o]),x.statusCode(w),w=void 0,p&&v.trigger(r?"ajaxSuccess":"ajaxError",[x,g,r?s:o]),b.fireWith(m,[x,u]),p&&(v.trigger("ajaxComplete",[x,g]),--S.active||S.event.trigger("ajaxStop")))}return x},getJSON:function(t,e,n){return S.get(t,e,n,"json")},getScript:function(t,e){return S.get(t,void 0,e,"script")}}),S.each(["get","post"],function(t,r){S[r]=function(t,e,n,i){return S.isFunction(e)&&(i=i||n,n=e,e=void 0),S.ajax({url:t,type:r,dataType:i,data:e,success:n})}}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){S.fn[e]=function(t){return this.on(e,t)}}),S._evalUrl=function(t){return S.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},S.fn.extend({wrapAll:function(e){if(S.isFunction(e))return this.each(function(t){S(this).wrapAll(e.call(this,t))});if(this[0]){var t=S(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(n){return S.isFunction(n)?this.each(function(t){S(this).wrapInner(n.call(this,t))}):this.each(function(){var t=S(this),e=t.contents();e.length?e.wrapAll(n):t.append(n)})},wrap:function(e){var n=S.isFunction(e);return this.each(function(t){S(this).wrapAll(n?e.call(this,t):e)})},unwrap:function(){return this.parent().each(function(){S.nodeName(this,"body")||S(this).replaceWith(this.childNodes)}).end()}}),S.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0||!v.reliableHiddenOffsets()&&"none"===(t.style&&t.style.display||S.css(t,"display"))},S.expr.filters.visible=function(t){return!S.expr.filters.hidden(t)};var Je=/%20/g,Ge=/\[\]$/,Xe=/\r?\n/g,Ye=/^(?:submit|button|image|reset|file)$/i,Ke=/^(?:input|select|textarea|keygen)/i;function Qe(n,t,i,r){var e;if(S.isArray(t))S.each(t,function(t,e){i||Ge.test(n)?r(n,e):Qe(n+"["+("object"==typeof e?t:"")+"]",e,i,r)});else if(i||"object"!==S.type(t))r(n,t);else for(e in t)Qe(n+"["+e+"]",t[e],i,r)}S.param=function(t,e){function n(t,e){e=S.isFunction(e)?e():null==e?"":e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)}var i,r=[];if(void 0===e&&(e=S.ajaxSettings&&S.ajaxSettings.traditional),S.isArray(t)||t.jquery&&!S.isPlainObject(t))S.each(t,function(){n(this.name,this.value)});else for(i in t)Qe(i,t[i],e,n);return r.join("&").replace(Je,"+")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=S.prop(this,"elements");return t?S.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!S(this).is(":disabled")&&Ke.test(this.nodeName)&&!Ye.test(t)&&(this.checked||!W.test(t))}).map(function(t,e){var n=S(this).val();return null==n?null:S.isArray(n)?S.map(n,function(t){return{name:e.name,value:t.replace(Xe,"\r\n")}}):{name:e.name,value:n.replace(Xe,"\r\n")}}).get()}}),S.ajaxSettings.xhr=void 0!==f.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&nn()||function(){try{return new f.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}()}:nn;var Ze=0,tn={},en=S.ajaxSettings.xhr();function nn(){try{return new f.XMLHttpRequest}catch(t){}}f.ActiveXObject&&S(f).on("unload",function(){for(var t in tn)tn[t](void 0,!0)}),v.cors=!!en&&"withCredentials"in en,(en=v.ajax=!!en)&&S.ajaxTransport(function(l){var u;if(!l.crossDomain||v.cors)return{send:function(t,s){var e,o=l.xhr(),a=++Ze;if(o.open(l.type,l.url,l.async,l.username,l.password),l.xhrFields)for(e in l.xhrFields)o[e]=l.xhrFields[e];for(e in l.mimeType&&o.overrideMimeType&&o.overrideMimeType(l.mimeType),l.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t)void 0!==t[e]&&o.setRequestHeader(e,t[e]+"");o.send(l.hasContent&&l.data||null),u=function(t,e){var n,i,r;if(u&&(e||4===o.readyState))if(delete tn[a],u=void 0,o.onreadystatechange=S.noop,e)4!==o.readyState&&o.abort();else{r={},n=o.status,"string"==typeof o.responseText&&(r.text=o.responseText);try{i=o.statusText}catch(t){i=""}n||!l.isLocal||l.crossDomain?1223===n&&(n=204):n=r.text?200:404}r&&s(n,i,r,o.getAllResponseHeaders())},l.async?4===o.readyState?setTimeout(u):o.onreadystatechange=tn[a]=u:u()},abort:function(){u&&u(void 0,!0)}}}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return S.globalEval(t),t}}}),S.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),S.ajaxTransport("script",function(e){if(e.crossDomain){var i,r=T.head||S("head")[0]||T.documentElement;return{send:function(t,n){(i=T.createElement("script")).async=!0,e.scriptCharset&&(i.charset=e.scriptCharset),i.src=e.url,i.onload=i.onreadystatechange=function(t,e){!e&&i.readyState&&!/loaded|complete/.test(i.readyState)||(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),i=null,e||n(200,"success"))},r.insertBefore(i,r.firstChild)},abort:function(){i&&i.onload(void 0,!0)}}}});var rn=[],sn=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=rn.pop()||S.expando+"_"+Oe++;return this[t]=!0,t}}),S.ajaxPrefilter("json jsonp",function(t,e,n){var i,r,s,o=!1!==t.jsonp&&(sn.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&sn.test(t.data)&&"data");if(o||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=S.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(sn,"$1"+i):!1!==t.jsonp&&(t.url+=(Ae.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return s||S.error(i+" was not called"),s[0]},t.dataTypes[0]="json",r=f[i],f[i]=function(){s=arguments},n.always(function(){f[i]=r,t[i]&&(t.jsonpCallback=e.jsonpCallback,rn.push(i)),s&&S.isFunction(r)&&r(s[0]),s=r=void 0}),"script"}),S.parseHTML=function(t,e,n){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(n=e,e=!1),e=e||T;var i=b.exec(t),r=!n&&[];return i?[e.createElement(i[1])]:(i=S.buildFragment([t],e,r),r&&r.length&&S(r).remove(),S.merge([],i.childNodes))};var on=S.fn.load;S.fn.load=function(t,e,n){if("string"!=typeof t&&on)return on.apply(this,arguments);var i,r,s,o=this,a=t.indexOf(" ");return 0<=a&&(i=S.trim(t.slice(a,t.length)),t=t.slice(0,a)),S.isFunction(e)?(n=e,e=void 0):e&&"object"==typeof e&&(s="POST"),0<o.length&&S.ajax({url:t,type:s,dataType:"html",data:e}).done(function(t){r=arguments,o.html(i?S("<div>").append(S.parseHTML(t)).find(i):t)}).complete(n&&function(t,e){o.each(n,r||[t.responseText,e,t])}),this},S.expr.filters.animated=function(e){return S.grep(S.timers,function(t){return e===t.elem}).length};var an=f.document.documentElement;function ln(t){return S.isWindow(t)?t:9===t.nodeType&&(t.defaultView||t.parentWindow)}S.offset={setOffset:function(t,e,n){var i,r,s,o,a,l,u=S.css(t,"position"),c=S(t),h={};"static"===u&&(t.style.position="relative"),a=c.offset(),s=S.css(t,"top"),l=S.css(t,"left"),r=("absolute"===u||"fixed"===u)&&-1<S.inArray("auto",[s,l])?(o=(i=c.position()).top,i.left):(o=parseFloat(s)||0,parseFloat(l)||0),S.isFunction(e)&&(e=e.call(t,n,a)),null!=e.top&&(h.top=e.top-a.top+o),null!=e.left&&(h.left=e.left-a.left+r),"using"in e?e.using.call(t,h):c.css(h)}},S.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){S.offset.setOffset(this,e,t)});var t,n,i={top:0,left:0},r=this[0],s=r&&r.ownerDocument;return s?(t=s.documentElement,S.contains(t,r)?(typeof r.getBoundingClientRect!==L&&(i=r.getBoundingClientRect()),n=ln(s),{top:i.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:i.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):i):void 0},position:function(){if(this[0]){var t,e,n={top:0,left:0},i=this[0];return"fixed"===S.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),S.nodeName(t[0],"html")||(n=t.offset()),n.top+=S.css(t[0],"borderTopWidth",!0),n.left+=S.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-S.css(i,"marginTop",!0),left:e.left-n.left-S.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||an;t&&!S.nodeName(t,"html")&&"static"===S.css(t,"position");)t=t.offsetParent;return t||an})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,r){var s=/Y/.test(r);S.fn[e]=function(t){return z(this,function(t,e,n){var i=ln(t);if(void 0===n)return i?r in i?i[r]:i.document.documentElement[e]:t[e];i?i.scrollTo(s?S(i).scrollLeft():n,s?n:S(i).scrollTop()):t[e]=n},e,t,arguments.length,null)}}),S.each(["top","left"],function(t,n){S.cssHooks[n]=Ut(v.pixelPosition,function(t,e){if(e)return e=At(t,n),qt.test(e)?S(t).position()[n]+"px":e})}),S.each({Height:"height",Width:"width"},function(s,o){S.each({padding:"inner"+s,content:o,"":"outer"+s},function(i,t){S.fn[t]=function(t,e){var n=arguments.length&&(i||"boolean"!=typeof t),r=i||(!0===t||!0===e?"margin":"border");return z(this,function(t,e,n){var i;return S.isWindow(t)?t.document.documentElement["client"+s]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+s],i["scroll"+s],t.body["offset"+s],i["offset"+s],i["client"+s])):void 0===n?S.css(t,e,r):S.style(t,e,n,r)},o,n?t:void 0,n,null)}})}),S.fn.size=function(){return this.length},S.fn.andSelf=S.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var un=f.jQuery,cn=f.$;return S.noConflict=function(t){return f.$===S&&(f.$=cn),t&&f.jQuery===S&&(f.jQuery=un),S},typeof t===L&&(f.jQuery=f.$=S),S}),function(){var Xn,t,e,Yn="3.0.0",Kn=1,Qn=2,Zn=4,ti=8,ei=16,ni=32,ii=64,ri=128,si=256,oi=30,ai="...",li=150,ui=16,ci=0,hi=1,di=2,pi="Expected a function",fi="__lodash_placeholder__",gi="[object Arguments]",mi="[object Array]",vi="[object Boolean]",yi="[object Date]",bi="[object Error]",wi="[object Function]",n="[object Map]",_i="[object Number]",xi="[object Object]",Si="[object RegExp]",i="[object Set]",Ti="[object String]",r="[object WeakMap]",Ci="[object ArrayBuffer]",Ei="[object Float32Array]",ki="[object Float64Array]",Mi="[object Int8Array]",Di="[object Int16Array]",Oi="[object Int32Array]",Ai="[object Uint8Array]",Ni="[object Uint8ClampedArray]",ji="[object Uint16Array]",Ri="[object Uint32Array]",Li=/\b__p \+= '';/g,Ii=/\b(__p \+=) '' \+/g,Pi=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Fi=/&(?:amp|lt|gt|quot|#39|#96);/g,Hi=/[&<>"'`]/g,qi=RegExp(Fi.source),$i=RegExp(Hi.source),Ui=/<%-([\s\S]+?)%>/g,Bi=/<%([\s\S]+?)%>/g,Vi=/<%=([\s\S]+?)%>/g,zi=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Wi=/\w*$/,Ji=/^\s*function[ \n\r\t]+\w/,Gi=/^0[xX]/,Xi=/^\[object .+?Constructor\]$/,Yi=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ki=/($^)/,Qi=/[.*+?^${}()|[\]\/\\]/g,Zi=RegExp(Qi.source),tr=/\bthis\b/,er=/['\n\r\u2028\u2029\\]/g,nr=(t="[A-Z\\xc0-\\xd6\\xd8-\\xde]",e="[a-z\\xdf-\\xf6\\xf8-\\xff]+",RegExp(t+"{2,}(?="+t+e+")|"+t+"?"+e+"|"+t+"+|[0-9]+","g")),ir=" \t\v\f \ufeff\n\r\u2028\u2029 ᠎             　",rr=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"],sr=-1,or={};or[Ei]=or[ki]=or[Mi]=or[Di]=or[Oi]=or[Ai]=or[Ni]=or[ji]=or[Ri]=!0,or[gi]=or[mi]=or[Ci]=or[vi]=or[yi]=or[bi]=or[wi]=or[n]=or[_i]=or[xi]=or[Si]=or[i]=or[Ti]=or[r]=!1;var ar={};ar[gi]=ar[mi]=ar[Ci]=ar[vi]=ar[yi]=ar[Ei]=ar[ki]=ar[Mi]=ar[Di]=ar[Oi]=ar[_i]=ar[xi]=ar[Si]=ar[Ti]=ar[Ai]=ar[Ni]=ar[ji]=ar[Ri]=!0,ar[bi]=ar[wi]=ar[n]=ar[i]=ar[r]=!1;var lr={leading:!1,maxWait:0,trailing:!1},s={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},a={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},l={function:!0,object:!0},u={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ur=l[typeof window]&&window!==(this&&this.window)?window:this,c=l[typeof exports]&&exports&&!exports.nodeType&&exports,h=l[typeof module]&&module&&!module.nodeType&&module,d=c&&h&&"object"==typeof global&&global;!d||d.global!==d&&d.window!==d&&d.self!==d||(ur=d);var p=h&&h.exports===c&&c;function cr(t,e){if(t!==e){var n=t==t,i=e==e;if(e<t||!n||void 0===t&&i)return 1;if(t<e||!i||void 0===e&&n)return-1}return 0}function hr(t,e,n){if(e!=e)return xr(t,n);for(var i=(n||0)-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}function dr(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function pr(t){return"string"==typeof t?t:null==t?"":t+""}function fr(t){return t.charCodeAt(0)}function gr(t,e){for(var n=-1,i=t.length;++n<i&&-1<e.indexOf(t.charAt(n)););return n}function mr(t,e){for(var n=t.length;n--&&-1<e.indexOf(t.charAt(n)););return n}function vr(t,e){return cr(t.criteria,e.criteria)||t.index-e.index}function yr(t,e){for(var n=-1,i=t.criteria,r=e.criteria,s=i.length;++n<s;){var o=cr(i[n],r[n]);if(o)return o}return t.index-e.index}function br(t){return s[t]}function wr(t){return o[t]}function _r(t){return"\\"+u[t]}function xr(t,e,n){for(var i=t.length,r=n?e||i:(e||0)-1;n?r--:++r<i;){var s=t[r];if(s!=s)return r}return-1}function Sr(t){return t&&"object"==typeof t||!1}function f(t){return t<=160&&9<=t&&t<=13||32==t||160==t||5760==t||6158==t||8192<=t&&(t<=8202||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}function Tr(t,e){for(var n=-1,i=t.length,r=-1,s=[];++n<i;)t[n]===e&&(t[n]=fi,s[++r]=n);return s}function Cr(t){for(var e=-1,n=t.length;++e<n&&f(t.charCodeAt(e)););return e}function Er(t){for(var e=t.length;e--&&f(t.charCodeAt(e)););return e}function kr(t){return a[t]}var Mr=function e(n){var M=(n=n?Mr.defaults(ur.Object(),n,Mr.pick(ur,rr)):ur).Array,t=n.Date,i=n.Error,m=n.Function,r=n.Math,s=n.Number,d=n.Object,v=n.RegExp,o=n.String,y=n.TypeError,a=M.prototype,l=d.prototype,u=(u=n.window)&&u.document,c=m.prototype.toString,h=Bt("length"),b=l.hasOwnProperty,p=0,w=l.toString,f=n._,g=v("^"+jn(w).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_=yn(_=n.ArrayBuffer)&&_,x=yn(x=_&&new _(0).slice)&&x,S=r.ceil,T=n.clearTimeout,C=r.floor,E=yn(E=d.getPrototypeOf)&&E,k=a.push,D=l.propertyIsEnumerable,O=yn(O=n.Set)&&O,A=n.setTimeout,N=a.splice,j=yn(j=n.Uint8Array)&&j,R=(a.unshift,yn(R=n.WeakMap)&&R),L=function(){try{var t=yn(t=n.Float64Array)&&t,e=new t(new _(10),0,1)&&t}catch(t){}return e}(),I=yn(I=M.isArray)&&I,P=yn(P=d.create)&&P,F=n.isFinite,H=yn(H=d.keys)&&H,q=r.max,$=r.min,U=yn(U=t.now)&&U,B=yn(B=s.isFinite)&&B,V=n.parseInt,z=r.random,W=s.NEGATIVE_INFINITY,J=s.POSITIVE_INFINITY,G=r.pow(2,32)-1,X=G-1,Y=G>>>1,K=L?L.BYTES_PER_ELEMENT:0,Q=r.pow(2,53)-1,Z=R&&new R;function tt(t){if(Sr(t)&&!dn(t)){if(t instanceof et)return t;if(b.call(t,"__wrapped__"))return new et(t.__wrapped__,t.__chain__,at(t.__actions__))}return new et(t)}function et(t,e,n){this.__actions__=n||[],this.__chain__=!!e,this.__wrapped__=t}var nt=tt.support={};function it(t){this.actions=null,this.dir=1,this.dropCount=0,this.filtered=!1,this.iteratees=null,this.takeCount=J,this.views=null,this.wrapped=t}function rt(){this.__data__={}}function st(t){var e=t?t.length:0;for(this.data={hash:P(null),set:new O};e--;)this.push(t[e])}function ot(t,e){var n=t.data;return("string"==typeof e||vn(e)?n.set.has(e):n.hash[e])?0:-1}function at(t,e){var n=-1,i=t.length;for(e=e||M(i);++n<i;)e[n]=t[n];return e}function lt(t,e){for(var n=-1,i=t.length;++n<i&&!1!==e(t[n],n,t););return t}function ut(t,e){for(var n=-1,i=t.length;++n<i;)if(!e(t[n],n,t))return!1;return!0}function ct(t,e){for(var n=-1,i=t.length,r=-1,s=[];++n<i;){var o=t[n];e(o,n,t)&&(s[++r]=o)}return s}function ht(t,e){for(var n=-1,i=t.length,r=M(i);++n<i;)r[n]=e(t[n],n,t);return r}function dt(t){for(var e=-1,n=t.length,i=W;++e<n;){var r=t[e];i<r&&(i=r)}return i}function pt(t,e,n,i){var r=-1,s=t.length;for(i&&s&&(n=t[++r]);++r<s;)n=e(n,t[r],r,t);return n}function ft(t,e,n,i){var r=t.length;for(i&&r&&(n=t[--r]);r--;)n=e(n,t[r],r,t);return n}function gt(t,e){for(var n=-1,i=t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}function mt(t,e){return void 0===t?e:t}function vt(t,e,n,i){return void 0!==t&&b.call(i,n)?t:e}function yt(t,e,n){var i=kn(e);if(!n)return wt(e,t,i);for(var r=-1,s=i.length;++r<s;){var o=i[r],a=t[o],l=n(a,e[o],o,t,e);(l==l?l===a:a!=a)&&(void 0!==a||o in t)||(t[o]=l)}return t}function bt(t,e){for(var n=-1,i=t.length,r=be(i),s=e.length,o=M(s);++n<s;){var a=e[n];r?(a=parseFloat(a),o[n]=ve(a,i)?t[a]:Xn):o[n]=t[a]}return o}function wt(t,e,n){n||(n=e,e={});for(var i=-1,r=n.length;++i<r;){var s=n[i];e[s]=t[s]}return e}function _t(t,e,n){var i=typeof t;return"function"==i?void 0!==e&&function(t){var e=tt.support,n=!(e.funcNames?t.name:e.funcDecomp);if(!n){var i=c.call(t);e.funcNames||(n=!Ji.test(i)),n||(n=tr.test(i)||yn(t),Wt(t,n))}return n}(t)?te(t,e,n):t:null==t?Vn:"object"==i?Ut(t,!n):Bt(n?pr(t):t)}function xt(n,i,r,t,e,s,o){var a;if(r&&(a=e?r(n,t,e):r(n)),void 0!==a)return a;if(!vn(n))return n;var l=dn(n);if(l){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&b.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(n),!i)return at(n,a)}else{var u=w.call(n),c=u==wi;if(u!=xi&&u!=gi&&(!c||e))return ar[u]?function(t,e,n){var i=t.constructor;switch(e){case Ci:return ee(t);case vi:case yi:return new i(+t);case Ei:case ki:case Mi:case Di:case Oi:case Ai:case Ni:case ji:case Ri:var r=t.buffer;return new i(n?ee(r):r,t.byteOffset,t.length);case _i:case Ti:return new i(t);case Si:var s=new i(t.source,Wi.exec(t));s.lastIndex=t.lastIndex}return s}(n,u,i):e?n:{};if(a=function(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=d),new e}(c?{}:n),!i)return wt(n,a,kn(n))}o=o||[];for(var h=(s=s||[]).length;h--;)if(s[h]==n)return o[h];return s.push(n),o.push(a),(l?lt:It)(n,function(t,e){a[e]=xt(t,i,r,e,n,s,o)}),a}!function(t){nt.funcDecomp=!yn(n.WinRTError)&&tr.test(e),nt.funcNames="string"==typeof m.name;try{nt.dom=11===u.createDocumentFragment().nodeType}catch(t){nt.dom=!1}try{nt.nonEnumArgs=!D.call(arguments,1)}catch(t){nt.nonEnumArgs=!0}}(0,0),tt.templateSettings={escape:Ui,evaluate:Bi,interpolate:Vi,variable:"",imports:{_:tt}};var St=function(t){if(vn(t)){Tt.prototype=t;var e=new Tt;Tt.prototype=null}return e||n.Object()};function Tt(){}function Ct(t,e,n,i){if(!mn(t))throw new y(pi);return A(function(){t.apply(Xn,Jt(n,i))},e)}function Et(t,e){var n=t?t.length:0,i=[];if(!n)return i;var r=-1,s=me(),o=s==hr,a=o&&200<=e.length&&oe(e),l=e.length;a&&(s=ot,o=!1,e=a);t:for(;++r<n;){var u=t[r];if(o&&u==u){for(var c=l;c--;)if(e[c]===u)continue t;i.push(u)}else s(e,u)<0&&i.push(u)}return i}function kt(t,e){var n=t?t.length:0;if(!be(n))return It(t,e);for(var i=-1,r=De(t);++i<n&&!1!==e(r[i],i,r););return t}function Mt(t,e){var n=t?t.length:0;if(!be(n))return Pt(t,e);for(var i=De(t);n--&&!1!==e(i[n],n,i););return t}function Dt(t,i){var r=!0;return kt(t,function(t,e,n){return r=!!i(t,e,n)}),r}function Ot(t,i){var r=[];return kt(t,function(t,e,n){i(t,e,n)&&r.push(t)}),r}function At(t,i,e,r){var s;return e(t,function(t,e,n){if(i(t,e,n))return s=r?e:t,!1}),s}function Nt(t,e,n,i){for(var r=(i||0)-1,s=t.length,o=-1,a=[];++r<s;){var l=t[r];if(Sr(l)&&be(l.length)&&(dn(l)||hn(l))){e&&(l=Nt(l,e,n));var u=-1,c=l.length;for(a.length+=c;++u<c;)a[++o]=l[u]}else n||(a[++o]=l)}return a}function jt(t,e,n){for(var i=-1,r=De(t),s=n(t),o=s.length;++i<o;){var a=s[i];if(!1===e(r[a],a,r))break}return t}function Rt(t,e,n){for(var i=De(t),r=n(t),s=r.length;s--;){var o=r[s];if(!1===e(i[o],o,i))break}return t}function Lt(t,e){return jt(t,e,Mn)}function It(t,e){return jt(t,e,kn)}function Pt(t,e){return Rt(t,e,kn)}function Ft(t,e){for(var n=-1,i=e.length,r=-1,s=[];++n<i;){var o=e[n];mn(t[o])&&(s[++r]=o)}return s}function Ht(t,e,n,i,r,s){if(t===e)return 0!==t||1/t==1/e;var o=typeof t,a=typeof e;return"function"!=o&&"object"!=o&&"function"!=a&&"object"!=a||null==t||null==e?t!=t&&e!=e:function(t,e,n,i,r,s,o){var a=dn(t),l=dn(e),u=mi,c=mi;a||((u=w.call(t))==gi?u=xi:u!=xi&&(a=Sn(t))),l||((c=w.call(e))==gi?c=xi:c!=xi&&(l=Sn(e)));var h=u==xi,d=c==xi,p=u==c;if(p&&!a&&!h)return function(t,e,n){switch(n){case vi:case yi:return+t==+e;case bi:return t.name==e.name&&t.message==e.message;case _i:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case Si:case Ti:return t==pr(e)}return!1}(t,e,u);var f=h&&b.call(t,"__wrapped__"),g=d&&b.call(e,"__wrapped__");if(f||g)return n(f?t.value():t,g?e.value():e,i,r,s,o);if(!p)return!1;o=o||[];for(var m=(s=s||[]).length;m--;)if(s[m]==t)return o[m]==e;s.push(t),o.push(e);var v=(a?function(t,e,n,i,r,s,o){var a=-1,l=t.length,u=e.length,c=!0;if(l!=u&&!(r&&l<u))return!1;for(;c&&++a<l;){var h=t[a],d=e[a];if(c=Xn,i&&(c=r?i(d,h,a):i(h,d,a)),void 0===c)if(r)for(var p=u;p--&&(d=e[p],!(c=h&&h===d||n(h,d,i,r,s,o))););else c=h&&h===d||n(h,d,i,r,s,o)}return!!c}:function(t,e,n,i,r,s,o){var a=kn(t),l=a.length,u=kn(e).length;if(l!=u&&!r)return!1;for(var c,h=-1;++h<l;){var d=a[h],p=b.call(e,d);if(p){var f=t[d],g=e[d];p=Xn,i&&(p=r?i(g,f,d):i(f,g,d)),void 0===p&&(p=f&&f===g||n(f,g,i,r,s,o))}if(!p)return!1;c=c||"constructor"==d}if(!c){var m=t.constructor,v=e.constructor;if(m!=v&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof v&&v instanceof v))return!1}return!0})(t,e,n,i,r,s,o);return s.pop(),o.pop(),v}(t,e,Ht,n,i,r,s)}function qt(t,e,n,i,r){var s=e.length;if(null==t)return!s;for(var o=-1,a=!r;++o<s;)if(a&&i[o]?n[o]!==t[e[o]]:!b.call(t,e[o]))return!1;for(o=-1;++o<s;){var l=e[o];if(a&&i[o])var u=b.call(t,l);else{var c=t[l],h=n[o];void 0===(u=r?r(c,h,l):Xn)&&(u=Ht(h,c,r,!0))}if(!u)return!1}return!0}function $t(t,i){var r=[];return kt(t,function(t,e,n){r.push(i(t,e,n))}),r}function Ut(t,e){var n=kn(t),i=n.length;if(1==i){var r=n[0],s=t[r];if(we(s))return function(t){return null!=t&&s===t[r]&&b.call(t,r)}}e&&(t=xt(t,!0));for(var o=M(i),a=M(i);i--;)s=t[n[i]],o[i]=s,a[i]=we(s);return function(t){return qt(t,n,o,a)}}function Bt(e){return function(t){return null==t?Xn:t[e]}}function Vt(t,e){return t+C(z()*(e-t+1))}function zt(t,i,r,s,e){return e(t,function(t,e,n){r=s?(s=!1,t):i(r,t,e,n)}),r}var Wt=Z?function(t,e){return Z.set(t,e),t}:Vn;function Jt(t,e,n){var i=-1,r=t.length;(e=null==e?0:+e||0)<0&&(e=r<-e?0:r+e),(n=void 0===n||r<n?r:+n||0)<0&&(n+=r);for(var s=M(r=n<e?0:n-e);++i<r;)s[i]=t[i+e];return s}function Gt(t,i){var r;return kt(t,function(t,e,n){return!(r=i(t,e,n))}),!!r}function Xt(t,e){var n=-1,i=me(),r=t.length,s=i==hr,o=s&&200<=r,a=o&&oe(),l=[];a?(i=ot,s=!1):(o=!1,a=e?[]:l);t:for(;++n<r;){var u=t[n],c=e?e(u,n,t):u;if(s&&u==u){for(var h=a.length;h--;)if(a[h]===c)continue t;e&&a.push(c),l.push(u)}else i(a,c)<0&&((e||o)&&a.push(c),l.push(u))}return l}function Yt(t,e){for(var n=-1,i=e.length,r=M(i);++n<i;)r[n]=t[e[n]];return r}function Kt(t,e){var n=t;n instanceof it&&(n=n.value());for(var i=-1,r=e.length;++i<r;){var s=[n],o=e[i];k.apply(s,o.args),n=o.func.apply(o.thisArg,s)}return n}function Qt(t,e,n){var i=0,r=t?t.length:i;if("number"==typeof e&&e==e&&r<=Y){for(;i<r;){var s=i+r>>>1,o=t[s];(n?o<=e:o<e)?i=1+s:r=s}return r}return Zt(t,e,Vn,n)}function Zt(t,e,n,i){e=n(e);for(var r=0,s=t?t.length:0,o=e!=e,a=void 0===e;r<s;){var l=C((r+s)/2),u=n(t[l]),c=u==u;if(o)var h=c||i;else h=a?c&&(i||void 0!==u):i?u<=e:u<e;h?r=l+1:s=l}return $(s,X)}function te(s,o,t){if("function"!=typeof s)return Vn;if(void 0===o)return s;switch(t){case 1:return function(t){return s.call(o,t)};case 3:return function(t,e,n){return s.call(o,t,e,n)};case 4:return function(t,e,n,i){return s.call(o,t,e,n,i)};case 5:return function(t,e,n,i,r){return s.call(o,t,e,n,i,r)}}return function(){return s.apply(o,arguments)}}function ee(t){return x.call(t,0)}function ne(t,e,n){for(var i=n.length,r=-1,s=q(t.length-i,0),o=-1,a=e.length,l=M(s+a);++o<a;)l[o]=e[o];for(;++r<i;)l[n[r]]=t[r];for(;s--;)l[o++]=t[r++];return l}function ie(t,e,n){for(var i=-1,r=n.length,s=-1,o=q(t.length-r,0),a=-1,l=e.length,u=M(o+l);++s<o;)u[s]=t[s];for(var c=s;++a<l;)u[c+a]=e[a];for(;++i<r;)u[c+n[i]]=t[s++];return u}function re(a,l){return function(t,i,e){var r=l?l():{};if(i=fe(i,e,3),dn(t))for(var n=-1,s=t.length;++n<s;){var o=t[n];a(r,o,i(o,n,t),t)}else kt(t,function(t,e,n){a(r,t,i(t,e,n),n)});return r}}function se(s){return function(){var t=arguments.length,e=arguments[0];if(t<2||null==e)return e;if(3<t&&ye(arguments[1],arguments[2],arguments[3])&&(t=2),3<t&&"function"==typeof arguments[t-2])var n=te(arguments[--t-1],arguments[t--],5);else 2<t&&"function"==typeof arguments[t-1]&&(n=arguments[--t]);for(var i=0;++i<t;){var r=arguments[i];r&&s(e,r,n)}return e}}x||(ee=_&&j?function(t){var e=t.byteLength,n=L?C(e/K):0,i=n*K,r=new _(e);if(n){var s=new L(r,0,n);s.set(new L(t,0,n))}return e!=i&&(s=new j(r,i)).set(new j(t,i)),r}:Bn(null));var oe=P&&O?function(t){return new st(t)}:Bn(null);function ae(s){return function(t){for(var e=-1,n=qn(Nn(t)),i=n.length,r="";++e<i;)r=s(r,n[e],e);return r}}function le(n){return function(){var t=St(n.prototype),e=n.apply(t,arguments);return vn(e)?e:t}}function ue(o,a){return function(t,e,n){n&&ye(t,e,n)&&(e=null);var i=fe(),r=null==e;if(i===_t&&r||(r=!1,e=i(e,n,3)),r){var s=dn(t);if(s||!xn(t))return o(s?t:Me(t));e=fr}return function(t,r,s){var o=s?J:W,a=o,l=a;return kt(t,function(t,e,n){var i=r(t,e,n);((s?i<a:a<i)||i===o&&i===l)&&(a=i,l=t)}),l}(t,e,a)}}function ce(c,h,d,p,f,g,m,v,y,b){var w=h&si,_=h&Kn,x=h&Qn,S=h&ti,T=h&Zn,C=h&ei,E=!x&&le(c),k=c;return function t(){for(var e=arguments.length,n=e,i=M(e);n--;)i[n]=arguments[n];if(p&&(i=ne(i,p,f)),g&&(i=ie(i,g,m)),S||C){var r=t.placeholder,s=Tr(i,r);if((e-=s.length)<b){var o=v?at(v):null,a=q(b-e,0);h|=S?ni:ii,h&=~(S?ii:ni),T||(h&=~(Kn|Qn));var l=ce(c,h,d,S?i:null,S?s:null,S?null:i,S?null:s,o,y,a);return l.placeholder=r,l}}var u=_?d:this;return x&&(c=u[k]),v&&(i=function(t,e){for(var n=t.length,i=$(e.length,n),r=at(t);i--;){var s=e[i];t[i]=ve(s,n)?r[s]:Xn}return t}(i,v)),w&&y<i.length&&(i.length=y),(this instanceof t?E||le(c):c).apply(u,i)}}function he(t,e,n){var i=t.length;if((e=+e)<=i||!F(e))return"";var r=e-i;return In(n=null==n?" ":pr(n),S(r/n.length)).slice(0,r)}function de(o,t,a,l){var u=t&Kn,c=le(o);return function t(){for(var e=-1,n=arguments.length,i=-1,r=l.length,s=M(n+r);++i<r;)s[i]=l[i];for(;n--;)s[i++]=arguments[++e];return(this instanceof t?c:o).apply(u?a:this,s)}}function pe(t,e,n,i,r,s,o,a){var l=e&Qn;if(!l&&!mn(t))throw new y(pi);var u=i?i.length:0;if(u||(e&=~(ni|ii),i=r=null),u-=r?r.length:0,e&ii){var c=i,h=r;i=r=null}var d=!l&&ge(t),p=[t,e,n,i,r,c,h,s,o,a];if(d&&!0!==d&&(function(t,e){var n=t[1],i=e[1],r=n|i,s=si|ri,o=Kn|Qn,a=s|o|Zn|ei,l=n&si&&!(i&si),u=n&ri&&!(i&ri),c=(u?t:e)[7],h=(l?t:e)[8],d=!(ri<=n&&o<i||o<n&&ri<=i),p=s<=r&&r<=a&&(n<ri||(u||l)&&c.length<=h);if(d||p){i&Kn&&(t[2]=e[2],r|=n&Kn?0:Zn);var f=e[3];if(f){var g=t[3];t[3]=g?ne(g,f,e[4]):at(f),t[4]=g?Tr(t[3],fi):at(e[4])}(f=e[5])&&(g=t[5],t[5]=g?ie(g,f,e[6]):at(f),t[6]=g?Tr(t[5],fi):at(e[6])),(f=e[7])&&(t[7]=at(f)),i&si&&(t[8]=null==t[8]?e[8]:$(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r}}(p,d),e=p[1],a=p[9]),p[9]=null==a?l?0:t.length:q(a-u,0)||0,e==Kn)var f=function(e,n){var i=le(e);return function t(){return(this instanceof t?i:e).apply(n,arguments)}}(p[0],p[2]);else f=e!=ni&&e!=(Kn|ni)||p[4].length?ce.apply(null,p):de.apply(null,p);return(d?Wt:Ce)(f,p)}function fe(t,e,n){var i=tt.callback||Un;return i=i===Un?_t:i,n?i(t,e,n):i}var ge=Z?function(t){return Z.get(t)}:Jn;function me(t,e,n){var i=tt.indexOf||Re;return i=i===Re?hr:i,t?i(t,e,n):i}function ve(t,e){return e=null==e?Q:e,-1<(t=+t)&&t%1==0&&t<e}function ye(t,e,n){if(!vn(n))return!1;var i=typeof e;if("number"==i)var r=n.length,s=be(r)&&ve(e,r);else s="string"==i&&e in t;return s&&n[e]===t}function be(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=Q}function we(t){return t==t&&(0===t?0<1/t:!vn(t))}function _e(t,e){t=De(t);for(var n=-1,i=e.length,r={};++n<i;){var s=e[n];s in t&&(r[s]=t[s])}return r}function xe(t,i){var r={};return Lt(t,function(t,e,n){i(t,e,n)&&(r[e]=t)}),r}var Se,Te,Ce=(Te=Se=0,function(t,e){var n=on(),i=ui-(n-Te);if(Te=n,0<i){if(++Se>=li)return t}else Se=0;return Wt(t,e)});function Ee(t){var e,n;return!(!Sr(t)||w.call(t)!=xi||!(b.call(t,"constructor")||"function"!=typeof(e=t.constructor)||e instanceof e))&&(Lt(t,function(t,e){n=e}),void 0===n||b.call(t,n))}function ke(t){for(var e=Mn(t),n=e.length,i=n&&t.length,r=tt.support,s=i&&be(i)&&(dn(t)||r.nonEnumArgs&&hn(t)),o=-1,a=[];++o<n;){var l=e[o];(s&&ve(l,i)||b.call(t,l))&&a.push(l)}return a}function Me(t){return null==t?[]:be(t.length)?vn(t)?t:d(t):On(t)}function De(t){return vn(t)?t:d(t)}function Oe(t,e,n){return t&&t.length?((n?ye(t,e,n):null==e)&&(e=1),Jt(t,e<0?0:e)):[]}function Ae(t,e,n){var i=t?t.length:0;return i?((n?ye(t,e,n):null==e)&&(e=1),Jt(t,0,(e=i-(+e||0))<0?0:e)):[]}function Ne(t,e,n){var i=-1,r=t?t.length:0;for(e=fe(e,n,3);++i<r;)if(e(t[i],i,t))return i;return-1}function je(t){return t?t[0]:Xn}function Re(t,e,n){var i=t?t.length:0;if(!i)return-1;if("number"==typeof n)n=n<0?q(i+n,0):n||0;else if(n){var r=Qt(t,e),s=t[r];return(e==e?e===s:s!=s)?r:-1}return hr(t,e,n)}function Le(t){return Oe(t,1)}function Ie(t,e,n,i){if(!t||!t.length)return[];"boolean"!=typeof e&&null!=e&&(n=ye(t,e,i=n)?null:e,e=!1);var r=fe();return r===_t&&null==n||(n=r(n,i,3)),e&&me()==hr?function(t,e){for(var n,i=-1,r=t.length,s=-1,o=[];++i<r;){var a=t[i],l=e?e(a,i,t):a;i&&n===l||(n=l,o[++s]=a)}return o}(t,n):Xt(t,n)}function Pe(t){for(var e=-1,n=(t&&t.length&&dt(ht(t,h)))>>>0,i=M(n);++e<n;)i[e]=ht(t,Bt(e));return i}function Fe(t,e){var n=-1,i=t?t.length:0,r={};for(!i||e||dn(t[0])||(e=[]);++n<i;){var s=t[n];e?r[s]=e[n]:s&&(r[s[0]]=s[1])}return r}function He(t){var e=tt(t);return e.__chain__=!0,e}function qe(t,e,n){return e.call(n,t)}function $e(t,e,n){var i=t?t.length:0;return be(i)||(i=(t=On(t)).length),!!i&&(n="number"==typeof n?n<0?q(i+n,0):n||0:0,"string"==typeof t||!dn(t)&&xn(t)?n<i&&-1<t.indexOf(e,n):-1<me(t,e,n))}var Ue=re(function(t,e,n){b.call(t,n)?++t[n]:t[n]=1});function Be(t,e,n){var i=dn(t)?ut:Dt;return"function"==typeof e&&void 0===n||(e=fe(e,n,3)),i(t,e)}function Ve(t,e,n){return(dn(t)?ct:Ot)(t,e=fe(e,n,3))}function ze(t,e,n){if(dn(t)){var i=Ne(t,e,n);return-1<i?t[i]:Xn}return At(t,e=fe(e,n,3),kt)}function We(t,e,n){return"function"==typeof e&&void 0===n&&dn(t)?lt(t,e):kt(t,te(e,n,3))}function Je(t,e,n){return"function"==typeof e&&void 0===n&&dn(t)?function(t,e){for(var n=t.length;n--&&!1!==e(t[n],n,t););return t}(t,e):Mt(t,te(e,n,3))}var Ge=re(function(t,e,n){b.call(t,n)?t[n].push(e):t[n]=[e]}),Xe=re(function(t,e,n){t[n]=e});function Ye(t,e,n){return(dn(t)?ht:$t)(t,e=fe(e,n,3))}var Ke=ue(dt),Qe=ue(function(t){for(var e=-1,n=t.length,i=J;++e<n;){var r=t[e];r<i&&(i=r)}return i},!0),Ze=re(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function tn(t,e,n,i){return(dn(t)?pt:zt)(t,fe(e,i,4),n,arguments.length<3,kt)}function en(t,e,n,i){return(dn(t)?ft:zt)(t,fe(e,i,4),n,arguments.length<3,Mt)}function nn(t,e,n){if(n?ye(t,e,n):null==e){var i=(t=Me(t)).length;return 0<i?t[Vt(0,i-1)]:Xn}var r=rn(t);return r.length=$(e<0?0:+e||0,r.length),r}function rn(t){for(var e=-1,n=(t=Me(t)).length,i=M(n);++e<n;){var r=Vt(0,e);e!=r&&(i[e]=i[r]),i[r]=t[e]}return i}function sn(t,e,n){var i=dn(t)?gt:Gt;return"function"==typeof e&&void 0===n||(e=fe(e,n,3)),i(t,e)}var on=U||function(){return(new t).getTime()};function an(t,e){var n;if(!mn(e)){if(!mn(t))throw new y(pi);var i=t;t=e,e=i}return function(){return 0<--t?n=e.apply(this,arguments):e=null,n}}function ln(i,r,t){var s,o,a,l,u,c,h,d=0,p=!1,f=!0;if(!mn(i))throw new y(pi);if(r=r<0?0:r,!0===t){var g=!0;f=!1}else vn(t)&&(g=t.leading,p="maxWait"in t&&q(+t.maxWait||0,r),f="trailing"in t?t.trailing:f);function m(){var t=r-(on()-l);if(t<=0||r<t){o&&T(o);var e=h;o=c=h=Xn,e&&(d=on(),a=i.apply(u,s),c||o||(s=u=null))}else c=A(m,t)}function v(){c&&T(c),o=c=h=Xn,!f&&p===r||(d=on(),a=i.apply(u,s),c||o||(s=u=null))}function e(){if(s=arguments,l=on(),u=this,h=f&&(c||!g),!1===p)var t=g&&!c;else{o||g||(d=l);var e=p-(l-d),n=e<=0||p<e;n?(o=o&&T(o),d=l,a=i.apply(u,s)):o=o||A(v,e)}return n&&c?c=T(c):c||r===p||(c=A(m,r)),t&&(n=!0,a=i.apply(u,s)),!n||c||o||(s=u=null),a}return e.cancel=function(){c&&T(c),o&&T(o),o=c=h=Xn},e}function un(){var n=arguments,i=n.length-1;if(i<0)return function(){};if(!ut(n,mn))throw new y(pi);return function(){for(var t=i,e=n[t].apply(this,arguments);t--;)e=n[t].call(this,e);return e}}function cn(i,r){if(!mn(i)||r&&!mn(r))throw new y(pi);var s=function(){var t=s.cache,e=r?r.apply(this,arguments):arguments[0];if(t.has(e))return t.get(e);var n=i.apply(this,arguments);return t.set(e,n),n};return s.cache=new cn.Cache,s}function hn(t){return be(Sr(t)?t.length:Xn)&&w.call(t)==gi||!1}var dn=I||function(t){return Sr(t)&&be(t.length)&&w.call(t)==mi||!1};function pn(t){return t&&1===t.nodeType&&Sr(t)&&-1<w.call(t).indexOf("Element")||!1}function fn(t){return Sr(t)&&"string"==typeof t.message&&w.call(t)==bi||!1}nt.dom||(pn=function(t){return t&&1===t.nodeType&&Sr(t)&&!wn(t)||!1});var gn=B||function(t){return"number"==typeof t&&F(t)};function mn(t){return"function"==typeof t||!1}function vn(t){var e=typeof t;return"function"==e||t&&"object"==e||!1}function yn(t){return null!=t&&(w.call(t)==wi?g.test(c.call(t)):Sr(t)&&Xi.test(t)||!1)}function bn(t){return"number"==typeof t||Sr(t)&&w.call(t)==_i||!1}(mn(/x/)||j&&!mn(j))&&(mn=function(t){return w.call(t)==wi});var wn=E?function(t){if(!t||w.call(t)!=xi)return!1;var e=t.valueOf,n=yn(e)&&(n=E(e))&&E(n);return n?t==n||E(t)==n:Ee(t)}:Ee;function _n(t){return Sr(t)&&w.call(t)==Si||!1}function xn(t){return"string"==typeof t||Sr(t)&&w.call(t)==Ti||!1}function Sn(t){return Sr(t)&&be(t.length)&&or[w.call(t)]||!1}function Tn(t){return wt(t,Mn(t))}var Cn=se(yt);function En(t){return Ft(t,Mn(t))}var kn=H?function(t){if(t)var e=t.constructor,n=t.length;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&n&&be(n)?ke(t):vn(t)?H(t):[]}:ke;function Mn(t){if(null==t)return[];vn(t)||(t=d(t));var e=t.length;e=e&&be(e)&&(dn(t)||nt.nonEnumArgs&&hn(t))&&e||0;for(var n=t.constructor,i=-1,r="function"==typeof n&&n.prototype==t,s=M(e),o=0<e;++i<e;)s[i]=i+"";for(var a in t)o&&ve(a,e)||"constructor"==a&&(r||!b.call(t,a))||s.push(a);return s}var Dn=se(function o(a,t,l,u,c){var h=be(t.length)&&(dn(t)||Sn(t));return(h?lt:It)(t,function(t,e,n){if(Sr(t))return function(t,e,n,i,r,s,o){for(var a=s.length,l=e[n];a--;)if(s[a]==l)return void(t[n]=o[a]);var u=t[n],c=r?r(u,l,n,t,e):Xn,h=void 0===c;h&&(be((c=l).length)&&(dn(l)||Sn(l))?c=dn(u)?u:u?at(u):[]:(wn(l)||hn(l))&&(c=hn(u)?Tn(u):wn(u)?u:{})),s.push(l),o.push(c),h?t[n]=i(c,l,r,s,o):(c==c?c!==u:u==u)&&(t[n]=c)}(a,n,e,o,l,u=u||[],c=c||[]);var i=a[e],r=l?l(i,t,e,a,n):Xn,s=void 0===r;s&&(r=t),!h&&void 0===r||!s&&(r==r?r===i:i!=i)||(a[e]=r)}),a});function On(t){return Yt(t,kn(t))}var An=ae(function(t,e,n){return e=e.toLowerCase(),n?t+e.charAt(0).toUpperCase()+e.slice(1):e});function Nn(t){return(t=pr(t))&&t.replace(Yi,br)}function jn(t){return(t=pr(t))&&Zi.test(t)?t.replace(Qi,"\\$&"):t}var Rn=ae(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()});function Ln(t,e,n){return n&&ye(t,e,n)&&(e=0),V(t,e)}function In(t,e){var n="";if(t=pr(t),(e=+e)<1||!t||!F(e))return n;for(;e%2&&(n+=t),t+=t,e=C(e/2););return n}8!=V(ir+"08")&&(Ln=function(t,e,n){return e=(n?ye(t,e,n):null==e)?0:e&&+e,t=Hn(t),V(t,e||(Gi.test(t)?16:10))});var Pn,Fn=ae(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function Hn(t,e,n){var i=t;return(t=pr(t))?(n?ye(i,e,n):null==e)?t.slice(Cr(t),Er(t)+1):(e=pr(e),t.slice(gr(t,e),mr(t,e)+1)):t}function qn(t,e,n){return n&&ye(t,e,n)&&(e=null),(t=pr(t)).match(e||nr)||[]}function $n(t){try{return t()}catch(t){return fn(t)?t:i(t)}}function Un(t,e,n){return n&&ye(t,e,n)&&(e=null),_t(t,e)}function Bn(t){return function(){return t}}function Vn(t){return t}function zn(t){return Ut(t,!0)}function Wn(r,t,e){if(null==e){var n=vn(t),i=n&&kn(t),s=i&&i.length&&Ft(t,i);(s?s.length:n)||(s=!1,e=t,t=r,r=this)}s=s||Ft(t,kn(t));var o=!0,a=-1,l=mn(r),u=s.length;!1===e?o=!1:vn(e)&&"chain"in e&&(o=e.chain);for(;++a<u;){var c=s[a],h=t[c];r[c]=h,l&&(r.prototype[c]=function(i){return function(){var t=this.__chain__;if(o||t){var e=r(this.__wrapped__);return(e.__actions__=at(this.__actions__)).push({func:i,args:arguments,thisArg:r}),e.__chain__=t,e}var n=[this.value()];return k.apply(n,arguments),i.apply(r,n)}}(h))}return r}function Jn(){}function Gn(t){return Bt(t+"")}return et.prototype=tt.prototype,rt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},rt.prototype.get=function(t){return"__proto__"==t?Xn:this.__data__[t]},rt.prototype.has=function(t){return"__proto__"!=t&&b.call(this.__data__,t)},rt.prototype.set=function(t,e){return"__proto__"!=t&&(this.__data__[t]=e),this},st.prototype.push=function(t){var e=this.data;"string"==typeof t||vn(t)?e.set.add(t):e.hash[t]=!0},cn.Cache=rt,tt.after=function(t,e){if(!mn(e)){if(!mn(t))throw new y(pi);var n=t;t=e,e=n}return t=F(t=+t)?t:0,function(){if(--t<1)return e.apply(this,arguments)}},tt.ary=function(t,e,n){return n&&ye(t,e,n)&&(e=null),e=t&&null==e?t.length:q(+e||0,0),pe(t,si,null,null,null,null,e)},tt.assign=Cn,tt.at=function(t){return be(t?t.length:0)&&(t=Me(t)),bt(t,Nt(arguments,!1,!1,1))},tt.before=an,tt.bind=function t(e,n){var i=Kn;if(2<arguments.length){var r=Jt(arguments,2),s=Tr(r,t.placeholder);i|=ni}return pe(e,i,n,r,s)},tt.bindAll=function(t){return function(t,e){for(var n=-1,i=e.length;++n<i;){var r=e[n];t[r]=pe(t[r],Kn,t)}return t}(t,1<arguments.length?Nt(arguments,!1,!1,1):En(t))},tt.bindKey=function t(e,n){var i=Kn|Qn;if(2<arguments.length){var r=Jt(arguments,2),s=Tr(r,t.placeholder);i|=ni}return pe(n,i,e,r,s)},tt.callback=Un,tt.chain=He,tt.chunk=function(t,e,n){e=(n?ye(t,e,n):null==e)?1:q(+e||1,1);for(var i=0,r=t?t.length:0,s=-1,o=M(S(r/e));i<r;)o[++s]=Jt(t,i,i+=e);return o},tt.compact=function(t){for(var e=-1,n=t?t.length:0,i=-1,r=[];++e<n;){var s=t[e];s&&(r[++i]=s)}return r},tt.constant=Bn,tt.countBy=Ue,tt.create=function(t,e,n){var i=St(t);return n&&ye(t,e,n)&&(e=null),e?wt(e,i,kn(e)):i},tt.curry=function t(e,n,i){i&&ye(e,n,i)&&(n=null);var r=pe(e,ti,null,null,null,null,null,n);return r.placeholder=t.placeholder,r},tt.curryRight=function t(e,n,i){i&&ye(e,n,i)&&(n=null);var r=pe(e,ei,null,null,null,null,null,n);return r.placeholder=t.placeholder,r},tt.debounce=ln,tt.defaults=function(t){if(null==t)return t;var e=at(arguments);return e.push(mt),Cn.apply(Xn,e)},tt.defer=function(t){return Ct(t,1,arguments,1)},tt.delay=function(t,e){return Ct(t,e,arguments,2)},tt.difference=function(){for(var t=-1,e=arguments.length;++t<e;){var n=arguments[t];if(dn(n)||hn(n))break}return Et(n,Nt(arguments,!1,!0,++t))},tt.drop=Oe,tt.dropRight=Ae,tt.dropRightWhile=function(t,e,n){var i=t?t.length:0;if(!i)return[];for(e=fe(e,n,3);i--&&e(t[i],i,t););return Jt(t,0,i+1)},tt.dropWhile=function(t,e,n){var i=t?t.length:0;if(!i)return[];var r=-1;for(e=fe(e,n,3);++r<i&&e(t[r],r,t););return Jt(t,r)},tt.filter=Ve,tt.flatten=function(t,e,n){var i=t?t.length:0;return n&&ye(t,e,n)&&(e=!1),i?Nt(t,e):[]},tt.flattenDeep=function(t){return t&&t.length?Nt(t,!0):[]},tt.flow=function(){var n=arguments,i=n.length;if(!i)return function(){};if(!ut(n,mn))throw new y(pi);return function(){for(var t=0,e=n[t].apply(this,arguments);++t<i;)e=n[t].call(this,e);return e}},tt.flowRight=un,tt.forEach=We,tt.forEachRight=Je,tt.forIn=function(t,e,n){return"function"==typeof e&&void 0===n||(e=te(e,n,3)),jt(t,e,Mn)},tt.forInRight=function(t,e,n){return Rt(t,e=te(e,n,3),Mn)},tt.forOwn=function(t,e,n){return"function"==typeof e&&void 0===n||(e=te(e,n,3)),It(t,e)},tt.forOwnRight=function(t,e,n){return Rt(t,e=te(e,n,3),kn)},tt.functions=En,tt.groupBy=Ge,tt.indexBy=Xe,tt.initial=function(t){return Ae(t,1)},tt.intersection=function(){for(var t=[],e=-1,n=arguments.length,i=[],r=me(),s=r==hr;++e<n;){var o=arguments[e];(dn(o)||hn(o))&&(t.push(o),i.push(s&&120<=o.length&&oe(e&&o)))}n=t.length;var a=t[0],l=-1,u=a?a.length:0,c=[],h=i[0];t:for(;++l<u;)if(o=a[l],(h?ot(h,o):r(c,o))<0){for(e=n;--e;){var d=i[e];if((d?ot(d,o):r(t[e],o))<0)continue t}h&&h.push(o),c.push(o)}return c},tt.invert=function(t,e,n){n&&ye(t,e,n)&&(e=null);for(var i=-1,r=kn(t),s=r.length,o={};++i<s;){var a=r[i],l=t[a];e?b.call(o,l)?o[l].push(a):o[l]=[a]:o[l]=a}return o},tt.invoke=function(t,e){return function(t,n,i){var r=-1,s="function"==typeof n,e=t?t.length:0,o=be(e)?M(e):[];return kt(t,function(t){var e=s?n:null!=t&&t[n];o[++r]=e?e.apply(t,i):Xn}),o}(t,e,Jt(arguments,2))},tt.keys=kn,tt.keysIn=Mn,tt.map=Ye,tt.mapValues=function(t,i,e){var r={};return i=fe(i,e,3),It(t,function(t,e,n){r[e]=i(t,e,n)}),r},tt.matches=zn,tt.memoize=cn,tt.merge=Dn,tt.mixin=Wn,tt.negate=function(t){if(!mn(t))throw new y(pi);return function(){return!t.apply(this,arguments)}},tt.omit=function(t,i,e){if(null==t)return{};if("function"==typeof i)return i=te(i,e,3),xe(t,function(t,e,n){return!i(t,e,n)});var n=ht(Nt(arguments,!1,!1,1),o);return _e(t,Et(Mn(t),n))},tt.once=function(t){return an(t,2)},tt.pairs=function(t){for(var e=-1,n=kn(t),i=n.length,r=M(i);++e<i;){var s=n[e];r[e]=[s,t[s]]}return r},tt.partial=function t(e){var n=Jt(arguments,1),i=Tr(n,t.placeholder);return pe(e,ni,null,n,i)},tt.partialRight=function t(e){var n=Jt(arguments,1),i=Tr(n,t.placeholder);return pe(e,ii,null,n,i)},tt.partition=Ze,tt.pick=function(t,e,n){return null==t?{}:"function"==typeof e?xe(t,te(e,n,3)):_e(t,Nt(arguments,!1,!1,1))},tt.pluck=function(t,e){return Ye(t,Gn(e))},tt.property=Gn,tt.propertyOf=function(e){return function(t){return null==e?Xn:e[t]}},tt.pull=function(){var t=arguments[0];if(!t||!t.length)return t;for(var e=0,n=me(),i=arguments.length;++e<i;)for(var r=0,s=arguments[e];-1<(r=n(t,s,r));)N.call(t,r,1);return t},tt.pullAt=function(t){return function(t,e){var n=e.length,i=bt(t,e);for(e.sort(cr);n--;){var r=parseFloat(e[n]);if(r!=s&&ve(r)){var s=r;N.call(t,r,1)}}return i}(t||[],Nt(arguments,!1,!1,1))},tt.range=function(t,e,n){n&&ye(t,e,n)&&(e=n=null),t=+t||0,null==e?(e=t,t=0):e=+e||0;for(var i=-1,r=q(S((e-t)/((n=null==n?1:+n||0)||1)),0),s=M(r);++i<r;)s[i]=t,t+=n;return s},tt.rearg=function(t){var e=Nt(arguments,!1,!1,1);return pe(t,ri,null,null,null,e)},tt.reject=function(t,i,e){var n=dn(t)?ct:Ot;return i=fe(i,e,3),n(t,function(t,e,n){return!i(t,e,n)})},tt.remove=function(t,e,n){var i=-1,r=t?t.length:0,s=[];for(e=fe(e,n,3);++i<r;){var o=t[i];e(o,i,t)&&(s.push(o),N.call(t,i--,1),r--)}return s},tt.rest=Le,tt.shuffle=rn,tt.slice=function(t,e,n){var i=t?t.length:0;return i?(n&&"number"!=typeof n&&ye(t,e,n)&&(e=0,n=i),Jt(t,e,n)):[]},tt.sortBy=function(t,i,e){var r=-1,n=t?t.length:0,s=be(n)?M(n):[];return e&&ye(t,i,e)&&(i=null),i=fe(i,e,3),kt(t,function(t,e,n){s[++r]={criteria:i(t,e,n),index:r,value:t}}),dr(s,vr)},tt.sortByAll=function(t){var e=arguments;3<e.length&&ye(e[1],e[2],e[3])&&(e=[t,e[1]]);var s=-1,n=t?t.length:0,o=Nt(e,!1,!1,1),a=be(n)?M(n):[];return kt(t,function(t,e,n){for(var i=o.length,r=M(i);i--;)r[i]=null==t?Xn:t[o[i]];a[++s]={criteria:r,index:s,value:t}}),dr(a,yr)},tt.take=function(t,e,n){return t&&t.length?((n?ye(t,e,n):null==e)&&(e=1),Jt(t,0,e<0?0:e)):[]},tt.takeRight=function(t,e,n){var i=t?t.length:0;return i?((n?ye(t,e,n):null==e)&&(e=1),Jt(t,(e=i-(+e||0))<0?0:e)):[]},tt.takeRightWhile=function(t,e,n){var i=t?t.length:0;if(!i)return[];for(e=fe(e,n,3);i--&&e(t[i],i,t););return Jt(t,i+1)},tt.takeWhile=function(t,e,n){var i=t?t.length:0;if(!i)return[];var r=-1;for(e=fe(e,n,3);++r<i&&e(t[r],r,t););return Jt(t,0,r)},tt.tap=function(t,e,n){return e.call(n,t),t},tt.throttle=function(t,e,n){var i=!0,r=!0;if(!mn(t))throw new y(pi);return!1===n?i=!1:vn(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),lr.leading=i,lr.maxWait=+e,lr.trailing=r,ln(t,e,lr)},tt.thru=qe,tt.times=function(t,e,n){if((t=+t)<1||!F(t))return[];var i=-1,r=M($(t,G));for(e=te(e,n,1);++i<t;)i<G?r[i]=e(i):e(i);return r},tt.toArray=function(t){var e=t?t.length:0;return be(e)?e?at(t):[]:On(t)},tt.toPlainObject=Tn,tt.transform=function(t,i,r,e){var n=dn(t)||Sn(t);if(i=fe(i,e,4),null==r)if(n||vn(t)){var s=t.constructor;r=n?dn(t)?new s:[]:St("function"==typeof s&&s.prototype)}else r={};return(n?lt:It)(t,function(t,e,n){return i(r,t,e,n)}),r},tt.union=function(){return Xt(Nt(arguments,!1,!0))},tt.uniq=Ie,tt.unzip=Pe,tt.values=On,tt.valuesIn=function(t){return Yt(t,Mn(t))},tt.where=function(t,e){return Ve(t,zn(e))},tt.without=function(t){return Et(t,Jt(arguments,1))},tt.wrap=function(t,e){return pe(e=null==e?Vn:e,ni,null,[t],[])},tt.xor=function(){for(var t=-1,e=arguments.length;++t<e;){var n=arguments[t];if(dn(n)||hn(n))var i=i?Et(i,n).concat(Et(n,i)):n}return i?Xt(i):[]},tt.zip=function(){for(var t=arguments.length,e=M(t);t--;)e[t]=arguments[t];return Pe(e)},tt.zipObject=Fe,tt.backflow=un,tt.collect=Ye,tt.compose=un,tt.each=We,tt.eachRight=Je,tt.extend=Cn,tt.iteratee=Un,tt.methods=En,tt.object=Fe,tt.select=Ve,tt.tail=Le,tt.unique=Ie,Wn(tt,tt),tt.attempt=$n,tt.camelCase=An,tt.capitalize=function(t){return(t=pr(t))&&t.charAt(0).toUpperCase()+t.slice(1)},tt.clone=function(t,e,n,i){return"boolean"!=typeof e&&null!=e&&(n=ye(t,e,i=n)?null:e,e=!1),xt(t,e,n="function"==typeof n&&te(n,i,1))},tt.cloneDeep=function(t,e,n){return xt(t,!0,e="function"==typeof e&&te(e,n,1))},tt.deburr=Nn,tt.endsWith=function(t,e,n){e+="";var i=(t=pr(t)).length;return 0<=(n=(void 0===n?i:$(n<0?0:+n||0,i))-e.length)&&t.indexOf(e,n)==n},tt.escape=function(t){return(t=pr(t))&&$i.test(t)?t.replace(Hi,wr):t},tt.escapeRegExp=jn,tt.every=Be,tt.find=ze,tt.findIndex=Ne,tt.findKey=function(t,e,n){return At(t,e=fe(e,n,3),It,!0)},tt.findLast=function(t,e,n){return At(t,e=fe(e,n,3),Mt)},tt.findLastIndex=function(t,e,n){var i=t?t.length:0;for(e=fe(e,n,3);i--;)if(e(t[i],i,t))return i;return-1},tt.findLastKey=function(t,e,n){return At(t,e=fe(e,n,3),Pt,!0)},tt.findWhere=function(t,e){return ze(t,zn(e))},tt.first=je,tt.has=function(t,e){return!!t&&b.call(t,e)},tt.identity=Vn,tt.includes=$e,tt.indexOf=Re,tt.isArguments=hn,tt.isArray=dn,tt.isBoolean=function(t){return!0===t||!1===t||Sr(t)&&w.call(t)==vi||!1},tt.isDate=function(t){return Sr(t)&&w.call(t)==yi||!1},tt.isElement=pn,tt.isEmpty=function(t){if(null==t)return!0;var e=t.length;return be(e)&&(dn(t)||xn(t)||hn(t)||Sr(t)&&mn(t.splice))?!e:!kn(t).length},tt.isEqual=function(t,e,n,i){if(!(n="function"==typeof n&&te(n,i,3))&&we(t)&&we(e))return t===e;var r=n?n(t,e):Xn;return void 0===r?Ht(t,e,n):!!r},tt.isError=fn,tt.isFinite=gn,tt.isFunction=mn,tt.isMatch=function(t,e,n,i){var r=kn(e),s=r.length;if(!(n="function"==typeof n&&te(n,i,3))&&1==s){var o=r[0],a=e[o];if(we(a))return null!=t&&a===t[o]&&b.call(t,o)}for(var l=M(s),u=M(s);s--;)a=l[s]=e[r[s]],u[s]=we(a);return qt(t,r,l,u,n)},tt.isNaN=function(t){return bn(t)&&t!=+t},tt.isNative=yn,tt.isNull=function(t){return null===t},tt.isNumber=bn,tt.isObject=vn,tt.isPlainObject=wn,tt.isRegExp=_n,tt.isString=xn,tt.isTypedArray=Sn,tt.isUndefined=function(t){return void 0===t},tt.kebabCase=Rn,tt.last=function(t){var e=t?t.length:0;return e?t[e-1]:Xn},tt.lastIndexOf=function(t,e,n){var i=t?t.length:0;if(!i)return-1;var r=i;if("number"==typeof n)r=(n<0?q(i+n,0):$(n||0,i-1))+1;else if(n){var s=t[r=Qt(t,e,!0)-1];return(e==e?e===s:s!=s)?r:-1}if(e!=e)return xr(t,r,!0);for(;r--;)if(t[r]===e)return r;return-1},tt.max=Ke,tt.min=Qe,tt.noConflict=function(){return n._=f,this},tt.noop=Jn,tt.now=on,tt.pad=function(t,e,n){e=+e;var i=(t=pr(t)).length;if(e<=i||!F(e))return t;var r=(e-i)/2,s=C(r);return(n=he("",S(r),n)).slice(0,s)+t+n},tt.padLeft=function(t,e,n){return(t=pr(t))&&he(t,e,n)+t},tt.padRight=function(t,e,n){return(t=pr(t))&&t+he(t,e,n)},tt.parseInt=Ln,tt.random=function(t,e,n){n&&ye(t,e,n)&&(e=n=null);var i=null==t,r=null==e;if(null==n&&(r&&"boolean"==typeof t?(n=t,t=1):"boolean"==typeof e&&(n=e,r=!0)),i&&r&&(r=!(e=1)),t=+t||0,r?(e=t,t=0):e=+e||0,n||t%1||e%1){var s=z();return $(t+s*(e-t+parseFloat("1e-"+((s+"").length-1))),e)}return Vt(t,e)},tt.reduce=tn,tt.reduceRight=en,tt.repeat=In,tt.result=function(t,e,n){var i=null==t?Xn:t[e];return void 0===i&&(i=n),mn(i)?i.call(t):i},tt.runInContext=e,tt.size=function(t){var e=t?t.length:0;return be(e)?e:kn(t).length},tt.snakeCase=Fn,tt.some=sn,tt.sortedIndex=function(t,e,n,i){var r=fe(n);return r===_t&&null==n?Qt(t,e):Zt(t,e,r(n,i,1))},tt.sortedLastIndex=function(t,e,n,i){var r=fe(n);return r===_t&&null==n?Qt(t,e,!0):Zt(t,e,r(n,i,1),!0)},tt.startsWith=function(t,e,n){return t=pr(t),n=null==n?0:$(n<0?0:+n||0,t.length),t.lastIndexOf(e,n)==n},tt.template=function(o,t,e){var n=tt.templateSettings;e&&ye(o,t,e)&&(t=e=null),o=pr(o),t=yt(yt({},e||t),n,vt);var a,l,i=yt(yt({},t.imports),n.imports,vt),r=kn(i),s=Yt(i,r),u=0,c=t.interpolate||Ki,h="__p += '",d=v((t.escape||Ki).source+"|"+c.source+"|"+(c===Vi?zi:Ki).source+"|"+(t.evaluate||Ki).source+"|$","g"),p="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++sr+"]")+"\n";o.replace(d,function(t,e,n,i,r,s){return n=n||i,h+=o.slice(u,s).replace(er,_r),e&&(a=!0,h+="' +\n__e("+e+") +\n'"),r&&(l=!0,h+="';\n"+r+";\n__p += '"),n&&(h+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=s+t.length,t}),h+="';\n";var f=t.variable;f||(h="with (obj) {\n"+h+"\n}\n"),h=(l?h.replace(Li,""):h).replace(Ii,"$1").replace(Pi,"$1;"),h="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g=$n(function(){return m(r,p+"return "+h).apply(Xn,s)});if(g.source=h,fn(g))throw g;return g},tt.trim=Hn,tt.trimLeft=function(t,e,n){var i=t;return(t=pr(t))?(n?ye(i,e,n):null==e)?t.slice(Cr(t)):t.slice(gr(t,pr(e))):t},tt.trimRight=function(t,e,n){var i=t;return(t=pr(t))?(n?ye(i,e,n):null==e)?t.slice(0,Er(t)+1):t.slice(0,mr(t,pr(e))+1):t},tt.trunc=function(t,e,n){n&&ye(t,e,n)&&(e=null);var i=oi,r=ai;if(null!=e)if(vn(e)){var s="separator"in e?e.separator:s;i="length"in e?+e.length||0:i,r="omission"in e?pr(e.omission):r}else i=+e||0;if(i>=(t=pr(t)).length)return t;var o=i-r.length;if(o<1)return r;var a=t.slice(0,o);if(null==s)return a+r;if(_n(s)){if(t.slice(o).search(s)){var l,u,c=t.slice(0,o);for(s.global||(s=v(s.source,(Wi.exec(s)||"")+"g")),s.lastIndex=0;l=s.exec(c);)u=l.index;a=a.slice(0,null==u?o:u)}}else if(t.indexOf(s,o)!=o){var h=a.lastIndexOf(s);-1<h&&(a=a.slice(0,h))}return a+r},tt.unescape=function(t){return(t=pr(t))&&qi.test(t)?t.replace(Fi,kr):t},tt.uniqueId=function(t){var e=++p;return pr(t)+e},tt.words=qn,tt.all=Be,tt.any=sn,tt.contains=$e,tt.detect=ze,tt.foldl=tn,tt.foldr=en,tt.head=je,tt.include=$e,tt.inject=tn,Wn(tt,(Pn={},It(tt,function(t,e){tt.prototype[e]||(Pn[e]=t)}),Pn),!1),tt.sample=nn,tt.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return nn(t,e)}):nn(this.value())},tt.VERSION=Yn,lt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){tt[t].placeholder=tt}),lt(["filter","map","takeWhile"],function(t,s){var o=s==ci;it.prototype[t]=function(t,e){var n=this.clone(),i=n.filtered,r=n.iteratees||(n.iteratees=[]);return n.filtered=i||o||s==di&&n.dir<0,r.push({iteratee:fe(t,e,3),type:s}),n}}),lt(["drop","take"],function(i,r){var s=i+"Count",n=i+"While";it.prototype[i]=function(t){t=null==t?1:q(+t||0,0);var e=this.clone();if(e.filtered){var n=e[s];e[s]=r?$(n,t):n+t}else(e.views||(e.views=[])).push({size:t,type:i+(e.dir<0?"Right":"")});return e},it.prototype[i+"Right"]=function(t){return this.reverse()[i](t).reverse()},it.prototype[i+"RightWhile"]=function(t,e){return this.reverse()[n](t,e).reverse()}}),lt(["first","last"],function(t,e){var n="take"+(e?"Right":"");it.prototype[t]=function(){return this[n](1).value()[0]}}),lt(["initial","rest"],function(t,e){var n="drop"+(e?"":"Right");it.prototype[t]=function(){return this[n](1)}}),lt(["pluck","where"],function(t,e){var n=e?"filter":"map",i=e?zn:Gn;it.prototype[t]=function(t){return this[n](i(t))}}),it.prototype.dropWhile=function(i,t){var r,s,o=this.dir<0;return i=fe(i,t,3),this.filter(function(t,e,n){return r=r&&(o?e<s:s<e),s=e,r=r||!i(t,e,n)})},it.prototype.reject=function(i,t){return i=fe(i,t,3),this.filter(function(t,e,n){return!i(t,e,n)})},it.prototype.slice=function(t,e){var n=(t=null==t?0:+t||0)<0?this.takeRight(-t):this.drop(t);return void 0!==e&&(n=(e=+e||0)<0?n.dropRight(-e):n.take(e-t)),n},It(it.prototype,function(u,c){var h=/^(?:first|last)$/.test(c);tt.prototype[c]=function(){var t=this.__wrapped__,n=arguments,e=this.__chain__,i=!!this.__actions__.length,r=t instanceof it,s=r&&!i;if(h&&!e)return s?u.call(t):tt[c](this.value());function o(t){var e=[t];return k.apply(e,n),tt[c].apply(tt,e)}if(r||dn(t)){var a=s?t:new it(this),l=u.apply(a,n);return h||!i&&!l.actions||(l.actions||(l.actions=[])).push({func:qe,args:[o],thisArg:tt}),new et(l,e)}return this.thru(o)}}),lt(["concat","join","pop","push","shift","sort","splice","unshift"],function(t){var n=a[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:join|pop|shift)$/.test(t);tt.prototype[t]=function(){var e=arguments;return r&&!this.__chain__?n.apply(this.value(),e):this[i](function(t){return n.apply(t,e)})}}),it.prototype.clone=function(){var t=this.actions,e=this.iteratees,n=this.views,i=new it(this.wrapped);return i.actions=t?at(t):null,i.dir=this.dir,i.dropCount=this.dropCount,i.filtered=this.filtered,i.iteratees=e?at(e):null,i.takeCount=this.takeCount,i.views=n?at(n):null,i},it.prototype.reverse=function(){var t=this.filtered,e=t?new it(this):this.clone();return e.dir=-1*this.dir,e.filtered=t,e},it.prototype.value=function(){var t=this.wrapped.value();if(!dn(t))return Kt(t,this.actions);var e=this.dir,n=e<0,i=t.length,r=function(t,e,n){for(var i=-1,r=n?n.length:0;++i<r;){var s=n[i],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=$(e,t+o);break;case"takeRight":t=q(t,e-o)}}return{start:t,end:e}}(0,i,this.views),s=r.start,o=r.end,a=this.dropCount,l=$(o-s,this.takeCount-a),u=n?o:s-1,c=this.iteratees,h=c?c.length:0,d=0,p=[];t:for(;i--&&d<l;){for(var f=-1,g=t[u+=e];++f<h;){var m=c[f],v=(0,m.iteratee)(g,u,t),y=m.type;if(y==hi)g=v;else if(!v){if(y==ci)continue t;break t}}a?a--:p[d++]=g}return n?p.reverse():p},tt.prototype.chain=function(){return He(this)},tt.prototype.reverse=function(){var t=this.__wrapped__;return t instanceof it?new et(t.reverse()):this.thru(function(t){return t.reverse()})},tt.prototype.toString=function(){return this.value()+""},tt.prototype.toJSON=tt.prototype.valueOf=tt.prototype.value=function(){return Kt(this.__wrapped__,this.__actions__)},tt.prototype.collect=tt.prototype.map,tt.prototype.head=tt.prototype.first,tt.prototype.select=tt.prototype.filter,tt.prototype.tail=tt.prototype.rest,tt}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(ur._=Mr,define(function(){return Mr})):c&&h?p?(h.exports=Mr)._=Mr:c._=Mr:ur._=Mr}.call(this),function(i,r){if("function"==typeof define&&define.amd)define(["../../.","jquery","exports"],function(t,e,n){i.Backbone=r(i,n,t,e)});else if("undefined"!=typeof exports){var t=require("underscore");r(i,exports,t)}else i.Backbone=r(i,{},i._,i.jQuery||i.Zepto||i.ender||i.$)}(this,function(t,a,x,e){var n=t.Backbone,i=[],r=i.slice;a.VERSION="1.1.2",a.$=e,a.noConflict=function(){return t.Backbone=n,this},a.emulateHTTP=!1,a.emulateJSON=!1;var s=a.Events={on:function(t,e,n){return h(this,"on",t,[e,n])&&e&&(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:e,context:n,ctx:n||this})),this},once:function(t,e,n){if(!h(this,"once",t,[e,n])||!e)return this;var i=this,r=x.once(function(){i.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,n)},off:function(t,e,n){var i,r,s,o,a,l,u,c;if(!this._events||!h(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(a=0,l=(o=t?[t]:x.keys(this._events)).length;a<l;a++)if(t=o[a],s=this._events[t]){if(this._events[t]=i=[],e||n)for(u=0,c=s.length;u<c;u++)r=s[u],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=r.call(arguments,1);if(!h(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&o(n,e),i&&o(i,arguments),this},stopListening:function(t,e,n){var i=this._listeningTo;if(!i)return this;var r=!e&&!n;for(var s in n||"object"!=typeof e||(n=this),t&&((i={})[t._listenId]=t),i)(t=i[s]).off(e,n,this),(r||x.isEmpty(t._events))&&delete this._listeningTo[s];return this}},l=/\s+/,h=function(t,e,n,i){if(!n)return!0;if("object"==typeof n){for(var r in n)t[e].apply(t,[r,n[r]].concat(i));return!1}if(l.test(n)){for(var s=n.split(l),o=0,a=s.length;o<a;o++)t[e].apply(t,[s[o]].concat(i));return!1}return!0},o=function(t,e){var n,i=-1,r=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o,a);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}};x.each({listenTo:"on",listenToOnce:"once"},function(r,t){s[t]=function(t,e,n){var i=this._listeningTo||(this._listeningTo={});return n||"object"!=typeof e||(n=this),(i[t._listenId||(t._listenId=x.uniqueId("l"))]=t)[r](e,n,this),this}}),s.bind=s.on,s.unbind=s.off,x.extend(a,s);var S=a.Model=function(t,e){var n=t||{};e=e||{},this.cid=x.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=x.defaults({},n,x.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};x.extend(S.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return x.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return x.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,r,s,o,a,l,u,c;if(null==t)return this;if("object"==typeof t?(r=t,n=e):(r={})[t]=e,n=n||{},!this._validate(r,n))return!1;for(i in s=n.unset,a=n.silent,o=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=x.clone(this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]),r)e=r[i],x.isEqual(c[i],e)||o.push(i),x.isEqual(u[i],e)?delete this.changed[i]:this.changed[i]=e,s?delete c[i]:c[i]=e;if(!a){o.length&&(this._pending=n);for(var h=0,d=o.length;h<d;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(l)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,x.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,x.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!x.isEmpty(this.changed):x.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&x.clone(this.changed);var e,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var r in t)x.isEqual(i[r],e=t[r])||((n=n||{})[r]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return x.clone(this._previousAttributes)},fetch:function(e){void 0===(e=e?x.clone(e):{}).parse&&(e.parse=!0);var n=this,i=e.success;return e.success=function(t){if(!n.set(n.parse(t,e),e))return!1;i&&i(n,t,e),n.trigger("sync",n,t,e)},N(this,e),this.sync("read",this,e)},save:function(t,e,n){var i,r,s,o=this.attributes;if(null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e,n=x.extend({validate:!0},n),i&&!n.wait){if(!this.set(i,n))return!1}else if(!this._validate(i,n))return!1;i&&n.wait&&(this.attributes=x.extend({},o,i)),void 0===n.parse&&(n.parse=!0);var a=this,l=n.success;return n.success=function(t){a.attributes=o;var e=a.parse(t,n);if(n.wait&&(e=x.extend(i||{},e)),x.isObject(e)&&!a.set(e,n))return!1;l&&l(a,t,n),a.trigger("sync",a,t,n)},N(this,n),"patch"==(r=this.isNew()?"create":n.patch?"patch":"update")&&(n.attrs=i),s=this.sync(r,this,n),i&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?x.clone(e):{};function n(){i.trigger("destroy",i,i.collection,e)}var i=this,r=e.success;if(e.success=function(t){(e.wait||i.isNew())&&n(),r&&r(i,t,e),i.isNew()||i.trigger("sync",i,t,e)},this.isNew())return e.success(),!1;N(this,e);var t=this.sync("delete",this,e);return e.wait||n(),t},url:function(){var t=x.result(this,"urlRoot")||x.result(this.collection,"url")||A();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},x.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=x.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,x.extend(e,{validationError:n})),!1)}});x.each(["keys","values","pairs","invert","pick","omit"],function(e){S.prototype[e]=function(){var t=r.call(arguments);return t.unshift(this.attributes),x[e].apply(x,t)}});var u=a.Collection=function(t,e){(e=e||{}).model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,x.extend({silent:!0},e))},T={add:!0,remove:!0,merge:!0},c={add:!0,remove:!1};x.extend(u.prototype,s,{model:S,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return a.sync.apply(this,arguments)},add:function(t,e){return this.set(t,x.extend({merge:!1},e,c))},remove:function(t,e){var n,i,r,s,o=!x.isArray(t);for(e=e||{},n=0,i=(t=o?[t]:x.clone(t)).length;n<i;n++)(s=t[n]=this.get(t[n]))&&(delete this._byId[s.id],delete this._byId[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,e.silent||(e.index=r,s.trigger("remove",s,this,e)),this._removeReference(s,e));return o?t[0]:t},set:function(t,e){(e=x.defaults({},e,T)).parse&&(t=this.parse(t,e));var n,i,r,s,o,a,l,u=!x.isArray(t);t=u?t?[t]:[]:x.clone(t);var c=e.at,h=this.model,d=this.comparator&&null==c&&!1!==e.sort,p=x.isString(this.comparator)?this.comparator:null,f=[],g=[],m={},v=e.add,y=e.merge,b=e.remove,w=!(d||!v||!b)&&[];for(n=0,i=t.length;n<i;n++){if(r=(o=t[n]||{})instanceof S?s=o:o[h.prototype.idAttribute||"id"],a=this.get(r))b&&(m[a.cid]=!0),y&&(o=o===s?s.attributes:o,e.parse&&(o=a.parse(o,e)),a.set(o,e),d&&!l&&a.hasChanged(p)&&(l=!0)),t[n]=a;else if(v){if(!(s=t[n]=this._prepareModel(o,e)))continue;f.push(s),this._addReference(s,e)}s=a||s,!w||!s.isNew()&&m[s.id]||w.push(s),m[s.id]=!0}if(b){for(n=0,i=this.length;n<i;++n)m[(s=this.models[n]).cid]||g.push(s);g.length&&this.remove(g,e)}if(f.length||w&&w.length)if(d&&(l=!0),this.length+=f.length,null!=c)for(n=0,i=f.length;n<i;n++)this.models.splice(c+n,0,f[n]);else{w&&(this.models.length=0);var _=w||f;for(n=0,i=_.length;n<i;n++)this.models.push(_[n])}if(l&&this.sort({silent:!0}),!e.silent){for(n=0,i=f.length;n<i;n++)(s=f[n]).trigger("add",s,this,e);(l||w&&w.length)&&this.trigger("sort",this,e)}return u?t[0]:t},reset:function(t,e){e=e||{};for(var n=0,i=this.models.length;n<i;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,x.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,x.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,x.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(n,t){return x.isEmpty(n)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var e in n)if(n[e]!==t.get(e))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t=t||{},x.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(x.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return x.invoke(this.models,"get",t)},fetch:function(n){void 0===(n=n?x.clone(n):{}).parse&&(n.parse=!0);var i=n.success,r=this;return n.success=function(t){var e=n.reset?"reset":"set";r[e](t,n),i&&i(r,t,n),r.trigger("sync",r,t,n)},N(this,n),this.sync("read",this,n)},create:function(t,n){if(n=n?x.clone(n):{},!(t=this._prepareModel(t,n)))return!1;n.wait||this.add(t,n);var i=this,r=n.success;return n.success=function(t,e){n.wait&&i.add(t,n),r&&r(t,e,n)},t.save(null,n),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof S)return t;var n=new(((e=e?x.clone(e):{}).collection=this).model)(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_addReference:function(t,e){null!=(this._byId[t.cid]=t).id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});x.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"],function(e){u.prototype[e]=function(){var t=r.call(arguments);return t.unshift(this.models),x[e].apply(x,t)}});x.each(["groupBy","countBy","sortBy","indexBy"],function(i){u.prototype[i]=function(e,t){var n=x.isFunction(e)?e:function(t){return t.get(e)};return x[i](this.models,n,t)}});var d=a.View=function(t){this.cid=x.uniqueId("view"),t=t||{},x.extend(this,x.pick(t,f)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},p=/^(\S+)\s*(.*)$/,f=["model","collection","el","id","attributes","className","tagName","events"];x.extend(d.prototype,s,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof a.$?t:a.$(t),this.el=this.$el[0],!1!==e&&this.delegateEvents(),this},delegateEvents:function(t){if(!(t=t||x.result(this,"events")))return this;for(var e in this.undelegateEvents(),t){var n=t[e];if(x.isFunction(n)||(n=this[t[e]]),n){var i=e.match(p),r=i[1],s=i[2];n=x.bind(n,this),r+=".delegateEvents"+this.cid,""===s?this.$el.on(r,n):this.$el.on(r,s,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(x.result(this,"el"),!1);else{var t=x.extend({},x.result(this,"attributes"));this.id&&(t.id=x.result(this,"id")),this.className&&(t.class=x.result(this,"className"));var e=a.$("<"+x.result(this,"tagName")+">").attr(t);this.setElement(e,!1)}}}),a.sync=function(t,e,n){var i=m[t];x.defaults(n=n||{},{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var r={type:i,dataType:"json"};if(n.url||(r.url=x.result(e,"url")||A()),null!=n.data||!e||"create"!==t&&"update"!==t&&"patch"!==t||(r.contentType="application/json",r.data=JSON.stringify(n.attrs||e.toJSON(n))),n.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),n.emulateHTTP&&("PUT"===i||"DELETE"===i||"PATCH"===i)){r.type="POST",n.emulateJSON&&(r.data._method=i);var s=n.beforeSend;n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",i),s)return s.apply(this,arguments)}}"GET"===r.type||n.emulateJSON||(r.processData=!1),"PATCH"===r.type&&g&&(r.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var o=n.xhr=a.ajax(x.extend(r,n));return e.trigger("request",e,o,n),o};var g=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),m={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var v=a.Router=function(t){(t=t||{}).routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,b=/(\(\?)?:\w+/g,w=/\*\w+/g,_=/[\-{}\[\]+?.,\\\^$|#\s]/g;x.extend(v.prototype,s,{initialize:function(){},route:function(n,i,r){x.isRegExp(n)||(n=this._routeToRegExp(n)),x.isFunction(i)&&(r=i,i=""),r=r||this[i];var s=this;return a.history.route(n,function(t){var e=s._extractParameters(n,t);s.execute(r,e),s.trigger.apply(s,["route:"+i].concat(e)),s.trigger("route",i,e),a.history.trigger("route",s,i,e)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,e){return a.history.navigate(t,e),this},_bindRoutes:function(){if(this.routes){this.routes=x.result(this,"routes");for(var t,e=x.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(_,"\\$&").replace(y,"(?:$1)?").replace(b,function(t,e){return e?t:"([^/?]+)"}).replace(w,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return x.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var C=a.History=function(){this.handlers=[],x.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,k=/^\/+|\/+$/g,M=/msie [\w.]+/,D=/\/$/,O=/#.*$/;C.started=!1,x.extend(C.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(D,"");t.indexOf(n)||(t=t.slice(n.length))}else t=this.getHash();return t.replace(E,"")},start:function(t){if(C.started)throw new Error("Backbone.history has already been started");C.started=!0,this.options=x.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment(),n=document.documentMode,i=M.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);if(this.root=("/"+this.root+"/").replace(k,"/"),i&&this._wantsHashChange){var r=a.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=r.hide().appendTo("body")[0].contentWindow,this.navigate(e)}this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),C.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),x.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(t,e){if(!C.started)return!1;e&&!0!==e||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(t=t.replace(O,""),this.fragment!==t){if(""===(this.fragment=t)&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),a.history=new C;S.extend=u.extend=v.extend=d.extend=C.extend=function(t,e){var n,i=this;n=t&&x.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},x.extend(n,i,e);function r(){this.constructor=n}return r.prototype=i.prototype,n.prototype=new r,t&&x.extend(n.prototype,t),n.__super__=i.prototype,n};var A=function(){throw new Error('A "url" property or function must be specified')},N=function(e,n){var i=n.error;n.error=function(t){i&&i(e,t,n),e.trigger("error",e,t,n)}};return a}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}var cx,escapable,gap,indent,meta,rep;function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,i,r,s,o,a=gap,l=e[t];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(t)),"function"==typeof rep&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(l)){for(s=l.length,n=0;n<s;n+=1)o[n]=str(n,l)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;n<s;n+=1)"string"==typeof rep[n]&&(r=str(i=rep[n],l))&&o.push(quote(i)+(gap?": ":":")+r);else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(r=str(i,l))&&o.push(quote(i)+(gap?": ":":")+r);return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,n){var i;if(indent=gap="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if((rep=e)&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){var j;function walk(t,e){var n,i,r=t[e];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(t,e,r)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var saveAs=saveAs||function(a){"use strict";if(!(void 0===a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=a.document,l=function(){return a.URL||a.webkitURL||a},u=t.createElementNS("http://www.w3.org/1999/xhtml","a"),c="download"in u,h=/constructor/i.test(a.HTMLElement)||a.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent),p=function(t){(a.setImmediate||a.setTimeout)(function(){throw t},0)},f=function(t){setTimeout(function(){"string"==typeof t?l().revokeObjectURL(t):t.remove()},4e4)},g=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},i=function(t,e,n){n||(t=g(t));function i(){!function(t,e,n){for(var i=(e=[].concat(e)).length;i--;){var r=t["on"+e[i]];if("function"==typeof r)try{r.call(t,n||t)}catch(t){p(t)}}}(s,"writestart progress write writeend".split(" "))}var r,s=this,o="application/octet-stream"===t.type;if(s.readyState=s.INIT,c)return r=l().createObjectURL(t),void setTimeout(function(){u.href=r,u.download=e,function(t){var e=new MouseEvent("click");t.dispatchEvent(e)}(u),i(),f(r),s.readyState=s.DONE});!function(){if((d||o&&h)&&a.FileReader){var e=new FileReader;return e.onloadend=function(){var t=d?e.result:e.result.replace(/^data:[^;]*;/,"data:attachment/file;");a.open(t,"_blank")||(a.location.href=t),t=void 0,s.readyState=s.DONE,i()},e.readAsDataURL(t),s.readyState=s.INIT}(r=r||l().createObjectURL(t),o)?a.location.href=r:a.open(r,"_blank")||(a.location.href=r);s.readyState=s.DONE,i(),f(r)}()},e=i.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=g(t)),navigator.msSaveOrOpenBlob(t,e)}:(e.abort=function(){},e.readyState=e.INIT=0,e.WRITING=1,e.DONE=2,e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null,function(t,e,n){return new i(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs}),function(t,e){if("object"==typeof exports)module.exports=e(require("underscore"),require("backbone"));else if("function"==typeof define&&define.amd)define(["underscore","backbone"],e);else{for(var n="FilteredCollection".split("."),i=t,r=0;r<n.length-1;r++)void 0===i[n[r]]&&(i[n[r]]={}),i=i[n[r]];i[n[n.length-1]]=e(t._,t.Backbone)}}(this,function(e,n){function g(t){return{underscore:e,backbone:n}[t]}function m(t){var e=m.cache[t];if(!e){var n={};e=m.cache[t]={id:t,exports:n},m.modules[t].call(n,e,n)}return e.exports}return m.cache=[],m.modules=[function(t,e){var n=g("underscore"),i=g("backbone"),r=m(1),s=m(2);function o(){this._filterResultCache={}}function a(t){for(var e in this._filterResultCache)this._filterResultCache.hasOwnProperty(e)&&delete this._filterResultCache[e][t]}function l(t){this._filterResultCache[t.cid]||(this._filterResultCache[t.cid]={});var e=this._filterResultCache[t.cid];for(var n in this._filters)if(this._filters.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=this._filters[n].fn(t)),!e[n]))return!1;return!0}function u(){var t=[];this._superset&&(t=this._superset.filter(n.bind(l,this))),this._collection.reset(t),this.length=this._collection.length}function c(t){if(this._filterResultCache[t.cid]={},l.call(this,t)){if(!this._collection.get(t.cid)){for(var e=null,n=this.superset().indexOf(t)-1;0<=n;n-=1)if(this.contains(this.superset().at(n))){e=this.indexOf(this.superset().at(n))+1;break}e=e||0,this._collection.add(t,{at:e})}}else this._collection.get(t.cid)&&this._collection.remove(t);this.length=this._collection.length}function h(t,e,n){"change:"===t.slice(0,7)&&function(t){this._filterResultCache[t.cid]={},l.call(this,t)||this._collection.get(t.cid)&&this._collection.remove(t)}.call(this,e)}function d(t){this.contains(t)&&this._collection.remove(t),this.length=this._collection.length}function p(t){this._superset=t,this._collection=new i.Collection(t.toArray()),r(this._collection,this),this.resetFilters(),this.listenTo(this._superset,"reset sort",u),this.listenTo(this._superset,"add change",c),this.listenTo(this._superset,"remove",d),this.listenTo(this._superset,"all",h)}var f={defaultFilterName:"__default",filterBy:function(t,e){return e||(e=t,t=this.defaultFilterName),function(t,e){this._filters[t]&&a.call(this,t),this._filters[t]=e,this.trigger("filtered:add",t)}.call(this,t,s(e)),u.call(this),this},removeFilter:function(t){return t=t||this.defaultFilterName,function(t){delete this._filters[t],a.call(this,t),this.trigger("filtered:remove",t)}.call(this,t),u.call(this),this},resetFilters:function(){return this._filters={},o.call(this),this.trigger("filtered:reset"),u.call(this),this},superset:function(){return this._superset},refilter:function(t){return"object"==typeof t&&t.cid?c.call(this,t):(o.call(this),u.call(this)),this},getFilters:function(){return n.keys(this._filters)},hasFilter:function(t){return n.contains(this.getFilters(),t)},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this.length=0,this.trigger("filtered:destroy")}};n.extend(p.prototype,f,i.Events),t.exports=p},function(t,e){var s=g("underscore"),n=g("backbone"),o=["_onModelEvent","_prepareModel","_removeReference","_reset","add","initialize","sync","remove","reset","set","push","pop","unshift","shift","sort","parse","fetch","create","model","off","on","listenTo","listenToOnce","bind","trigger","once","stopListening"],a=["add","remove","reset","sort","destroy","sync","request","error"];t.exports=function(i,r){function t(){r.length=i.length}var e={};return s.each(s.functions(n.Collection.prototype),function(t){s.contains(o,t)||(e[t]=function(){return i[t].apply(i,arguments)})}),s.extend(r,n.Events,e),r.listenTo(i,"all",t),r.listenTo(i,"all",function(t){var e=s.toArray(arguments),n="change"===t||"change:"===t.slice(0,7);"reset"===t&&(r.models=i.models),s.contains(a,t)?(s.contains(["add","remove","destroy"],t)?e[2]=r:s.contains(["reset","sort"],t)&&(e[1]=r),r.trigger.apply(this,e)):n&&r.contains(e[1])&&r.trigger.apply(this,e)}),r.models=i.models,t(),r}},function(t,e){var r=g("underscore");function s(t,e){return r.isArray(e)||(e=null),{fn:t,keys:e}}function n(n){var t=r.keys(n),i=r.map(t,function(t){var e=n[t];return r.isFunction(e)?function(e,n){return function(t){return n(t.get(e))}}(t,e):function(e,n){return function(t){return t.get(e)===n}}(t,e)});return s(function(t){for(var e=0;e<i.length;e++)if(!i[e](t))return!1;return!0},t)}t.exports=function(t,e){return r.isFunction(t)?s(t,e):r.isObject(t)?n(t):void 0}}],m(0)}),function(t,n){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(t,e){return n(t,e)});else if("undefined"!=typeof exports){var e=require("backbone"),i=require("underscore");module.exports=n(e,i)}else n(t.Backbone,t._)}(this,function(t,e){"use strict";var n=t.ChildViewContainer;return t.ChildViewContainer=function(t,i){function n(t){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),i.each(t,this.add,this)}i.extend(n.prototype,{add:function(t,e){var n=t.cid;return(this._views[n]=t).model&&(this._indexByModel[t.model.cid]=n),e&&(this._indexByCustom[e]=n),this._updateLength(),this},findByModel:function(t){return this.findByModelCid(t.cid)},findByModelCid:function(t){var e=this._indexByModel[t];return this.findByCid(e)},findByCustom:function(t){var e=this._indexByCustom[t];return this.findByCid(e)},findByIndex:function(t){return i.values(this._views)[t]},findByCid:function(t){return this._views[t]},remove:function(t){var n=t.cid;return t.model&&delete this._indexByModel[t.model.cid],i.any(this._indexByCustom,function(t,e){if(t===n)return delete this._indexByCustom[e],!0},this),delete this._views[n],this._updateLength(),this},call:function(t){this.apply(t,i.tail(arguments))},apply:function(e,n){i.each(this._views,function(t){i.isFunction(t[e])&&t[e].apply(t,n||[])})},_updateLength:function(){this.length=i.size(this._views)}});return i.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"],function(e){n.prototype[e]=function(){var t=[i.values(this._views)].concat(i.toArray(arguments));return i[e].apply(i,t)}}),n}(0,e),t.ChildViewContainer.VERSION="0.1.6",t.ChildViewContainer.noConflict=function(){return t.ChildViewContainer=n,this},t.ChildViewContainer}),function(i,r){"function"==typeof define&&define.amd?define(["underscore","backbone","jquery"],function(t,e,n){return i.Backbone=r(t,e,n)}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=r(require("underscore"),require("backbone"),require("jquery")):i.Backbone=r(i._,i.Backbone,i.jQuery)}(this,function(h,d,p){var f={modelFetch:d.Model.prototype.fetch,modelSync:d.Model.prototype.sync,collectionFetch:d.Collection.prototype.fetch},n=function(){var e=void 0!==window.localStorage;if(e)try{localStorage.setItem("test_support","test_support"),localStorage.removeItem("test_support")}catch(t){e=!1}return e}();function i(t,e){if(t&&h.isObject(t)){if(h.isFunction(t.getCacheKey))return t.getCacheKey(e);t=e&&e.url?e.url:h.isFunction(t.url)?t.url():t.url}else if(h.isFunction(t))return t(e);return e&&e.data?"string"==typeof e.data?t+"?"+e.data:t+"?"+p.param(e.data):t}function g(t,e){return h.isFunction(t)?t=t():t&&h.isObject(t)&&(t=i(t,e)),d.fetchCache._cache[t]}function a(t,e){h.isFunction(t)?t=t():t&&h.isObject(t)&&(t=i(t,e)),delete d.fetchCache._cache[t],d.fetchCache.setLocalStorage()}function t(){if(n&&d.fetchCache.localStorage){var t=localStorage.getItem(d.fetchCache.getLocalStorageKey())||"{}";d.fetchCache._cache=JSON.parse(t)}}function m(t){return window.setTimeout(t,0)}return d.fetchCache=d.fetchCache||{},d.fetchCache._cache=d.fetchCache._cache||{},d.fetchCache.enabled=!0,d.fetchCache.priorityFn=function(t,e){return t&&t.expires&&e&&e.expires?t.expires-e.expires:t},d.fetchCache._prioritize=function(){var t=h.values(this._cache).sort(this.priorityFn),e=h.indexOf(h.values(this._cache),t[0]);return h.keys(this._cache)[e]},d.fetchCache._deleteCacheWithPriority=function(){d.fetchCache._cache[this._prioritize()]=null,delete d.fetchCache._cache[this._prioritize()],d.fetchCache.setLocalStorage()},d.fetchCache.getLocalStorageKey=function(){return"backboneCache"},void 0===d.fetchCache.localStorage&&(d.fetchCache.localStorage=!0),d.Model.prototype.fetch=function(t){if(!d.fetchCache.enabled)return f.modelFetch.apply(this,arguments);t=h.defaults(t||{},{parse:!0});var e=g(d.fetchCache.getCacheKey(this,t)),n=!1,i=!1,r=!1,s=new p.Deferred,o=t.context||this,a=this;function l(){return t.prefill&&(!t.prefillExpires||i)}function u(){t.parse&&(r=a.parse(r,t)),a.set(r,t),h.isFunction(t.prefillSuccess)&&t.prefillSuccess.call(o,a,r,t),a.trigger("cachesync",a,r,t),a.trigger("sync",a,r,t),l()?s.notifyWith(o,[a]):(h.isFunction(t.success)&&t.success.call(o,a,r,t),s.resolveWith(o,[a]))}if(e&&(n=(n=e.expires)&&e.expires<(new Date).getTime(),i=(i=e.prefillExpires)&&e.prefillExpires<(new Date).getTime(),r=e.value),!n&&(t.cache||t.prefill)&&r&&(null==t.async&&(t.async=!0),t.async?m(u):u(),!l()))return s.promise();var c=f.modelFetch.apply(this,arguments);return void 0!==c&&(c.done(h.bind(s.resolve,o,this)).done(h.bind(d.fetchCache.setCache,null,this,t)).fail(h.bind(s.reject,o,this)),s.abort=c.abort),s.promise()},d.Model.prototype.sync=function(t,e,n){if("read"===t||!d.fetchCache.enabled)return f.modelSync.apply(this,arguments);var i,r,s=e.collection,o=[];for(o.push(d.fetchCache.getCacheKey(e,n)),s&&o.push(d.fetchCache.getCacheKey(s)),i=0,r=o.length;i<r;i++)a(o[i]);return f.modelSync.apply(this,arguments)},d.Collection.prototype.fetch=function(t){if(!d.fetchCache.enabled)return f.collectionFetch.apply(this,arguments);t=h.defaults(t||{},{parse:!0});var e=g(d.fetchCache.getCacheKey(this,t)),n=!1,i=!1,r=!1,s=new p.Deferred,o=t.context||this,a=this;function l(){return t.prefill&&(!t.prefillExpires||i)}function u(){a[t.reset?"reset":"set"](r,t),h.isFunction(t.prefillSuccess)&&t.prefillSuccess.call(o,a),a.trigger("cachesync",a,r,t),a.trigger("sync",a,r,t),l()?s.notifyWith(o,[a]):(h.isFunction(t.success)&&t.success.call(o,a,r,t),s.resolveWith(o,[a]))}if(e&&(n=(n=e.expires)&&e.expires<(new Date).getTime(),i=(i=e.prefillExpires)&&e.prefillExpires<(new Date).getTime(),r=e.value),!n&&(t.cache||t.prefill)&&r&&(null==t.async&&(t.async=!0),t.async?m(u):u(),!l()))return s.promise();var c=f.collectionFetch.apply(this,arguments);return void 0!==c&&(c.done(h.bind(s.resolve,o,this)).done(h.bind(d.fetchCache.setCache,null,this,t)).fail(h.bind(s.reject,o,this)),s.abort=c.abort),s.promise()},t(),d.fetchCache._superMethods=f,d.fetchCache.setCache=function(t,e,n){e=e||{};var i=d.fetchCache.getCacheKey(t,e),r=!1,s=e.lastSync||(new Date).getTime(),o=!1;i&&!1!==e.cache&&(e.cache||e.prefill)&&(!1!==e.expires&&(r=(new Date).getTime()+1e3*(e.expires||300)),!1!==e.prefillExpires&&(o=(new Date).getTime()+1e3*(e.prefillExpires||300)),d.fetchCache._cache[i]={expires:r,lastSync:s,prefillExpires:o,value:n},d.fetchCache.setLocalStorage())},d.fetchCache.getCache=g,d.fetchCache.getCacheKey=i,d.fetchCache.getLastSync=function(t,e){return g(t).lastSync},d.fetchCache.clearItem=a,d.fetchCache.reset=function(){d.fetchCache._cache={}},d.fetchCache.setLocalStorage=function(){if(n&&d.fetchCache.localStorage)try{localStorage.setItem(d.fetchCache.getLocalStorageKey(),JSON.stringify(d.fetchCache._cache))}catch(t){var e=t.code||t.number||t.message;if(22!==e&&1014!==e)throw t;this._deleteCacheWithPriority()}},d.fetchCache.getLocalStorage=t,d}),function(e,n){"object"==typeof exports&&"function"==typeof require?module.exports=n(require("backbone")):"function"==typeof define&&define.amd?define(["backbone"],function(t){return n(t||e.Backbone)}):n(Backbone)}(this,function(a){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function l(t,e){if(null!=t){var n=t[e];return"function"==typeof n?t[e]():n}}return a.LocalStorage=window.Store=function(t,e){if(!this.localStorage)throw"Backbone.localStorage: Environment does not support localStorage.";this.name=t,this.serializer=e||{serialize:function(t){return function(t){return t===Object(t)}(t)?JSON.stringify(t):t},deserialize:function(t){return t&&JSON.parse(t)}};var n=this.localStorage().getItem(this.name);this.records=n&&n.split(",")||[]},function(t,e){for(var n in e)t[n]=e[n]}(a.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(t){return t.id||0===t.id||(t.id=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),t.set(t.idAttribute,t.id)),this.localStorage().setItem(this._itemName(t.id),this.serializer.serialize(t)),this.records.push(t.id.toString()),this.save(),this.find(t)},update:function(t){this.localStorage().setItem(this._itemName(t.id),this.serializer.serialize(t));var e=t.id.toString();return function(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1}(this.records,e)||(this.records.push(e),this.save()),this.find(t)},find:function(t){return this.serializer.deserialize(this.localStorage().getItem(this._itemName(t.id)))},findAll:function(){for(var t,e,n=[],i=0;i<this.records.length;i++)t=this.records[i],null!=(e=this.serializer.deserialize(this.localStorage().getItem(this._itemName(t))))&&n.push(e);return n},destroy:function(t){this.localStorage().removeItem(this._itemName(t.id));for(var e=t.id.toString(),n=0;n<this.records.length;n++)this.records[n]===e&&this.records.splice(n,1);return this.save(),t},localStorage:function(){return localStorage},_clear:function(){var t=this.localStorage(),e=new RegExp("^"+this.name+"-");for(var n in t.removeItem(this.name),t)e.test(n)&&t.removeItem(n);this.records.length=0},_storageSize:function(){return this.localStorage().length},_itemName:function(t){return this.name+"-"+t}}),a.LocalStorage.sync=window.Store.sync=a.localSync=function(t,e,n){var i,r,s=l(e,"localStorage")||l(e.collection,"localStorage"),o=a.$?a.$.Deferred&&a.$.Deferred():a.Deferred&&a.Deferred();try{switch(t){case"read":i=null!=e.id?s.find(e):s.findAll();break;case"create":i=s.create(e);break;case"update":i=s.update(e);break;case"delete":i=s.destroy(e)}}catch(t){r=22===t.code&&0===s._storageSize()?"Private browsing is unsupported":t.message}return i?(n&&n.success&&("0.9.10"===a.VERSION?n.success(e,i,n):n.success(i)),o&&o.resolve(i)):(r=r||"Record Not Found",n&&n.error&&("0.9.10"===a.VERSION?n.error(e,r,n):n.error(r)),o&&o.reject(r)),n&&n.complete&&n.complete(i),o&&o.promise()},a.ajaxSync=a.sync,a.getSyncMethod=function(t,e){return e&&e.ajaxSync||!l(t,"localStorage")&&!l(t.collection,"localStorage")?a.ajaxSync:a.localSync},a.sync=function(t,e,n){return a.getSyncMethod(e,n).apply(this,[t,e,n])},a.LocalStorage}),function(n,i){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(t,e){return n.Marionette=n.Mn=i(n,t,e)});else if("undefined"!=typeof exports){var t=require("backbone"),e=require("underscore");module.exports=i(n,t,e)}else n.Marionette=n.Mn=i(n,n.Backbone,n._)}(this,function(t,o,l){"use strict";var e,n,i,r,s,a,u,c,h,d,p,f;function g(t){this.options=t,this._wreqrHandlers={},u.isFunction(this.initialize)&&this.initialize(t)}function m(t){this.options=t,this._commands={},s.isFunction(this.initialize)&&this.initialize(t)}function v(){}function y(t){this.vent=new r.Wreqr.EventAggregator,this.reqres=new r.Wreqr.RequestResponse,this.commands=new r.Wreqr.Commands,this.channelName=t}n=l,i=(e=o).ChildViewContainer,e.ChildViewContainer=function(t,i){function n(t){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),i.each(t,this.add,this)}return i.extend(n.prototype,{add:function(t,e){var n=t.cid;return(this._views[n]=t).model&&(this._indexByModel[t.model.cid]=n),e&&(this._indexByCustom[e]=n),this._updateLength(),this},findByModel:function(t){return this.findByModelCid(t.cid)},findByModelCid:function(t){var e=this._indexByModel[t];return this.findByCid(e)},findByCustom:function(t){var e=this._indexByCustom[t];return this.findByCid(e)},findByIndex:function(t){return i.values(this._views)[t]},findByCid:function(t){return this._views[t]},remove:function(t){var n=t.cid;return t.model&&delete this._indexByModel[t.model.cid],i.any(this._indexByCustom,function(t,e){if(t===n)return delete this._indexByCustom[e],!0},this),delete this._views[n],this._updateLength(),this},call:function(t){this.apply(t,i.tail(arguments))},apply:function(e,n){i.each(this._views,function(t){i.isFunction(t[e])&&t[e].apply(t,n||[])})},_updateLength:function(){this.length=i.size(this._views)}}),i.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(e){n.prototype[e]=function(){var t=[i.values(this._views)].concat(i.toArray(arguments));return i[e].apply(i,t)}}),n}(0,n),e.ChildViewContainer.VERSION="0.1.5",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer,s=l,p=(r=o).Wreqr,f=r.Wreqr={},r.Wreqr.VERSION="1.3.1",r.Wreqr.noConflict=function(){return r.Wreqr=p,this},f.Handlers=(u=s,g.extend=(a=r).Model.extend,u.extend(g.prototype,a.Events,{setHandlers:function(t){u.each(t,function(t,e){var n=null;u.isObject(t)&&!u.isFunction(t)&&(n=t.context,t=t.callback),this.setHandler(e,t,n)},this)},setHandler:function(t,e,n){var i={callback:e,context:n};this._wreqrHandlers[t]=i,this.trigger("handler:add",t,e,n)},hasHandler:function(t){return!!this._wreqrHandlers[t]},getHandler:function(t){var e=this._wreqrHandlers[t];if(e)return function(){var t=Array.prototype.slice.apply(arguments);return e.callback.apply(e.context,t)}},removeHandler:function(t){delete this._wreqrHandlers[t]},removeAllHandlers:function(){this._wreqrHandlers={}}}),g),f.CommandStorage=(s.extend(m.prototype,r.Events,{getCommands:function(t){var e=this._commands[t];return e||(e={command:t,instances:[]},this._commands[t]=e),e},addCommand:function(t,e){this.getCommands(t).instances.push(e)},clearCommands:function(t){this.getCommands(t).instances=[]}}),m),f.Commands=(c=f).Handlers.extend({storageType:c.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var e=Array.prototype.slice.call(arguments);c.Handlers.prototype.constructor.apply(this,e)},execute:function(t,e){t=arguments[0],e=Array.prototype.slice.call(arguments,1),this.hasHandler(t)?this.getHandler(t).apply(this,e):this.storage.addCommand(t,e)},_executeCommands:function(t,e,n){var i=this.storage.getCommands(t);s.each(i.instances,function(t){e.apply(n,t)}),this.storage.clearCommands(t)},_initializeStorage:function(t){var e,n=t.storageType||this.storageType;e=s.isFunction(n)?new n:n,this.storage=e}}),f.RequestResponse=f.Handlers.extend({request:function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);if(this.hasHandler(t))return this.getHandler(t).apply(this,e)}}),f.EventAggregator=(d=s,v.extend=(h=r).Model.extend,d.extend(v.prototype,h.Events),v),f.Channel=(s.extend(y.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(t,e){return this._connect("vent",t,e),this},connectCommands:function(t,e){return this._connect("commands",t,e),this},connectRequests:function(t,e){return this._connect("reqres",t,e),this},_connect:function(n,t,i){if(t){i=i||this;var r="vent"===n?"on":"setHandler";s.each(t,function(t,e){this[n][r](e,s.bind(t,i))},this)}}}),y),f.radio=function(n){function t(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()}s.extend(t.prototype,{channel:function(t){if(!t)throw new Error("Channel must receive a name");return this._getChannel(t)},_getChannel:function(t){var e=this._channels[t];return e||(e=new n.Channel(t),this._channels[t]=e),e},_proxyMethods:function(){s.each(["vent","commands","reqres"],function(e){s.each(i[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var i={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(i,r,s){return function(t){var e=i._getChannel(t)[r],n=Array.prototype.slice.call(arguments,1);return e[s].apply(e,n)}};return new t}(f),r.Wreqr;var b=t.Marionette,w=o.Marionette={};w.VERSION="2.3.1",w.noConflict=function(){return t.Marionette=b,this},(o.Marionette=w).Deferred=o.$.Deferred,w.extend=o.Model.extend,w.isNodeAttached=function(t){return o.$.contains(document.documentElement,t)},w.getOption=function(t,e){if(t&&e)return t.options&&void 0!==t.options[e]?t.options[e]:t[e]},w.proxyGetOption=function(t){return w.getOption(this,t)},w._getValue=function(t,e,n){return l.isFunction(t)&&(t=t.apply(e,n)),t},w.normalizeMethods=function(t){return l.reduce(t,function(t,e,n){return l.isFunction(e)||(e=this[e]),e&&(t[n]=e),t},{},this)},w.normalizeUIString=function(t,e){return t.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(t){return e[t.slice(4)]})},w.normalizeUIKeys=function(t,i){return l.reduce(t,function(t,e,n){return t[w.normalizeUIString(n,i)]=e,t},{})},w.normalizeUIValues=function(n,i){return l.each(n,function(t,e){l.isString(t)&&(n[e]=w.normalizeUIString(t,i))}),n},w.actAsCollection=function(t,n){l.each(["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"],function(e){t[e]=function(){var t=[l.values(l.result(this,n))].concat(l.toArray(arguments));return l[e].apply(l,t)}})};var _,x,S=w.deprecate=function(t,e){l.isObject(t)&&(t=t.prev+" is going to be removed in the future. Please use "+t.next+" instead."+(t.url?" See: "+t.url:"")),void 0!==e&&e||S._cache[t]||(S._warn("Deprecation warning: "+t),S._cache[t]=!0)};function T(t,e,n){return n.toUpperCase()}function C(n,i,r,t){var e=t.split(/\s+/);l.each(e,function(t){var e=n[t];if(!e)throw new x.Error('Method "'+t+'" was configured as an event handler, but does not exist.');n.listenTo(i,r,e)})}function E(t,e,n,i){t.listenTo(e,n,i)}function k(n,i,r,t){var e=t.split(/\s+/);l.each(e,function(t){var e=n[t];n.stopListening(i,r,e)})}function M(t,e,n,i){t.stopListening(e,n,i)}function D(n,i,t,r,s){if(i&&t){if(!l.isObject(t))throw new x.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});t=x._getValue(t,n),l.each(t,function(t,e){l.isFunction(t)?r(n,i,e,t):s(n,i,e,t)})}}S._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},S._cache={},w._triggerMethod=(_=/(^|:)(\w)/gi,function(t,e,n){var i=arguments.length<3;i&&(e=(n=e)[0]);var r,s=t["on"+e.replace(_,T)];return l.isFunction(s)&&(r=s.apply(t,i?l.rest(n):n)),l.isFunction(t.trigger)&&(1<i+n.length?t.trigger.apply(t,i?n:[e].concat(l.rest(n,0))):t.trigger(e)),r}),w.triggerMethod=function(t){return w._triggerMethod(this,arguments)},w.triggerMethodOn=function(t){return(l.isFunction(t.triggerMethod)?t.triggerMethod:w.triggerMethod).apply(t,l.rest(arguments))},w.MonitorDOMRefresh=function(t){function e(){t._isShown&&t._isRendered&&w.isNodeAttached(t.el)&&l.isFunction(t.triggerMethod)&&t.triggerMethod("dom:refresh")}t.on({show:function(){t._isShown=!0,e()},render:function(){t._isRendered=!0,e()}})},(x=w).bindEntityEvents=function(t,e,n){D(t,e,n,E,C)},x.unbindEntityEvents=function(t,e,n){D(t,e,n,M,k)},x.proxyBindEntityEvents=function(t,e){return x.bindEntityEvents(this,t,e)},x.proxyUnbindEntityEvents=function(t,e){return x.unbindEntityEvents(this,t,e)};var O,A,N,j,R=["description","fileName","lineNumber","name","message","number"];function L(t,e){return A.isObject(t.behaviors)?(e=L.parseBehaviors(t,e||A.result(t,"behaviors")),L.wrap(t,e,A.keys(j)),e):{}}function I(t,e){this._view=t,this._viewUI=A.result(t,"ui"),this._behaviors=e,this._triggers={}}return w.Error=w.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+w.VERSION+"/",constructor:function(t,e){l.isObject(t)?t=(e=t).message:e=e||{};var n=Error.call(this,t);l.extend(this,l.pick(n,R),l.pick(e,R)),this.captureStackTrace(),e.url&&(this.url=this.urlRoot+e.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,w.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),w.Error.extend=w.extend,w.Callbacks=function(){this._deferred=w.Deferred(),this._callbacks=[]},l.extend(w.Callbacks.prototype,{add:function(e,n){var t=l.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:n}),t.then(function(t){n&&(t.context=n),e.call(t.context,t.options)})},run:function(t,e){this._deferred.resolve({options:t,context:e})},reset:function(){var t=this._callbacks;this._deferred=w.Deferred(),this._callbacks=[],l.each(t,function(t){this.add(t.cb,t.ctx)},this)}}),w.Controller=function(t){this.options=t||{},l.isFunction(this.initialize)&&this.initialize(this.options)},w.Controller.extend=w.extend,l.extend(w.Controller.prototype,o.Events,{destroy:function(){return w._triggerMethod(this,"before:destroy",arguments),w._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:w.triggerMethod,getOption:w.proxyGetOption}),w.Object=function(t){this.options=l.extend({},l.result(this,"options"),t),this.initialize.apply(this,arguments)},w.Object.extend=w.extend,l.extend(w.Object.prototype,o.Events,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening()},triggerMethod:w.triggerMethod,getOption:w.proxyGetOption,bindEntityEvents:w.proxyBindEntityEvents,unbindEntityEvents:w.proxyUnbindEntityEvents}),w.Region=w.Object.extend({constructor:function(t){if(this.options=t||{},this.el=this.getOption("el"),this.el=this.el instanceof o.$?this.el[0]:this.el,!this.el)throw new w.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),w.Object.call(this,t)},show:function(t,e){if(this._ensureElement()){this._ensureViewIsIntact(t);var n=e||{},i=t!==this.currentView,r=!!n.preventDestroy,s=!!n.forceShow,o=!!this.currentView,a=i&&!r,l=i||s;if(o&&this.triggerMethod("before:swapOut",this.currentView,this,e),this.currentView&&delete this.currentView._parent,a?this.empty():o&&l&&this.currentView.off("destroy",this.empty,this),l){t.once("destroy",this.empty,this),t.render(),t._parent=this,o&&this.triggerMethod("before:swap",t,this,e),this.triggerMethod("before:show",t,this,e),w.triggerMethodOn(t,"before:show",t,this,e),o&&this.triggerMethod("swapOut",this.currentView,this,e);var u=w.isNodeAttached(this.el),c=[],h=n.triggerBeforeAttach||this.triggerBeforeAttach,d=n.triggerAttach||this.triggerAttach;return u&&h&&(c=this._displayedViews(t),this._triggerAttach(c,"before:")),this.attachHtml(t),this.currentView=t,u&&d&&(c=this._displayedViews(t),this._triggerAttach(c)),o&&this.triggerMethod("swap",t,this,e),this.triggerMethod("show",t,this,e),w.triggerMethodOn(t,"show",t,this,e),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(t,e){var n=(e||"")+"attach";l.each(t,function(t){w.triggerMethodOn(t,n,t,this)},this)},_displayedViews:function(t){return l.union([t],l.result(t,"_getNestedViews")||[])},_ensureElement:function(){if(l.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),this.$el&&0!==this.$el.length)return!0;if(this.getOption("allowMissingEl"))return!1;throw new w.Error('An "el" '+this.$el.selector+" must exist in DOM")},_ensureViewIsIntact:function(t){if(!t)throw new w.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(t.isDestroyed)throw new w.Error({name:"ViewDestroyedError",message:'View (cid: "'+t.cid+'") has already been destroyed and cannot be used.'})},getEl:function(t){return o.$(t,w._getValue(this.options.parentEl,this))},attachHtml:function(t){this.$el.contents().detach(),this.el.appendChild(t.el)},empty:function(){var t=this.currentView;if(t)return t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,this},_destroyView:function(){var t=this.currentView;t.destroy&&!t.isDestroyed?t.destroy():t.remove&&(t.remove(),t.isDestroyed=!0)},attachView:function(t){return this.currentView=t,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(t,e){if(l.isString(t))return this._buildRegionFromSelector(t,e);if(t.selector||t.el||t.regionClass)return this._buildRegionFromObject(t,e);if(l.isFunction(t))return this._buildRegionFromRegionClass(t);throw new w.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(t,e){return new e({el:t})},_buildRegionFromObject:function(t,e){var n=t.regionClass||e,i=l.omit(t,"selector","regionClass");return t.selector&&!i.el&&(i.el=t.selector),new n(i)},_buildRegionFromRegionClass:function(t){return new t}}),w.RegionManager=w.Controller.extend({constructor:function(t){this._regions={},w.Controller.call(this,t),this.addRegions(this.getOption("regions"))},addRegions:function(t,i){return t=w._getValue(t,this,arguments),l.reduce(t,function(t,e,n){return l.isString(e)&&(e={selector:e}),e.selector&&(e=l.defaults({},e,i)),t[n]=this.addRegion(n,e),t},{},this)},addRegion:function(t,e){var n;return n=e instanceof w.Region?e:w.Region.buildRegion(e,w.Region),this.triggerMethod("before:add:region",t,n),(n._parent=this)._store(t,n),this.triggerMethod("add:region",t,n),n},get:function(t){return this._regions[t]},getRegions:function(){return l.clone(this._regions)},removeRegion:function(t){var e=this._regions[t];return this._remove(t,e),e},removeRegions:function(){var t=this.getRegions();return l.each(this._regions,function(t,e){this._remove(e,t)},this),t},emptyRegions:function(){var t=this.getRegions();return l.invoke(t,"empty"),t},destroy:function(){return this.removeRegions(),w.Controller.prototype.destroy.apply(this,arguments)},_store:function(t,e){this._regions[t]=e,this._setLength()},_remove:function(t,e){this.triggerMethod("before:remove:region",t,e),e.empty(),e.stopListening(),delete e._parent,delete this._regions[t],this._setLength(),this.triggerMethod("remove:region",t,e)},_setLength:function(){this.length=l.size(this._regions)}}),w.actAsCollection(w.RegionManager.prototype,"_regions"),w.TemplateCache=function(t){this.templateId=t},l.extend(w.TemplateCache,{templateCaches:{},get:function(t){var e=this.templateCaches[t];return e||(e=new w.TemplateCache(t),this.templateCaches[t]=e),e.load()},clear:function(){var t,e=l.toArray(arguments),n=e.length;if(0<n)for(t=0;t<n;t++)delete this.templateCaches[e[t]];else this.templateCaches={}}}),l.extend(w.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(t),this.compiledTemplate},loadTemplate:function(t){var e=o.$(t).html();if(!e||0===e.length)throw new w.Error({name:"NoTemplateError",message:'Could not find template: "'+t+'"'});return e},compileTemplate:function(t){return l.template(t)}}),w.Renderer={render:function(t,e){if(!t)throw new w.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return(l.isFunction(t)?t:w.TemplateCache.get(t))(e)}},w.View=o.View.extend({isDestroyed:!1,constructor:function(t){l.bindAll(this,"render"),t=w._getValue(t,this),this.options=l.extend({},l.result(this,"options"),t),this._behaviors=w.Behaviors(this),o.View.apply(this,arguments),w.MonitorDOMRefresh(this),this.on("show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(t){return t.toJSON.apply(t,l.rest(arguments))},mixinTemplateHelpers:function(t){t=t||{};var e=this.getOption("templateHelpers");return e=w._getValue(e,this),l.extend(t,e)},normalizeUIKeys:function(t){var e=l.result(this,"_uiBindings");return w.normalizeUIKeys(t,e||l.result(this,"ui"))},normalizeUIValues:function(t){var e=l.result(this,"ui"),n=l.result(this,"_uiBindings");return w.normalizeUIValues(t,n||e)},configureTriggers:function(){if(this.triggers){var t=this.normalizeUIKeys(l.result(this,"triggers"));return l.reduce(t,function(t,e,n){return t[n]=this._buildViewTrigger(e),t},{},this)}},delegateEvents:function(t){return this._delegateDOMEvents(t),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),l.each(this._behaviors,function(t){t.bindEntityEvents(this.model,t.getOption("modelEvents")),t.bindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(t){var e=w._getValue(t||this.events,this);e=this.normalizeUIKeys(e),l.isUndefined(t)&&(this.events=e);var n={},i=l.result(this,"behaviorEvents")||{},r=this.configureTriggers(),s=l.result(this,"behaviorTriggers")||{};l.extend(n,i,e,r,s),o.View.prototype.delegateEvents.call(this,n)},undelegateEvents:function(){return o.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),l.each(this._behaviors,function(t){t.unbindEntityEvents(this.model,t.getOption("modelEvents")),t.unbindEntityEvents(this.collection,t.getOption("collectionEvents"))},this),this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new w.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(!this.isDestroyed){var t=l.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(t)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(t)),this.unbindUIElements(),this.remove(),l.invoke(this._behaviors,"destroy",t),this}},bindUIElements:function(){this._bindUIElements(),l.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var t=l.result(this,"_uiBindings");this.ui={},l.each(t,function(t,e){this.ui[e]=this.$(t)},this)}},unbindUIElements:function(){this._unbindUIElements(),l.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(l.each(this.ui,function(t,e){delete this.ui[e]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(t){var e=l.isObject(t),n=l.defaults({},e?t:{},{preventDefault:!0,stopPropagation:!0}),i=e?n.event:t;return function(t){t&&(t.preventDefault&&n.preventDefault&&t.preventDefault(),t.stopPropagation&&n.stopPropagation&&t.stopPropagation());var e={view:this,model:this.model,collection:this.collection};this.triggerMethod(i,e)}},setElement:function(){var t=o.View.prototype.setElement.apply(this,arguments);return l.invoke(this._behaviors,"proxyViewProperties",this),t},triggerMethod:function(){for(var t=w._triggerMethod,e=t(this,arguments),n=this._behaviors,i=0,r=n&&n.length;i<r;i++)t(n[i],arguments);return e},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var t=this._getImmediateChildren();return t.length?l.reduce(t,function(t,e){return e._getNestedViews?t.concat(e._getNestedViews()):t},t):t},normalizeMethods:w.normalizeMethods,getOption:w.proxyGetOption,bindEntityEvents:w.proxyBindEntityEvents,unbindEntityEvents:w.proxyUnbindEntityEvents}),w.ItemView=w.View.extend({constructor:function(){w.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var t=[this.model||this.collection];return arguments.length&&t.push.apply(t,arguments),this.model?this.serializeModel.apply(this,t):{items:this.serializeCollection.apply(this,t)}},serializeCollection:function(t){return t.toJSON.apply(t,l.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var t=this.getTemplate();if(!1!==t){if(!t)throw new w.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var e=this.serializeData();e=this.mixinTemplateHelpers(e);var n=w.Renderer.render(t,e,this);return this.attachElContent(n),this}},attachElContent:function(t){return this.$el.html(t),this}}),w.CollectionView=w.View.extend({childViewEventPrefix:"childview",constructor:function(t){var e=t||{};l.isUndefined(this.sort)&&(this.sort=!!l.isUndefined(e.sort)||e.sort),this.once("render",this._initialEvents),this._initChildViewStorage(),w.View.apply(this,arguments),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&l.each(this._bufferedChildren,l.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&(l.each(this._bufferedChildren,l.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(t,e){w.triggerMethodOn(e,t)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(t){this.destroyEmptyView();var e=this.getChildView(t),n=this.collection.indexOf(t);this.addChild(t,e,n)},_onCollectionRemove:function(t){var e=this.children.findByModel(t);this.removeChildView(e),this.checkEmpty()},onShowCalled:function(){this.children.each(l.partial(this._triggerMethodOnChild,"show"))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},resortView:function(){this.render()},_sortViews:function(){this.collection.find(function(t,e){var n=this.children.findByModel(t);return!n||n._index!==e},this)&&this.resortView()},_emptyViewIndex:-1,_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var n;this.collection.each(function(t,e){n=this.getChildView(t),this.addChild(t,n,e)},this)},showEmptyView:function(){var t=this.getEmptyView();if(t&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var e=new o.Model;this.addEmptyView(e,t),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(t,e){var n=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");l.isFunction(n)&&(n=n.call(this,t,this._emptyViewIndex));var i=this.buildChildView(t,e,n);(i._parent=this).proxyChildEvents(i),this._isShown&&w.triggerMethodOn(i,"before:show"),this.children.add(i),this.renderChildView(i,this._emptyViewIndex),this._isShown&&w.triggerMethodOn(i,"show")},getChildView:function(t){var e=this.getOption("childView");if(!e)throw new w.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return e},addChild:function(t,e,n){var i=this.getOption("childViewOptions");i=w._getValue(i,this,[t,n]);var r=this.buildChildView(t,e,i);return this._updateIndices(r,!0,n),this._addChildView(r,n),r._parent=this,r},_updateIndices:function(e,n,t){this.sort&&(n&&(e._index=t),this.children.each(function(t){t._index>=e._index&&(t._index+=n?1:-1)}))},_addChildView:function(t,e){this.proxyChildEvents(t),this.triggerMethod("before:add:child",t),this.children.add(t),this.renderChildView(t,e),this._isShown&&!this.isBuffering&&w.triggerMethodOn(t,"show"),this.triggerMethod("add:child",t)},renderChildView:function(t,e){return t.render(),this.attachHtml(this,t,e),t},buildChildView:function(t,e,n){return new e(l.extend({model:t},n))},removeChildView:function(t){return t&&(this.triggerMethod("before:remove:child",t),t.destroy?t.destroy():t.remove&&t.remove(),delete t._parent,this.stopListening(t),this.children.remove(t),this.triggerMethod("remove:child",t),this._updateIndices(t,!1)),t},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(t,e){t.$el.append(e)},attachHtml:function(t,e,n){t.isBuffering?(t.elBuffer.appendChild(e.el),t._bufferedChildren.push(e)):t._insertBefore(e,n)||t._insertAfter(e)},_insertBefore:function(t,e){var n;return this.sort&&e<this.children.length-1&&(n=this.children.find(function(t){return t._index===e+1})),!!n&&(n.$el.before(t.el),!0)},_insertAfter:function(t){this.$el.append(t.el)},_initChildViewStorage:function(){this.children=new o.ChildViewContainer},destroy:function(){if(!this.isDestroyed)return this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),w.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(){var t=this.children.map(l.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),t},proxyChildEvents:function(i){var r=this.getOption("childViewEventPrefix");this.listenTo(i,"all",function(){var t=l.toArray(arguments),e=t[0],n=this.normalizeMethods(l.result(this,"childEvents"));t[0]=r+":"+e,t.splice(1,0,i),void 0!==n&&l.isFunction(n[e])&&n[e].apply(this,t.slice(1)),this.triggerMethod.apply(this,t)},this)},_getImmediateChildren:function(){return l.values(this.children._views)}}),w.CompositeView=w.CollectionView.extend({constructor:function(){w.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(t){return this.getOption("childView")||this.constructor},serializeData:function(){var t={};return this.model&&(t=l.partial(this.serializeModel,this.model).apply(this,arguments)),t},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&w.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var t={};t=this.serializeData(),t=this.mixinTemplateHelpers(t),this.triggerMethod("before:render:template");var e=this.getTemplate(),n=w.Renderer.render(e,t,this);this.attachElContent(n),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(t){return this.$el.html(t),this},attachBuffer:function(t,e){this.getChildViewContainer(t).append(e)},_insertAfter:function(t){this.getChildViewContainer(this,t).append(t.el)},getChildViewContainer:function(t,e){if("$childViewContainer"in t)return t.$childViewContainer;var n,i=w.getOption(t,"childViewContainer");if(i){var r=w._getValue(i,t);if((n="@"===r.charAt(0)&&t.ui?t.ui[r.substr(4)]:t.$(r)).length<=0)throw new w.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+t.childViewContainer})}else n=t.$el;return t.$childViewContainer=n},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),w.LayoutView=w.ItemView.extend({regionClass:w.Region,constructor:function(t){t=t||{},this._firstRender=!0,this._initializeRegions(t),w.ItemView.call(this,t)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),w.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.regionManager.destroy(),w.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(t,e){var n={};return n[t]=e,this._buildRegions(n)[t]},addRegions:function(t){return this.regions=l.extend({},this.regions,t),this._buildRegions(t)},removeRegion:function(t){return delete this.regions[t],this.regionManager.removeRegion(t)},getRegion:function(t){return this.regionManager.get(t)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(t){var e={regionClass:this.getOption("regionClass"),parentEl:l.partial(l.result,this,"el")};return this.regionManager.addRegions(t,e)},_initializeRegions:function(t){var e;this._initRegionManager(),e=w._getValue(this.regions,this,[t])||{};var n=this.getOption.call(t,"regions");n=w._getValue(n,this,[t]),l.extend(e,n),e=this.normalizeUIValues(e),this.addRegions(e)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new w.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),(this.regionManager._parent=this).listenTo(this.regionManager,"before:add:region",function(t){this.triggerMethod("before:add:region",t)}),this.listenTo(this.regionManager,"add:region",function(t,e){this[t]=e,this.triggerMethod("add:region",t,e)}),this.listenTo(this.regionManager,"before:remove:region",function(t){this.triggerMethod("before:remove:region",t)}),this.listenTo(this.regionManager,"remove:region",function(t,e){delete this[t],this.triggerMethod("remove:region",t,e)})},_getImmediateChildren:function(){return l.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),w.Behavior=w.Object.extend({constructor:function(t,e){this.view=e,this.defaults=l.result(this,"defaults")||{},this.options=l.extend({},this.defaults,t),w.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){this.stopListening()},proxyViewProperties:function(t){this.$el=t.$el,this.el=t.el}}),w.Behaviors=(O=w,N=/^(\S+)\s*(.*)$/,j={behaviorTriggers:function(t,e){return new I(this,e).buildBehaviorTriggers()},behaviorEvents:function(t,e){var i={},r=this._uiBindings||A.result(this,"ui");return A.each(e,function(s,o){var a={},t=A.clone(A.result(s,"events"))||{},e=s._uiBindings||A.result(s,"ui"),n=A.extend({},r,e);t=O.normalizeUIKeys(t,n);var l=0;A.each(t,function(t,e){var n=e.match(N),i=n[1]+"."+[this.cid,o,l++," "].join("")+n[2],r=A.isFunction(t)?t:s[t];a[i]=A.bind(r,s)},this),i=A.extend(i,a)},this),i}},(A=l).extend(L,{behaviorsLookup:function(){throw new O.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,e){return t.behaviorClass?t.behaviorClass:O._getValue(L.behaviorsLookup,this,[t,e])[e]},parseBehaviors:function(r,t){return A.chain(t).map(function(t,e){var n=new(L.getBehaviorClass(t,e))(t,r),i=L.parseBehaviors(r,A.result(n,"behaviors"));return[n].concat(i)}).flatten().value()},wrap:function(e,n,t){A.each(t,function(t){e[t]=A.partial(j[t],e[t],n)})}}),A.extend(I.prototype,{buildBehaviorTriggers:function(){return A.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(t,e){var n=A.extend({},this._viewUI,A.result(t,"ui")),i=A.clone(A.result(t,"triggers"))||{};i=O.normalizeUIKeys(i,n),A.each(i,A.bind(this._setHandlerForBehavior,this,t,e))},_setHandlerForBehavior:function(t,e,n,i){var r=i.replace(/^\S+/,function(t){return t+".behaviortriggers"+e});this._triggers[r]=this._view._buildViewTrigger(n)}}),L),w.AppRouter=o.Router.extend({constructor:function(t){this.options=t||{},o.Router.apply(this,arguments);var e=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,e),this.on("route",this._processOnRoute,this)},appRoute:function(t,e){var n=this._getController();this._addAppRoute(n,t,e)},_processOnRoute:function(t,e){if(l.isFunction(this.onRoute)){var n=l.invert(this.getOption("appRoutes"))[t];this.onRoute(t,n,e)}},processAppRoutes:function(e,n){if(n){var t=l.keys(n).reverse();l.each(t,function(t){this._addAppRoute(e,t,n[t])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(t,e,n){var i=t[n];if(!i)throw new w.Error('Method "'+n+'" was not found on the controller');this.route(e,n,l.bind(i,t))},getOption:w.proxyGetOption,triggerMethod:w.triggerMethod,bindEntityEvents:w.proxyBindEntityEvents,unbindEntityEvents:w.proxyUnbindEntityEvents}),w.Application=w.Object.extend({constructor:function(t){this._initializeRegions(t),this._initCallbacks=new w.Callbacks,this.submodules={},l.extend(this,t),this._initChannel(),w.Object.call(this,t)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(t){this._initCallbacks.add(t)},start:function(t){this.triggerMethod("before:start",t),this._initCallbacks.run(t,this),this.triggerMethod("start",t)},addRegions:function(t){return this._regionManager.addRegions(t)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(t){return this._regionManager.removeRegion(t)},getRegion:function(t){return this._regionManager.get(t)},getRegions:function(){return this._regionManager.getRegions()},module:function(t,e){var n=w.Module.getClass(e),i=l.toArray(arguments);return i.unshift(this),n.create.apply(n,i)},getRegionManager:function(){return new w.RegionManager},_initializeRegions:function(t){var e=l.isFunction(this.regions)?this.regions(t):this.regions||{};this._initRegionManager();var n=w.getOption(t,"regions");return l.isFunction(n)&&(n=n.call(this,t)),l.extend(e,n),this.addRegions(e),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),(this._regionManager._parent=this).listenTo(this._regionManager,"before:add:region",function(){w._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(t,e){this[t]=e,w._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){w._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(t){delete this[t],w._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=l.result(this,"channelName")||"global",this.channel=l.result(this,"channel")||o.Wreqr.radio.channel(this.channelName),this.vent=l.result(this,"vent")||this.channel.vent,this.commands=l.result(this,"commands")||this.channel.commands,this.reqres=l.result(this,"reqres")||this.channel.reqres}}),w.Module=function(t,e,n){this.moduleName=t,this.options=l.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=e,l.isFunction(this.initialize)&&this.initialize(t,e,this.options)},w.Module.extend=w.extend,l.extend(w.Module.prototype,o.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(e){this._isInitialized||(l.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),l.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(t,e){this._runModuleDefinition(t,e)},_runModuleDefinition:function(t,e){if(t){var n=l.flatten([this,this.app,o,w,o.$,l,e]);t.apply(this,n)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new w.Callbacks,this._finalizerCallbacks=new w.Callbacks},triggerMethod:w.triggerMethod}),l.extend(w.Module,{create:function(i,t,r){var s=i,o=l.rest(arguments,3),e=(t=t.split(".")).length,a=[];return a[e-1]=r,l.each(t,function(t,e){var n=s;s=this._getModule(n,t,i,r),this._addModuleDefinition(n,s,a[e],o)},this),s},_getModule:function(t,e,n,i,r){var s=l.extend({},i),o=this.getClass(i),a=t[e];return a||(a=new o(e,n,s),t[e]=a,t.submodules[e]=a),a},getClass:function(t){var e=w.Module;return t?t.prototype instanceof e?t:t.moduleClass||e:e},_addModuleDefinition:function(t,e,n,i){var r=this._getDefine(n),s=this._getStartWithParent(n,e);r&&e.addDefinition(r,i),this._addStartWithParent(t,e,s)},_getStartWithParent:function(t,e){var n;return l.isFunction(t)&&t.prototype instanceof w.Module?(n=e.constructor.prototype.startWithParent,!!l.isUndefined(n)||n):!l.isObject(t)||(n=t.startWithParent,!!l.isUndefined(n)||n)},_getDefine:function(t){return!l.isFunction(t)||t.prototype instanceof w.Module?l.isObject(t)?t.define:null:t},_addStartWithParent:function(t,e,n){e.startWithParent=e.startWithParent&&n,e.startWithParent&&!e.startWithParentIsConfigured&&(e.startWithParentIsConfigured=!0,t.addInitializer(function(t){e.startWithParent&&e.start(t)}))}}),w}),function(t){"function"==typeof define&&define.amd?define(["backbone","underscore"],t):"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):t(window.Backbone,window._)}(function(t,r){function s(){}var o=t.Router.prototype.route;r.extend(t.Router.prototype,{before:s,after:s,route:function(e,t,n){n=n||this[t];var i=r.bind(function(){var t=[e,r.toArray(arguments)];!1!==(r.isFunction(this.before)?this.before:void 0!==this.before[e]?this.before[e]:s).apply(this,t)&&(n&&n.apply(this,arguments),(r.isFunction(this.after)?this.after:void 0!==this.after[e]?this.after[e]:s).apply(this,t))},this);return o.call(this,e,t,i)}})}),function(i,t,e,n,r,s){"use strict";"object"==typeof n?r.exports=s(e("underscore"),e("backbone"),e("jquery")):"function"==typeof t&&t.amd?t(["underscore","backbone","jquery"],function(t,e,n){return t=void 0===t?i._:t,e=void 0===e?i.Backbone:e,n=void 0===n?i.$:n,i.Backbone=s(t,e,n)}):i.returnExportsGlobal=s(i._,i.Backbone,i.$)}(this,this.define,this.require,this.exports,this.module,function(m,v,n,y){"use strict";function t(t){this.options=t!==y?t:{},this.namespaceDelimiter=t!==y&&t.namespaceDelimiter!==y?t.namespaceDelimiter:this.namespaceDelimiter,this.contentType=t!==y&&t.contentType!==y?t.contentType:this.contentType,m.bindAll(this)}var s,o,a,e=v.Model.prototype.constructor,i=v.sync,b={};return t.prototype={options:{},charset:"iso-8859-1",namespace:"",namespaceDelimiter:"/",contentType:"application/json",url:null,responseID:null,exceptions:{404:{code:-1,message:"404"},500:{code:-2,message:"500"},typeMissmatch:{code:-3,message:"Type missmatch"},badResponseId:{code:-4,message:"Bad response ID"},noResponse:{code:-5,message:"No response"},noDefError:{code:-6,message:"No error defined"},renderError:function(t,e){return{code:e!==y?-7:e,message:t?"No error defined":t}}},onSuccess:function(t,e,n){if(!0===m.isFunction(t)){if(null===n||n===y)return this.handleExceptions(this.exceptions.noResponse),this;null!==n&&e!==String(n.id)&&this.handleExceptions(this.exceptions.badResponseId),t.apply(this,[n.result,n.error])}else this.onError(n)},onError:function(t,e){if(null===e||e===y)return this.handleExceptions(this.exceptions.noResponse),this;null!==e.error&&y!==e.error?this.handleExceptions(e.error):this.handleExceptions(this.exceptions.noDefError)},query:function(t,e,i){var r=String((new Date).getTime());return this.responseID=r,(m.isArray(e)||m.isObject(e))&&m.isString(t)?n.ajax({contentType:this.contentType+"; charset="+this.charset,type:"POST",dataType:"json",url:this.url,data:JSON.stringify({jsonrpc:"2.0",method:this.namespace+this.namespaceDelimiter+t,id:r,params:e}),statusCode:{404:m.bind(function(){this.handleExceptions(this.exceptions[404])},this),500:m.bind(function(){this.handleExceptions(this.exceptions[500])},this)},success:m.bind(function(t,e,n){null!==t&&t.error!==y?this.onError(i,t,e,n):this.onSuccess(i,r,t,e,n)},this),error:m.bind(function(t,e,n){404!==t.status&&500!==t.status&&this.onError(i,t,e,n)},this)}):this.handleExceptions(this.exceptions.typeMissmatch)},checkMethods:function(n,t,i,e,r,s,o){var a=this,l=this.options&&!0===this.options.useNamedParameters,u=null,c=!1,h=null,d=[],p={},f=null,g=i;return(l=i.options&&i.options.useNamedParameters?i.options.useNamedParameters:l)&&(d={},m.isFunction(i.args)&&(g=i.args())),e="delete"===e?"remove":e,m.isArray(i.methods[e])||m.isFunction(i.methods[e])?(u=m.isFunction(i.methods[e])?(m.isString(b[i.get("_rpcId")])||m.each(b[i.get("_rpcId")],function(t,e){i.get(e)!==t&&(p[e]=!0)}),b[i.get("_rpcId")]=i.toJSON(),m.bind(i.methods[e],i)(p,r)):i.methods[e],m.isArray(u[0])&&(c=!0),!0!==c?(f=m.clone(u),h=f.shift(),0<f.length?m.each(f,function(t){""===t?m.isArray(d)&&d.push(""):i instanceof v.Collection?g!==y&&g[t]!==y?d=a.addParam(d,g,t,m.isFunction(g[t]),!1):r[t]!==y&&(d=a.addParam(d,r,t,!1,!1)):i.get(t)!==y?d=a.addParam(d,i,t,!1,!0):r[t]!==y&&(d=a.addParam(d,r,t,!1,!1))}):d=m.isArray(d)?[]:{},n(h,d,s,o)):(m.each(u,function(t){var e=m.clone(t);return h=null,d=[],h=e.shift(),m.each(e,function(t){d.push(i.get(t))}),n(h,d,s,o)}),null)):this.handleExceptions(this.exceptions.typeMissmatch)},addParam:function(t,e,n,i,r){var s;return s=r?e.get(n):i?e[n]():e[n],m.isArray(t)?t.push(s):s!==y&&(t[n]=s),t},invoke:function(n,e,i){var t={success:function(t){e.trigger("called:"+n,e,t),i!==y&&m.isFunction(i.success)&&i.success(e,t)},error:function(t,e){t.trigger("error",t,e),t.trigger("error:"+n,t,e),i!==y&&m.isFunction(i.error)&&i.error(t,e)}};return v.sync(n,e,t),this},defaultExceptionHandler:function(t){throw"Error code: "+t.code+" - message: "+t.message},handleExceptions:function(t){return(m.isFunction(this.options.exceptionHandler)?this.options.exceptionHandler:this.defaultExceptionHandler).call(this,t),this}},v.Rpc=t,v.Model=v.Model.extend({constructor:function(t){this.rpc!==y&&!0===m.isFunction(this.rpc.invoke)&&this.methods!==y&&m.each(this.methods,m.bind(function(t,e){1!=={read:1,create:1,remove:1,update:1}[e]&&(this[e]=m.bind(function(t){return this.rpc.invoke(e,this,t),this},this))},this)),e.apply(this,arguments)}}),v.sync=(s=t,o=null,(a=function(e,i,r){if(i.rpc instanceof s){if((o=i.rpc).url=m.isFunction(i.url)?i.url():i.url,!0===m.isString(i.namespace)&&(o.namespace=i.namespace),i.methods===y)throw"Backbone.Rpc Error: No Method(s) given!";return"object"!=typeof i.params&&(i.params={}),o.checkMethods(o.query,i.params,i,e,r,function(n,t){if(null!==t&&t!==y)return r.error(i,t),this;i instanceof v.Collection&&n!==y&&null!==n&&("object"==typeof n[0]?m.each(n,function(t,e){t._rpcId=m.uniqueId("rpc_"),n[e]=t,b[t._rpcId]=t}):m.each(n,function(t,e){b[e]=t})),i instanceof v.Model&&n!==y&&null!==n&&(n._rpcId=m.uniqueId("rpc_"),b[n._rpcId]=n),n!==y&&null!==n||(n=[]),i.parsers!==y&&i.parsers[e]!==y&&m.isFunction(i.parsers[e])&&i.parsers[e].apply(i,[n]),r.success(n)},function(t){r.error(i,t)})}return a.previous.apply(i,arguments)}).previous=i,a),v}),function(t,i){if("function"==typeof define&&define.amd)define(["underscore","backbone","jquery"],function(t,e,n){return i(t,e,n)});else if("undefined"!=typeof exports){var e=require("underscore"),n=require("backbone"),r=require("jquery");module.exports=i(e,n,r)}else i(t._,t.Backbone,t.jQuery)}(this,function(l,t,u){"use strict";var e=t.Syphon,n=t.Syphon={};n.VERSION="0.5.0",n.noConflict=function(){return t.Syphon=e,this},n.ignoredTypes=["button","submit","reset","fieldset"],n.serialize=function(t,e){var o={},a=d(e),n=c(t,a);return l.each(n,function(t){var e=u(t),n=h(e),i=a.keyExtractors.get(n)(e),r=a.inputReaders.get(n)(e);if(a.keyAssignmentValidators.get(n)(e,i,r)){var s=a.keySplitter(i);o=p(o,s,r)}}),o},n.deserialize=function(t,e,n){var r=d(n),i=c(t,r),s=o(r,e);l.each(i,function(t){var e=u(t),n=h(e),i=r.keyExtractors.get(n)(e);r.inputWriters.get(n)(e,s[i])})};var c=function(t,o){var e=i(t).elements;return e=l.reject(e,function(t){var e=h(t),n=o.keyExtractors.get(e)(u(t)),i=l.include(o.ignoredTypes,e),r=l.include(o.include,n),s=l.include(o.exclude,n);return!r&&(!!o.include||(s||i))})},h=function(t){var e=u(t),n=e[0].tagName,i=n;return"input"===n.toLowerCase()&&(i=e.attr("type")||"text"),i.toLowerCase()},i=function(t){return l.isUndefined(t.$el)&&"form"===t.tagName.toLowerCase()?t:t.$el.is("form")?t.el:t.$("form")[0]},d=function(t){var e=l.clone(t)||{};return e.ignoredTypes=l.clone(n.ignoredTypes),e.inputReaders=e.inputReaders||n.InputReaders,e.inputWriters=e.inputWriters||n.InputWriters,e.keyExtractors=e.keyExtractors||n.KeyExtractors,e.keySplitter=e.keySplitter||n.KeySplitter,e.keyJoiner=e.keyJoiner||n.KeyJoiner,e.keyAssignmentValidators=e.keyAssignmentValidators||n.KeyAssignmentValidators,e},p=function(t,e,n){if(!e)return t;var i=e.shift();return t[i]||(t[i]=l.isArray(i)?[]:{}),0===e.length&&(l.isArray(t[i])?t[i].push(n):t[i]=n),0<e.length&&p(t[i],e,n),t},o=function(i,t,r){var s={};return l.each(t,function(t,e){var n={};r&&(e=i.keyJoiner(r,e)),l.isArray(t)?n[e+="[]"]=t:l.isObject(t)?n=o(i,t,e):n[e]=t,l.extend(s,n)}),s},r=n.TypeRegistry=function(){this.registeredTypes={}};r.extend=t.Model.extend,l.extend(r.prototype,{get:function(t){return this.registeredTypes[t]||this.registeredTypes.default},register:function(t,e){this.registeredTypes[t]=e},registerDefault:function(t){this.registeredTypes.default=t},unregister:function(t){this.registeredTypes[t]&&delete this.registeredTypes[t]}});var s=n.KeyExtractorSet=r.extend();(n.KeyExtractors=new s).registerDefault(function(t){return t.prop("name")||""});var a=n.InputReaderSet=r.extend(),f=n.InputReaders=new a;f.registerDefault(function(t){return t.val()}),f.register("checkbox",function(t){return t.prop("checked")});var g=n.InputWriterSet=r.extend(),m=n.InputWriters=new g;m.registerDefault(function(t,e){t.val(e)}),m.register("checkbox",function(t,e){t.prop("checked",e)}),m.register("radio",function(t,e){t.prop("checked",t.val()===e.toString())});var v=n.KeyAssignmentValidatorSet=r.extend(),y=n.KeyAssignmentValidators=new v;return y.registerDefault(function(){return!0}),y.register("radio",function(t,e,n){return t.prop("checked")}),n.KeySplitter=function(t){var e,n=t.match(/[^\[\]]+/g);return t.indexOf("[]")===t.length-2&&(e=n.pop(),n.push([e])),n},n.KeyJoiner=function(t,e){return t+"["+e+"]"},t.Syphon}),function(t,n){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(t,e){return n(t,e)});else if("undefined"!=typeof exports){var e=require("backbone"),i=require("underscore");module.exports=n(e,i)}else n(t.Backbone,t._)}(this,function(e,s){"use strict";var t,i,n,r,o,a,l,u=e.Wreqr,c=e.Wreqr={};function h(t){this.options=t,this._wreqrHandlers={},i.isFunction(this.initialize)&&this.initialize(t)}function d(t){this.options=t,this._commands={},s.isFunction(this.initialize)&&this.initialize(t)}function p(){}function f(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t}return e.Wreqr.VERSION="1.3.2",e.Wreqr.noConflict=function(){return e.Wreqr=u,this},c.Handlers=(i=s,h.extend=(t=e).Model.extend,i.extend(h.prototype,t.Events,{setHandlers:function(t){i.each(t,function(t,e){var n=null;i.isObject(t)&&!i.isFunction(t)&&(n=t.context,t=t.callback),this.setHandler(e,t,n)},this)},setHandler:function(t,e,n){var i={callback:e,context:n};this._wreqrHandlers[t]=i,this.trigger("handler:add",t,e,n)},hasHandler:function(t){return!!this._wreqrHandlers[t]},getHandler:function(t){var e=this._wreqrHandlers[t];if(e)return function(){return e.callback.apply(e.context,arguments)}},removeHandler:function(t){delete this._wreqrHandlers[t]},removeAllHandlers:function(){this._wreqrHandlers={}}}),h),c.CommandStorage=(s.extend(d.prototype,e.Events,{getCommands:function(t){var e=this._commands[t];return e||(e={command:t,instances:[]},this._commands[t]=e),e},addCommand:function(t,e){this.getCommands(t).instances.push(e)},clearCommands:function(t){this.getCommands(t).instances=[]}}),d),c.Commands=(r=s,(n=c).Handlers.extend({storageType:n.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),n.Handlers.prototype.constructor.apply(this,arguments)},execute:function(t){t=arguments[0];var e=r.rest(arguments);this.hasHandler(t)?this.getHandler(t).apply(this,e):this.storage.addCommand(t,e)},_executeCommands:function(t,e,n){var i=this.storage.getCommands(t);r.each(i.instances,function(t){e.apply(n,t)}),this.storage.clearCommands(t)},_initializeStorage:function(t){var e,n=t.storageType||this.storageType;e=r.isFunction(n)?new n:n,this.storage=e}})),c.RequestResponse=(o=s,c.Handlers.extend({request:function(t){if(this.hasHandler(t))return this.getHandler(t).apply(this,o.rest(arguments))}})),c.EventAggregator=(l=s,p.extend=(a=e).Model.extend,l.extend(p.prototype,a.Events),p),c.Channel=(s.extend(f.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(t,e){return this._connect("vent",t,e),this},connectCommands:function(t,e){return this._connect("commands",t,e),this},connectRequests:function(t,e){return this._connect("reqres",t,e),this},_connect:function(n,t,i){if(t){i=i||this;var r="vent"===n?"on":"setHandler";s.each(t,function(t,e){this[n][r](e,s.bind(t,i))},this)}}}),f),c.radio=function(n,s){function t(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()}s.extend(t.prototype,{channel:function(t){if(!t)throw new Error("Channel must receive a name");return this._getChannel(t)},_getChannel:function(t){var e=this._channels[t];return e||(e=new n.Channel(t),this._channels[t]=e),e},_proxyMethods:function(){s.each(["vent","commands","reqres"],function(e){s.each(i[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var i={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(n,i,r){return function(t){var e=n._getChannel(t)[i];return e[r].apply(e,s.rest(arguments))}};return new t}(c,s),e.Wreqr});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,n,i,r,s,o,a,l="",u=0;for(t=Base64._utf8_encode(t);u<t.length;)r=(e=t.charCodeAt(u++))>>2,s=(3&e)<<4|(n=t.charCodeAt(u++))>>4,o=(15&n)<<2|(i=t.charCodeAt(u++))>>6,a=63&i,isNaN(n)?o=a=64:isNaN(i)&&(a=64),l=l+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(a);return l},decode:function(t){var e,n,i,r,s,o,a="",l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)e=this._keyStr.indexOf(t.charAt(l++))<<2|(r=this._keyStr.indexOf(t.charAt(l++)))>>4,n=(15&r)<<4|(s=this._keyStr.indexOf(t.charAt(l++)))>>2,i=(3&s)<<6|(o=this._keyStr.indexOf(t.charAt(l++))),a+=String.fromCharCode(e),64!=s&&(a+=String.fromCharCode(n)),64!=o&&(a+=String.fromCharCode(i));return a=Base64._utf8_decode(a)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e+=String.fromCharCode(i):(127<i&&i<2048?e+=String.fromCharCode(i>>6|192):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128)),e+=String.fromCharCode(63&i|128))}return e},_utf8_decode:function(t){for(var e="",n=0,i=c1=c2=0;n<t.length;)(i=t.charCodeAt(n))<128?(e+=String.fromCharCode(i),n++):191<i&&i<224?(c2=t.charCodeAt(n+1),e+=String.fromCharCode((31&i)<<6|63&c2),n+=2):(c2=t.charCodeAt(n+1),c3=t.charCodeAt(n+2),e+=String.fromCharCode((15&i)<<12|(63&c2)<<6|63&c3),n+=3);return e}};Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){function i(t,e){return("000"+t).slice(-1*(e=e||2))}var a,l,u,r=Date,t=r.prototype,o=r.CultureInfo;t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var t=new Date;return this.setHours(t.getHours()),this.setMinutes(t.getMinutes()),this.setSeconds(t.getSeconds()),this.setMilliseconds(t.getMilliseconds()),this},r.today=function(){return(new Date).clearTime()},r.compare=function(t,e){if(isNaN(t)||isNaN(e))throw new Error(t+" - "+e);if(t instanceof Date&&e instanceof Date)return t<e?-1:e<t?1:0;throw new TypeError(t+" - "+e)},r.equals=function(t,e){return 0===t.compareTo(e)},r.getDayNumberFromName=function(t){for(var e=o.dayNames,n=o.abbreviatedDayNames,i=o.shortestDayNames,r=t.toLowerCase(),s=0;s<e.length;s++)if(e[s].toLowerCase()==r||n[s].toLowerCase()==r||i[s].toLowerCase()==r)return s;return-1},r.getMonthNumberFromName=function(t){for(var e=o.monthNames,n=o.abbreviatedMonthNames,i=t.toLowerCase(),r=0;r<e.length;r++)if(e[r].toLowerCase()==i||n[r].toLowerCase()==i)return r;return-1},r.isLeapYear=function(t){return t%4==0&&t%100!=0||t%400==0},r.getDaysInMonth=function(t,e){return[31,r.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},r.getTimezoneAbbreviation=function(t){for(var e=o.timezones,n=0;n<e.length;n++)if(e[n].offset===t)return e[n].name;return null},r.getTimezoneOffset=function(t){for(var e=o.timezones,n=0;n<e.length;n++)if(e[n].name===t.toUpperCase())return e[n].offset;return null},t.clone=function(){return new Date(this.getTime())},t.compareTo=function(t){return Date.compare(this,t)},t.equals=function(t){return Date.equals(this,t||new Date)},t.between=function(t,e){return this.getTime()>=t.getTime()&&this.getTime()<=e.getTime()},t.isAfter=function(t){return 1===this.compareTo(t||new Date)},t.isBefore=function(t){return-1===this.compareTo(t||new Date)},t.isToday=function(){return this.isSameDay(new Date)},t.isSameDay=function(t){return this.clone().clearTime().equals(t.clone().clearTime())},t.addMilliseconds=function(t){return this.setMilliseconds(this.getMilliseconds()+t),this},t.addSeconds=function(t){return this.addMilliseconds(1e3*t)},t.addMinutes=function(t){return this.addMilliseconds(6e4*t)},t.addHours=function(t){return this.addMilliseconds(36e5*t)},t.addDays=function(t){return this.setDate(this.getDate()+t),this},t.addWeeks=function(t){return this.addDays(7*t)},t.addMonths=function(t){var e=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+t),this.setDate(Math.min(e,r.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addYears=function(t){return this.addMonths(12*t)},t.add=function(t){if("number"==typeof t)return this._orient=t,this;var e=t;return e.milliseconds&&this.addMilliseconds(e.milliseconds),e.seconds&&this.addSeconds(e.seconds),e.minutes&&this.addMinutes(e.minutes),e.hours&&this.addHours(e.hours),e.weeks&&this.addWeeks(e.weeks),e.months&&this.addMonths(e.months),e.years&&this.addYears(e.years),e.days&&this.addDays(e.days),this},t.getWeek=function(){var t,e,n,i,r,s,o;return a=a||this.getFullYear(),l=l||this.getMonth()+1,u=u||this.getDate(),i=l<=2?(o=(e=((t=a-1)/4|0)-(t/100|0)+(t/400|0))-(((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0)),n=0,u-1+31*(l-1)):(n=(o=(e=((t=a)/4|0)-(t/100|0)+(t/400|0))-(((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0)))+1,u+(153*(l-3)+2)/5+58+o),a=l=u=null,(s=i+3-(i+(r=(t+e)%7)-n)%7|0)<0?53-((r-o)/5|0):364+o<s?1:1+(s/7|0)},t.getISOWeek=function(){return a=this.getUTCFullYear(),l=this.getUTCMonth()+1,u=this.getUTCDate(),i(this.getWeek())},t.setWeek=function(t){return this.moveToDayOfWeek(1).addWeeks(t-this.getWeek())},r._validate=function(t,e,n,i){if(void 0===t)return!1;if("number"!=typeof t)throw new TypeError(t+" is not a Number.");if(t<e||n<t)throw new RangeError(t+" is not a valid value for "+i+".");return!0},r.validateMillisecond=function(t){return r._validate(t,0,999,"millisecond")},r.validateSecond=function(t){return r._validate(t,0,59,"second")},r.validateMinute=function(t){return r._validate(t,0,59,"minute")},r.validateHour=function(t){return r._validate(t,0,23,"hour")},r.validateDay=function(t,e,n){return r._validate(t,1,r.getDaysInMonth(e,n),"day")},r.validateMonth=function(t){return r._validate(t,0,11,"month")},r.validateYear=function(t){return r._validate(t,0,9999,"year")},t.set=function(t){return r.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),r.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),r.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),r.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),r.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),r.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),r.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),t.week&&r._validate(t.week,0,53,"week")&&this.setWeek(t.week),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:r.getDaysInMonth(this.getFullYear(),this.getMonth())})},t.moveToNthOccurrence=function(t,e){var n=0;if(0<e)n=e-1;else if(-1===e)return this.moveToLastDayOfMonth(),this.getDay()!==t&&this.moveToDayOfWeek(t,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(t,1).addWeeks(n)},t.moveToDayOfWeek=function(t,e){var n=(t-this.getDay()+7*(e||1))%7;return this.addDays(0===n?n+=7*(e||1):n)},t.moveToMonth=function(t,e){var n=(t-this.getMonth()+12*(e||1))%12;return this.addMonths(0===n?n+=12*(e||1):n)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return r.getTimezoneAbbreviation(this.getUTCOffset())},t.setTimezoneOffset=function(t){var e=this.getTimezoneOffset(),n=-6*Number(t)/10;return this.addMinutes(n-e)},t.setTimezone=function(t){return this.setTimezoneOffset(r.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()},t.getUTCOffset=function(){var t,e=-10*this.getTimezoneOffset()/6;return e<0?(t=(e-1e4).toString()).charAt(0)+t.substr(2):"+"+(t=(1e4+e).toString()).substr(1)},t.getElapsed=function(t){return(t||new Date)-this},t.toISOString||(t.toISOString=function(){function t(t){return t<10?"0"+t:t}return'"'+this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+'Z"'}),t._toString=t.toString,t.toString=function(t){var e=this;if(t&&1==t.length){var n=o.formatPatterns;switch(e.t=e.toString,t){case"d":return e.t(n.shortDate);case"D":return e.t(n.longDate);case"F":return e.t(n.fullDateTime);case"m":return e.t(n.monthDay);case"r":return e.t(n.rfc1123);case"s":return e.t(n.sortableDateTime);case"t":return e.t(n.shortTime);case"T":return e.t(n.longTime);case"u":return e.t(n.universalSortableDateTime);case"y":return e.t(n.yearMonth)}}return t?t.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(t){if("\\"===t.charAt(0))return t.replace("\\","");switch(e.h=e.getHours,t){case"hh":return i(e.h()<13?0===e.h()?12:e.h():e.h()-12);case"h":return e.h()<13?0===e.h()?12:e.h():e.h()-12;case"HH":return i(e.h());case"H":return e.h();case"mm":return i(e.getMinutes());case"m":return e.getMinutes();case"ss":return i(e.getSeconds());case"s":return e.getSeconds();case"yyyy":return i(e.getFullYear(),4);case"yy":return i(e.getFullYear());case"dddd":return o.dayNames[e.getDay()];case"ddd":return o.abbreviatedDayNames[e.getDay()];case"dd":return i(e.getDate());case"d":return e.getDate();case"MMMM":return o.monthNames[e.getMonth()];case"MMM":return o.abbreviatedMonthNames[e.getMonth()];case"MM":return i(e.getMonth()+1);case"M":return e.getMonth()+1;case"t":return e.h()<12?o.amDesignator.substring(0,1):o.pmDesignator.substring(0,1);case"tt":return e.h()<12?o.amDesignator:o.pmDesignator;case"S":return function(t){switch(1*t){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}}(e.getDate());default:return t}}):this._toString()}}(),function(){var i=Date,t=i.prototype,r=i.CultureInfo,e=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,e._dateElement="day",t.next=function(){return this._orient=1,this},i.next=function(){return i.today().next()},t.last=t.prev=t.previous=function(){return this._orient=-1,this},i.last=i.prev=i.previous=function(){return i.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},t.at=function(t){return"string"==typeof t?i.parse(this.toString("d")+" "+t):this.set(t)},e.fromNow=e.after=function(t){var e={};return e[this._dateElement]=this,(t?t.clone():new Date).add(e)},e.ago=e.before=function(t){var e={};return e[this._dateElement]=-1*this,(t?t.clone():new Date).add(e)};var n,s="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),o="january february march april may june july august september october november december".split(/\s/),a="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),l="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),u="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var t={},e=0;e<a.length;e++)t[a[e].toLowerCase()]=this["get"+l[e]]();return t},i.fromObject=function(t){return t.week=null,Date.today().set(t)};function c(n){return function(){if(this._is)return this._is=!1,this.getDay()==n;if(null===this._nth)return this.moveToDayOfWeek(n,this._orient);this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var t=this._nth;this._nth=null;var e=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(n,t),e<this)throw new RangeError(i.getDayName(n)+" does not occur "+t+" times in the month of "+i.getMonthName(e.getMonth())+" "+e.getFullYear()+".");return this}}function h(n){return function(){var t=i.today(),e=n-t.getDay();return 0===n&&1===r.firstDayOfWeek&&0!==t.getDay()&&(e+=7),t.addDays(e)}}for(var d=0;d<s.length;d++)i[s[d].toUpperCase()]=i[s[d].toUpperCase().substring(0,3)]=d,i[s[d]]=i[s[d].substring(0,3)]=h(d),t[s[d]]=t[s[d].substring(0,3)]=c(d);function p(t){return function(){return this._is?(this._is=!1,this.getMonth()===t):this.moveToMonth(t,this._orient)}}function f(t){return function(){return i.today().set({month:t,day:1})}}for(var g=0;g<o.length;g++)i[o[g].toUpperCase()]=i[o[g].toUpperCase().substring(0,3)]=g,i[o[g]]=i[o[g].substring(0,3)]=f(g),t[o[g]]=t[o[g].substring(0,3)]=p(g);function m(s){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var t=this.toObject(),e=(arguments[0]||new Date).toObject(),n="",i=s.toLowerCase(),r=a.length-1;-1<r;r--){if(t[n=a[r].toLowerCase()]!=e[n])return!1;if(i==n)break}return!0}return"s"!=s.substring(s.length-1)&&(s+="s"),this["add"+s](this._orient)}}function v(t){return function(){return this._dateElement=t,this}}for(var y=0;y<a.length;y++)t[n=a[y].toLowerCase()]=t[n+"s"]=m(a[y]),e[n]=e[n+"s"]=v(n);t._ss=m("Second");function b(e){return function(t){return this._same?this._ss(t):t||0===t?this.moveToNthOccurrence(t,e):2===(this._nth=e)&&null==t?(this._isSecond=!0,this.addSeconds(this._orient)):this}}for(var w=0;w<u.length;w++)t[u[w]]=b(0===w?-1:w)}(),function(){Date.Parsing={Exception:function(t){this.message="Parse error at '"+t.substring(0,10)+" ...'"}};function t(r){return function(){var t=null,e=[];if(1<arguments.length?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return r.apply(null,arguments);for(var n=0,i=t.shift();n<i.length;n++)return t.unshift(i[n]),e.push(r.apply(null,t)),t.shift(),e}}for(var p=Date.Parsing,f=p.Operators={rtoken:function(n){return function(t){var e=t.match(n);if(e)return[e[0],t.substring(e[0].length)];throw new p.Exception(t)}},token:function(t){return function(t){return f.rtoken(new RegExp("^s*"+t+"s*"))(t)}},stoken:function(t){return f.rtoken(new RegExp("^"+t))},until:function(t){return function(e){for(var n=[],i=null;e.length;){try{i=t.call(this,e)}catch(t){n.push(i[0]),e=i[1];continue}break}return[n,e]}},many:function(i){return function(e){for(var n=[],t=null;e.length;){try{t=i.call(this,e)}catch(t){return[n,e]}n.push(t[0]),e=t[1]}return[n,e]}},optional:function(n){return function(e){var t=null;try{t=n.call(this,e)}catch(t){return[null,e]}return[t[0],t[1]]}},not:function(t){return function(e){try{t.call(this,e)}catch(t){return[null,e]}throw new p.Exception(e)}},ignore:function(e){return e?function(t){return[null,e.call(this,t)[1]]}:null},product:function(){for(var t=arguments[0],e=Array.prototype.slice.call(arguments,1),n=[],i=0;i<t.length;i++)n.push(f.each(t[i],e));return n},cache:function(t){var n={},i=null;return function(e){try{i=n[e]=n[e]||t.call(this,e)}catch(t){i=n[e]=t}if(i instanceof p.Exception)throw i;return i}},any:function(){var i=arguments;return function(t){for(var e=null,n=0;n<i.length;n++)if(null!=i[n]){try{e=i[n].call(this,t)}catch(t){e=null}if(e)return e}throw new p.Exception(t)}},each:function(){var r=arguments;return function(e){for(var t=[],n=null,i=0;i<r.length;i++)if(null!=r[i]){try{n=r[i].call(this,e)}catch(t){throw new p.Exception(e)}t.push(n[0]),e=n[1]}return[t,e]}},all:function(){var t=arguments,e=e;return e.each(e.optional(t))},sequence:function(s,o,a){return o=o||f.rtoken(/^\s*/),a=a||null,1==s.length?s[0]:function(t){for(var e=null,n=null,i=[],r=0;r<s.length;r++){try{e=s[r].call(this,t)}catch(t){break}i.push(e[0]);try{n=o.call(this,e[1])}catch(t){n=null;break}t=n[1]}if(!e)throw new p.Exception(t);if(n)throw new p.Exception(n[1]);if(a)try{e=a.call(this,e[1])}catch(t){throw new p.Exception(e[1])}return[i,e?e[1]:t]}},between:function(t,e,n){n=n||t;var i=f.each(f.ignore(t),e,f.ignore(n));return function(t){var e=i.call(this,t);return[[e[0][0],r[0][2]],e[1]]}},list:function(t,e,n){return e=e||f.rtoken(/^\s*/),n=n||null,t instanceof Array?f.each(f.product(t.slice(0,-1),f.ignore(e)),t.slice(-1),f.ignore(n)):f.each(f.many(f.each(t,f.ignore(e))),px,f.ignore(n))},set:function(c,h,d){return h=h||f.rtoken(/^\s*/),d=d||null,function(t){for(var e=null,n=null,i=null,r=null,s=[[],t],o=!1,a=0;a<c.length;a++){e=n=i=null,o=1==c.length;try{e=c[a].call(this,t)}catch(t){continue}if(r=[[e[0]],e[1]],0<e[1].length&&!o)try{i=h.call(this,e[1])}catch(t){o=!0}else o=!0;if(o||0!==i[1].length||(o=!0),!o){for(var l=[],u=0;u<c.length;u++)a!=u&&l.push(c[u]);0<(n=f.set(l,h).call(this,i[1]))[0].length&&(r[0]=r[0].concat(n[0]),r[1]=n[1])}if(r[1].length<s[1].length&&(s=r),0===s[1].length)break}if(0===s[0].length)return s;if(d){try{i=d.call(this,s[1])}catch(t){throw new p.Exception(s[1])}s[1]=i[1]}return s}},forward:function(e,n){return function(t){return e[n].call(this,t)}},replace:function(n,i){return function(t){var e=n.call(this,t);return[i,e[1]]}},process:function(n,i){return function(t){var e=n.call(this,t);return[i.call(this,e[0]),e[1]]}},min:function(n,i){return function(t){var e=i.call(this,t);if(e[0].length<n)throw new p.Exception(t);return e}}},e="optional not ignore cache".split(/\s/),n=0;n<e.length;n++)f[e[n]]=t(f[e[n]]);function i(t){return function(){return arguments[0]instanceof Array?t.apply(null,arguments[0]):t.apply(null,arguments)}}for(var s="each any all".split(/\s/),o=0;o<s.length;o++)f[s[o]]=i(f[s[o]])}(),function(){var l=Date,o=(l.prototype,l.CultureInfo),u=function(t){for(var e=[],n=0;n<t.length;n++)t[n]instanceof Array?e=e.concat(u(t[n])):t[n]&&e.push(t[n]);return e};l.Grammar={},l.Translator={hour:function(t){return function(){this.hour=Number(t)}},minute:function(t){return function(){this.minute=Number(t)}},second:function(t){return function(){this.second=Number(t)}},meridian:function(t){return function(){this.meridian=t.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(t){var e=t[0];return function(){this.day=Number(e.match(/\d+/)[0])}},month:function(t){return function(){this.month=3==t.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(t)/4:Number(t)-1}},year:function(e){return function(){var t=Number(e);this.year=2<e.length?t:t+(t+2e3<o.twoDigitYearMax?2e3:1900)}},rday:function(t){return function(){switch(t){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];for(var e=0;e<t.length;e++)t[e]&&t[e].call(this);var n=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=n.getDate()),this.year||(this.year=n.getFullYear()),this.month||0===this.month||(this.month=n.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>l.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var i=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?i.set({timezone:this.timezone}):this.timezoneOffset&&i.set({timezoneOffset:this.timezoneOffset}),i},finish:function(t){if(0===(t=t instanceof Array?u(t):[t]).length)return null;for(var e=0;e<t.length;e++)"function"==typeof t[e]&&t[e].call(this);var n=l.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(n=new Date);var i,r,s,o=!!(this.days&&null!==this.days||this.orient||this.operator);if(s="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||n.setTimeToNow(),!this.month&&0!==this.month||-1=="year day hour minute second".indexOf(this.unit)||(this.value=this.month+1,o=!(this.month=null)),!o&&this.weekday&&!this.day&&!this.days){var a=Date[this.weekday]();this.day=a.getDate(),this.month||(this.month=a.getMonth()),this.year=a.getFullYear()}if(o&&this.weekday&&"month"!=this.unit&&(this.unit="day",i=l.getDayNumberFromName(this.weekday)-n.getDay(),r=7,this.days=i?(i+s*r)%r:s*r),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(n.set({day:1*this.value}),o||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,o=!0),o&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",i=this.month-n.getMonth(),r=12,this.months=i?(i+s*r)%r:s*r,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*s:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*s),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){a=Date[this.weekday]();this.day=a.getDate(),a.getMonth()!==n.getMonth()&&(this.month=a.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(o&&this.timezone&&this.day&&this.days&&(this.day=this.days),o?n.add(this):n.set(this)):Date.today().setWeek(this.value)}};var t,a=l.Parsing.Operators,n=l.Grammar,e=l.Translator;n.datePartDelimiter=a.rtoken(/^([\s\-\.\,\/\x27]+)/),n.timePartDelimiter=a.stoken(":"),n.whiteSpace=a.rtoken(/^\s*/),n.generalDelimiter=a.rtoken(/^(([\s\,]|at|@|on)+)/);var c={};n.ctoken=function(t){var e=c[t];if(!e){for(var n=o.regexPatterns,i=t.split(/\s+/),r=[],s=0;s<i.length;s++)r.push(a.replace(a.rtoken(n[i[s]]),i[s]));e=c[t]=a.any.apply(null,r)}return e},n.ctoken2=function(t){return a.rtoken(o.regexPatterns[t])},n.h=a.cache(a.process(a.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),e.hour)),n.hh=a.cache(a.process(a.rtoken(/^(0[0-9]|1[0-2])/),e.hour)),n.H=a.cache(a.process(a.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),e.hour)),n.HH=a.cache(a.process(a.rtoken(/^([0-1][0-9]|2[0-3])/),e.hour)),n.m=a.cache(a.process(a.rtoken(/^([0-5][0-9]|[0-9])/),e.minute)),n.mm=a.cache(a.process(a.rtoken(/^[0-5][0-9]/),e.minute)),n.s=a.cache(a.process(a.rtoken(/^([0-5][0-9]|[0-9])/),e.second)),n.ss=a.cache(a.process(a.rtoken(/^[0-5][0-9]/),e.second)),n.hms=a.cache(a.sequence([n.H,n.m,n.s],n.timePartDelimiter)),n.t=a.cache(a.process(n.ctoken2("shortMeridian"),e.meridian)),n.tt=a.cache(a.process(n.ctoken2("longMeridian"),e.meridian)),n.z=a.cache(a.process(a.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),e.timezone)),n.zz=a.cache(a.process(a.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),e.timezone)),n.zzz=a.cache(a.process(n.ctoken2("timezone"),e.timezone)),n.timeSuffix=a.each(a.ignore(n.whiteSpace),a.set([n.tt,n.zzz])),n.time=a.each(a.optional(a.ignore(a.stoken("T"))),n.hms,n.timeSuffix),n.d=a.cache(a.process(a.each(a.rtoken(/^([0-2]\d|3[0-1]|\d)/),a.optional(n.ctoken2("ordinalSuffix"))),e.day)),n.dd=a.cache(a.process(a.each(a.rtoken(/^([0-2]\d|3[0-1])/),a.optional(n.ctoken2("ordinalSuffix"))),e.day)),n.ddd=n.dddd=a.cache(a.process(n.ctoken("sun mon tue wed thu fri sat"),function(t){return function(){this.weekday=t}})),n.M=a.cache(a.process(a.rtoken(/^(1[0-2]|0\d|\d)/),e.month)),n.MM=a.cache(a.process(a.rtoken(/^(1[0-2]|0\d)/),e.month)),n.MMM=n.MMMM=a.cache(a.process(n.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),e.month)),n.y=a.cache(a.process(a.rtoken(/^(\d\d?)/),e.year)),n.yy=a.cache(a.process(a.rtoken(/^(\d\d)/),e.year)),n.yyy=a.cache(a.process(a.rtoken(/^(\d\d?\d?\d?)/),e.year)),n.yyyy=a.cache(a.process(a.rtoken(/^(\d\d\d\d)/),e.year)),t=function(){return a.each(a.any.apply(null,arguments),a.not(n.ctoken2("timeContext")))},n.day=t(n.d,n.dd),n.month=t(n.M,n.MMM),n.year=t(n.yyyy,n.yy),n.orientation=a.process(n.ctoken("past future"),function(t){return function(){this.orient=t}}),n.operator=a.process(n.ctoken("add subtract"),function(t){return function(){this.operator=t}}),n.rday=a.process(n.ctoken("yesterday tomorrow today now"),e.rday),n.unit=a.process(n.ctoken("second minute hour day week month year"),function(t){return function(){this.unit=t}}),n.value=a.process(a.rtoken(/^\d\d?(st|nd|rd|th)?/),function(t){return function(){this.value=t.replace(/\D/g,"")}}),n.expression=a.set([n.rday,n.operator,n.value,n.unit,n.orientation,n.ddd,n.MMM]),t=function(){return a.set(arguments,n.datePartDelimiter)},n.mdy=t(n.ddd,n.month,n.day,n.year),n.ymd=t(n.ddd,n.year,n.month,n.day),n.dmy=t(n.ddd,n.day,n.month,n.year),n.date=function(t){return(n[o.dateElementOrder]||n.mdy).call(this,t)},n.format=a.process(a.many(a.any(a.process(a.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(n[t])return n[t];throw l.Parsing.Exception(t)}),a.process(a.rtoken(/^[^dMyhHmstz]+/),function(t){return a.ignore(a.stoken(t))}))),function(t){return a.process(a.each.apply(null,t),e.finishExact)});function i(t){return r[t]=r[t]||n.format(t)[0]}var r={};n.formats=function(t){if(t instanceof Array){for(var e=[],n=0;n<t.length;n++)e.push(i(t[n]));return a.any.apply(null,e)}return i(t)},n._formats=n.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]),n._start=a.process(a.set([n.date,n.time,n.expression],n.generalDelimiter,n.whiteSpace),e.finish),n.start=function(t){try{var e=n._formats.call({},t);if(0===e[1].length)return e}catch(t){}return n._start.call({},t)},l._parse=l.parse,l.parse=function(t){var e=null;if(!t)return null;if(t instanceof Date)return t;try{e=l.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(t){return null}return 0===e[1].length?e[0]:null},l.getParseFunction=function(t){var n=l.Grammar.formats(t);return function(t){var e=null;try{e=n.call({},t)}catch(t){return null}return 0===e[1].length?e[0]:null}},l.parseExact=function(t,e){return l.getParseFunction(e)(t)}}(),function(t,r){function f(t){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=s.extend({},this.defaults,t),this.textdomain(this.options.domain),t.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+t.domain+"`")}var e=Array.prototype,n=Object.prototype,i=e.slice,o=n.hasOwnProperty,a=e.forEach,l={},s={forEach:function(t,e,n){var i,r,s;if(null!==t)if(a&&t.forEach===a)t.forEach(e,n);else if(t.length===+t.length){for(i=0,r=t.length;i<r;i++)if(i in t&&e.call(n,t[i],i,t)===l)return}else for(s in t)if(o.call(t,s)&&e.call(n,t[s],s,t)===l)return},extend:function(n){return this.forEach(i.call(arguments,1),function(t){for(var e in t)n[e]=t[e]}),n}};function g(t){return f.PF.compile(t||"nplurals=2; plural=(n != 1);")}function u(t,e){this._key=t,this._i18n=e}f.context_delimiter=String.fromCharCode(4),s.extend(u.prototype,{onDomain:function(t){return this._domain=t,this},withContext:function(t){return this._context=t,this},ifPlural:function(t,e){return this._val=t,this._pkey=e,this},fetch:function(t){return"[object Array]"!={}.toString.call(t)&&(t=[].slice.call(arguments,0)),(t&&t.length?f.sprintf:function(t){return t})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),t)}}),s.extend(f.prototype,{translate:function(t){return new u(t,this)},textdomain:function(t){if(!t)return this._textdomain;this._textdomain=t},gettext:function(t){return this.dcnpgettext.call(this,r,r,t)},dgettext:function(t,e){return this.dcnpgettext.call(this,t,r,e)},dcgettext:function(t,e){return this.dcnpgettext.call(this,t,r,e)},ngettext:function(t,e,n){return this.dcnpgettext.call(this,r,r,t,e,n)},dngettext:function(t,e,n,i){return this.dcnpgettext.call(this,t,r,e,n,i)},dcngettext:function(t,e,n,i){return this.dcnpgettext.call(this,t,r,e,n,i)},pgettext:function(t,e){return this.dcnpgettext.call(this,r,t,e)},dpgettext:function(t,e,n){return this.dcnpgettext.call(this,t,e,n)},dcpgettext:function(t,e,n){return this.dcnpgettext.call(this,t,e,n)},npgettext:function(t,e,n,i){return this.dcnpgettext.call(this,r,t,e,n,i)},dnpgettext:function(t,e,n,i,r){return this.dcnpgettext.call(this,t,e,n,i,r)},dcnpgettext:function(t,e,n,i,r){var s;if(i=i||n,t=t||this._textdomain,!this.options)return(s=new f).dcnpgettext.call(s,void 0,void 0,n,i,r);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[t])throw new Error("Domain `"+t+"` was not found.");if(!this.options.locale_data[t][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");var o,a,l,u=e?e+f.context_delimiter+n:n,c=this.options.locale_data,h=c[t],d=(c.messages||this.defaults.locale_data.messages)[""],p=h[""].plural_forms||h[""]["Plural-Forms"]||h[""]["plural-forms"]||d.plural_forms||d["Plural-Forms"]||d["plural-forms"];if(void 0===r)l=0;else{if("number"!=typeof r&&(r=parseInt(r,10),isNaN(r)))throw new Error("The number that was passed in is not a number.");l=g(p)(r)}if(!h)throw new Error("No domain named `"+t+"` could be found.");return!(o=h[u])||l>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(u,t),a=[n,i],!0===this.options.debug&&console.log(a[g(p)(r)]),a[g()(r)]):(a=o[l])||(a=[n,i])[g()(r)]}});var c,p=((c=function(){return c.cache.hasOwnProperty(arguments[0])||(c.cache[arguments[0]]=c.parse(arguments[0])),c.format.call(null,c.cache[arguments[0]],arguments)}).format=function(t,e){var n,i,r,s,o,a,l,u=1,c=t.length,h="",d=[];for(i=0;i<c;i++)if("string"===(h=m(t[i])))d.push(t[i]);else if("array"===h){if((s=t[i])[2])for(n=e[u],r=0;r<s[2].length;r++){if(!n.hasOwnProperty(s[2][r]))throw p('[sprintf] property "%s" does not exist',s[2][r]);n=n[s[2][r]]}else n=s[1]?e[s[1]]:e[u++];if(/[^s]/.test(s[8])&&"number"!=m(n))throw p("[sprintf] expecting number but found %s",m(n));switch(null==n&&(n=""),s[8]){case"b":n=n.toString(2);break;case"c":n=String.fromCharCode(n);break;case"d":n=parseInt(n,10);break;case"e":n=s[7]?n.toExponential(s[7]):n.toExponential();break;case"f":n=s[7]?parseFloat(n).toFixed(s[7]):parseFloat(n);break;case"o":n=n.toString(8);break;case"s":n=(n=String(n))&&s[7]?n.substring(0,s[7]):n;break;case"u":n=Math.abs(n);break;case"x":n=n.toString(16);break;case"X":n=n.toString(16).toUpperCase()}n=/[def]/.test(s[8])&&s[3]&&0<=n?"+"+n:n,a=s[4]?"0"==s[4]?"0":s[4].charAt(1):" ",l=s[6]-String(n).length,o=s[6]?v(a,l):"",d.push(s[5]?n+o:o+n)}return d.join("")},c.cache={},c.parse=function(t){for(var e=t,n=[],i=[],r=0;e;){if(null!==(n=/^[^\x25]+/.exec(e)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(e)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(e)))throw"[sprintf] huh?";if(n[2]){r|=1;var s=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(s.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))s.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";s.push(a[1])}n[2]=s}else r|=2;if(3===r)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";i.push(n)}e=e.substring(n[0].length)}return i},c);function m(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function v(t,e){for(var n=[];0<e;n[--e]=t);return n.join("")}var h;f.parse_plural=function(t,e){return t=t.replace(/n/g,e),f.parse_expression(t)},f.sprintf=function(t,e){return"[object Array]"=={}.toString.call(e)?function(t,e){return e.unshift(t),p.apply(null,e)}(t,[].slice.call(e)):p.apply(this,[].slice.call(arguments))},f.prototype.sprintf=function(){return f.sprintf.apply(this,arguments)},(f.PF={}).parse=function(t){var e=f.PF.extractPluralExpr(t);return f.PF.parser.parse.call(f.PF.parser,e)},f.PF.compile=function(t){var e=f.PF.parse(t);return function(t){return function(t){return!0===t?1:t||0}(f.PF.interpreter(e)(t))}},f.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return f.PF.interpreter(e.expr)(t);case"TERNARY":return f.PF.interpreter(e.expr)(t)?f.PF.interpreter(e.truthy)(t):f.PF.interpreter(e.falsey)(t);case"OR":return f.PF.interpreter(e.left)(t)||f.PF.interpreter(e.right)(t);case"AND":return f.PF.interpreter(e.left)(t)&&f.PF.interpreter(e.right)(t);case"LT":return f.PF.interpreter(e.left)(t)<f.PF.interpreter(e.right)(t);case"GT":return f.PF.interpreter(e.left)(t)>f.PF.interpreter(e.right)(t);case"LTE":return f.PF.interpreter(e.left)(t)<=f.PF.interpreter(e.right)(t);case"GTE":return f.PF.interpreter(e.left)(t)>=f.PF.interpreter(e.right)(t);case"EQ":return f.PF.interpreter(e.left)(t)==f.PF.interpreter(e.right)(t);case"NEQ":return f.PF.interpreter(e.left)(t)!=f.PF.interpreter(e.right)(t);case"MOD":return f.PF.interpreter(e.left)(t)%f.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},f.PF.extractPluralExpr=function(t){t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(t)||(t=t.concat(";"));var e,n=/nplurals\=(\d+);/,i=t.match(n);if(!(1<i.length))throw new Error("nplurals not found in plural_forms string: "+t);if(i[1],!((e=(t=t.replace(n,"")).match(/plural\=(.*);/))&&1<e.length))throw new Error("`plural` expression not found: "+t);return e[1]},f.PF.parser=((h={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(t,e,n,i,r,s){var o=s.length-1;switch(r){case 1:return{type:"GROUP",expr:s[o-1]};case 2:this.$={type:"TERNARY",expr:s[o-4],truthy:s[o-2],falsey:s[o]};break;case 3:this.$={type:"OR",left:s[o-2],right:s[o]};break;case 4:this.$={type:"AND",left:s[o-2],right:s[o]};break;case 5:this.$={type:"LT",left:s[o-2],right:s[o]};break;case 6:this.$={type:"LTE",left:s[o-2],right:s[o]};break;case 7:this.$={type:"GT",left:s[o-2],right:s[o]};break;case 8:this.$={type:"GTE",left:s[o-2],right:s[o]};break;case 9:this.$={type:"NEQ",left:s[o-2],right:s[o]};break;case 10:this.$={type:"EQ",left:s[o-2],right:s[o]};break;case 11:this.$={type:"MOD",left:s[o-2],right:s[o]};break;case 12:this.$={type:"GROUP",expr:s[o-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(t)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(t){throw new Error(t)},parse:function(t){var e=this,n=[0],i=[null],r=[],s=this.table,o="",a=0,l=0,u=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var c=this.lexer.yylloc;function h(){var t;return"number"!=typeof(t=e.lexer.lex()||1)&&(t=e.symbols_[t]||t),t}r.push(c),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var d,p,f,g,m,v,y,b,w,_,x={};;){if(f=n[n.length-1],void 0===(g=this.defaultActions[f]?this.defaultActions[f]:(null==d&&(d=h()),s[f]&&s[f][d]))||!g.length||!g[0]){if(!u){for(v in w=[],s[f])this.terminals_[v]&&2<v&&w.push("'"+this.terminals_[v]+"'");var S="";S=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+this.terminals_[d]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==d?"end of input":"'"+(this.terminals_[d]||d)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[d]||d,line:this.lexer.yylineno,loc:c,expected:w})}if(3==u){if(1==d)throw new Error(S||"Parsing halted.");l=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,c=this.lexer.yylloc,d=h()}for(;!(2..toString()in s[f]);){if(0==f)throw new Error(S||"Parsing halted.");_=1,n.length=n.length-2*_,i.length=i.length-_,r.length=r.length-_,f=n[n.length-1]}p=d,d=2,g=s[f=n[n.length-1]]&&s[f][2],u=3}if(g[0]instanceof Array&&1<g.length)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+d);switch(g[0]){case 1:n.push(d),i.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(g[1]),d=null,p?(d=p,p=null):(l=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,c=this.lexer.yylloc,0<u&&u--);break;case 2:if(y=this.productions_[g[1]][1],x.$=i[i.length-y],x._$={first_line:r[r.length-(y||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(y||1)].first_column,last_column:r[r.length-1].last_column},void 0!==(m=this.performAction.call(x,o,l,a,this.yy,g[1],i,r)))return m;y&&(n=n.slice(0,-1*y*2),i=i.slice(0,-1*y),r=r.slice(0,-1*y)),n.push(this.productions_[g[1]][0]),i.push(x.$),r.push(x._$),b=s[n[n.length-2]][n[n.length-1]],n.push(b);break;case 3:return!0}}return!0}}).lexer={EOF:1,parseError:function(t,e){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.match+=t,this.matched+=t,t.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),t},unput:function(t){return this._input=t+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(20<t.length?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(20<t.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;var t,e;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),i=0;i<n.length;i++)if(t=this._input.match(this.rules[n[i]]))return(e=t[0].match(/\n.*/g))&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],this.performAction.call(this,this.yy,this,n[i],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return void 0!==t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)},performAction:function(t,e,n){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}},h),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports.Jed=f):("function"==typeof define&&define.amd&&define(function(){return f}),t.Jed=f)}(this),function(a){function l(){}var e=1;function u(t){return{jsonrpc:"2.0",method:t.method||"",params:t.params||{},id:e++}}function c(t,e){return t.id<e.id?-1:1}a.extend({jsonrpc:function(t,e){var s=new a.Deferred,n=(e=e||{}).success||l,o=e.error||l;delete e.success,delete e.error;var i=a.isArray(t),r=a.extend({url:(i?t[0].url:t.url)||a.jsonrpc.defaultUrl,contentType:"application/json",dataType:"text",dataFilter:function(t,e){return JSON.parse(t)},type:"POST",processData:!1,data:function(t){var e=a.isArray(t)?t.map(u):u(t);return JSON.stringify(e)}(t),success:function(t){if(i){var e=function(t){return t.sort(c)}(t);return n(e),void s.resolve(e)}if(t.hasOwnProperty("error"))return o(t.error),void s.reject(t.error);if(t.hasOwnProperty("result"))return n(t.result),void s.resolve(t.result);throw"Invalid response returned"},error:function(e,n,i){var r=null;if("timeout"===i)r={status:n,code:-32e3,message:"Request Timeout",data:null};else try{r=JSON.parse(e.responseText).error}catch(t){r={status:n,code:-32603,message:i,data:e.responseText}}o(r),s.reject(r)}},e);return a.ajax(r),s.promise()}}),a.jsonrpc.defaultUrl="/jsonrpc"}(jQuery),function(a,i,r,l){var u=a(i);a.fn.lazyload=function(t){function e(){var e=0;s.each(function(){var t=a(this);if((!o.skip_invisible||t.is(":visible"))&&!a.abovethetop(this,o)&&!a.leftofbegin(this,o))if(a.belowthefold(this,o)||a.rightoffold(this,o)){if(++e>o.failure_limit)return!1}else t.trigger("appear"),e=0})}var n,s=this,o={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:i,data_attribute:"original",skip_invisible:!0,appear:null,load:null,placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"};return t&&(l!==t.failurelimit&&(t.failure_limit=t.failurelimit,delete t.failurelimit),l!==t.effectspeed&&(t.effect_speed=t.effectspeed,delete t.effectspeed),a.extend(o,t)),n=o.container===l||o.container===i?u:a(o.container),0===o.event.indexOf("scroll")&&n.bind(o.event,function(){return e()}),this.each(function(){var i=this,r=a(i);i.loaded=!1,r.attr("src")!==l&&!1!==r.attr("src")||!r.is("img")||r.attr("src",o.placeholder),r.one("appear",function(){if(!this.loaded){if(o.appear){var t=s.length;o.appear.call(i,t,o)}a("<img />").bind("load",function(){var t=r.attr("data-"+o.data_attribute);r.hide(),r.is("img")?r.attr("src",t):r.css("background-image","url('"+t+"')"),r[o.effect](o.effect_speed),i.loaded=!0;var e=a.grep(s,function(t){return!t.loaded});if(s=a(e),o.load){var n=s.length;o.load.call(i,n,o)}}).attr("src",r.attr("data-"+o.data_attribute))}}),0!==o.event.indexOf("scroll")&&r.bind(o.event,function(){i.loaded||r.trigger("appear")})}),u.bind("resize",function(){e()}),/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion)&&u.bind("pageshow",function(t){t.originalEvent&&t.originalEvent.persisted&&s.each(function(){a(this).trigger("appear")})}),a(r).ready(function(){e()}),this},a.belowthefold=function(t,e){return(e.container===l||e.container===i?(i.innerHeight?i.innerHeight:u.height())+u.scrollTop():a(e.container).offset().top+a(e.container).height())<=a(t).offset().top-e.threshold},a.rightoffold=function(t,e){return(e.container===l||e.container===i?u.width()+u.scrollLeft():a(e.container).offset().left+a(e.container).width())<=a(t).offset().left-e.threshold},a.abovethetop=function(t,e){return(e.container===l||e.container===i?u.scrollTop():a(e.container).offset().top)>=a(t).offset().top+e.threshold+a(t).height()},a.leftofbegin=function(t,e){return(e.container===l||e.container===i?u.scrollLeft():a(e.container).offset().left)>=a(t).offset().left+e.threshold+a(t).width()},a.inviewport=function(t,e){return!(a.rightoffold(t,e)||a.leftofbegin(t,e)||a.belowthefold(t,e)||a.abovethetop(t,e))},a.extend(a.expr[":"],{"below-the-fold":function(t){return a.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!a.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return a.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!a.rightoffold(t,{threshold:0})},"in-viewport":function(t){return a.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!a.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return a.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!a.rightoffold(t,{threshold:0})}})}(jQuery,window,document),function(w){"use strict";function r(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}function _(t,e,n){t.addClass(e),setTimeout(function(){t.removeClass(e)},n)}function x(t){return Math.max(Math.min(t,100),0)}function S(t){return w.isArray(t)?t:[t]}var T=w(document),e=w.fn.val,C=".nui",E=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},k=["noUi-target","noUi-base","noUi-origin","noUi-handle","noUi-horizontal","noUi-vertical","noUi-background","noUi-connect","noUi-ltr","noUi-rtl","noUi-dragable","","noUi-state-drag","","noUi-state-tap","noUi-active","","noUi-stacking"];function l(t,e){return 100/(e-t)}function u(t,e){return 100*e/(t[1]-t[0])}function c(t,e){for(var n=1;t>=e[n];)n+=1;return n}function n(t,e,n){if(n>=t.slice(-1)[0])return 100;var i,r,s,o,a=c(n,t);return i=t[a-1],r=t[a],s=e[a-1],o=e[a],s+function(t,e){return u(t,t[0]<0?e+Math.abs(t[0]):e-t[0])}([i,r],n)/l(s,o)}function i(t,e,n){if(100<=n)return t.slice(-1)[0];var i,r=c(n,e);return function(t,e){return e*(t[1]-t[0])/100+t[0]}([t[r-1],t[r]],(n-(i=e[r-1]))*l(i,e[r]))}function s(t,e,n,i){if(100===i)return i;var r,s,o=c(i,t);return n?(r=t[o-1],((s=t[o])-r)/2<i-r?s:r):e[o-1]?t[o-1]+function(t,e){return Math.round(t/e)*e}(i-t[o-1],e[o-1]):i}function o(t,e,n){var i;if("number"==typeof e&&(e=[e]),"[object Array]"!==Object.prototype.toString.call(e))throw new Error("noUiSlider: 'range' contains invalid value.");if(!r(i="min"===t?0:"max"===t?100:parseFloat(t))||!r(e[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");n.xPct.push(i),n.xVal.push(e[0]),i?n.xSteps.push(!isNaN(e[1])&&e[1]):isNaN(e[1])||(n.xSteps[0]=e[1])}function a(t,e,n){if(!e)return!0;n.xSteps[t]=u([n.xVal[t],n.xVal[t+1]],e)/l(n.xPct[t],n.xPct[t+1])}function h(t,e,n,i){this.xPct=[],this.xVal=[],this.xSteps=[i||!1],this.xNumSteps=[!1],this.snap=e,this.direction=n;var r,s=[];for(r in t)t.hasOwnProperty(r)&&s.push([t[r],r]);for(s.sort(function(t,e){return t[0]-e[0]}),r=0;r<s.length;r++)o(s[r][1],s[r][0],this);for(this.xNumSteps=this.xSteps.slice(0),r=0;r<this.xNumSteps.length;r++)a(r,this.xNumSteps[r],this)}h.prototype.getMargin=function(t){return 2===this.xPct.length&&u(this.xVal,t)},h.prototype.toStepping=function(t){return t=n(this.xVal,this.xPct,t),this.direction&&(t=100-t),t},h.prototype.fromStepping=function(t){return this.direction&&(t=100-t),function(t){var e=Math.pow(10,7);return Number((Math.round(t*e)/e).toFixed(7))}(i(this.xVal,this.xPct,t))},h.prototype.getStep=function(t){return this.direction&&(t=100-t),t=s(this.xPct,this.xSteps,this.snap,t),this.direction&&(t=100-t),t},h.prototype.getApplicableStep=function(t){var e=c(t,this.xPct),n=100===t?2:1;return[this.xNumSteps[e-2],this.xVal[e-n],this.xNumSteps[e-n]]},h.prototype.convert=function(t){return this.getStep(this.toStepping(t))};var d={to:function(t){return t.toFixed(2)},from:Number};function p(t,e){if(!r(e))throw new Error("noUiSlider: 'step' is not numeric.");t.singleStep=e}function f(t,e){if("object"!=typeof e||w.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(void 0===e.min||void 0===e.max)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");t.spectrum=new h(e,t.snap,t.dir,t.singleStep)}function g(t,e){if(e=S(e),!w.isArray(e)||!e.length||2<e.length)throw new Error("noUiSlider: 'start' option is incorrect.");t.handles=e.length,t.start=e}function m(t,e){if("boolean"!=typeof(t.snap=e))throw new Error("noUiSlider: 'snap' option must be a boolean.")}function v(t,e){if("boolean"!=typeof(t.animate=e))throw new Error("noUiSlider: 'animate' option must be a boolean.")}function y(t,e){if("lower"===e&&1===t.handles)t.connect=1;else if("upper"===e&&1===t.handles)t.connect=2;else if(!0===e&&2===t.handles)t.connect=3;else{if(!1!==e)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");t.connect=0}}function b(t,e){switch(e){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function M(t,e){if(!r(e))throw new Error("noUiSlider: 'margin' option must be numeric.");if(t.margin=t.spectrum.getMargin(e),!t.margin)throw new Error("noUiSlider: 'margin' option is only supported on linear sliders.")}function D(t,e){if(!r(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(t.limit=t.spectrum.getMargin(e),!t.limit)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders.")}function O(t,e){switch(e){case"ltr":t.dir=0;break;case"rtl":t.dir=1,t.connect=[0,2,1,3][t.connect];break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function A(t,e){if("string"!=typeof e)throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var n=0<=e.indexOf("tap"),i=0<=e.indexOf("drag"),r=0<=e.indexOf("fixed"),s=0<=e.indexOf("snap");t.events={tap:n||s,drag:i,fixed:r,snap:s}}function N(t,e){if("function"==typeof(t.format=e).to&&"function"==typeof e.from)return!0;throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.")}function j(t,l,e){var r,u,s=w(t),c=[-1,-1],h=l.spectrum,d=[],p=["lower","upper"].slice(0,l.handles);function a(){return r[["width","height"][l.ort]]()}function f(t){var e,n=[s.val()];for(e=0;e<t.length;e+=1)s.trigger(t[e],n)}function n(t){return 1===t.length?t[0]:l.dir?t.reverse():t}function g(t){var e=w.inArray(t,p);s[0].linkAPI&&s[0].linkAPI[t]&&s[0].linkAPI[t].change(d[e],u[e].children(),s)}function i(t,e,n,i){return t=t.replace(/\s/g,C+" ")+C,e.on(t,function(t){return!s.attr("disabled")&&(!s.hasClass(k[14])&&((t=function(t){t.preventDefault();var e,n,i=0===t.type.indexOf("touch"),r=0===t.type.indexOf("mouse"),s=0===t.type.indexOf("pointer"),o=t;return 0===t.type.indexOf("MSPointer")&&(s=!0),t.originalEvent&&(t=t.originalEvent),i&&(e=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY),(r||s)&&(s||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),e=t.clientX+window.pageXOffset,n=t.clientY+window.pageYOffset),o.points=[e,n],o.cursor=r,o}(t)).calcPoint=t.points[l.ort],void n(t,i)))})}function o(t,e){var n,i=e.handles||u,r=!1,s=100*(t.calcPoint-e.start)/a(),o=i[0][0]!==u[0][0]?1:0;n=function(t,e,n){var i=t+e[0],r=t+e[1];return n?(i<0&&(r+=Math.abs(i)),100<r&&(i-=r-100),[x(i),x(r)]):[i,r]}(s,e.positions,1<i.length),r=b(i[0],n[o],1===i.length),1<i.length&&(r=b(i[1],n[o?0:1],!1)||r),r&&f(["slide"])}function m(t){w("."+k[15]).removeClass(k[15]),t.cursor&&w("body").css("cursor","").off(C),T.off(C),s.removeClass(k[12]),f(["set","change"])}function v(t,e){1===e.handles.length&&e.handles[0].children().addClass(k[15]),t.stopPropagation(),i(E.move,T,o,{start:t.calcPoint,handles:e.handles,positions:[c[0],c[u.length-1]]}),i(E.end,T,m,null),t.cursor&&(w("body").css("cursor",w(t.target).css("cursor")),1<u.length&&s.addClass(k[12]),w("body").on("selectstart"+C,!1))}function y(t){var e,n=t.calcPoint,i=0;t.stopPropagation(),w.each(u,function(){i+=this.offset()[l.style]}),i=n<i/2||1===u.length?0:1,e=100*(n-=r.offset()[l.style])/a(),l.events.snap||_(s,k[14],300),b(u[i],e),f(["slide","set","change"]),l.events.snap&&v(t,{handles:[u[i]]})}function b(t,e,n){var i=t[0]!==u[0][0]?1:0,r=c[0]+l.margin,s=c[1]-l.margin,o=c[0]+l.limit,a=c[1]-l.limit;return 1<u.length&&(e=i?Math.max(e,r):Math.min(e,s)),!1!==n&&l.limit&&1<u.length&&(e=i?Math.min(e,o):Math.max(e,a)),e=h.getStep(e),(e=x(parseFloat(e.toFixed(7))))!==c[i]&&(t.css(l.style,e+"%"),t.is(":first-child")&&t.toggleClass(k[17],50<e),c[i]=e,d[i]=h.fromStepping(e),g(p[i]),!0)}if(l.dir&&p.reverse(),t.LinkUpdate=g,t.LinkConfirm=function(t,e){var n=w.inArray(t,p);return e&&e.appendTo(u[n].children()),l.dir&&1<l.handles&&(n=1===n?0:1),function(n){return function(t,e){s.val([n?null:e,n?e:null],!0)}}(n)},t.LinkDefaultFormatter=l.format,t.LinkDefaultFlag="lower",t.reappend=function(){var t,e;for(t=0;t<p.length;t+=1)this.linkAPI&&this.linkAPI[e=p[t]]&&this.linkAPI[e].reconfirm(e)},s.hasClass(k[0]))throw new Error("Slider was already initialized.");r=function(t,e,n){return n.addClass([k[0],k[8+t],k[4+e]].join(" ")),w("<div/>").appendTo(n).addClass(k[1])}(l.dir,l.ort,s),u=function(t,e,n){var i,r,s,o,a,l=[];for(i=0;i<t;i+=1)l.push((r=e,s=i,a=o=void 0,o=w("<div><div/></div>").addClass(k[2]),a=["-lower","-upper"],r&&a.reverse(),o.children().addClass(k[3]+" "+k[3]+a[s]),o).appendTo(n));return l}(l.handles,l.dir,r),function(t,e,n){switch(t){case 1:e.addClass(k[7]),n[0].addClass(k[6]);break;case 3:n[1].addClass(k[6]);case 2:n[0].addClass(k[7]);case 0:e.addClass(k[6])}}(l.connect,s,u),function(t){var e,n;if(!t.fixed)for(e=0;e<u.length;e+=1)i(E.start,u[e].children(),v,{handles:[u[e]]});t.tap&&i(E.start,r,y,{handles:u}),t.drag&&(n=r.find("."+k[7]).addClass(k[10]),t.fixed&&(n=n.add(r.children().not(n).children())),i(E.start,n,v,{handles:u}))}(l.events),t.vSet=function(t){if(s[0].LinkIsEmitting)return this;var e,n=S(t);return l.dir&&1<l.handles&&n.reverse(),l.animate&&-1!==c[0]&&_(s,k[14],300),e=1<u.length?3:1,1===n.length&&(e=1),function(t,e){var n,i,r;for(l.limit&&(t+=1),n=0;n<t;n+=1)null!==(r=e[i=n%2])&&!1!==r&&("number"==typeof r&&(r=String(r)),!1!==(r=l.format.from(r))&&!isNaN(r)&&!1!==b(u[i],h.toStepping(r),n===3-l.dir)||g(p[i]))}(e,n),f(["set"]),this},t.vGet=function(){var t,e=[];for(t=0;t<l.handles;t+=1)e[t]=l.format.to(d[t]);return n(e)},t.destroy=function(){return w(this).off(C).removeClass(k.join(" ")).empty(),delete this.LinkUpdate,delete this.LinkConfirm,delete this.LinkDefaultFormatter,delete this.LinkDefaultFlag,delete this.reappend,delete this.vGet,delete this.vSet,delete this.getCurrentStep,delete this.getInfo,delete this.destroy,e},t.getCurrentStep=function(){return n(w.map(c,function(t,e){var n=h.getApplicableStep(t),i=function(t){var e=t.split(".");return 1<e.length?e[1].length:0}(String(n[2])),r=d[e],s=100===t?null:n[2],o=Number((r-n[2]).toFixed(i));return[[0===t?null:o>=n[1]?n[2]:n[0]||!1,s]]}))},t.getOriginalOptions=function(){return e},t.getInfo=function(){return[h,l.style,l.ort]},s.val(l.start)}function R(t){var e=function(n){var t,i={margin:0,limit:0,animate:!0,format:d};return t={step:{r:!1,t:p},start:{r:!0,t:g},connect:{r:!0,t:y},direction:{r:!0,t:O},snap:{r:!1,t:m},animate:{r:!1,t:v},range:{r:!0,t:f},orientation:{r:!1,t:b},margin:{r:!1,t:M},limit:{r:!1,t:D},behaviour:{r:!0,t:A},format:{r:!1,t:N}},n=w.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},n),w.each(t,function(t,e){if(void 0===n[t]){if(e.r)throw new Error("noUiSlider: '"+t+"' is required.");return!0}e.t(i,n[t])}),i.style=i.ort?"top":"left",i}(t);return this.each(function(){j(this,e,t)})}function L(){return this[0][arguments.length?"vSet":"vGet"].apply(this[0],arguments)}w.fn.val=function(i){function r(t){return t.hasClass(k[0])?L:e}if(!arguments.length){var t=w(this[0]);return r(t).call(t)}var s=w.isFunction(i);return this.each(function(t){var e=i,n=w(this);s&&(e=i.call(this,t,n.val())),r(n).call(n,e)})},w.fn.noUiSlider=function(t,e){switch(t){case"step":return this[0].getCurrentStep();case"options":return this[0].getOriginalOptions()}return(e?function(i){return this.each(function(){if(this.destroy){var t=w(this).val(),e=this.destroy(),n=w.extend({},e,i);w(this).noUiSlider(n),this.reappend(),e.start===n.start&&w(this).val(t)}else w(this).noUiSlider(i)})}:R).call(this,t)}}(window.jQuery||window.Zepto),function(t){"use strict";"object"==typeof exports?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(n){"use strict";function i(t){if("string"!=typeof(t=t||"once"))throw new Error("The jQuery Once id parameter must be a string");return t}n.fn.once=function(t){var e="jquery-once-"+i(t);return this.filter(function(){return!0!==n(this).data(e)}).data(e,!0)},n.fn.removeOnce=function(t){return this.findOnce(t).removeData("jquery-once-"+i(t))},n.fn.findOnce=function(t){var e="jquery-once-"+i(t);return this.filter(function(){return!0===n(this).data(e)})}}),function(t){var M=t(window);t.fn.visible=function(t,e,n){if(!(this.length<1)){var i=1<this.length?this.eq(0):this,r=i.get(0),s=M.width(),o=M.height(),a=(n=n||"both",!0!==e||r.offsetWidth*r.offsetHeight);if("function"==typeof r.getBoundingClientRect){var l=r.getBoundingClientRect(),u=0<=l.top&&l.top<o,c=0<l.bottom&&l.bottom<=o,h=0<=l.left&&l.left<s,d=0<l.right&&l.right<=s,p=t?u||c:u&&c,f=t?h||d:h&&d;if("both"===n)return a&&p&&f;if("vertical"===n)return a&&p;if("horizontal"===n)return a&&f}else{var g=M.scrollTop(),m=g+o,v=M.scrollLeft(),y=v+s,b=i.offset(),w=b.top,_=w+i.height(),x=b.left,S=x+i.width(),T=!0===t?_:w,C=!0===t?w:_,E=!0===t?S:x,k=!0===t?x:S;if("both"===n)return!!a&&C<=m&&g<=T&&k<=y&&v<=E;if("vertical"===n)return!!a&&C<=m&&g<=T;if("horizontal"===n)return!!a&&k<=y&&v<=E}}}}(jQuery),window.JST||(window.JST={});var prettyPrint=function(){var f={el:function(t,e){var n,i=document.createElement(t);if((e=f.merge({},e))&&e.style){e.style;f.applyCSS(i,e.style),delete e.style}for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i},applyCSS:function(t,e){for(var n in e)if(e.hasOwnProperty(n))try{t.style[n]=e[n]}catch(t){}},txt:function(t){return document.createTextNode(t)},row:function(t,e,n){n=n||"td";var i,r=f.count(t,null)+1,s=f.el("tr"),o={style:f.getStyles(n,e),colSpan:r,onmouseover:function(){var t=this.parentNode.childNodes;f.forEach(t,function(t){"td"===t.nodeName.toLowerCase()&&f.applyCSS(t,f.getStyles("td_hover",e))})},onmouseout:function(){var t=this.parentNode.childNodes;f.forEach(t,function(t){"td"===t.nodeName.toLowerCase()&&f.applyCSS(t,f.getStyles("td",e))})}};return f.forEach(t,function(t){null!==t&&(i=f.el(n,o),t.nodeType?i.appendChild(t):i.innerHTML=f.shorten(t.toString()),s.appendChild(i))}),s},hRow:function(t,e){return f.row(t,e,"th")},table:function(t,i){t=t||[];var e={thead:{style:f.getStyles("thead",i)},tbody:{style:f.getStyles("tbody",i)},table:{style:f.getStyles("table",i)}},n=f.el("table",e.table),r=f.el("thead",e.thead),s=f.el("tbody",e.tbody);return t.length&&(n.appendChild(r),r.appendChild(f.hRow(t,i))),n.appendChild(s),{node:n,tbody:s,thead:r,appendChild:function(t){this.tbody.appendChild(t)},addRow:function(t,e,n){return this.appendChild(f.row.call(f,t,e||i,n)),this}}},shorten:function(t){return t},htmlentities:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},merge:function(t,e){for(var n in"object"!=typeof t&&(t={}),e)if(e.hasOwnProperty(n)){var i=e[n];if("object"==typeof i){t[n]=f.merge(t[n],i);continue}t[n]=i}for(var r=2,s=arguments.length;r<s;r++)f.merge(t,arguments[r]);return t},count:function(t,e){for(var n=0,i=0,r=t.length;i<r;i++)t[i]===e&&n++;return n},thead:function(t){return t.getElementsByTagName("thead")[0]},forEach:function(t,e,n){n=n||e;for(var i=t.length,r=-1;++r<i&&!1!==n(t[r],r,t););return!0},type:function(t){try{if(null===t)return"null";if(void 0===t)return"undefined";var e=Object.prototype.toString.call(t).match(/\s(.+?)\]/)[1].toLowerCase();return t.nodeType?1===t.nodeType?"domelement":"domnode":/^(string|number|array|regexp|function|date|boolean)$/.test(e)?e:"object"==typeof t?t.jquery&&"string"==typeof t.jquery?"jquery":"object":t===window||t===document?"object":"default"}catch(t){return"default"}},within:function(n){return{is:function(t){for(var e in n)if(n[e]===t)return e;return""}}},common:{circRef:function(t,e,n){return f.expander("[POINTS BACK TO <strong>"+e+"</strong>]","Click to show this item anyway",function(){this.parentNode.appendChild(i(t,{maxDepth:1}))})},depthReached:function(t,e){return f.expander("[DEPTH REACHED]","Click to show this item anyway",function(){try{this.parentNode.appendChild(i(t,{maxDepth:1}))}catch(t){this.parentNode.appendChild(f.table(["ERROR OCCURED DURING OBJECT RETRIEVAL"],"error").addRow([t.message]).node)}})}},getStyles:function(t,e){return e=i.settings.styles[e]||{},f.merge({},i.settings.styles.default[t],e[t])},expander:function(t,e,n){return f.el("a",{innerHTML:f.shorten(t)+' <b style="visibility:hidden;">[+]</b>',title:e,onmouseover:function(){this.getElementsByTagName("b")[0].style.visibility="visible"},onmouseout:function(){this.getElementsByTagName("b")[0].style.visibility="hidden"},onclick:function(){return this.style.display="none",n.call(this),!1},style:{cursor:"pointer"}})},stringify:function(t){var n,e=f.type(t),i=!0;if("array"===e)return n="[",f.forEach(t,function(t,e){n+=(0===e?"":", ")+f.stringify(t)}),n+"]";if("object"!=typeof t)return"regexp"===e?"/"+t.source+"/":"string"===e?'"'+t.replace(/"/g,'\\"')+'"':t.toString();for(var r in n="{",t)t.hasOwnProperty(r)&&(n+=(i?"":", ")+r+":"+f.stringify(t[r]),i=!1);return n+"}"},headerGradient:function(){var t=document.createElement("canvas");if(!t.getContext)return"";var e=t.getContext("2d");t.height=30,t.width=1;var n=e.createLinearGradient(0,0,0,30);return n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"rgba(0,0,0,0.25)"),e.fillStyle=n,e.fillRect(0,0,1,30),"url("+(t.toDataURL&&t.toDataURL()||"")+")"}()},i=function(t,e){e=e||{};var c=f.merge({},i.config,e),n=f.el("div"),h=(i.config,{}),d=!1;i.settings=c;var p={string:function(t){return f.txt('"'+f.shorten(t.replace(/"/g,'\\"'))+'"')},number:function(t){return f.txt(t)},regexp:function(t){var e=f.table(["RegExp",null],"regexp"),n=f.table(),i=f.expander("/"+t.source+"/","Click to show more",function(){this.parentNode.appendChild(e.node)});return n.addRow(["g",t.global]).addRow(["i",t.ignoreCase]).addRow(["m",t.multiline]),e.addRow(["source","/"+t.source+"/"]).addRow(["flags",n.node]).addRow(["lastIndex",t.lastIndex]),c.expanded?e.node:i},domelement:function(e,t){var n=f.table(["DOMElement",null],"domelement"),i=e.nodeName||"";return n.addRow(["tag","&lt;"+i.toLowerCase()+"&gt;"]),f.forEach(["id","className","innerHTML","src","href"],function(t){e[t]&&n.addRow([t,f.htmlentities(e[t])])}),c.expanded?n.node:f.expander("DOMElement ("+i.toLowerCase()+")","Click to show more",function(){this.parentNode.appendChild(n.node)})},domnode:function(t){var e=f.table(["DOMNode",null],"domelement"),n=f.htmlentities((t.data||"UNDEFINED").replace(/\n/g,"\\n"));return e.addRow(["nodeType",t.nodeType+" ("+t.nodeName+")"]).addRow(["data",n]),c.expanded?e.node:f.expander("DOMNode","Click to show more",function(){this.parentNode.appendChild(e.node)})},jquery:function(t,e,n){return p.array(t,e,n,!0)},object:function(t,e,n){var i=f.within(h).is(t);if(i)return f.common.circRef(t,i,c);if(h[n||"TOP"]=t,e===c.maxDepth)return f.common.depthReached(t,c);var r=f.table(["Object",null],"object"),s=!0;for(var o in t)if(!t.hasOwnProperty||t.hasOwnProperty(o)){var a=t[o],l=f.type(a);s=!1;try{r.addRow([o,p[l](a,e+1,o)],l)}catch(t){window.console&&window.console.log&&console.log(t.message)}}s?r.addRow(["<small>[empty]</small>"]):r.thead.appendChild(f.hRow(["key","value"],"colHeader"));var u=c.expanded||d?r.node:f.expander(f.stringify(t),"Click to show more",function(){this.parentNode.appendChild(r.node)});return d=!0,u},array:function(n,i,t,e){var r=f.within(h).is(n);if(r)return f.common.circRef(n,r);if(h[t||"TOP"]=n,i===c.maxDepth)return f.common.depthReached(n);var s=e?"jQuery":"Array",o=f.table([s+"("+n.length+")",null],e?"jquery":s.toLowerCase()),a=!0,l=0;return e&&o.addRow(["selector",n.selector]),f.forEach(n,function(t,e){if(0<=c.maxArray&&++l>c.maxArray)return o.addRow([e+".."+(n.length-1),p[f.type(t)]("...",i+1,e)]),!1;a=!1,o.addRow([e,p[f.type(t)](t,i+1,e)])}),e||(a?o.addRow(["<small>[empty]</small>"]):o.thead.appendChild(f.hRow(["index","value"],"colHeader"))),c.expanded?o.node:f.expander(f.stringify(n),"Click to show more",function(){this.parentNode.appendChild(o.node)})},function:function(t,e,n){var i=f.within(h).is(t);if(i)return f.common.circRef(t,i);h[n||"TOP"]=t;var r=f.table(["Function",null],"function"),s=(f.table(["Arguments"]),t.toString().match(/\((.+?)\)/)),o=t.toString().match(/\(.*?\)\s+?\{?([\S\s]+)/)[1].replace(/\}?$/,"");return r.addRow(["arguments",s?s[1].replace(/[^\w_,\s]/g,""):"<small>[none/native]</small>"]).addRow(["body",o]),c.expanded?r.node:f.expander("function(){...}","Click to see more about this function.",function(){this.parentNode.appendChild(r.node)})},date:function(t){var e=f.table(["Date",null],"date"),n=t.toString().split(/\s/);return e.addRow(["Time",n[4]]).addRow(["Date",n.slice(0,4).join("-")]),c.expanded?e.node:f.expander("Date (timestamp): "+ +t,"Click to see a little more info about this date",function(){this.parentNode.appendChild(e.node)})},boolean:function(t){return f.txt(t.toString().toUpperCase())},undefined:function(){return f.txt("UNDEFINED")},null:function(){return f.txt("NULL")},default:function(){return f.txt("prettyPrint: TypeNotFound Error")}};return n.appendChild(p[c.forceObject?"object":f.type(t)](t,0)),n};return i.config={expanded:!0,forceObject:!1,maxDepth:3,maxArray:-1,styles:{array:{th:{backgroundColor:"#A4C18B",color:"white"}},function:{th:{backgroundColor:"#D82525"}},regexp:{th:{backgroundColor:"#E2F3FB",color:"#000"}},object:{th:{backgroundColor:"#8DA3AD"}},jquery:{th:{backgroundColor:"#FBF315"}},error:{th:{backgroundColor:"red",color:"yellow"}},domelement:{th:{backgroundColor:"#F3801E"}},date:{th:{backgroundColor:"#A725D8"}},colHeader:{th:{backgroundColor:"#EEE",color:"#aaa",textTransform:"uppercase",fontSize:"80%",padding:"2px 5px"}},default:{table:{borderCollapse:"collapse",width:"100%"},td:{padding:"5px",fontSize:"12px",backgroundColor:"rgba(255,255,255,0.5)",color:"#222",border:"1px solid #ddd",verticalAlign:"top",fontFamily:'"Consolas","Lucida Console",Courier,mono',whiteSpace:"nowrap"},td_hover:{},th:{padding:"5px",fontSize:"12px",backgroundColor:"#222",color:"#EEE",textAlign:"left",border:"1px solid #ddd",verticalAlign:"top",fontFamily:'"Consolas","Lucida Console",Courier,mono',backgroundRepeat:"repeat-x"}}}},i}();!function(t){"use strict";"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&void 0!==module.exports?module.exports=t():"undefined"!=typeof Package?Sortable=t():window.Sortable=t()}(function(){"use strict";function l(t,e,n,i,r,s){var o=h.createEvent("Event");o.initEvent(e,!0,!0),o.item=n||t,o.from=i||t,o.clone=_,o.oldIndex=r,o.newIndex=s,t.dispatchEvent(o)}function o(){}var b,w,_,x,S,p,f,T,C,u,i,E,c,s,g={},k="Sortable"+(new Date).getTime(),m=window,h=m.document,a=m.parseInt,d=!!("draggable"in h.createElement("div")),M=!1,v="onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),y=Math.abs,r=[].slice,D=[],O=t(function(t,e,n){if(n&&e.scroll){var i,r,s,o,a=e.scrollSensitivity,l=e.scrollSpeed,u=t.clientX,c=t.clientY,h=window.innerWidth,d=window.innerHeight;if(f!==n&&(p=e.scroll,f=n,!0===p)){p=n;do{if(p.offsetWidth<p.scrollWidth||p.offsetHeight<p.scrollHeight)break}while(p=p.parentNode)}p&&(r=(i=p).getBoundingClientRect(),s=(y(r.right-u)<=a)-(y(r.left-u)<=a),o=(y(r.bottom-c)<=a)-(y(r.top-c)<=a)),s||o||(o=(d-c<=a)-(c<=a),((s=(h-u<=a)-(u<=a))||o)&&(i=m)),g.vx===s&&g.vy===o&&g.el===i||(g.el=i,g.vx=s,g.vy=o,clearInterval(g.pid),i&&(g.pid=setInterval(function(){i===m?m.scrollTo(m.scrollX+s*l,m.scrollY+o*l):(o&&(i.scrollTop+=o*l),s&&(i.scrollLeft+=s*l))},24)))}},30);function A(e,n){this.el=e,this.options=n=n||{};var t={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1};for(var i in t)i in n||(n[i]=t[i]);var r=n.group;for(var s in r&&"object"==typeof r||(r=n.group={name:r}),["pull","put"].forEach(function(t){t in r||(r[t]=!0)}),v.forEach(function(t){n[t]=j(this,n[t]||o),L(e,t.substr(2).toLowerCase(),n[t])},this),n.groups=" "+r.name+(r.put.join?" "+r.put.join(" "):"")+" ",e[k]=n,this)"_"===s.charAt(0)&&(this[s]=j(this,this[s]));L(e,"mousedown",this._onTapStart),L(e,"touchstart",this._onTapStart),L(e,"dragover",this),L(e,"dragenter",this),D.push(this._onDragOver),n.store&&this.sort(n.store.get(this))}function N(t){_&&_.state!==t&&(F(_,"display",t?"none":""),!t&&_.state&&x.insertBefore(_,b),_.state=t)}function j(t,e){var n=r.call(arguments,2);return e.bind?e.bind.apply(e,[t].concat(n)):function(){return e.apply(t,n.concat(r.call(arguments)))}}function R(t,e,n){if(t){n=n||h;var i=(e=e.split(".")).shift().toUpperCase(),r=new RegExp("\\s("+e.join("|")+")\\s","g");do{if(">*"===i&&t.parentNode===n||(""===i||t.nodeName.toUpperCase()==i)&&(!e.length||((" "+t.className+" ").match(r)||[]).length==e.length))return t}while(t!==n&&(t=t.parentNode))}return null}function L(t,e,n){t.addEventListener(e,n,!1)}function I(t,e,n){t.removeEventListener(e,n,!1)}function P(t,e,n){if(t)if(t.classList)t.classList[n?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(/\s+/g," ").replace(" "+e+" ","");t.className=i+(n?" "+e:"")}}function F(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return h.defaultView&&h.defaultView.getComputedStyle?n=h.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in i||(e="-webkit-"+e),i[e]=n+("string"==typeof n?"":"px")}}function H(t,e,n){if(t){var i=t.getElementsByTagName(e),r=0,s=i.length;if(n)for(;r<s;r++)n(i[r],r);return i}return[]}function q(t){t.draggable=!1}function $(){M=!1}function U(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,i=0;n--;)i+=e.charCodeAt(n);return i.toString(36)}function B(t){for(var e=0;t=t&&t.previousElementSibling;)"TEMPLATE"!==t.nodeName.toUpperCase()&&e++;return e}function t(t,e){var n,i;return function(){void 0===n&&(n=arguments,i=this,setTimeout(function(){1===n.length?t.call(i,n[0]):t.apply(i,n),n=void 0},e))}}return A.prototype={constructor:A,_dragStarted:function(){x&&b&&(P(b,this.options.ghostClass,!0),A.active=this,l(x,"start",b,x,u))},_onTapStart:function(t){var e=t.type,n=t.touches&&t.touches[0],i=(n||t).target,r=i,s=this.options,o=this.el,a=s.filter;if(!("mousedown"===e&&0!==t.button||s.disabled)&&(i=R(i,s.draggable,o))){if(u=B(i),"function"==typeof a){if(a.call(this,t,i,this))return l(r,"filter",i,o,u),void t.preventDefault()}else if(a=a&&a.split(",").some(function(t){if(t=R(r,t.trim(),o))return l(t,"filter",i,o,u),!0}))return void t.preventDefault();if((!s.handle||R(r,s.handle,o))&&i&&!b&&i.parentNode===o){c=t,x=this.el,S=(b=i).nextSibling,E=this.options.group,b.draggable=!0,s.ignore.split(",").forEach(function(t){H(i,t.trim(),q)}),n&&(c={target:i,clientX:n.clientX,clientY:n.clientY},this._onDragStart(c,"touch"),t.preventDefault()),L(h,"mouseup",this._onDrop),L(h,"touchend",this._onDrop),L(h,"touchcancel",this._onDrop),L(b,"dragend",this),L(x,"dragstart",this._onDragStart),d||this._onDragStart(c,!0);try{h.selection?h.selection.empty():window.getSelection().removeAllRanges()}catch(t){}}}},_emulateDragOver:function(){if(s){F(w,"display","none");var t=h.elementFromPoint(s.clientX,s.clientY),e=t,n=" "+this.options.group.name,i=D.length;if(e)do{if(e[k]&&-1<e[k].groups.indexOf(n)){for(;i--;)D[i]({clientX:s.clientX,clientY:s.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);F(w,"display","")}},_onTouchMove:function(t){if(c){var e=t.touches?t.touches[0]:t,n=e.clientX-c.clientX,i=e.clientY-c.clientY,r=t.touches?"translate3d("+n+"px,"+i+"px,0)":"translate("+n+"px,"+i+"px)";s=e,F(w,"webkitTransform",r),F(w,"mozTransform",r),F(w,"msTransform",r),F(w,"transform",r),t.preventDefault()}},_onDragStart:function(t,e){var n=t.dataTransfer,i=this.options;if(this._offUpEvents(),"clone"==E.pull&&(F(_=b.cloneNode(!0),"display","none"),x.insertBefore(_,b)),e){var r,s=b.getBoundingClientRect(),o=F(b);F(w=b.cloneNode(!0),"top",s.top-a(o.marginTop,10)),F(w,"left",s.left-a(o.marginLeft,10)),F(w,"width",s.width),F(w,"height",s.height),F(w,"opacity","0.8"),F(w,"position","fixed"),F(w,"zIndex","100000"),x.appendChild(w),r=w.getBoundingClientRect(),F(w,"width",2*s.width-r.width),F(w,"height",2*s.height-r.height),"touch"===e?(L(h,"touchmove",this._onTouchMove),L(h,"touchend",this._onDrop),L(h,"touchcancel",this._onDrop)):(L(h,"mousemove",this._onTouchMove),L(h,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,150)}else n&&(n.effectAllowed="move",i.setData&&i.setData.call(this,n,b)),L(h,"drop",this);setTimeout(this._dragStarted,0)},_onDragOver:function(t){var e,n,i,r=this.el,s=this.options,o=s.group,a=o.put,l=E===o,u=s.sort;if(b&&(void 0!==t.preventDefault&&(t.preventDefault(),s.dragoverBubble||t.stopPropagation()),E&&!s.disabled&&(l?u||(i=!x.contains(b)):E.pull&&a&&(E.name===o.name||a.indexOf&&~a.indexOf(E.name)))&&(void 0===t.rootEl||t.rootEl===this.el))){if(O(t,s,this.el),M)return;if(e=R(t.target,s.draggable,r),n=b.getBoundingClientRect(),i)return N(!0),void(_||S?x.insertBefore(b,_||S):u||x.appendChild(b));if(0===r.children.length||r.children[0]===w||r===t.target&&(e=function(t,e){var n=t.lastElementChild,i=n.getBoundingClientRect();return 5<e.clientY-(i.top+i.height)&&n}(r,t))){if(e){if(e.animated)return;h=e.getBoundingClientRect()}N(l),r.appendChild(b),this._animate(n,b),e&&this._animate(h,e)}else if(e&&!e.animated&&e!==b&&void 0!==e.parentNode[k]){T!==e&&(C=F(T=e));var c,h=e.getBoundingClientRect(),d=h.right-h.left,p=h.bottom-h.top,f=/left|right|inline/.test(C.cssFloat+C.display),g=e.offsetWidth>b.offsetWidth,m=e.offsetHeight>b.offsetHeight,v=.5<(f?(t.clientX-h.left)/d:(t.clientY-h.top)/p),y=e.nextElementSibling;M=!0,setTimeout($,30),N(l),(c=f?e.previousElementSibling===b&&!g||v&&g:y!==b&&!m||v&&m)&&!y?r.appendChild(b):e.parentNode.insertBefore(b,c?y:e),this._animate(n,b),this._animate(h,e)}}},_animate:function(t,e){var n=this.options.animation;if(n){var i=e.getBoundingClientRect();F(e,"transition","none"),F(e,"transform","translate3d("+(t.left-i.left)+"px,"+(t.top-i.top)+"px,0)"),e.offsetWidth,F(e,"transition","all "+n+"ms"),F(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=setTimeout(function(){F(e,"transition",""),F(e,"transform",""),e.animated=!1},n)}},_offUpEvents:function(){I(h,"mouseup",this._onDrop),I(h,"touchmove",this._onTouchMove),I(h,"touchend",this._onDrop),I(h,"touchcancel",this._onDrop)},_onDrop:function(t){var e=this.el,n=this.options;clearInterval(this._loopId),clearInterval(g.pid),I(h,"drop",this),I(h,"mousemove",this._onTouchMove),I(e,"dragstart",this._onDragStart),this._offUpEvents(),t&&(t.preventDefault(),n.dropBubble||t.stopPropagation(),w&&w.parentNode.removeChild(w),b&&(I(b,"dragend",this),q(b),P(b,this.options.ghostClass,!1),x!==b.parentNode?(i=B(b),l(b.parentNode,"sort",b,x,u,i),l(x,"sort",b,x,u,i),l(b,"add",b,x,u,i),l(x,"remove",b,x,u,i)):(_&&_.parentNode.removeChild(_),b.nextSibling!==S&&(i=B(b),l(x,"update",b,x,u,i),l(x,"sort",b,x,u,i))),A.active&&l(x,"end",b,x,u,i)),x=b=w=S=_=p=f=c=s=T=C=E=A.active=null,this.save())},handleEvent:function(t){var e=t.type;"dragover"===e||"dragenter"===e?(this._onDragOver(t),function(t){t.dataTransfer.dropEffect="move",t.preventDefault()}(t)):"drop"!==e&&"dragend"!==e||this._onDrop(t)},toArray:function(){for(var t,e=[],n=this.el.children,i=0,r=n.length;i<r;i++)R(t=n[i],this.options.draggable,this.el)&&e.push(t.getAttribute("data-id")||U(t));return e},sort:function(t){var i={},r=this.el;this.toArray().forEach(function(t,e){var n=r.children[e];R(n,this.options.draggable,r)&&(i[t]=n)},this),t.forEach(function(t){i[t]&&(r.removeChild(i[t]),r.appendChild(i[t]))})},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return R(t,e||this.options.draggable,this.el)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];n[t]=e},destroy:function(){var e=this.el,n=this.options;v.forEach(function(t){I(e,t.substr(2).toLowerCase(),n[t])}),I(e,"mousedown",this._onTapStart),I(e,"touchstart",this._onTapStart),I(e,"dragover",this),I(e,"dragenter",this),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),D.splice(D.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},A.utils={on:L,off:I,css:F,find:H,bind:j,is:function(t,e){return!!R(t,e,t)},throttle:t,closest:R,toggleClass:P,dispatchEvent:l,index:B},A.version="1.1.1",A.create=function(t,e){return new A(t,e)},A}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(r){"use strict";r.fn.sortable=function(n){var i;return this.each(function(){var t=r(this),e=t.data("sortable");if(e||!(n instanceof Object)&&n||(e=new Sortable(this,n),t.data("sortable",e)),e){if("widget"===n)return e;"destroy"===n?(e.destroy(),t.removeData("sortable")):n in e&&(i=e[e].apply(e,[].slice.call(arguments,1)))}}),void 0===i?this:i}});var XBBCODE=function(){var m,v,y,i,r,s,o,t={},a=/^(?:https?|file|c):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:;@#%&()~_?\+=\/\\\.]*$/,l=/^(?:aliceblue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blue|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|cyan|darkblue|darkcyan|darkgoldenrod|darkgray|darkgreen|darkkhaki|darkmagenta|darkolivegreen|darkorange|darkorchid|darkred|darksalmon|darkseagreen|darkslateblue|darkslategray|darkturquoise|darkviolet|deeppink|deepskyblue|dimgray|dodgerblue|firebrick|floralwhite|forestgreen|fuchsia|gainsboro|ghostwhite|gold|goldenrod|gray|green|greenyellow|honeydew|hotpink|indianred|indigo|ivory|khaki|lavender|lavenderblush|lawngreen|lemonchiffon|lightblue|lightcoral|lightcyan|lightgoldenrodyellow|lightgray|lightgreen|lightpink|lightsalmon|lightseagreen|lightskyblue|lightslategray|lightsteelblue|lightyellow|lime|limegreen|linen|magenta|maroon|mediumaquamarine|mediumblue|mediumorchid|mediumpurple|mediumseagreen|mediumslateblue|mediumspringgreen|mediumturquoise|mediumvioletred|midnightblue|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orange|orangered|orchid|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|purple|red|rosybrown|royalblue|saddlebrown|salmon|sandybrown|seagreen|seashell|sienna|silver|skyblue|slateblue|slategray|snow|springgreen|steelblue|tan|teal|thistle|tomato|turquoise|violet|wheat|white|whitesmoke|yellow|yellowgreen)$/,u=/^#?[a-fA-F0-9]{6}$/,c=/[^\s@]+@[^\s@]+\.[^\s@]+/,h=/^([a-z][a-z0-9_]+|"[a-z][a-z0-9_\s]+")$/i,d=[];function n(){var t,e,n;for(t in v=[],m)if(m.hasOwnProperty(t)){for("*"===t?v.push("\\"+t):(v.push(t),m[t].noParse&&d.push(t)),m[t].validChildLookup={},m[t].validParentLookup={},m[t].restrictParentsTo=m[t].restrictParentsTo||[],m[t].restrictChildrenTo=m[t].restrictChildrenTo||[],n=m[t].restrictChildrenTo.length,e=0;e<n;e++)m[t].validChildLookup[m[t].restrictChildrenTo[e]]=!0;for(n=m[t].restrictParentsTo.length,e=0;e<n;e++)m[t].validParentLookup[m[t].restrictParentsTo[e]]=!0}y=new RegExp("<bbcl=([0-9]+) ("+v.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi"),i=new RegExp("\\[("+v.join("|")+")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi"),r=new RegExp("\\[("+d.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi"),function(){for(var t=[],e=0;e<v.length;e++)"\\*"!==v[e]&&t.push("/"+v[e]);s=new RegExp("(\\[)((?:"+v.join("|")+")(?:[ =][^\\]]*?)?)(\\])","gi"),o=new RegExp("(\\[)("+t.join("|")+")(\\])","gi")}()}m={b:{openTag:function(t,e){return'<span class="xbbcode-b">'},closeTag:function(t,e){return"</span>"}},bbcode:{openTag:function(t,e){return""},closeTag:function(t,e){return""}},center:{openTag:function(t,e){return'<span class="xbbcode-center">'},closeTag:function(t,e){return"</span>"}},code:{openTag:function(t,e){return'<span class="xbbcode-code">'},closeTag:function(t,e){return"</span>"},noParse:!0},color:{openTag:function(t,e){var n=t.substr(1).toLowerCase()||"black";return l.lastIndex=0,u.lastIndex=0,l.test(n)||(u.test(n)?"#"!==n.substr(0,1)&&(n="#"+n):n="black"),'<span style="color:'+n+'">'},closeTag:function(t,e){return"</span>"}},email:{openTag:function(t,e){var n;return n=t?t.substr(1):e.replace(/<.*?>/g,""),c.lastIndex=0,c.test(n)?'<a href="mailto:'+n+'">':"<a>"},closeTag:function(t,e){return"</a>"}},face:{openTag:function(t,e){var n=t.substr(1)||"inherit";return h.lastIndex=0,h.test(n)||(n="inherit"),'<span style="font-family:'+n+'">'},closeTag:function(t,e){return"</span>"}},font:{openTag:function(t,e){var n=t.substr(1)||"inherit";return h.lastIndex=0,h.test(n)||(n="inherit"),'<span style="font-family:'+n+'">'},closeTag:function(t,e){return"</span>"}},i:{openTag:function(t,e){return'<span class="xbbcode-i">'},closeTag:function(t,e){return"</span>"}},img:{openTag:function(t,e){var n=e;return a.lastIndex=0,a.test(n)||(n=""),'<img src="'+n+'" />'},closeTag:function(t,e){return""},displayContent:!1},justify:{openTag:function(t,e){return'<span class="xbbcode-justify">'},closeTag:function(t,e){return"</span>"}},large:{openTag:function(t,e){var n=(t=t||"").substr(1)||"inherit";return l.lastIndex=0,u.lastIndex=0,l.test(n)||(u.test(n)?"#"!==n.substr(0,1)&&(n="#"+n):n="inherit"),'<span class="xbbcode-size-36" style="color:'+n+'">'},closeTag:function(t,e){return"</span>"}},left:{openTag:function(t,e){return'<span class="xbbcode-left">'},closeTag:function(t,e){return"</span>"}},li:{openTag:function(t,e){return"<li>"},closeTag:function(t,e){return"</li>"},restrictParentsTo:["list","ul","ol"]},list:{openTag:function(t,e){return"<ul>"},closeTag:function(t,e){return"</ul>"},restrictChildrenTo:["*","li"]},noparse:{openTag:function(t,e){return""},closeTag:function(t,e){return""},noParse:!0},ol:{openTag:function(t,e){return"<ol>"},closeTag:function(t,e){return"</ol>"},restrictChildrenTo:["*","li"]},php:{openTag:function(t,e){return'<span class="xbbcode-code">'},closeTag:function(t,e){return"</span>"},noParse:!0},quote:{openTag:function(t,e){return'<blockquote class="xbbcode-blockquote">'},closeTag:function(t,e){return"</blockquote>"}},right:{openTag:function(t,e){return'<span class="xbbcode-right">'},closeTag:function(t,e){return"</span>"}},s:{openTag:function(t,e){return'<span class="xbbcode-s">'},closeTag:function(t,e){return"</span>"}},size:{openTag:function(t,e){var n=parseInt(t.substr(1),10)||0;return(n<4||40<n)&&(n=14),'<span class="xbbcode-size-'+n+'">'},closeTag:function(t,e){return"</span>"}},small:{openTag:function(t,e){var n=(t=t||"").substr(1)||"inherit";return l.lastIndex=0,u.lastIndex=0,l.test(n)||(u.test(n)?"#"!==n.substr(0,1)&&(n="#"+n):n="inherit"),'<span class="xbbcode-size-10" style="color:'+n+'">'},closeTag:function(t,e){return"</span>"}},sub:{openTag:function(t,e){return"<sub>"},closeTag:function(t,e){return"</sub>"}},sup:{openTag:function(t,e){return"<sup>"},closeTag:function(t,e){return"</sup>"}},table:{openTag:function(t,e){return'<table class="xbbcode-table">'},closeTag:function(t,e){return"</table>"},restrictChildrenTo:["tbody","thead","tfoot","tr"]},tbody:{openTag:function(t,e){return"<tbody>"},closeTag:function(t,e){return"</tbody>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},tfoot:{openTag:function(t,e){return"<tfoot>"},closeTag:function(t,e){return"</tfoot>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},thead:{openTag:function(t,e){return'<thead class="xbbcode-thead">'},closeTag:function(t,e){return"</thead>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},td:{openTag:function(t,e){return'<td class="xbbcode-td">'},closeTag:function(t,e){return"</td>"},restrictParentsTo:["tr"]},th:{openTag:function(t,e){return'<th class="xbbcode-th">'},closeTag:function(t,e){return"</th>"},restrictParentsTo:["tr"]},tr:{openTag:function(t,e){return'<tr class="xbbcode-tr">'},closeTag:function(t,e){return"</tr>"},restrictChildrenTo:["td","th"],restrictParentsTo:["table","tbody","tfoot","thead"]},u:{openTag:function(t,e){return'<span class="xbbcode-u">'},closeTag:function(t,e){return"</span>"}},ul:{openTag:function(t,e){return"<ul>"},closeTag:function(t,e){return"</ul>"},restrictChildrenTo:["*","li"]},url:{openTag:function(t,e){var n;return n=t?t.substr(1):e.replace(/<.*?>/g,""),a.lastIndex=0,a.test(n)||(n="#"),'<a href="'+n+'">'},closeTag:function(t,e){return"</a>"}},"*":{openTag:function(t,e){return"<li>"},closeTag:function(t,e){return"</li>"},restrictParentsTo:["list","ul","ol"]}},n();var p=function(t,e,n,i,r){n=n.toLowerCase();var s=m[n].noParse?function(t){return t.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;")}(r):r.replace(y,p),o=m[n].openTag(i,s),a=m[n].closeTag(i,s);return!1===m[n].displayContent&&(s=""),o+s+a};function f(t){for(;t!==(t=t.replace(i,function(t,e,n,i){return t=(t=t.replace(/\[/g,"<")).replace(/\]/g,">"),t.replace(/\<([^\>][^\>]*?)\>/gi,function(t,e){return null===e.match(/^bbcl=([0-9]+) /)?"<bbcl=0 "+e+">":"<"+e.replace(/^(bbcl=)([0-9]+)/,function(t,e,n){return e+(parseInt(n,10)+1)})+">"})})););return t}return t.tags=function(){return m},t.addTags=function(t){var e;for(e in t)m[e]=t[e];n()},t.process=function(t){var e={html:"",error:!1},n=[];for(t.text=t.text.replace(/</g,"&lt;"),t.text=t.text.replace(/>/g,"&gt;"),t.text=t.text.replace(s,function(t,e,n,i){return"<"+n+">"}),t.text=t.text.replace(o,function(t,e,n,i){return"<"+n+">"}),t.text=t.text.replace(/\[/g,"&#91;"),t.text=t.text.replace(/\]/g,"&#93;"),t.text=t.text.replace(/</g,"["),t.text=t.text.replace(/>/g,"]");t.text!==(t.text=t.text.replace(r,function(t,e,n,i){return"["+e+(n=n||"")+"]"+(i=(i=(i=i.replace(/\[/g,"&#91;")).replace(/\]/g,"&#93;"))||"")+"[/"+e+"]"})););return t.text=function(t){for(t=(t=t.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/gi,"<")).replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/gi,">");t!==(t=t.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi,function(t,e,n){for(var i=t;i!==(i=i.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i,function(t,e,n){return"<*]"+e+(n=">/list]"===n.toLowerCase()?"</*]</list]":"</*][*]")})););return i=i.replace(/>/g,"<")})););return t=t.replace(/</g,"[")}(t.text),t.text=f(t.text),n=function s(t,e,n,i,r,o,a){a=a||[],n++;var l,u,c,h,d=new RegExp("(<bbcl="+n+" )("+v.join("|")+")([ =>])","gi"),p=new RegExp("(<bbcl="+n+" )("+v.join("|")+")([ =>])","i"),f=o.match(d)||[],g=m[t]||{};for(f||(o=""),c=d.lastIndex=0;c<f.length;c++)p.lastIndex=0,h=f[c].match(p)[2].toLowerCase(),g&&g.restrictChildrenTo&&0<g.restrictChildrenTo.length&&(g.validChildLookup[h]||(u='The tag "'+h+'" is not allowed as a child of the tag "'+t+'".',a.push(u))),0<(l=m[h]||{}).restrictParentsTo.length&&(l.validParentLookup[t]||(u='The tag "'+t+'" is not allowed as a parent of the tag "'+h+'".',a.push(u)));return o=o.replace(y,function(t,e,n,i,r){return a=s(n.toLowerCase(),t,e,n,i,r,a),t}),a}("bbcode",t.text,-1,0,0,t.text),e.html=function(t){var e=t.text;return e=e.replace(y,p)}(t),-1===e.html.indexOf("[")&&-1===e.html.indexOf("]")||n.push("Some tags appear to be misaligned."),t.removeMisalignedTags&&(e.html=e.html.replace(/\[.*?\]/g,"")),t.addInLineBreaks&&(e.html='<div style="white-space:pre;">'+e.html+"</div>"),e.html=e.html.replace("&#91;","["),e.html=e.html.replace("&#93;","]"),e.error=0!==n.length,e.errorQueue=n,e},t}();!function(l){"use strict";var u=function(t,e){this.options=l.extend({},u.DEFAULTS,e),this.$target=l(this.options.target).on("scroll.bs.affix.data-api",l.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",l.proxy(this.checkPositionWithEventLoop,this)),this.$element=l(t),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};function n(i){return this.each(function(){var t=l(this),e=t.data("bs.affix"),n="object"==typeof i&&i;e||t.data("bs.affix",e=new u(this,n)),"string"==typeof i&&e[i]()})}u.VERSION="3.3.1",u.RESET="affix affix-top affix-bottom",u.DEFAULTS={offset:0,target:window},u.prototype.getState=function(t,e,n,i){var r=this.$target.scrollTop(),s=this.$element.offset(),o=this.$target.height();if(null!=n&&"top"==this.affixed)return r<n&&"top";if("bottom"==this.affixed)return null!=n?!(r+this.unpin<=s.top)&&"bottom":!(r+o<=t-i)&&"bottom";var a=null==this.affixed,l=a?r:s.top;return null!=n&&l<=n?"top":null!=i&&t-i<=l+(a?o:e)&&"bottom"},u.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(u.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},u.prototype.checkPositionWithEventLoop=function(){setTimeout(l.proxy(this.checkPosition,this),1)},u.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=this.$element.height(),e=this.options.offset,n=e.top,i=e.bottom,r=l("body").height();"object"!=typeof e&&(i=n=e),"function"==typeof n&&(n=e.top(this.$element)),"function"==typeof i&&(i=e.bottom(this.$element));var s=this.getState(r,t,n,i);if(this.affixed!=s){null!=this.unpin&&this.$element.css("top","");var o="affix"+(s?"-"+s:""),a=l.Event(o+".bs.affix");if(this.$element.trigger(a),a.isDefaultPrevented())return;this.affixed=s,this.unpin="bottom"==s?this.getPinnedOffset():null,this.$element.removeClass(u.RESET).addClass(o).trigger(o.replace("affix","affixed")+".bs.affix")}"bottom"==s&&this.$element.offset({top:r-t-i})}};var t=l.fn.affix;l.fn.affix=n,l.fn.affix.Constructor=u,l.fn.affix.noConflict=function(){return l.fn.affix=t,this},l(window).on("load",function(){l('[data-spy="affix"]').each(function(){var t=l(this),e=t.data();e.offset=e.offset||{},null!=e.offsetBottom&&(e.offset.bottom=e.offsetBottom),null!=e.offsetTop&&(e.offset.top=e.offsetTop),n.call(t,e)})})}(jQuery),function(s){"use strict";function o(t){s(t).on("click",e,this.close)}var e='[data-dismiss="alert"]';o.VERSION="3.3.1",o.TRANSITION_DURATION=150,o.prototype.close=function(t){var e=s(this),n=e.attr("data-target");n=n||(n=e.attr("href"))&&n.replace(/.*(?=#[^\s]*$)/,"");var i=s(n);function r(){i.detach().trigger("closed.bs.alert").remove()}t&&t.preventDefault(),i.length||(i=e.closest(".alert")),i.trigger(t=s.Event("close.bs.alert")),t.isDefaultPrevented()||(i.removeClass("in"),s.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",r).emulateTransitionEnd(o.TRANSITION_DURATION):r())};var t=s.fn.alert;s.fn.alert=function(n){return this.each(function(){var t=s(this),e=t.data("bs.alert");e||t.data("bs.alert",e=new o(this)),"string"==typeof n&&e[n].call(t)})},s.fn.alert.Constructor=o,s.fn.alert.noConflict=function(){return s.fn.alert=t,this},s(document).on("click.bs.alert.data-api",e,o.prototype.close)}(jQuery),function(s){"use strict";var r=function(t,e){this.$element=s(t),this.options=s.extend({},r.DEFAULTS,e),this.isLoading=!1};function n(i){return this.each(function(){var t=s(this),e=t.data("bs.button"),n="object"==typeof i&&i;e||t.data("bs.button",e=new r(this,n)),"toggle"==i?e.toggle():i&&e.setState(i)})}r.VERSION="3.3.1",r.DEFAULTS={loadingText:"loading..."},r.prototype.setState=function(t){var e="disabled",n=this.$element,i=n.is("input")?"val":"html",r=n.data();t+="Text",null==r.resetText&&n.data("resetText",n[i]()),setTimeout(s.proxy(function(){n[i](null==r[t]?this.options[t]:r[t]),"loadingText"==t?(this.isLoading=!0,n.addClass(e).attr(e,e)):this.isLoading&&(this.isLoading=!1,n.removeClass(e).removeAttr(e))},this),0)},r.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var n=this.$element.find("input");"radio"==n.prop("type")&&(n.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active"));t&&this.$element.toggleClass("active")};var t=s.fn.button;s.fn.button=n,s.fn.button.Constructor=r,s.fn.button.noConflict=function(){return s.fn.button=t,this},s(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(t){var e=s(t.target);e.hasClass("btn")||(e=e.closest(".btn")),n.call(e,"toggle"),t.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){s(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}(jQuery),function(d){"use strict";function p(t,e){this.$element=d(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=e,this.paused=this.sliding=this.interval=this.$active=this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",d.proxy(this.keydown,this)),"hover"!=this.options.pause||"ontouchstart"in document.documentElement||this.$element.on("mouseenter.bs.carousel",d.proxy(this.pause,this)).on("mouseleave.bs.carousel",d.proxy(this.cycle,this))}function o(r){return this.each(function(){var t=d(this),e=t.data("bs.carousel"),n=d.extend({},p.DEFAULTS,t.data(),"object"==typeof r&&r),i="string"==typeof r?r:n.slide;e||t.data("bs.carousel",e=new p(this,n)),"number"==typeof r?e.to(r):i?e[i]():n.interval&&e.pause().cycle()})}p.VERSION="3.3.1",p.TRANSITION_DURATION=600,p.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},p.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},p.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(d.proxy(this.next,this),this.options.interval)),this},p.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},p.prototype.getItemForDirection=function(t,e){var n="prev"==t?-1:1,i=(this.getItemIndex(e)+n)%this.$items.length;return this.$items.eq(i)},p.prototype.to=function(t){var e=this,n=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):n==t?this.pause().cycle():this.slide(n<t?"next":"prev",this.$items.eq(t))},p.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&d.support.transition&&(this.$element.trigger(d.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},p.prototype.next=function(){if(!this.sliding)return this.slide("next")},p.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},p.prototype.slide=function(t,e){var n=this.$element.find(".item.active"),i=e||this.getItemForDirection(t,n),r=this.interval,s="next"==t?"left":"right",o="next"==t?"first":"last",a=this;if(!i.length){if(!this.options.wrap)return;i=this.$element.find(".item")[o]()}if(i.hasClass("active"))return this.sliding=!1;var l=i[0],u=d.Event("slide.bs.carousel",{relatedTarget:l,direction:s});if(this.$element.trigger(u),!u.isDefaultPrevented()){if(this.sliding=!0,r&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var c=d(this.$indicators.children()[this.getItemIndex(i)]);c&&c.addClass("active")}var h=d.Event("slid.bs.carousel",{relatedTarget:l,direction:s});return d.support.transition&&this.$element.hasClass("slide")?(i.addClass(t),i[0].offsetWidth,n.addClass(s),i.addClass(s),n.one("bsTransitionEnd",function(){i.removeClass([t,s].join(" ")).addClass("active"),n.removeClass(["active",s].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger(h)},0)}).emulateTransitionEnd(p.TRANSITION_DURATION)):(n.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger(h)),r&&this.cycle(),this}};var t=d.fn.carousel;d.fn.carousel=o,d.fn.carousel.Constructor=p,d.fn.carousel.noConflict=function(){return d.fn.carousel=t,this};function e(t){var e,n=d(this),i=d(n.attr("data-target")||(e=n.attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,""));if(i.hasClass("carousel")){var r=d.extend({},i.data(),n.data()),s=n.attr("data-slide-to");s&&(r.interval=!1),o.call(i,r),s&&i.data("bs.carousel").to(s),t.preventDefault()}}d(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),d(window).on("load",function(){d('[data-ride="carousel"]').each(function(){var t=d(this);o.call(t,t.data())})})}(jQuery),function(o){"use strict";var a=function(t,e){this.$element=o(t),this.options=o.extend({},a.DEFAULTS,e),this.$trigger=o(this.options.trigger).filter('[href="#'+t.id+'"], [data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};function r(t){var e,n=t.attr("data-target")||(e=t.attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,"");return o(n)}function l(i){return this.each(function(){var t=o(this),e=t.data("bs.collapse"),n=o.extend({},a.DEFAULTS,t.data(),"object"==typeof i&&i);!e&&n.toggle&&"show"==i&&(n.toggle=!1),e||t.data("bs.collapse",e=new a(this,n)),"string"==typeof i&&e[i]()})}a.VERSION="3.3.1",a.TRANSITION_DURATION=350,a.DEFAULTS={toggle:!0,trigger:'[data-toggle="collapse"]'},a.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},a.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,e=this.$parent&&this.$parent.find("> .panel").children(".in, .collapsing");if(!(e&&e.length&&(t=e.data("bs.collapse"))&&t.transitioning)){var n=o.Event("show.bs.collapse");if(this.$element.trigger(n),!n.isDefaultPrevented()){e&&e.length&&(l.call(e,"hide"),t||e.data("bs.collapse",null));var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var r=function(){this.$element.removeClass("collapsing").addClass("collapse in")[i](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!o.support.transition)return r.call(this);var s=o.camelCase(["scroll",i].join("-"));this.$element.one("bsTransitionEnd",o.proxy(r,this)).emulateTransitionEnd(a.TRANSITION_DURATION)[i](this.$element[0][s])}}}},a.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=o.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var e=this.dimension();this.$element[e](this.$element[e]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!o.support.transition)return n.call(this);this.$element[e](0).one("bsTransitionEnd",o.proxy(n,this)).emulateTransitionEnd(a.TRANSITION_DURATION)}}},a.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},a.prototype.getParent=function(){return o(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(o.proxy(function(t,e){var n=o(e);this.addAriaAndCollapsedClass(r(n),n)},this)).end()},a.prototype.addAriaAndCollapsedClass=function(t,e){var n=t.hasClass("in");t.attr("aria-expanded",n),e.toggleClass("collapsed",!n).attr("aria-expanded",n)};var t=o.fn.collapse;o.fn.collapse=l,o.fn.collapse.Constructor=a,o.fn.collapse.noConflict=function(){return o.fn.collapse=t,this},o(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(t){var e=o(this);e.attr("data-target")||t.preventDefault();var n=r(e),i=n.data("bs.collapse")?"toggle":o.extend({},e.data(),{trigger:this});l.call(n,i)})}(jQuery),function(a){"use strict";function i(t){a(t).on("click.bs.dropdown",this.toggle)}var l='[data-toggle="dropdown"]';function s(i){i&&3===i.which||(a(".dropdown-backdrop").remove(),a(l).each(function(){var t=a(this),e=u(t),n={relatedTarget:this};e.hasClass("open")&&(e.trigger(i=a.Event("hide.bs.dropdown",n)),i.isDefaultPrevented()||(t.attr("aria-expanded","false"),e.removeClass("open").trigger("hidden.bs.dropdown",n)))}))}function u(t){var e=t.attr("data-target"),n=(e=e||(e=t.attr("href"))&&/#[A-Za-z]/.test(e)&&e.replace(/.*(?=#[^\s]*$)/,""))&&a(e);return n&&n.length?n:t.parent()}i.VERSION="3.3.1",i.prototype.toggle=function(t){var e=a(this);if(!e.is(".disabled, :disabled")){var n=u(e),i=n.hasClass("open");if(s(),!i){"ontouchstart"in document.documentElement&&!n.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",s);var r={relatedTarget:this};if(n.trigger(t=a.Event("show.bs.dropdown",r)),t.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),n.toggleClass("open").trigger("shown.bs.dropdown",r)}return!1}},i.prototype.keydown=function(t){if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)){var e=a(this);if(t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled")){var n=u(e),i=n.hasClass("open");if(!i&&27!=t.which||i&&27==t.which)return 27==t.which&&n.find(l).trigger("focus"),e.trigger("click");var r=" li:not(.divider):visible a",s=n.find('[role="menu"]'+r+', [role="listbox"]'+r);if(s.length){var o=s.index(t.target);38==t.which&&0<o&&o--,40==t.which&&o<s.length-1&&o++,~o||(o=0),s.eq(o).trigger("focus")}}}};var t=a.fn.dropdown;a.fn.dropdown=function(n){return this.each(function(){var t=a(this),e=t.data("bs.dropdown");e||t.data("bs.dropdown",e=new i(this)),"string"==typeof n&&e[n].call(t)})},a.fn.dropdown.Constructor=i,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=t,this},a(document).on("click.bs.dropdown.data-api",s).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",l,i.prototype.toggle).on("keydown.bs.dropdown.data-api",l,i.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',i.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',i.prototype.keydown)}(jQuery),function(a){"use strict";function o(t){this.element=a(t)}function e(n){return this.each(function(){var t=a(this),e=t.data("bs.tab");e||t.data("bs.tab",e=new o(this)),"string"==typeof n&&e[n]()})}o.VERSION="3.3.1",o.TRANSITION_DURATION=150,o.prototype.show=function(){var t=this.element,e=t.closest("ul:not(.dropdown-menu)"),n=t.data("target");if(n=n||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]*$)/,""),!t.parent("li").hasClass("active")){var i=e.find(".active:last a"),r=a.Event("hide.bs.tab",{relatedTarget:t[0]}),s=a.Event("show.bs.tab",{relatedTarget:i[0]});if(i.trigger(r),t.trigger(s),!s.isDefaultPrevented()&&!r.isDefaultPrevented()){var o=a(n);this.activate(t.closest("li"),e),this.activate(o,o.parent(),function(){i.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:i[0]})})}}},o.prototype.activate=function(t,e,n){var i=e.find("> .active"),r=n&&a.support.transition&&(i.length&&i.hasClass("fade")||!!e.find("> .fade").length);function s(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),r?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),n&&n()}i.length&&r?i.one("bsTransitionEnd",s).emulateTransitionEnd(o.TRANSITION_DURATION):s(),i.removeClass("in")};var t=a.fn.tab;a.fn.tab=e,a.fn.tab.Constructor=o,a.fn.tab.noConflict=function(){return a.fn.tab=t,this};function n(t){t.preventDefault(),e.call(a(this),"show")}a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',n).on("click.bs.tab.data-api",'[data-toggle="pill"]',n)}(jQuery),function(i){"use strict";i.fn.emulateTransitionEnd=function(t){var e=!1,n=this;i(this).one("bsTransitionEnd",function(){e=!0});return setTimeout(function(){e||i(n).trigger(i.support.transition.end)},t),this},i(function(){i.support.transition=function(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in e)if(void 0!==t.style[n])return{end:e[n]};return!1}(),i.support.transition&&(i.event.special.bsTransitionEnd={bindType:i.support.transition.end,delegateType:i.support.transition.end,handle:function(t){if(i(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(s){"use strict";function r(t,e){var n=s.proxy(this.process,this);this.$body=s("body"),this.$scrollElement=s(t).is("body")?s(window):s(t),this.options=s.extend({},r.DEFAULTS,e),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",n),this.refresh(),this.process()}function e(i){return this.each(function(){var t=s(this),e=t.data("bs.scrollspy"),n="object"==typeof i&&i;e||t.data("bs.scrollspy",e=new r(this,n)),"string"==typeof i&&e[i]()})}r.VERSION="3.3.1",r.DEFAULTS={offset:10},r.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},r.prototype.refresh=function(){var i="offset",r=0;s.isWindow(this.$scrollElement[0])||(i="position",r=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var t=this;this.$body.find(this.selector).map(function(){var t=s(this),e=t.data("target")||t.attr("href"),n=/^#./.test(e)&&s(e);return n&&n.length&&n.is(":visible")&&[[n[i]().top+r,e]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},r.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,n=this.getScrollHeight(),i=this.options.offset+n-this.$scrollElement.height(),r=this.offsets,s=this.targets,o=this.activeTarget;if(this.scrollHeight!=n&&this.refresh(),i<=e)return o!=(t=s[s.length-1])&&this.activate(t);if(o&&e<r[0])return this.activeTarget=null,this.clear();for(t=r.length;t--;)o!=s[t]&&e>=r[t]&&(!r[t+1]||e<=r[t+1])&&this.activate(s[t])},r.prototype.activate=function(t){this.activeTarget=t,this.clear();var e=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=s(e).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},r.prototype.clear=function(){s(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var t=s.fn.scrollspy;s.fn.scrollspy=e,s.fn.scrollspy.Constructor=r,s.fn.scrollspy.noConflict=function(){return s.fn.scrollspy=t,this},s(window).on("load.bs.scrollspy.data-api",function(){s('[data-spy="scroll"]').each(function(){var t=s(this);e.call(t,t.data())})})}(jQuery),function(s){"use strict";function o(t,e){this.options=e,this.$body=s(document.body),this.$element=s(t),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,s.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))}function a(i,r){return this.each(function(){var t=s(this),e=t.data("bs.modal"),n=s.extend({},o.DEFAULTS,t.data(),"object"==typeof i&&i);e||t.data("bs.modal",e=new o(this,n)),"string"==typeof i?e[i](r):n.show&&e.show(r)})}o.VERSION="3.3.1",o.TRANSITION_DURATION=300,o.BACKDROP_TRANSITION_DURATION=150,o.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},o.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},o.prototype.show=function(n){var i=this,t=s.Event("show.bs.modal",{relatedTarget:n});this.$element.trigger(t),this.isShown||t.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',s.proxy(this.hide,this)),this.backdrop(function(){var t=s.support.transition&&i.$element.hasClass("fade");i.$element.parent().length||i.$element.appendTo(i.$body),i.$element.show().scrollTop(0),i.options.backdrop&&i.adjustBackdrop(),i.adjustDialog(),t&&i.$element[0].offsetWidth,i.$element.addClass("in").attr("aria-hidden",!1),i.enforceFocus();var e=s.Event("shown.bs.modal",{relatedTarget:n});t?i.$element.find(".modal-dialog").one("bsTransitionEnd",function(){i.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(o.TRANSITION_DURATION):i.$element.trigger("focus").trigger(e)}))},o.prototype.hide=function(t){t&&t.preventDefault(),t=s.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),s(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),s.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",s.proxy(this.hideModal,this)).emulateTransitionEnd(o.TRANSITION_DURATION):this.hideModal())},o.prototype.enforceFocus=function(){s(document).off("focusin.bs.modal").on("focusin.bs.modal",s.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},o.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",s.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},o.prototype.resize=function(){this.isShown?s(window).on("resize.bs.modal",s.proxy(this.handleUpdate,this)):s(window).off("resize.bs.modal")},o.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},o.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},o.prototype.backdrop=function(t){var e=this,n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=s.support.transition&&n;if(this.$backdrop=s('<div class="modal-backdrop '+n+'" />').prependTo(this.$element).on("click.dismiss.bs.modal",s.proxy(function(t){t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;i?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(o.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var r=function(){e.removeBackdrop(),t&&t()};s.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",r).emulateTransitionEnd(o.BACKDROP_TRANSITION_DURATION):r()}else t&&t()},o.prototype.handleUpdate=function(){this.options.backdrop&&this.adjustBackdrop(),this.adjustDialog()},o.prototype.adjustBackdrop=function(){this.$backdrop.css("height",0).css("height",this.$element[0].scrollHeight)},o.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},o.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},o.prototype.checkScrollbar=function(){this.bodyIsOverflowing=document.body.scrollHeight>document.documentElement.clientHeight,this.scrollbarWidth=this.measureScrollbar()},o.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.bodyIsOverflowing&&this.$body.css("padding-right",t+this.scrollbarWidth)},o.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},o.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var t=s.fn.modal;s.fn.modal=a,s.fn.modal.Constructor=o,s.fn.modal.noConflict=function(){return s.fn.modal=t,this},s(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var e=s(this),n=e.attr("href"),i=s(e.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),r=i.data("bs.modal")?"toggle":s.extend({remote:!/#/.test(n)&&n},i.data(),e.data());e.is("a")&&t.preventDefault(),i.one("show.bs.modal",function(t){t.isDefaultPrevented()||i.one("hidden.bs.modal",function(){e.is(":visible")&&e.trigger("focus")})}),a.call(i,r,this)})}(jQuery),function(m){"use strict";function v(t,e){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",t,e)}v.VERSION="3.3.1",v.TRANSITION_DURATION=150,v.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},v.prototype.init=function(t,e,n){this.enabled=!0,this.type=t,this.$element=m(e),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&m(this.options.viewport.selector||this.options.viewport);for(var i=this.options.trigger.split(" "),r=i.length;r--;){var s=i[r];if("click"==s)this.$element.on("click."+this.type,this.options.selector,m.proxy(this.toggle,this));else if("manual"!=s){var o="hover"==s?"mouseenter":"focusin",a="hover"==s?"mouseleave":"focusout";this.$element.on(o+"."+this.type,this.options.selector,m.proxy(this.enter,this)),this.$element.on(a+"."+this.type,this.options.selector,m.proxy(this.leave,this))}}this.options.selector?this._options=m.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},v.prototype.getDefaults=function(){return v.DEFAULTS},v.prototype.getOptions=function(t){return(t=m.extend({},this.getDefaults(),this.$element.data(),t)).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},v.prototype.getDelegateOptions=function(){var n={},i=this.getDefaults();return this._options&&m.each(this._options,function(t,e){i[t]!=e&&(n[t]=e)}),n},v.prototype.enter=function(t){var e=t instanceof this.constructor?t:m(t.currentTarget).data("bs."+this.type);if(e&&e.$tip&&e.$tip.is(":visible"))e.hoverState="in";else{if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),m(t.currentTarget).data("bs."+this.type,e)),clearTimeout(e.timeout),e.hoverState="in",!e.options.delay||!e.options.delay.show)return e.show();e.timeout=setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show)}},v.prototype.leave=function(t){var e=t instanceof this.constructor?t:m(t.currentTarget).data("bs."+this.type);if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),m(t.currentTarget).data("bs."+this.type,e)),clearTimeout(e.timeout),e.hoverState="out",!e.options.delay||!e.options.delay.hide)return e.hide();e.timeout=setTimeout(function(){"out"==e.hoverState&&e.hide()},e.options.delay.hide)},v.prototype.show=function(){var t=m.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var e=m.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!e)return;var n=this,i=this.tip(),r=this.getUID(this.type);this.setContent(),i.attr("id",r),this.$element.attr("aria-describedby",r),this.options.animation&&i.addClass("fade");var s="function"==typeof this.options.placement?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,o=/\s?auto?\s?/i,a=o.test(s);a&&(s=s.replace(o,"")||"top"),i.detach().css({top:0,left:0,display:"block"}).addClass(s).data("bs."+this.type,this),this.options.container?i.appendTo(this.options.container):i.insertAfter(this.$element);var l=this.getPosition(),u=i[0].offsetWidth,c=i[0].offsetHeight;if(a){var h=s,d=this.options.container?m(this.options.container):this.$element.parent(),p=this.getPosition(d);s="bottom"==s&&l.bottom+c>p.bottom?"top":"top"==s&&l.top-c<p.top?"bottom":"right"==s&&l.right+u>p.width?"left":"left"==s&&l.left-u<p.left?"right":s,i.removeClass(h).addClass(s)}var f=this.getCalculatedOffset(s,l,u,c);this.applyPlacement(f,s);var g=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};m.support.transition&&this.$tip.hasClass("fade")?i.one("bsTransitionEnd",g).emulateTransitionEnd(v.TRANSITION_DURATION):g()}},v.prototype.applyPlacement=function(t,e){var n=this.tip(),i=n[0].offsetWidth,r=n[0].offsetHeight,s=parseInt(n.css("margin-top"),10),o=parseInt(n.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(o)&&(o=0),t.top=t.top+s,t.left=t.left+o,m.offset.setOffset(n[0],m.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},t),0),n.addClass("in");var a=n[0].offsetWidth,l=n[0].offsetHeight;"top"==e&&l!=r&&(t.top=t.top+r-l);var u=this.getViewportAdjustedDelta(e,t,a,l);u.left?t.left+=u.left:t.top+=u.top;var c=/top|bottom/.test(e),h=c?2*u.left-i+a:2*u.top-r+l,d=c?"offsetWidth":"offsetHeight";n.offset(t),this.replaceArrow(h,n[0][d],c)},v.prototype.replaceArrow=function(t,e,n){this.arrow().css(n?"left":"top",50*(1-t/e)+"%").css(n?"top":"left","")},v.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},v.prototype.hide=function(t){var e=this,n=this.tip(),i=m.Event("hide.bs."+this.type);function r(){"in"!=e.hoverState&&n.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),t&&t()}if(this.$element.trigger(i),!i.isDefaultPrevented())return n.removeClass("in"),m.support.transition&&this.$tip.hasClass("fade")?n.one("bsTransitionEnd",r).emulateTransitionEnd(v.TRANSITION_DURATION):r(),this.hoverState=null,this},v.prototype.fixTitle=function(){var t=this.$element;!t.attr("title")&&"string"==typeof t.attr("data-original-title")||t.attr("data-original-title",t.attr("title")||"").attr("title","")},v.prototype.hasContent=function(){return this.getTitle()},v.prototype.getPosition=function(t){var e=(t=t||this.$element)[0],n="BODY"==e.tagName,i=e.getBoundingClientRect();null==i.width&&(i=m.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var r=n?{top:0,left:0}:t.offset(),s={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},o=n?{width:m(window).width(),height:m(window).height()}:null;return m.extend({},i,s,o,r)},v.prototype.getCalculatedOffset=function(t,e,n,i){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-n/2}:"top"==t?{top:e.top-i,left:e.left+e.width/2-n/2}:"left"==t?{top:e.top+e.height/2-i/2,left:e.left-n}:{top:e.top+e.height/2-i/2,left:e.left+e.width}},v.prototype.getViewportAdjustedDelta=function(t,e,n,i){var r={top:0,left:0};if(!this.$viewport)return r;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(t)){var a=e.top-s-o.scroll,l=e.top+s-o.scroll+i;a<o.top?r.top=o.top-a:l>o.top+o.height&&(r.top=o.top+o.height-l)}else{var u=e.left-s,c=e.left+s+n;u<o.left?r.left=o.left-u:c>o.width&&(r.left=o.left+o.width-c)}return r},v.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},v.prototype.getUID=function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},v.prototype.tip=function(){return this.$tip=this.$tip||m(this.options.template)},v.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},v.prototype.enable=function(){this.enabled=!0},v.prototype.disable=function(){this.enabled=!1},v.prototype.toggleEnabled=function(){this.enabled=!this.enabled},v.prototype.toggle=function(t){var e=this;t&&((e=m(t.currentTarget).data("bs."+this.type))||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),m(t.currentTarget).data("bs."+this.type,e))),e.tip().hasClass("in")?e.leave(e):e.enter(e)},v.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type)})};var t=m.fn.tooltip;m.fn.tooltip=function(r){return this.each(function(){var t=m(this),e=t.data("bs.tooltip"),n="object"==typeof r&&r,i=n&&n.selector;!e&&"destroy"==r||(i?(e||t.data("bs.tooltip",e={}),e[i]||(e[i]=new v(this,n))):e||t.data("bs.tooltip",e=new v(this,n)),"string"==typeof r&&e[r]())})},m.fn.tooltip.Constructor=v,m.fn.tooltip.noConflict=function(){return m.fn.tooltip=t,this}}(jQuery),function(s){"use strict";function o(t,e){this.init("popover",t,e)}if(!s.fn.tooltip)throw new Error("Popover requires tooltip.js");o.VERSION="3.3.1",o.DEFAULTS=s.extend({},s.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),((o.prototype=s.extend({},s.fn.tooltip.Constructor.prototype)).constructor=o).prototype.getDefaults=function(){return o.DEFAULTS},o.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),n=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},o.prototype.hasContent=function(){return this.getTitle()||this.getContent()},o.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},o.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},o.prototype.tip=function(){return this.$tip||(this.$tip=s(this.options.template)),this.$tip};var t=s.fn.popover;s.fn.popover=function(r){return this.each(function(){var t=s(this),e=t.data("bs.popover"),n="object"==typeof r&&r,i=n&&n.selector;!e&&"destroy"==r||(i?(e||t.data("bs.popover",e={}),e[i]||(e[i]=new o(this,n))):e||t.data("bs.popover",e=new o(this,n)),"string"==typeof r&&e[r]())})},s.fn.popover.Constructor=o,s.fn.popover.noConflict=function(){return s.fn.popover=t,this}}(jQuery),function(i){i.expr[":"].notmdproc=function(t){return!i(t).data("mdproc")},i.material={options:{input:!0,ripples:!0,checkbox:!0,togglebutton:!0,radio:!0,arrive:!0,autofill:!0,withRipples:[".btn:not(.btn-link)",".card-image",".navbar a:not(.withoutripple)",".dropdown-menu a",".nav-tabs a:not(.withoutripple)",".withripple"].join(","),inputElements:"input.form-control, textarea.form-control, select.form-control",checkboxElements:".checkbox > label > input[type=checkbox]",togglebuttonElements:".togglebutton > label > input[type=checkbox]",radioElements:".radio > label > input[type=radio]"},checkbox:function(t){i(t||this.options.checkboxElements).filter(":notmdproc").data("mdproc",!0).after("<span class=ripple></span><span class=check></span>")},togglebutton:function(t){i(t||this.options.togglebuttonElements).filter(":notmdproc").data("mdproc",!0).after("<span class=toggle></span>")},radio:function(t){i(t||this.options.radioElements).filter(":notmdproc").data("mdproc",!0).after("<span class=circle></span><span class=check></span>")},input:function(t){i(t||this.options.inputElements).filter(":notmdproc").data("mdproc",!0).each(function(){var t=i(this);if(t.wrap("<div class=form-control-wrapper></div>"),t.after("<span class=material-input></span>"),t.hasClass("floating-label")){var e=t.attr("placeholder");t.attr("placeholder",null).removeClass("floating-label"),t.after("<div class=floating-label>"+e+"</div>")}if(t.attr("data-hint")&&t.after("<div class=hint>"+t.attr("data-hint")+"</div>"),null!==t.val()&&"undefined"!=t.val()&&""!==t.val()||t.addClass("empty"),t.parent().next().is("[type=file]")){t.parent().addClass("fileinput");var n=t.parent().next().detach();t.after(n)}}),i(document).on("change",".checkbox input[type=checkbox]",function(){i(this).blur()}).on("keydown paste",".form-control",function(t){!function(t){return void 0===t.which||"number"==typeof t.which&&0<t.which&&(!t.ctrlKey&&!t.metaKey&&!t.altKey&&8!=t.which)}(t)||i(this).removeClass("empty")}).on("keyup change",".form-control",function(){var t=i(this);""===t.val()&&t[0].checkValidity()?t.addClass("empty"):t.removeClass("empty")}).on("focus",".form-control-wrapper.fileinput",function(){i(this).find("input").addClass("focus")}).on("blur",".form-control-wrapper.fileinput",function(){i(this).find("input").removeClass("focus")}).on("change",".form-control-wrapper.fileinput [type=file]",function(){var n="";i.each(i(this)[0].files,function(t,e){console.log(e),n+=e.name+", "}),(n=n.substring(0,n.length-2))?i(this).prev().removeClass("empty"):i(this).prev().addClass("empty"),i(this).prev().val(n)})},ripples:function(t){i(t||this.options.withRipples).ripples()},autofill:function(){var e,t=setInterval(function(){i("input[type!=checkbox]").each(function(){i(this).val()&&i(this).val()!==i(this).attr("value")&&i(this).trigger("change")})},100);setTimeout(function(){clearInterval(t)},1e4),i(document).on("focus","input",function(){var t=i(this).parents("form").find("input").not("[type=file]");e=setInterval(function(){t.each(function(){i(this).val()!==i(this).attr("value")&&i(this).trigger("change")})},100)}).on("blur","input",function(){clearInterval(e)})},init:function(){i.ripples&&this.options.ripples&&this.ripples(),this.options.input&&this.input(),this.options.checkbox&&this.checkbox(),this.options.togglebutton&&this.togglebutton(),this.options.radio&&this.radio(),this.options.autofill&&this.autofill(),document.arrive&&this.options.arrive&&(i(document).arrive(this.options.inputElements,function(){i.material.input(i(this))}),i(document).arrive(this.options.checkboxElements,function(){i.material.checkbox(i(this))}),i(document).arrive(this.options.radioElements,function(){i.material.radio(i(this))}),i(document).arrive(this.options.togglebuttonElements,function(){i.material.togglebutton(i(this))}))}}}(jQuery),function(a,l,e,n){"use strict";var i="ripples",u=null,r={};function s(t,e){(u=this).element=a(t),this.options=a.extend({},r,e),this._defaults=r,this._name=i,this.init()}s.prototype.init=function(){var o=this.element;o.on("mousedown touchstart",function(t){if(u.isTouch()&&"mousedown"===t.type)return!1;o.find(".ripple-wrapper").length||o.append('<div class="ripple-wrapper"></div>');var e=o.children(".ripple-wrapper"),n=u.getRelY(e,t),i=u.getRelX(e,t);if(n||i){var r=u.getRipplesColor(),s=a("<div></div>");s.addClass("ripple").css({left:i,top:n,"background-color":r}),e.append(s),l.getComputedStyle(s[0]).opacity,u.rippleOn(s),setTimeout(function(){u.rippleEnd(s)},500),o.on("mouseup mouseleave touchend",function(){s.data("mousedown","off"),"off"===s.data("animating")&&u.rippleOut(s)})}})},s.prototype.getNewSize=function(t){var e=this.element;return Math.max(e.outerWidth(),e.outerHeight())/t.outerWidth()*2.5},s.prototype.getRelX=function(t,e){var n=t.offset();return u.isTouch()?1!==(e=e.originalEvent).touches.length&&e.touches[0].pageX-n.left:e.pageX-n.left},s.prototype.getRelY=function(t,e){var n=t.offset();return u.isTouch()?1!==(e=e.originalEvent).touches.length&&e.touches[0].pageY-n.top:e.pageY-n.top},s.prototype.getRipplesColor=function(){var t=this.element;return this.options&&this.options.color?this.options.color:t.data("ripple-color")?t.data("ripple-color"):l.getComputedStyle(t[0]).color},s.prototype.hasTransitionSupport=function(){var t=(e.body||e.documentElement).style;return t.transition!==n||t.WebkitTransition!==n||t.MozTransition!==n||t.MsTransition!==n||t.OTransition!==n},s.prototype.isTouch=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},s.prototype.rippleEnd=function(t){t.data("animating","off"),"off"===t.data("mousedown")&&u.rippleOut(t)},s.prototype.rippleOut=function(t){t.off(),u.hasTransitionSupport()?t.addClass("ripple-out"):t.animate({opacity:0},100,function(){t.trigger("transitionend")}),t.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){t.remove()})},s.prototype.rippleOn=function(t){var e=u.getNewSize(t),n=this.element;u.hasTransitionSupport()?t.css({"-ms-transform":"scale("+e+")","-moz-transform":"scale("+e+")","-webkit-transform":"scale("+e+")",transform:"scale("+e+")"}).addClass("ripple-on").data("animating","on").data("mousedown","on"):t.animate({width:2*Math.max(n.outerWidth(),n.outerHeight()),height:2*Math.max(n.outerWidth(),n.outerHeight()),"margin-left":-1*Math.max(n.outerWidth(),n.outerHeight()),"margin-top":-1*Math.max(n.outerWidth(),n.outerHeight()),opacity:.2},500,function(){t.trigger("transitionend")})},a.fn.ripples=function(t){return this.each(function(){a.data(this,"plugin_"+i)||a.data(this,"plugin_"+i,new s(this,t))})}}(jQuery,window,document),function(s){function o(t){return null!=t}s(document).ready(function(){s("body").append("<div id=snackbar-container/>")}),s(document).on("click","[data-toggle=snackbar]",function(){s(this).snackbar("toggle")}).on("click","#snackbar-container .snackbar",function(){s(this).snackbar("hide")}),s.snackbar=function(t){if(o(t)&&t===Object(t)){var e,n=(e=o(t.id)?s("#"+t.id):s("<div/>").attr("id","snackbar"+Date.now()).attr("class","snackbar")).hasClass("snackbar-opened");o(t.style)?e.attr("class","snackbar "+t.style):e.attr("class","snackbar"),t.timeout=o(t.timeout)?t.timeout:3e3,o(t.content)&&(e.find(".snackbar-content").length?e.find(".snackbar-content").text(t.content):e.prepend("<span class=snackbar-content>"+t.content+"</span>")),o(t.id)?e.insertAfter("#snackbar-container .snackbar:last-child"):e.appendTo("#snackbar-container"),o(t.action)&&"toggle"==t.action&&(t.action=n?"hide":"show");var i=Date.now();e.data("animationId1",i),setTimeout(function(){e.data("animationId1")===i&&(o(t.action)&&"show"!=t.action?o(t.action)&&"hide"==t.action&&e.removeClass("snackbar-opened"):e.addClass("snackbar-opened"))},50);var r=Date.now();return e.data("animationId2",r),0!==t.timeout&&setTimeout(function(){e.data("animationId2")===r&&e.removeClass("snackbar-opened")},t.timeout),e}return!1},s.fn.snackbar=function(t){var e={};if(this.hasClass("snackbar"))return e.id=this.attr("id"),"show"!==t&&"hide"!==t&&"toggle"!=t||(e.action=t),s.snackbar(e);o(t)&&"show"!==t&&"hide"!==t&&"toggle"!=t||(e={content:s(this).attr("data-content"),style:s(this).attr("data-style"),timeout:s(this).attr("data-timeout")}),o(t)&&(e.id=this.attr("data-snackbar-id"),"show"!==t&&"hide"!==t&&"toggle"!=t||(e.action=t));var n=s.snackbar(e);return this.attr("data-snackbar-id",n.attr("id")),n}}(jQuery),function s(o,a,l){function u(n,t){if(!a[n]){if(!o[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(c)return c(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var r=a[n]={exports:{}};o[n][0].call(r.exports,function(t){var e=o[n][1][t];return u(e||t)},r,r.exports,s,o,a,l)}return a[n].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)u(l[t]);return u}({1:[function(t,e,n){if(!f)var f={map:function(t,n){var i={};return n?t.map(function(t,e){return i.index=e,n.call(i,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:e<t?1:0},sum:function(t,i){var r={};return t.reduce(i?function(t,e,n){return r.index=n,t+i.call(r,e)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?f.map(t,e):t)}};var d,h,i=(h=8-(d=5),p.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var e=this,n=e.histo;if(!e._count_set||t){var i,r,s,o=0;for(i=e.r1;i<=e.r2;i++)for(r=e.g1;r<=e.g2;r++)for(s=e.b1;s<=e.b2;s++)index=g(i,r,s),o+=n[index]||0;e._count=o,e._count_set=!0}return e._count},copy:function(){return new p(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(t){var e=this,n=e.histo;if(!e._avg||t){var i,r,s,o,a=0,l=1<<8-d,u=0,c=0,h=0;for(r=e.r1;r<=e.r2;r++)for(s=e.g1;s<=e.g2;s++)for(o=e.b1;o<=e.b2;o++)a+=i=n[g(r,s,o)]||0,u+=i*(r+.5)*l,c+=i*(s+.5)*l,h+=i*(o+.5)*l;e._avg=a?[~~(u/a),~~(c/a),~~(h/a)]:[~~(l*(e.r1+e.r2+1)/2),~~(l*(e.g1+e.g2+1)/2),~~(l*(e.b1+e.b2+1)/2)]}return e._avg},contains:function(t){var e=t[0]>>h;return gval=t[1]>>h,bval=t[2]>>h,e>=this.r1&&e<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},u.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,n=0;n<e.size();n++)if(e.peek(n).vbox.contains(t))return e.peek(n).color;return this.nearest(t)},nearest:function(t){for(var e,n,i,r=this.vboxes,s=0;s<r.size();s++)((n=Math.sqrt(Math.pow(t[0]-r.peek(s).color[0],2)+Math.pow(t[1]-r.peek(s).color[1],2)+Math.pow(t[2]-r.peek(s).color[2],2)))<e||void 0===e)&&(e=n,i=r.peek(s).color);return i},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return f.naturalOrder(f.sum(t.color),f.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,i=t[n].color;251<i[0]&&251<i[1]&&251<i[2]&&(t[n].color=[255,255,255])}},{quantize:function(t,e){if(!t.length||e<2||256<e)return!1;var l=function(t){var e,n,i,r,s=new Array(1<<3*d);return t.forEach(function(t){n=t[0]>>h,i=t[1]>>h,r=t[2]>>h,e=g(n,i,r),s[e]=(s[e]||0)+1}),s}(t);l.forEach(function(){});var n=function(t,e){var n,i,r,s=1e6,o=0,a=1e6,l=0,u=1e6,c=0;return t.forEach(function(t){n=t[0]>>h,i=t[1]>>h,r=t[2]>>h,n<s?s=n:o<n&&(o=n),i<a?a=i:l<i&&(l=i),r<u?u=r:c<r&&(c=r)}),new p(s,o,a,l,u,c,e)}(t,l),i=new a(function(t,e){return f.naturalOrder(t.count(),e.count())});function r(t,e){for(var n,i=1,r=0;r<1e3;)if((n=t.pop()).count()){var s=c(l,n),o=s[0],a=s[1];if(!o)return;if(t.push(o),a&&(t.push(a),i++),e<=i)return;if(1e3<r++)return}else t.push(n),r++}i.push(n),r(i,.75*e);for(var s=new a(function(t,e){return f.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});i.size();)s.push(i.pop());r(s,e-s.size());for(var o=new u;s.size();)o.push(s.pop());return o}});function g(t,e,n){return(t<<2*d)+(e<<d)+n}function a(t){var e=[],n=!1;function i(){e.sort(t),n=!0}return{push:function(t){e.push(t),n=!1},peek:function(t){return n||i(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return n||i(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return n||i(),e}}}function p(t,e,n,i,r,s,o){this.r1=t,this.r2=e,this.g1=n,this.g2=i,this.b1=r,this.b2=s,this.histo=o}function u(){this.vboxes=new a(function(t,e){return f.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function c(t,u){if(u.count()){var e=u.r2-u.r1+1,n=u.g2-u.g1+1,i=u.b2-u.b1+1,r=f.max([e,n,i]);if(1==u.count())return[u.copy()];var c,s,o,a,h=0,d=[],p=[];if(r==e)for(c=u.r1;c<=u.r2;c++){for(a=0,s=u.g1;s<=u.g2;s++)for(o=u.b1;o<=u.b2;o++)a+=t[g(c,s,o)]||0;h+=a,d[c]=h}else if(r==n)for(c=u.g1;c<=u.g2;c++){for(a=0,s=u.r1;s<=u.r2;s++)for(o=u.b1;o<=u.b2;o++)a+=t[g(s,c,o)]||0;h+=a,d[c]=h}else for(c=u.b1;c<=u.b2;c++){for(a=0,s=u.r1;s<=u.r2;s++)for(o=u.g1;o<=u.g2;o++)a+=t[g(s,o,c)]||0;h+=a,d[c]=h}return d.forEach(function(t,e){p[e]=h-t}),l(r==e?"r":r==n?"g":"b")}function l(t){var e,n,i,r,s,o=t+"1",a=t+"2",l=0;for(c=u[o];c<=u[a];c++)if(d[c]>h/2){for(i=u.copy(),r=u.copy(),s=(e=c-u[o])<=(n=u[a]-c)?Math.min(u[a]-1,~~(c+n/2)):Math.max(u[o],~~(c-1-e/2));!d[s];)s++;for(l=p[s];!l&&d[s-1];)l=p[--s];return i[a]=s,r[o]=i[a]+1,[i,r]}}}e.exports=i.quantize},{}],2:[function(r,t,e){(function(){var p,f,t,s=[].slice;function e(t,e){this.rgb=t,this.population=e}function n(t,e,n){var i,r,s,o,a,l,u,c,h,d;for(this.swatches=function(t,e){return function(){return t.apply(e,arguments)}}(this.swatches,this),void 0===e&&(e=64),void 0===n&&(n=5),h=(l=new p(t)).getImageData().data,c=l.getPixelCount(),i=[],a=0;a<c;)d=h[0+(u=4*a)],o=h[1+u],r=h[2+u],125<=h[3+u]&&(250<d&&250<o&&250<r||i.push([d,o,r])),a+=n;s=this.quantize(i,e),this._swatches=s.vboxes.map(function(t){return new f(t.color,t.vbox.count())}),this.maxPopulation=this.findMaxPopulation,this.generateVarationColors(),this.generateEmptySwatches(),l.removeCanvas()}function i(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)}window.Swatch=(e.prototype.hsl=void 0,e.prototype.rgb=void 0,e.prototype.population=1,e.yiq=0,e.prototype.getHsl=function(){return this.hsl?this.hsl:this.hsl=t.rgbToHsl(this.rgb[0],this.rgb[1],this.rgb[2])},e.prototype.getPopulation=function(){return this.population},e.prototype.getRgb=function(){return this.rgb},e.prototype.getHex=function(){return"#"+((1<<24)+(this.rgb[0]<<16)+(this.rgb[1]<<8)+this.rgb[2]).toString(16).slice(1,7)},e.prototype.getTitleTextColor=function(){return this._ensureTextColors(),this.yiq<200?"#fff":"#000"},e.prototype.getBodyTextColor=function(){return this._ensureTextColors(),this.yiq<150?"#fff":"#000"},e.prototype._ensureTextColors=function(){if(!this.yiq)return this.yiq=(299*this.rgb[0]+587*this.rgb[1]+114*this.rgb[2])/1e3},f=e),window.Vibrant=(n.prototype.quantize=r("quantize"),n.prototype._swatches=[],n.prototype.TARGET_DARK_LUMA=.26,n.prototype.MAX_DARK_LUMA=.45,n.prototype.MIN_LIGHT_LUMA=.55,n.prototype.TARGET_LIGHT_LUMA=.74,n.prototype.MIN_NORMAL_LUMA=.3,n.prototype.TARGET_NORMAL_LUMA=.5,n.prototype.MAX_NORMAL_LUMA=.7,n.prototype.TARGET_MUTED_SATURATION=.3,n.prototype.MAX_MUTED_SATURATION=.4,n.prototype.TARGET_VIBRANT_SATURATION=1,n.prototype.MIN_VIBRANT_SATURATION=.35,n.prototype.WEIGHT_SATURATION=3,n.prototype.WEIGHT_LUMA=6,n.prototype.WEIGHT_POPULATION=1,n.prototype.VibrantSwatch=void 0,n.prototype.MutedSwatch=void 0,n.prototype.DarkVibrantSwatch=void 0,n.prototype.DarkMutedSwatch=void 0,n.prototype.LightVibrantSwatch=void 0,n.prototype.LightMutedSwatch=void 0,n.prototype.HighestPopulation=0,n.prototype.generateVarationColors=function(){return this.VibrantSwatch=this.findColorVariation(this.TARGET_NORMAL_LUMA,this.MIN_NORMAL_LUMA,this.MAX_NORMAL_LUMA,this.TARGET_VIBRANT_SATURATION,this.MIN_VIBRANT_SATURATION,1),this.LightVibrantSwatch=this.findColorVariation(this.TARGET_LIGHT_LUMA,this.MIN_LIGHT_LUMA,1,this.TARGET_VIBRANT_SATURATION,this.MIN_VIBRANT_SATURATION,1),this.DarkVibrantSwatch=this.findColorVariation(this.TARGET_DARK_LUMA,0,this.MAX_DARK_LUMA,this.TARGET_VIBRANT_SATURATION,this.MIN_VIBRANT_SATURATION,1),this.MutedSwatch=this.findColorVariation(this.TARGET_NORMAL_LUMA,this.MIN_NORMAL_LUMA,this.MAX_NORMAL_LUMA,this.TARGET_MUTED_SATURATION,0,this.MAX_MUTED_SATURATION),this.LightMutedSwatch=this.findColorVariation(this.TARGET_LIGHT_LUMA,this.MIN_LIGHT_LUMA,1,this.TARGET_MUTED_SATURATION,0,this.MAX_MUTED_SATURATION),this.DarkMutedSwatch=this.findColorVariation(this.TARGET_DARK_LUMA,0,this.MAX_DARK_LUMA,this.TARGET_MUTED_SATURATION,0,this.MAX_MUTED_SATURATION)},n.prototype.generateEmptySwatches=function(){var t;if(void 0===this.VibrantSwatch&&void 0!==this.DarkVibrantSwatch&&((t=this.DarkVibrantSwatch.getHsl())[2]=this.TARGET_NORMAL_LUMA,this.VibrantSwatch=new f(n.hslToRgb(t[0],t[1],t[2]),0)),void 0===this.DarkVibrantSwatch&&void 0!==this.VibrantSwatch)return(t=this.VibrantSwatch.getHsl())[2]=this.TARGET_DARK_LUMA,this.DarkVibrantSwatch=new f(n.hslToRgb(t[0],t[1],t[2]),0)},n.prototype.findMaxPopulation=function(){var t,e,n,i,r;for(t=n=0,e=(i=this._swatches).length;t<e;t++)r=i[t],n=Math.max(n,r.getPopulation());return n},n.prototype.findColorVariation=function(t,e,n,i,r,s){var o,a,l,u,c,h,d,p,f;for(u=void 0,o=c=0,a=(h=this._swatches).length;o<a;o++)d=(p=h[o]).getHsl()[1],l=p.getHsl()[2],r<=d&&d<=s&&e<=l&&l<=n&&!this.isAlreadySelected(p)&&(f=this.createComparisonValue(d,i,l,t,p.getPopulation(),this.HighestPopulation),(void 0===u||c<f)&&(u=p,c=f));return u},n.prototype.createComparisonValue=function(t,e,n,i,r,s){return this.weightedMean(this.invertDiff(t,e),this.WEIGHT_SATURATION,this.invertDiff(n,i),this.WEIGHT_LUMA,r/s,this.WEIGHT_POPULATION)},n.prototype.invertDiff=function(t,e){return 1-Math.abs(t-e)},n.prototype.weightedMean=function(){var t,e,n,i,r;for(i=1<=arguments.length?s.call(arguments,0):[],t=n=e=0;t<i.length;)e+=i[t]*(r=i[t+1]),n+=r,t+=2;return e/n},n.prototype.swatches=function(){return{Vibrant:this.VibrantSwatch,Muted:this.MutedSwatch,DarkVibrant:this.DarkVibrantSwatch,DarkMuted:this.DarkMutedSwatch,LightVibrant:this.LightVibrantSwatch,LightMuted:this.LightMuted}},n.prototype.isAlreadySelected=function(t){return this.VibrantSwatch===t||this.DarkVibrantSwatch===t||this.LightVibrantSwatch===t||this.MutedSwatch===t||this.DarkMutedSwatch===t||this.LightMutedSwatch===t},n.rgbToHsl=function(t,e,n){var i,r,s,o,a,l;if(t/=255,e/=255,n/=255,l=r=void 0,s=((o=Math.max(t,e,n))+(a=Math.min(t,e,n)))/2,o===a)r=l=0;else{switch(i=o-a,l=.5<s?i/(2-o-a):i/(o+a),o){case t:r=(e-n)/i+(e<n?6:0);break;case e:r=(n-t)/i+2;break;case n:r=(t-e)/i+4}r/=6}return[r,l,s]},n.hslToRgb=function(t,e,n){var i,r,s,o,a,l;return i=r=l=void 0,s=function(t,e,n){return n<0&&(n+=1),1<n&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},0===e?l=r=i=n:(l=s(o=2*n-(a=n<.5?n*(1+e):n+e-n*e),a,t+1/3),r=s(o,a,t),i=s(o,a,t-1/3)),[255*l,255*r,255*i]},t=n),window.CanvasImage=(i.prototype.clear=function(){return this.context.clearRect(0,0,this.width,this.height)},i.prototype.update=function(t){return this.context.putImageData(t,0,0)},i.prototype.getPixelCount=function(){return this.width*this.height},i.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},i.prototype.removeCanvas=function(){return this.canvas.parentNode.removeChild(this.canvas)},p=i)}).call(this)},{quantize:1}]},{},[2]),function(pe,fe){"use strict";if(!pe||!pe.document)throw new Error("SoundManager requires a browser with window and document objects.");var t=null;function n(t,e){this.setupOptions={url:t||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,forceUseGlobalHTML5Audio:!1,ignoreMobileRestrictions:!1,html5Test:/^(probably|maybe)$/i,preferFlash:!1,noSWFCache:!1,idPrefix:"sound"},this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onerror:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,playbackRate:1,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100},this.flash9Options={onfailure:null,isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},opus:{type:["audio/ogg; codecs=opus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1},flac:{type:["audio/flac"],required:!1}},this.movieID="sm2-container",this.id=e||"sm2movie",this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.versionNumber="V2.97a.20170601",this.version=null,this.movieURL=null,this.altURL=null,this.swfLoaded=!1,this.enabled=!1,this.oMC=null,this.sounds={},this.soundIDs=[],this.muted=!1,this.didFlashBlock=!1,this.filePattern=null,this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i},this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null},this.html5={usingFlash:null},this.flash={},this.html5Only=!1,this.ignoreFlash=!1;var a,y,n,i,b,v,w,_,r,x,l,u,s,o,c,h,d,p,S,f,T,g,m,C,E,k,M,D,O,A,N,j,R,L,I,P,F,H,q,$,U,B,V,z,W,J,G,X,Y,K,Q,Z,tt,et,nt,it,rt,st,ot,at,lt,ut,ct,ht,dt,pt,ft,gt=this,mt=null,vt=null,yt="soundManager",bt=yt+": ",wt="HTML5::",_t=navigator.userAgent,xt=pe.location.href.toString(),St=document,Tt=[],Ct=!0,Et=!1,kt=!1,Mt=!1,Dt=!1,Ot=!1,At=0,Nt=["log","info","warn","error"],jt=null,Rt=null,Lt=!1,It=!1,Pt=0,Ft=null,Ht=[],qt=null,$t=Array.prototype.slice,Ut=!1,Bt=0,Vt=_t.match(/(ipad|iphone|ipod)/i),zt=_t.match(/android/i),Wt=_t.match(/msie|trident/i),Jt=_t.match(/webkit/i),Gt=_t.match(/safari/i)&&!_t.match(/chrome/i),Xt=_t.match(/opera/i),Yt=_t.match(/(mobile|pre\/|xoom)/i)||Vt||zt,Kt=!xt.match(/usehtml5audio/i)&&!xt.match(/sm2-ignorebadua/i)&&Gt&&!_t.match(/silk/i)&&_t.match(/OS\sX\s10_6_([3-7])/i),Qt=pe.console!==fe&&console.log!==fe,Zt=St.hasFocus!==fe?St.hasFocus():null,te=Gt&&(St.hasFocus===fe||!St.hasFocus()),ee=!te,ne=/(mp3|mp4|mpa|m4a|m4b)/i,ie="about:blank",re=St.location?St.location.protocol.match(/http/i):null,se=re?"":"//",oe=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4|m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,ae=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","m4b","mp4v","3gp","3g2"],le=new RegExp("\\.("+ae.join("|")+")(\\?.*)?$","i");function ue(t){return gt.preferFlash&&st&&!gt.ignoreFlash&&gt.flash[t]!==fe&&gt.flash[t]}function ce(t){var e=$t.call(t),n=e.length;return pt?(e[1]="on"+e[1],3<n&&e.pop()):3===n&&e.push(!1),e}function he(t,e){var n=t.shift(),i=[ft[e]];pt?n[i](t[0],t[1]):n[i].apply(n,t)}function de(n){return function(t){var e=this._s;return e&&e._a?n.call(this,t):(e&&e.id?gt._wD(e.id+": Ignoring "+t.type):gt._wD(wt+"Ignoring "+t.type),null)}}this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,this.useAltURL=!re,F={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"},Q=[null,"MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"],this.hasHTML5=function(){try{return Audio!==fe&&(Xt&&opera!==fe&&opera.version()<10?new Audio(null):new Audio).canPlayType!==fe}catch(t){return!1}}(),this.setup=function(t){var e=!gt.url;return t!==fe&&Mt&&qt&&gt.ok()&&(t.flashVersion!==fe||t.url!==fe||t.html5Test!==fe)&&U(L("setupLate")),l(t),Ut||(Yt?gt.setupOptions.ignoreMobileRestrictions&&!gt.setupOptions.forceUseGlobalHTML5Audio||(Ht.push(T.globalHTML5),Ut=!0):gt.setupOptions.forceUseGlobalHTML5Audio&&(Ht.push(T.globalHTML5),Ut=!0)),!dt&&Yt&&(gt.setupOptions.ignoreMobileRestrictions?Ht.push(T.ignoreMobile):(gt.setupOptions.useHTML5Audio&&!gt.setupOptions.preferFlash||gt._wD(T.mobileUA),gt.setupOptions.useHTML5Audio=!0,gt.setupOptions.preferFlash=!1,Vt?gt.ignoreFlash=!0:(!zt||_t.match(/android\s2\.3/i))&&zt||(gt._wD(T.globalHTML5),Ut=!0))),t&&(e&&E&&t.url!==fe&&gt.beginDelayedInit(),E||t.url===fe||"complete"!==St.readyState||setTimeout(m,1)),dt=!0,gt},this.ok=function(){return qt?Mt&&!Dt:gt.useHTML5Audio&&gt.hasHTML5},this.supported=this.ok,this.getMovie=function(t){return y(t)||St[t]||pe[t]},this.createSound=function(t,e){var n,i,r,s=null;if(i=(n=yt+".createSound(): ")+L(Mt?"notOK":"notReady"),!Mt||!gt.ok())return U(i),!1;if(e!==fe&&(t={id:t,url:e}),(r=x(t)).url=J(r.url),r.id===fe&&(r.id=gt.setupOptions.idPrefix+Bt++),r.id.toString().charAt(0).match(/^[0-9]$/)&&gt._wD(n+L("badID",r.id),2),gt._wD(n+r.id+(r.url?" ("+r.url+")":""),1),B(r.id,!0))return gt._wD(n+r.id+" exists",1),gt.sounds[r.id];function o(){return r=q(r),gt.sounds[r.id]=new a(r),gt.soundIDs.push(r.id),gt.sounds[r.id]}if(Y(r))s=o(),gt.html5Only||gt._wD(r.id+": Using HTML5"),s._setup_html5(r);else{if(gt.html5Only)return gt._wD(r.id+": No HTML5 support for this sound, and no Flash. Exiting."),o();if(gt.html5.usingFlash&&r.url&&r.url.match(/data:/i))return gt._wD(r.id+": data: URIs not supported via Flash. Exiting."),o();8<v&&(null===r.isMovieStar&&(r.isMovieStar=!!(r.serverURL||r.type&&r.type.match(oe)||r.url&&r.url.match(le))),r.isMovieStar&&(gt._wD(n+"using MovieStar handling"),1<r.loops&&_("noNSLoop"))),r=$(r,n),s=o(),8===v?vt._createSound(r.id,r.loops||1,r.usePolicyFile):(vt._createSound(r.id,r.url,r.usePeakData,r.useWaveformData,r.useEQData,r.isMovieStar,!!r.isMovieStar&&r.bufferTime,r.loops||1,r.serverURL,r.duration||null,r.autoPlay,!0,r.autoLoad,r.usePolicyFile),r.serverURL||(s.connected=!0,r.onconnect&&r.onconnect.apply(s))),r.serverURL||!r.autoLoad&&!r.autoPlay||s.load(r)}return!r.serverURL&&r.autoPlay&&s.play(),s},this.destroySound=function(t,e){if(!B(t))return!1;var n,i=gt.sounds[t];for(i.stop(),i._iO={},i.unload(),n=0;n<gt.soundIDs.length;n++)if(gt.soundIDs[n]===t){gt.soundIDs.splice(n,1);break}return e||i.destruct(!0),i=null,delete gt.sounds[t],!0},this.load=function(t,e){return!!B(t)&&gt.sounds[t].load(e)},this.unload=function(t){return!!B(t)&&gt.sounds[t].unload()},this.onPosition=function(t,e,n,i){return!!B(t)&&gt.sounds[t].onposition(e,n,i)},this.onposition=this.onPosition,this.clearOnPosition=function(t,e,n){return!!B(t)&&gt.sounds[t].clearOnPosition(e,n)},this.play=function(t,e){var n=null,i=e&&!(e instanceof Object);if(!Mt||!gt.ok())return U(yt+".play(): "+L(Mt?"notOK":"notReady")),!1;if(B(t,i))i&&(e={url:e});else{if(!i)return!1;i&&(e={url:e}),e&&e.url&&(gt._wD(yt+'.play(): Attempting to create "'+t+'"',1),e.id=t,n=gt.createSound(e).play())}return null===n&&(n=gt.sounds[t].play(e)),n},this.start=this.play,this.setPlaybackRate=function(t,e,n){return!!B(t)&&gt.sounds[t].setPlaybackRate(e,n)},this.setPosition=function(t,e){return!!B(t)&&gt.sounds[t].setPosition(e)},this.stop=function(t){return!!B(t)&&(gt._wD(yt+".stop("+t+")",1),gt.sounds[t].stop())},this.stopAll=function(){var t;for(t in gt._wD(yt+".stopAll()",1),gt.sounds)gt.sounds.hasOwnProperty(t)&&gt.sounds[t].stop()},this.pause=function(t){return!!B(t)&&gt.sounds[t].pause()},this.pauseAll=function(){var t;for(t=gt.soundIDs.length-1;0<=t;t--)gt.sounds[gt.soundIDs[t]].pause()},this.resume=function(t){return!!B(t)&&gt.sounds[t].resume()},this.resumeAll=function(){var t;for(t=gt.soundIDs.length-1;0<=t;t--)gt.sounds[gt.soundIDs[t]].resume()},this.togglePause=function(t){return!!B(t)&&gt.sounds[t].togglePause()},this.setPan=function(t,e){return!!B(t)&&gt.sounds[t].setPan(e)},this.setVolume=function(t,e){var n,i;if(t===fe||isNaN(t)||e!==fe)return!!B(t)&&gt.sounds[t].setVolume(e);for(n=0,i=gt.soundIDs.length;n<i;n++)gt.sounds[gt.soundIDs[n]].setVolume(t);return!1},this.mute=function(t){var e=0;if(t instanceof String&&(t=null),t)return!!B(t)&&(gt._wD(yt+'.mute(): Muting "'+t+'"'),gt.sounds[t].mute());for(gt._wD(yt+".mute(): Muting all sounds"),e=gt.soundIDs.length-1;0<=e;e--)gt.sounds[gt.soundIDs[e]].mute();return gt.muted=!0},this.muteAll=function(){gt.mute()},this.unmute=function(t){var e;if(t instanceof String&&(t=null),t)return!!B(t)&&(gt._wD(yt+'.unmute(): Unmuting "'+t+'"'),gt.sounds[t].unmute());for(gt._wD(yt+".unmute(): Unmuting all sounds"),e=gt.soundIDs.length-1;0<=e;e--)gt.sounds[gt.soundIDs[e]].unmute();return!(gt.muted=!1)},this.unmuteAll=function(){gt.unmute()},this.toggleMute=function(t){return!!B(t)&&gt.sounds[t].toggleMute()},this.getMemoryUse=function(){var t=0;return vt&&8!==v&&(t=parseInt(vt._getMemoryUse(),10)),t},this.disable=function(t){var e;if(t===fe&&(t=!1),Dt)return!1;for(Dt=!0,_("shutdown",1),e=gt.soundIDs.length-1;0<=e;e--)N(gt.sounds[gt.soundIDs[e]]);return N(gt),r(t),it.remove(pe,"load",c),!0},this.canPlayMIME=function(t){var e;return gt.hasHTML5&&(e=K({type:t})),!e&&qt&&(e=t&&gt.ok()?!!(8<v&&t.match(oe)||t.match(gt.mimePattern)):null),e},this.canPlayURL=function(t){var e;return gt.hasHTML5&&(e=K({url:t})),!e&&qt&&(e=t&&gt.ok()?!!t.match(gt.filePattern):null),e},this.canPlayLink=function(t){return!(t.type===fe||!t.type||!gt.canPlayMIME(t.type))||gt.canPlayURL(t.href)},this.getSoundById=function(t,e){if(!t)return null;var n=gt.sounds[t];return n||e||gt._wD(yt+'.getSoundById(): Sound "'+t+'" not found.',2),n},this.onready=function(t,e){var n="onready";if("function"!=typeof t)throw L("needFunction",n);return Mt&&gt._wD(L("queue",n)),s(n,t,e=e||pe),o(),!0},this.ontimeout=function(t,e){var n="ontimeout";if("function"!=typeof t)throw L("needFunction",n);return Mt&&gt._wD(L("queue",n)),s(n,t,e=e||pe),o({type:n}),!0},this._writeDebug=function(t,e){var n,i;return!!gt.setupOptions.debugMode&&(!!(Qt&&gt.useConsole&&(e&&"object"==typeof e?console.log(t,e):Nt[e]!==fe?console[Nt[e]](t):console.log(t),gt.consoleOnly))||!!(n=y("soundmanager-debug"))&&(i=St.createElement("div"),++At%2==0&&(i.className="sm2-alt"),e=e===fe?0:parseInt(e,10),i.appendChild(St.createTextNode(t)),e&&(2<=e&&(i.style.fontWeight="bold"),3===e&&(i.style.color="#ff3333")),n.insertBefore(i,n.firstChild),!(n=null)))},-1!==xt.indexOf("sm2-debug=alert")&&(this._writeDebug=function(t){pe.alert(t)}),this._wD=this._writeDebug,this._debug=function(){var t,e;for(_("currentObj",1),t=0,e=gt.soundIDs.length;t<e;t++)gt.sounds[gt.soundIDs[t]]._debug()},this.reboot=function(t,e){var n,i,r;for(gt.soundIDs.length&&gt._wD("Destroying "+gt.soundIDs.length+" SMSound object"+(1!==gt.soundIDs.length?"s":"")+"..."),n=gt.soundIDs.length-1;0<=n;n--)gt.sounds[gt.soundIDs[n]].destruct();if(vt)try{Wt&&(Rt=vt.innerHTML),jt=vt.parentNode.removeChild(vt)}catch(t){_("badRemove",2)}if(Rt=jt=qt=vt=null,gt.enabled=E=Mt=Lt=It=Et=kt=Dt=Ut=gt.swfLoaded=!1,gt.soundIDs=[],gt.sounds={},Bt=0,dt=!1,t)Tt=[];else for(n in Tt)if(Tt.hasOwnProperty(n))for(i=0,r=Tt[n].length;i<r;i++)Tt[n][i].fired=!1;return e||gt._wD(yt+": Rebooting..."),gt.html5={usingFlash:null},gt.flash={},gt.html5Only=!1,gt.ignoreFlash=!1,pe.setTimeout(function(){e||gt.beginDelayedInit()},20),gt},this.reset=function(){return _("reset"),gt.reboot(!0,!0)},this.getMoviePercent=function(){return vt&&"PercentLoaded"in vt?vt.PercentLoaded():null},this.beginDelayedInit=function(){Ot=!0,m(),setTimeout(function(){return!It&&(M(),g(),It=!0)},20),h()},this.destruct=function(){gt._wD(yt+".destruct()"),gt.disable(!0)},a=function(t){var s,o,e,i,u,c,r,h,a,d,p=this,f=!1,l=[],g=0,m=null;a={duration:null,time:null},this.id=t.id,this.sID=this.id,this.url=t.url,this.options=x(t),this.instanceOptions=this.options,this._iO=this.instanceOptions,this.pan=this.options.pan,this.volume=this.options.volume,this.isHTML5=!1,this._a=null,d=!this.url,this.id3={},this._debug=function(){gt._wD(p.id+": Merged options:",p.options)},this.load=function(t){var e;if(t!==fe?p._iO=x(t,p.options):(t=p.options,p._iO=t,m&&m!==p.url&&(_("manURL"),p._iO.url=p.url,p.url=null)),p._iO.url||(p._iO.url=p.url),p._iO.url=J(p._iO.url),p.instanceOptions=p._iO,e=p._iO,gt._wD(p.id+": load ("+e.url+")"),!e.url&&!p.url)return gt._wD(p.id+": load(): url is unassigned. Exiting.",2),p;if(p.isHTML5||8!==v||p.url||e.autoPlay||gt._wD(p.id+": Flash 8 load() limitation: Wait for onload() before calling play().",1),e.url===p.url&&0!==p.readyState&&2!==p.readyState)return _("onURL",1),3===p.readyState&&e.onload&&ht(p,function(){e.onload.apply(p,[!!p.duration])}),p;if(p.loaded=!1,p.readyState=1,p.playState=0,p.id3={},Y(e))p._setup_html5(e)._called_load?gt._wD(p.id+": Ignoring request to load again"):(p._html5_canplay=!1,p.url!==e.url&&(gt._wD(_("manURL")+": "+e.url),p._a.src=e.url,p.setPosition(0)),p._a.autobuffer="auto",p._a.preload="auto",p._a._called_load=!0);else{if(gt.html5Only)return gt._wD(p.id+": No flash support. Exiting."),p;if(p._iO.url&&p._iO.url.match(/data:/i))return gt._wD(p.id+": data: URIs not supported via Flash. Exiting."),p;try{p.isHTML5=!1,p._iO=$(q(e)),p._iO.autoPlay&&(p._iO.position||p._iO.from)&&(gt._wD(p.id+": Disabling autoPlay because of non-zero offset case"),p._iO.autoPlay=!1),e=p._iO,8===v?vt._load(p.id,e.url,e.stream,e.autoPlay,e.usePolicyFile):vt._load(p.id,e.url,!!e.stream,!!e.autoPlay,e.loops||1,!!e.autoLoad,e.usePolicyFile)}catch(t){_("smError",2),w("onload",!1),D({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}return p.url=e.url,p},this.unload=function(){return 0!==p.readyState&&(gt._wD(p.id+": unload()"),p.isHTML5?(i(),p._a&&(p._a.pause(),m=tt(p._a))):8===v?vt._unload(p.id,ie):vt._unload(p.id),s()),p},this.destruct=function(t){gt._wD(p.id+": Destruct"),p.isHTML5?(i(),p._a&&(p._a.pause(),tt(p._a),Ut||e(),p._a._s=null,p._a=null)):(p._iO.onfailure=null,vt._destroySound(p.id)),t||gt.destroySound(p.id,!0)},this.play=function(t,e){var n,i,r,s,o,a,l=!0;if(n=p.id+": play(): ",e=e===fe||e,t=t||{},p.url&&(p._iO.url=p.url),p._iO=x(p._iO,p.options),p._iO=x(t,p._iO),p._iO.url=J(p._iO.url),p.instanceOptions=p._iO,!p.isHTML5&&p._iO.serverURL&&!p.connected)return p.getAutoPlay()||(gt._wD(n+" Netstream not connected yet - setting autoPlay"),p.setAutoPlay(!0)),p;if(Y(p._iO)&&(p._setup_html5(p._iO),u()),1===p.playState&&!p.paused){if(!p._iO.multiShot)return gt._wD(n+"Already playing (one-shot)",1),p.isHTML5&&p.setPosition(p._iO.position),p;gt._wD(n+"Already playing (multi-shot)",1)}if(t.url&&t.url!==p.url&&(p.readyState||p.isHTML5||8!==v||!d?p.load(p._iO):d=!1),p.loaded)gt._wD(n.substr(0,n.lastIndexOf(":")));else if(0===p.readyState){if(gt._wD(n+"Attempting to load"),p.isHTML5||gt.html5Only){if(!p.isHTML5)return gt._wD(n+"Unsupported type. Exiting."),p;p.load(p._iO)}else p._iO.autoPlay=!0,p.load(p._iO);p.instanceOptions=p._iO}else{if(2===p.readyState)return gt._wD(n+"Could not load - exiting",2),p;gt._wD(n+"Loading - attempting to play...")}return!p.isHTML5&&9===v&&0<p.position&&p.position===p.duration&&(gt._wD(n+"Sound at end, resetting to position: 0"),t.position=0),p.paused&&0<=p.position&&(!p._iO.serverURL||0<p.position)?(gt._wD(n+"Resuming from paused state",1),p.resume()):(p._iO=x(t,p._iO),(!p.isHTML5&&null!==p._iO.position&&0<p._iO.position||null!==p._iO.from&&0<p._iO.from||null!==p._iO.to)&&0===p.instanceCount&&0===p.playState&&!p._iO.serverURL&&(r=function(){p._iO=x(t,p._iO),p.play(p._iO)},p.isHTML5&&!p._html5_canplay?(gt._wD(n+"Beginning load for non-zero offset case"),p.load({_oncanplay:r})):p.isHTML5||p.loaded||p.readyState&&2===p.readyState||(gt._wD(n+"Preloading for non-zero offset case"),p.load({onload:r})),p._iO=h()),(!p.instanceCount||p._iO.multiShotEvents||p.isHTML5&&p._iO.multiShot&&!Ut||!p.isHTML5&&8<v&&!p.getAutoPlay())&&p.instanceCount++,p._iO.onposition&&0===p.playState&&c(p),p.playState=1,p.paused=!1,p.position=p._iO.position===fe||isNaN(p._iO.position)?0:p._iO.position,p.isHTML5||(p._iO=$(q(p._iO))),p._iO.onplay&&e&&(p._iO.onplay.apply(p),f=!0),p.setVolume(p._iO.volume,!0),p.setPan(p._iO.pan,!0),1!==p._iO.playbackRate&&p.setPlaybackRate(p._iO.playbackRate),p.isHTML5?p.instanceCount<2?(u(),i=p._setup_html5(),p.setPosition(p._iO.position),i.play()):(gt._wD(p.id+": Cloning Audio() for instance #"+p.instanceCount+"..."),s=new Audio(p._iO.url),o=function(){it.remove(s,"ended",o),p._onfinish(p),tt(s),s=null},a=function(){it.remove(s,"canplay",a);try{s.currentTime=p._iO.position/1e3}catch(t){U(p.id+": multiShot play() failed to apply position of "+p._iO.position/1e3)}s.play()},it.add(s,"ended",o),p._iO.volume!==fe&&(s.volume=Math.max(0,Math.min(1,p._iO.volume/100))),p.muted&&(s.muted=!0),p._iO.position?it.add(s,"canplay",a):s.play()):(l=vt._start(p.id,p._iO.loops||1,9===v?p.position:p.position/1e3,p._iO.multiShot||!1),9!==v||l||(gt._wD(n+"No sound hardware, or 32-sound ceiling hit",2),p._iO.onplayerror&&p._iO.onplayerror.apply(p)))),p},this.start=this.play,this.stop=function(t){var e,n=p._iO;return 1===p.playState&&(gt._wD(p.id+": stop()"),p._onbufferchange(0),p._resetOnPosition(0),p.paused=!1,p.isHTML5||(p.playState=0),r(),n.to&&p.clearOnPosition(n.to),p.isHTML5?p._a&&(e=p.position,p.setPosition(0),p.position=e,p._a.pause(),p.playState=0,p._onTimer(),i()):(vt._stop(p.id,t),n.serverURL&&p.unload()),p.instanceCount=0,p._iO={},n.onstop&&n.onstop.apply(p)),p},this.setAutoPlay=function(t){gt._wD(p.id+": Autoplay turned "+(t?"on":"off")),p._iO.autoPlay=t,p.isHTML5||(vt._setAutoPlay(p.id,t),t&&(p.instanceCount||1!==p.readyState||(p.instanceCount++,gt._wD(p.id+": Incremented instance count to "+p.instanceCount))))},this.getAutoPlay=function(){return p._iO.autoPlay},this.setPlaybackRate=function(t){var e=Math.max(.5,Math.min(4,t));if(e!==t&&gt._wD(p.id+": setPlaybackRate("+t+"): limiting rate to "+e,2),p.isHTML5)try{p._iO.playbackRate=e,p._a.playbackRate=e}catch(t){gt._wD(p.id+": setPlaybackRate("+e+") failed: "+t.message,2)}return p},this.setPosition=function(t){t===fe&&(t=0);var e,n,i=p.isHTML5?Math.max(t,0):Math.min(p.duration||p._iO.duration,Math.max(t,0));if(p.position=i,n=p.position/1e3,p._resetOnPosition(p.position),p._iO.position=i,p.isHTML5){if(p._a){if(p._html5_canplay){if(p._a.currentTime.toFixed(3)!==n.toFixed(3)){gt._wD(p.id+": setPosition("+n+")");try{p._a.currentTime=n,0!==p.playState&&!p.paused||p._a.pause()}catch(t){gt._wD(p.id+": setPosition("+n+") failed: "+t.message,2)}}}else if(n)return gt._wD(p.id+": setPosition("+n+"): Cannot seek yet, sound not ready",2),p;p.paused&&p._onTimer(!0)}}else e=9===v?p.position:n,p.readyState&&2!==p.readyState&&vt._setPosition(p.id,e,p.paused||!p.playState,p._iO.multiShot);return p},this.pause=function(t){return p.paused||0===p.playState&&1!==p.readyState||(gt._wD(p.id+": pause()"),p.paused=!0,p.isHTML5?(p._setup_html5().pause(),i()):!t&&t!==fe||vt._pause(p.id,p._iO.multiShot),p._iO.onpause&&p._iO.onpause.apply(p)),p},this.resume=function(){var t=p._iO;return p.paused&&(gt._wD(p.id+": resume()"),p.paused=!1,p.playState=1,p.isHTML5?(p._setup_html5().play(),u()):(t.isMovieStar&&!t.serverURL&&p.setPosition(p.position),vt._pause(p.id,t.multiShot)),!f&&t.onplay?(t.onplay.apply(p),f=!0):t.onresume&&t.onresume.apply(p)),p},this.togglePause=function(){return gt._wD(p.id+": togglePause()"),0===p.playState?p.play({position:9!==v||p.isHTML5?p.position/1e3:p.position}):p.paused?p.resume():p.pause(),p},this.setPan=function(t,e){return t===fe&&(t=0),e===fe&&(e=!1),p.isHTML5||vt._setPan(p.id,t),p._iO.pan=t,e||(p.pan=t,p.options.pan=t),p},this.setVolume=function(t,e){return t===fe&&(t=100),e===fe&&(e=!1),p.isHTML5?p._a&&(gt.muted&&!p.muted&&(p.muted=!0,p._a.muted=!0),p._a.volume=Math.max(0,Math.min(1,t/100))):vt._setVolume(p.id,gt.muted&&!p.muted||p.muted?0:t),p._iO.volume=t,e||(p.volume=t,p.options.volume=t),p},this.mute=function(){return p.muted=!0,p.isHTML5?p._a&&(p._a.muted=!0):vt._setVolume(p.id,0),p},this.unmute=function(){p.muted=!1;var t=p._iO.volume!==fe;return p.isHTML5?p._a&&(p._a.muted=!1):vt._setVolume(p.id,t?p._iO.volume:p.options.volume),p},this.toggleMute=function(){return p.muted?p.unmute():p.mute()},this.onPosition=function(t,e,n){return l.push({position:parseInt(t,10),method:e,scope:n!==fe?n:p,fired:!1}),p},this.onposition=this.onPosition,this.clearOnPosition=function(t,e){var n;if(t=parseInt(t,10),!isNaN(t))for(n=0;n<l.length;n++)t===l[n].position&&(e&&e!==l[n].method||(l[n].fired&&g--,l.splice(n,1)))},this._processOnPosition=function(){var t,e,n=l.length;if(!n||!p.playState||n<=g)return!1;for(t=n-1;0<=t;t--)!(e=l[t]).fired&&p.position>=e.position&&(e.fired=!0,g++,e.method.apply(e.scope,[e.position]),n=l.length);return!0},this._resetOnPosition=function(t){var e,n,i=l.length;if(!i)return!1;for(e=i-1;0<=e;e--)(n=l[e]).fired&&t<=n.position&&(n.fired=!1,g--);return!0},h=function(){var t,e,n=p._iO,i=n.from,r=n.to;return e=function(){gt._wD(p.id+': "To" time of '+r+" reached."),p.clearOnPosition(r,e),p.stop()},t=function(){gt._wD(p.id+': Playing "from" '+i),null===r||isNaN(r)||p.onPosition(r,e)},null===i||isNaN(i)||(n.position=i,n.multiShot=!1,t()),n},c=function(){var t,e=p._iO.onposition;if(e)for(t in e)e.hasOwnProperty(t)&&p.onPosition(parseInt(t,10),e[t])},r=function(){var t,e=p._iO.onposition;if(e)for(t in e)e.hasOwnProperty(t)&&p.clearOnPosition(parseInt(t,10))},u=function(){p.isHTML5&&V(p)},i=function(){p.isHTML5&&z(p)},(s=function(t){t||(l=[],g=0),f=!1,p._hasTimer=null,p._a=null,p._html5_canplay=!1,p.bytesLoaded=null,p.bytesTotal=null,p.duration=p._iO&&p._iO.duration?p._iO.duration:null,p.durationEstimate=null,p.buffered=[],p.eqData=[],p.eqData.left=[],p.eqData.right=[],p.failures=0,p.isBuffering=!1,p.instanceOptions={},p.instanceCount=0,p.loaded=!1,p.metadata={},p.readyState=0,p.muted=!1,p.paused=!1,p.peakData={left:0,right:0},p.waveformData={left:[],right:[]},p.playState=0,p.position=null,p.id3={}})(),this._onTimer=function(t){var e,n,i=!1,r={};return(p._hasTimer||t)&&p._a&&(t||(0<p.playState||1===p.readyState)&&!p.paused)&&((e=p._get_html5_duration())!==a.duration&&(a.duration=e,p.duration=e,i=!0),p.durationEstimate=p.duration,(n=1e3*p._a.currentTime||0)!==a.time&&(a.time=n,i=!0),(i||t)&&p._whileplaying(n,r,r,r,r)),i},this._get_html5_duration=function(){var t=p._iO,e=p._a&&p._a.duration?1e3*p._a.duration:t&&t.duration?t.duration:null;return e&&!isNaN(e)&&e!==1/0?e:null},this._apply_loop=function(t,e){!t.loop&&1<e&&gt._wD("Note: Native HTML5 looping is infinite.",1),t.loop=1<e?"loop":""},this._setup_html5=function(t){var e,n=x(p._iO,t),i=Ut?mt:p._a,r=decodeURI(n.url);if(Ut?r===decodeURI(rt)&&(e=!0):r===decodeURI(m)&&(e=!0),i){if(i._s)if(Ut)i._s&&i._s.playState&&!e&&i._s.stop();else if(!Ut&&r===decodeURI(m))return p._apply_loop(i,n.loops),i;e||(m&&s(!1),i.src=n.url,p.url=n.url,m=n.url,rt=n.url,i._called_load=!1)}else n.autoLoad||n.autoPlay?(p._a=new Audio(n.url),p._a.load()):p._a=Xt&&opera.version()<10?new Audio(null):new Audio,(i=p._a)._called_load=!1,Ut&&(mt=i);return p.isHTML5=!0,(p._a=i)._s=p,o(),p._apply_loop(i,n.loops),n.autoLoad||n.autoPlay?p.load():(i.autobuffer=!1,i.preload="auto"),i},o=function(){if(p._a._added_events)return!1;var t,e,n,i;for(t in p._a._added_events=!0,lt)lt.hasOwnProperty(t)&&(n=lt[e=t],i=void 0,p._a&&p._a.addEventListener(e,n,i||!1));return!0},e=function(){var t,e,n,i;for(t in gt._wD(p.id+": Removing event listeners"),p._a._added_events=!1,lt)lt.hasOwnProperty(t)&&(n=lt[e=t],i=void 0,p._a&&p._a.removeEventListener(e,n,i||!1))},this._onload=function(t){var e,n=!!t||!p.isHTML5&&8===v&&p.duration;return e=p.id+": ",gt._wD(e+(n?"onload()":"Failed to load / invalid sound?"+(p.duration?" -":" Zero-length duration reported.")+" ("+p.url+")"),n?1:2),n||p.isHTML5||(!0===gt.sandbox.noRemote&&gt._wD(e+L("noNet"),1),!0===gt.sandbox.noLocal&&gt._wD(e+L("noLocal"),1)),p.loaded=n,p.readyState=n?3:2,p._onbufferchange(0),n||p.isHTML5||p._onerror(),p._iO.onload&&ht(p,function(){p._iO.onload.apply(p,[n])}),!0},this._onerror=function(t,e){p._iO.onerror&&ht(p,function(){p._iO.onerror.apply(p,[t,e])})},this._onbufferchange=function(t){return 0!==p.playState&&(!(t&&p.isBuffering||!t&&!p.isBuffering)&&(p.isBuffering=1===t,p._iO.onbufferchange&&(gt._wD(p.id+": Buffer state change: "+t),p._iO.onbufferchange.apply(p,[t])),!0))},this._onsuspend=function(){return p._iO.onsuspend&&(gt._wD(p.id+": Playback suspended"),p._iO.onsuspend.apply(p)),!0},this._onfailure=function(t,e,n){p.failures++,gt._wD(p.id+": Failure ("+p.failures+"): "+t),p._iO.onfailure&&1===p.failures?p._iO.onfailure(t,e,n):gt._wD(p.id+": Ignoring failure")},this._onwarning=function(t,e,n){p._iO.onwarning&&p._iO.onwarning(t,e,n)},this._onfinish=function(){var t=p._iO.onfinish;p._onbufferchange(0),p._resetOnPosition(0),p.instanceCount&&(p.instanceCount--,p.instanceCount||(r(),p.playState=0,p.paused=!1,p.instanceCount=0,p.instanceOptions={},p._iO={},i(),p.isHTML5&&(p.position=0)),p.instanceCount&&!p._iO.multiShotEvents||t&&(gt._wD(p.id+": onfinish()"),ht(p,function(){t.apply(p)})))},this._whileloading=function(t,e,n,i){var r=p._iO;p.bytesLoaded=t,p.bytesTotal=e,p.duration=Math.floor(n),p.bufferLength=i,p.isHTML5||r.isMovieStar?p.durationEstimate=p.duration:r.duration?p.durationEstimate=p.duration>r.duration?p.duration:r.duration:p.durationEstimate=parseInt(p.bytesTotal/p.bytesLoaded*p.duration,10),p.isHTML5||(p.buffered=[{start:0,end:p.duration}]),(3!==p.readyState||p.isHTML5)&&r.whileloading&&r.whileloading.apply(p)},this._whileplaying=function(t,e,n,i,r){var s,o=p._iO;return!isNaN(t)&&null!==t&&(p.position=Math.max(0,t),p._processOnPosition(),!p.isHTML5&&8<v&&(o.usePeakData&&e!==fe&&e&&(p.peakData={left:e.leftPeak,right:e.rightPeak}),o.useWaveformData&&n!==fe&&n&&(p.waveformData={left:n.split(","),right:i.split(",")}),o.useEQData&&r!==fe&&r&&r.leftEQ&&(s=r.leftEQ.split(","),p.eqData=s,p.eqData.left=s,r.rightEQ!==fe&&r.rightEQ&&(p.eqData.right=r.rightEQ.split(",")))),1===p.playState&&(p.isHTML5||8!==v||p.position||!p.isBuffering||p._onbufferchange(0),o.whileplaying&&o.whileplaying.apply(p)),!0)},this._oncaptiondata=function(t){gt._wD(p.id+": Caption data received."),p.captiondata=t,p._iO.oncaptiondata&&p._iO.oncaptiondata.apply(p,[t])},this._onmetadata=function(t,e){gt._wD(p.id+": Metadata received.");var n,i,r={};for(n=0,i=t.length;n<i;n++)r[t[n]]=e[n];p.metadata=r,p._iO.onmetadata&&p._iO.onmetadata.call(p,p.metadata)},this._onid3=function(t,e){gt._wD(p.id+": ID3 data received.");var n,i,r=[];for(n=0,i=t.length;n<i;n++)r[t[n]]=e[n];p.id3=x(p.id3,r),p._iO.onid3&&p._iO.onid3.apply(p)},this._onconnect=function(t){t=1===t,gt._wD(p.id+": "+(t?"Connected.":"Failed to connect? - "+p.url),t?1:2),(p.connected=t)&&(p.failures=0,B(p.id)&&(p.getAutoPlay()?p.play(fe,p.getAutoPlay()):p._iO.autoLoad&&p.load()),p._iO.onconnect&&p._iO.onconnect.apply(p,[t]))},this._ondataerror=function(t){0<p.playState&&(gt._wD(p.id+": Data error: "+t),p._iO.ondataerror&&p._iO.ondataerror.apply(p))},this._debug()},k=function(){return St.body||St.getElementsByTagName("div")[0]},y=function(t){return St.getElementById(t)},x=function(t,e){var n,i,r=t||{};for(i in n=e===fe?gt.defaultOptions:e)n.hasOwnProperty(i)&&r[i]===fe&&("object"!=typeof n[i]||null===n[i]?r[i]=n[i]:r[i]=x(r[i],n[i]));return r},ht=function(t,e){t.isHTML5||8!==v?e():pe.setTimeout(e,0)},u={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1},l=function(t,e){var n,i=!0,r=e!==fe,s=gt.setupOptions,o=u;if(t===fe){for(n in i=[],s)s.hasOwnProperty(n)&&i.push(n);for(n in o)o.hasOwnProperty(n)&&("object"==typeof gt[n]?i.push(n+": {...}"):gt[n]instanceof Function?i.push(n+": function() {...}"):i.push(n));return gt._wD(L("setup",i.join(", "))),!1}for(n in t)if(t.hasOwnProperty(n))if("object"!=typeof t[n]||null===t[n]||t[n]instanceof Array||t[n]instanceof RegExp)r&&o[e]!==fe?gt[e][n]=t[n]:s[n]!==fe?(gt.setupOptions[n]=t[n],gt[n]=t[n]):o[n]===fe?(U(L(gt[n]===fe?"setupUndef":"setupError",n),2),i=!1):gt[n]instanceof Function?gt[n].apply(gt,t[n]instanceof Array?t[n]:[t[n]]):gt[n]=t[n];else{if(o[n]!==fe)return l(t[n],n);U(L(gt[n]===fe?"setupUndef":"setupError",n),2),i=!1}return i},pt=pe.attachEvent,ft={add:pt?"attachEvent":"addEventListener",remove:pt?"detachEvent":"removeEventListener"},it={add:function(){he(ce(arguments),"add")},remove:function(){he(ce(arguments),"remove")}},lt={abort:de(function(){gt._wD(this._s.id+": abort")}),canplay:de(function(){var e,n=this._s;if(!n._html5_canplay){if(n._html5_canplay=!0,gt._wD(n.id+": canplay"),n._onbufferchange(0),e=n._iO.position===fe||isNaN(n._iO.position)?null:n._iO.position/1e3,this.currentTime!==e){gt._wD(n.id+": canplay: Setting position to "+e);try{this.currentTime=e}catch(t){gt._wD(n.id+": canplay: Setting position of "+e+" failed: "+t.message,2)}}n._iO._oncanplay&&n._iO._oncanplay()}}),canplaythrough:de(function(){var t=this._s;t.loaded||(t._onbufferchange(0),t._whileloading(t.bytesLoaded,t.bytesTotal,t._get_html5_duration()),t._onload(!0))}),durationchange:de(function(){var t,e=this._s;t=e._get_html5_duration(),isNaN(t)||t===e.duration||(gt._wD(this._s.id+": durationchange ("+t+")"+(e.duration?", previously "+e.duration:"")),e.durationEstimate=e.duration=t)}),ended:de(function(){var t=this._s;gt._wD(t.id+": ended"),t._onfinish()}),error:de(function(){var t=Q[this.error.code]||null;gt._wD(this._s.id+": HTML5 error, code "+this.error.code+(t?" ("+t+")":"")),this._s._onload(!1),this._s._onerror(this.error.code,t)}),loadeddata:de(function(){var t=this._s;gt._wD(t.id+": loadeddata"),t._loaded||Gt||(t.duration=t._get_html5_duration())}),loadedmetadata:de(function(){gt._wD(this._s.id+": loadedmetadata")}),loadstart:de(function(){gt._wD(this._s.id+": loadstart"),this._s._onbufferchange(1)}),play:de(function(){this._s._onbufferchange(0)}),playing:de(function(){gt._wD(this._s.id+": playing "+String.fromCharCode(9835)),this._s._onbufferchange(0)}),progress:de(function(t){var e,n,i,r=this._s,s=0,o="progress"===t.type,a=t.target.buffered,l=t.loaded||0,u=t.total||1;if(r.buffered=[],a&&a.length){for(e=0,n=a.length;e<n;e++)r.buffered.push({start:1e3*a.start(e),end:1e3*a.end(e)});if(s=1e3*(a.end(0)-a.start(0)),l=Math.min(1,s/(1e3*t.target.duration)),o&&1<a.length){for(i=[],n=a.length,e=0;e<n;e++)i.push(1e3*t.target.buffered.start(e)+"-"+1e3*t.target.buffered.end(e));gt._wD(this._s.id+": progress, timeRanges: "+i.join(", "))}o&&!isNaN(l)&&gt._wD(this._s.id+": progress, "+Math.floor(100*l)+"% loaded")}isNaN(l)||(r._whileloading(l,u,r._get_html5_duration()),l&&u&&l===u&&lt.canplaythrough.call(this,t))}),ratechange:de(function(){gt._wD(this._s.id+": ratechange")}),suspend:de(function(t){var e=this._s;gt._wD(this._s.id+": suspend"),lt.progress.call(this,t),e._onsuspend()}),stalled:de(function(){gt._wD(this._s.id+": stalled")}),timeupdate:de(function(){this._s._onTimer()}),waiting:de(function(){var t=this._s;gt._wD(this._s.id+": waiting"),t._onbufferchange(1)})},Y=function(t){return!(!t||!(t.type||t.url||t.serverURL))&&(!(t.serverURL||t.type&&ue(t.type))&&(t.type?K({type:t.type}):K({url:t.url})||gt.html5Only||t.url.match(/data:/i)))},tt=function(t){var e;return t&&(e=Gt?ie:gt.html5.canPlayType("audio/wav")?"data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==":ie,t.src=e,t._called_unload!==fe&&(t._called_load=!1)),Ut&&(rt=null),e},K=function(t){if(!gt.useHTML5Audio||!gt.hasHTML5)return!1;var e,n,i,r,s=t.url||null,o=t.type||null,a=gt.audioFormats;if(o&&gt.html5[o]!==fe)return gt.html5[o]&&!ue(o);if(!Z){for(r in Z=[],a)a.hasOwnProperty(r)&&(Z.push(r),a[r].related&&(Z=Z.concat(a[r].related)));Z=new RegExp("\\.("+Z.join("|")+")(\\?.*)?$","i")}return(i=s?s.toLowerCase().match(Z):null)&&i.length?i=i[1]:o?i=(-1!==(n=o.indexOf(";"))?o.substr(0,n):o).substr(6):e=!1,e=i&&gt.html5[i]!==fe?gt.html5[i]&&!ue(i):(o="audio/"+i,e=gt.html5.canPlayType({type:o}),(gt.html5[i]=e)&&gt.html5[o]&&!ue(o))},nt=function(){if(!gt.useHTML5Audio||!gt.hasHTML5)return gt.html5.usingFlash=!0,!(qt=!0);var t,e,n,s,o=Audio!==fe?Xt&&opera.version()<10?new Audio(null):new Audio:null,i={};function r(t){var e,n,i=!1,r=!1;if(!o||"function"!=typeof o.canPlayType)return i;if(t instanceof Array){for(s=0,n=t.length;s<n;s++)(gt.html5[t[s]]||o.canPlayType(t[s]).match(gt.html5Test))&&(r=!0,gt.html5[t[s]]=!0,gt.flash[t[s]]=!!t[s].match(ne));i=r}else i=!(!(e=!(!o||"function"!=typeof o.canPlayType)&&o.canPlayType(t))||!e.match(gt.html5Test));return i}for(t in n=gt.audioFormats)if(n.hasOwnProperty(t)&&(e="audio/"+t,i[t]=r(n[t].type),i[e]=i[t],t.match(ne)?(gt.flash[t]=!0,gt.flash[e]=!0):(gt.flash[t]=!1,gt.flash[e]=!1),n[t]&&n[t].related))for(s=n[t].related.length-1;0<=s;s--)i["audio/"+n[t].related[s]]=i[t],gt.html5[n[t].related[s]]=i[t],gt.flash[n[t].related[s]]=i[t];return i.canPlayType=o?r:null,gt.html5=x(gt.html5,i),gt.html5.usingFlash=X(),qt=gt.html5.usingFlash,!0},T={notReady:"Unavailable - wait until onready() has fired.",notOK:"Audio support is not available.",domError:yt+"exception caught while appending SWF to DOM.",spcWmode:"Removing wmode, preventing known SWF loading issue(s)",swf404:bt+"Verify that %s is a valid path.",tryDebug:"Try "+yt+".debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:bt+"Non-HTTP page ("+St.location.protocol+" URL?) Review Flash player security settings for this special case:\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:bt+"Special case: Waiting for SWF to load with window focus...",waitForever:bt+"Waiting indefinitely for Flash (will recover if unblocked)...",waitSWF:bt+"Waiting for 100% SWF load...",needFunction:bt+"Function object expected for %s",badID:'Sound ID "%s" should be a string, starting with a non-numeric character',currentObj:bt+"_debug(): Current sound objects",waitOnload:bt+"Waiting for window.onload()",docLoaded:bt+"Document already loaded",onload:bt+"initComplete(): calling soundManager.onload()",onloadOK:yt+".onload() complete",didInit:bt+"init(): Already called?",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:bt+"Failed to remove Flash node.",shutdown:yt+".disable(): Shutting down",queue:bt+"Queueing %s handler",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+F.swfTimedout+" CSS...",fbLoaded:"Flash loaded",fbHandler:bt+"flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:yt+".load(): current URL already assigned.",badFV:yt+'.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",needFlash:bt+"Fatal error: Flash is needed to play some required formats, but is not available.",gotFocus:bt+"Got window focus.",policy:"Enabling usePolicyFile for data access",setup:yt+".setup(): allowed parameters: %s",setupError:yt+'.setup(): "%s" cannot be assigned with this method.',setupUndef:yt+'.setup(): Could not find option "%s"',setupLate:yt+".setup(): url, flashVersion and html5Test property changes will not take effect until reboot().",noURL:bt+"Flash URL required. Call soundManager.setup({url:...}) to get started.",sm2Loaded:"SoundManager 2: Ready. "+String.fromCharCode(10003),reset:yt+".reset(): Removing event callbacks",mobileUA:"Mobile UA detected, preferring HTML5 by default.",globalHTML5:"Using singleton HTML5 Audio() pattern for this device.",ignoreMobile:"Ignoring mobile restrictions for this device."},L=function(){var t,e,n,i,r;if(i=(t=$t.call(arguments)).shift(),(r=T&&T[i]?T[i]:"")&&t&&t.length)for(e=0,n=t.length;e<n;e++)r=r.replace("%s",t[e]);return r},q=function(t){return 8===v&&1<t.loops&&t.stream&&(_("as2loop"),t.stream=!1),t},$=function(t,e){return t&&!t.usePolicyFile&&(t.onid3||t.usePeakData||t.useWaveformData||t.useEQData)&&(gt._wD((e||"")+L("policy")),t.usePolicyFile=!0),t},U=function(t){Qt&&console.warn!==fe?console.warn(t):gt._wD(t)},n=function(){return!1},N=function(t){var e;for(e in t)t.hasOwnProperty(e)&&"function"==typeof t[e]&&(t[e]=n);e=null},j=function(t){t===fe&&(t=!1),(Dt||t)&&gt.disable(t)},R=function(t){var e;if(t)if(t.match(/\.swf(\?.*)?$/i)){if(t.substr(t.toLowerCase().lastIndexOf(".swf?")+4))return t}else t.lastIndexOf("/")!==t.length-1&&(t+="/");return e=(t&&-1!==t.lastIndexOf("/")?t.substr(0,t.lastIndexOf("/")+1):"./")+gt.movieURL,gt.noSWFCache&&(e+="?ts="+(new Date).getTime()),e},S=function(){8!==(v=parseInt(gt.flashVersion,10))&&9!==v&&(gt._wD(L("badFV",v,8)),gt.flashVersion=v=8);var t=gt.debugMode||gt.debugFlash?"_debug.swf":".swf";gt.useHTML5Audio&&!gt.html5Only&&gt.audioFormats.mp4.required&&v<9&&(gt._wD(L("needfl9")),gt.flashVersion=v=9),gt.version=gt.versionNumber+(gt.html5Only?" (HTML5-only mode)":9===v?" (AS3/Flash 9)":" (AS2/Flash 8)"),8<v?(gt.defaultOptions=x(gt.defaultOptions,gt.flash9Options),gt.features.buffering=!0,gt.defaultOptions=x(gt.defaultOptions,gt.movieStarOptions),gt.filePatterns.flash9=new RegExp("\\.(mp3|"+ae.join("|")+")(\\?.*)?$","i"),gt.features.movieStar=!0):gt.features.movieStar=!1,gt.filePattern=gt.filePatterns[8!==v?"flash9":"flash8"],gt.movieURL=(8===v?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",t),gt.features.peakData=gt.features.waveformData=gt.features.eqData=8<v},O=function(t,e){vt&&vt._setPolling(t,e)},A=function(){if(gt.debugURLParam.test(xt)&&(gt.setupOptions.debugMode=gt.debugMode=!0),!y(gt.debugID)){var t,e,n,i,r;if(gt.debugMode&&!y(gt.debugID)&&(!Qt||!gt.useConsole||!gt.consoleOnly)){for(r in(t=St.createElement("div")).id=gt.debugID+"-toggle",i={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001},t.appendChild(St.createTextNode("-")),t.onclick=H,t.title="Toggle SM2 debug console",_t.match(/msie 6/i)&&(t.style.position="absolute",t.style.cursor="hand"),i)i.hasOwnProperty(r)&&(t.style[r]=i[r]);if((e=St.createElement("div")).id=gt.debugID,e.style.display=gt.debugMode?"block":"none",gt.debugMode&&!y(t.id)){try{(n=k()).appendChild(t)}catch(t){throw new Error(L("domError")+" \n"+t.toString())}n.appendChild(e)}}n=null}},B=this.getSoundById,_=function(t,e){return t?gt._wD(L(t),e):""},H=function(){var t=y(gt.debugID),e=y(gt.debugID+"-toggle");t&&(Ct?(e.innerHTML="+",t.style.display="none"):(e.innerHTML="-",t.style.display="block"),Ct=!Ct)},w=function(t,e,n){if(pe.sm2Debugger!==fe)try{sm2Debugger.handleEvent(t,e,n)}catch(t){return!1}return!0},P=function(){var t=[];return gt.debugMode&&t.push(F.sm2Debug),gt.debugFlash&&t.push(F.flashDebug),gt.useHighPerformance&&t.push(F.highPerf),t.join(" ")},I=function(){var t=L("fbHandler"),e=gt.getMoviePercent(),n=F,i={type:"FLASHBLOCK"};gt.html5Only||(gt.ok()?(gt.didFlashBlock&&gt._wD(t+": Unblocked"),gt.oMC&&(gt.oMC.className=[P(),n.swfDefault,n.swfLoaded+(gt.didFlashBlock?" "+n.swfUnblocked:"")].join(" "))):(qt&&(gt.oMC.className=P()+" "+n.swfDefault+" "+(null===e?n.swfTimedout:n.swfError),gt._wD(t+": "+L("fbTimeout")+(e?" ("+L("fbLoaded")+")":""))),gt.didFlashBlock=!0,o({type:"ontimeout",ignoreInit:!0,error:i}),D(i)))},s=function(t,e,n){Tt[t]===fe&&(Tt[t]=[]),Tt[t].push({method:e,scope:n||null,fired:!1})},o=function(t){if(t=t||{type:gt.ok()?"onready":"ontimeout"},!Mt&&t&&!t.ignoreInit)return!1;if("ontimeout"===t.type&&(gt.ok()||Dt&&!t.ignoreInit))return!1;var e,n,i={success:t&&t.ignoreInit?gt.ok():!Dt},r=t&&t.type&&Tt[t.type]||[],s=[],o=[i],a=qt&&!gt.ok();for(t.error&&(o[0].error=t.error),e=0,n=r.length;e<n;e++)!0!==r[e].fired&&s.push(r[e]);if(s.length)for(e=0,n=s.length;e<n;e++)s[e].scope?s[e].method.apply(s[e].scope,o):s[e].method.apply(this,o),a||(s[e].fired=!0);return!0},c=function(){pe.setTimeout(function(){gt.useFlashBlock&&I(),o(),"function"==typeof gt.onload&&(_("onload",1),gt.onload.apply(pe),_("onloadOK",1)),gt.waitForWindowLoad&&it.add(pe,"load",c)},1)},ot=function(){if(st!==fe)return st;var e,t,n,i,r=!1,s=navigator,o=pe.ActiveXObject;try{i=s.plugins}catch(t){i=void 0}if(i&&i.length)t="application/x-shockwave-flash",(n=s.mimeTypes)&&n[t]&&n[t].enabledPlugin&&n[t].enabledPlugin.description&&(r=!0);else if(o!==fe&&!_t.match(/MSAppHost/i)){try{e=new o("ShockwaveFlash.ShockwaveFlash")}catch(t){e=null}r=!!e,e=null}return st=r},X=function(){var t,e,n=gt.audioFormats;if(Vt&&!!_t.match(/os (1|2|3_0|3_1)\s/i)?(gt.hasHTML5=!1,gt.html5Only=!0,gt.oMC&&(gt.oMC.style.display="none")):gt.useHTML5Audio&&(gt.html5&&gt.html5.canPlayType||(gt._wD("SoundManager: No HTML5 Audio() support detected."),gt.hasHTML5=!1),Kt&&gt._wD(bt+"Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(st?"will use flash fallback for MP3/MP4, if available":" would use flash fallback for MP3/MP4, but none detected."),1)),gt.useHTML5Audio&&gt.hasHTML5)for(e in G=!0,n)n.hasOwnProperty(e)&&n[e].required&&(gt.html5.canPlayType(n[e].type)?gt.preferFlash&&(gt.flash[e]||gt.flash[n[e].type])&&(t=!0):t=!(G=!1));return gt.ignoreFlash&&(G=!(t=!1)),gt.html5Only=gt.hasHTML5&&gt.useHTML5Audio&&!t,!gt.html5Only},J=function(t){var e,n,i,r=0;if(t instanceof Array){for(e=0,n=t.length;e<n;e++)if(t[e]instanceof Object){if(gt.canPlayMIME(t[e].type)){r=e;break}}else if(gt.canPlayURL(t[e])){r=e;break}t[r].url&&(t[r]=t[r].url),i=t[r]}else i=t;return i},V=function(t){t._hasTimer||(t._hasTimer=!0,!Yt&&gt.html5PollingInterval&&(null===Ft&&0===Pt&&(Ft=setInterval(W,gt.html5PollingInterval)),Pt++))},z=function(t){t._hasTimer&&(t._hasTimer=!1,!Yt&&gt.html5PollingInterval&&Pt--)},W=function(){var t;if(null!==Ft&&!Pt)return clearInterval(Ft),void(Ft=null);for(t=gt.soundIDs.length-1;0<=t;t--)gt.sounds[gt.soundIDs[t]].isHTML5&&gt.sounds[gt.soundIDs[t]]._hasTimer&&gt.sounds[gt.soundIDs[t]]._onTimer()},D=function(t){t=t!==fe?t:{},"function"==typeof gt.onerror&&gt.onerror.apply(pe,[{type:t.type!==fe?t.type:null}]),t.fatal!==fe&&t.fatal&&gt.disable()},at=function(){if(Kt&&ot()){var t,e,n=gt.audioFormats;for(e in n)if(n.hasOwnProperty(e)&&("mp3"===e||"mp4"===e)&&(gt._wD(yt+": Using flash fallback for "+e+" format"),gt.html5[e]=!1,n[e]&&n[e].related))for(t=n[e].related.length-1;0<=t;t--)gt.html5[n[e].related[t]]=!1}},this._setSandboxType=function(t){var e=gt.sandbox;e.type=t,e.description=e.types[e.types[t]!==fe?t:"unknown"],"localWithFile"===e.type?(e.noRemote=!0,e.noLocal=!1,_("secNote",2)):"localWithNetwork"===e.type?(e.noRemote=!1,e.noLocal=!0):"localTrusted"===e.type&&(e.noRemote=!1,e.noLocal=!1)},this._externalInterfaceOK=function(t){if(!gt.swfLoaded){var e;if(w("swf",!0),w("flashtojs",!0),gt.swfLoaded=!0,te=!1,Kt&&at(),!t||t.replace(/\+dev/i,"")!==gt.versionNumber.replace(/\+dev/i,""))return e=yt+': Fatal: JavaScript file build "'+gt.versionNumber+'" does not match Flash SWF build "'+t+'" at '+gt.url+". Ensure both are up-to-date.",void setTimeout(function(){throw new Error(e)},0);setTimeout(b,Wt?100:1)}},M=function(t,e){if(Et&&kt)return!1;function n(){var t,e=[],n=[];t="SoundManager "+gt.version+(!gt.html5Only&&gt.useHTML5Audio?gt.hasHTML5?" + HTML5 audio":", no HTML5 audio support":""),gt.html5Only?gt.html5PollingInterval&&e.push("html5PollingInterval ("+gt.html5PollingInterval+"ms)"):(gt.preferFlash&&e.push("preferFlash"),gt.useHighPerformance&&e.push("useHighPerformance"),gt.flashPollingInterval&&e.push("flashPollingInterval ("+gt.flashPollingInterval+"ms)"),gt.html5PollingInterval&&e.push("html5PollingInterval ("+gt.html5PollingInterval+"ms)"),gt.wmode&&e.push("wmode ("+gt.wmode+")"),gt.debugFlash&&e.push("debugFlash"),gt.useFlashBlock&&e.push("flashBlock")),e.length&&(n=n.concat([e.join(" + ")])),gt._wD(t+(n.length?" + "+n.join(", "):""),1),ut()}if(gt.html5Only)return S(),n(),gt.oMC=y(gt.movieID),b(),!(kt=Et=!0);var i,r,s,o,a,l,u,c,h,d=e||gt.url,p=gt.altURL||d,f=k(),g=P(),m=St.getElementsByTagName("html")[0];function v(t,e){return'<param name="'+t+'" value="'+e+'" />'}if(i=m&&m.dir&&m.dir.match(/rtl/i),t=t===fe?gt.id:t,S(),gt.url=R(re?d:p),e=gt.url,gt.wmode=!gt.wmode&&gt.useHighPerformance?"transparent":gt.wmode,null!==gt.wmode&&(_t.match(/msie 8/i)||!Wt&&!gt.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(Ht.push(T.spcWmode),gt.wmode=null),r={name:t,id:t,src:e,quality:"high",allowScriptAccess:gt.allowScriptAccess,bgcolor:gt.bgColor,pluginspage:se+"www.macromedia.com/go/getflashplayer",title:"JS/Flash audio component (SoundManager 2)",type:"application/x-shockwave-flash",wmode:gt.wmode,hasPriority:"true"},gt.debugFlash&&(r.FlashVars="debug=1"),gt.wmode||delete r.wmode,Wt)s=St.createElement("div"),a=['<object id="'+t+'" data="'+e+'" type="'+r.type+'" title="'+r.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',v("movie",e),v("AllowScriptAccess",gt.allowScriptAccess),v("quality",r.quality),gt.wmode?v("wmode",gt.wmode):"",v("bgcolor",gt.bgColor),v("hasPriority","true"),gt.debugFlash?v("FlashVars",r.FlashVars):"","</object>"].join("");else for(o in s=St.createElement("embed"),r)r.hasOwnProperty(o)&&s.setAttribute(o,r[o]);if(A(),g=P(),f=k())if(gt.oMC=y(gt.movieID)||St.createElement("div"),gt.oMC.id)h=gt.oMC.className,gt.oMC.className=(h?h+" ":F.swfDefault)+(g?" "+g:""),gt.oMC.appendChild(s),Wt&&((l=gt.oMC.appendChild(St.createElement("div"))).className=F.swfBox,l.innerHTML=a),kt=!0;else{if(gt.oMC.id=gt.movieID,gt.oMC.className=F.swfDefault+" "+g,l=u=null,gt.useFlashBlock||(gt.useHighPerformance?u={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(u={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},i&&(u.left=Math.abs(parseInt(u.left,10))+"px"))),Jt&&(gt.oMC.style.zIndex=1e4),!gt.debugFlash)for(c in u)u.hasOwnProperty(c)&&(gt.oMC.style[c]=u[c]);try{Wt||gt.oMC.appendChild(s),f.appendChild(gt.oMC),Wt&&((l=gt.oMC.appendChild(St.createElement("div"))).className=F.swfBox,l.innerHTML=a),kt=!0}catch(t){throw new Error(L("domError")+" \n"+t.toString())}}return Et=!0,n(),!0},g=function(){return gt.html5Only?(M(),!1):!vt&&(gt.url?((vt=gt.getMovie(gt.id))||(jt?(Wt?gt.oMC.innerHTML=Rt:gt.oMC.appendChild(jt),Et=!(jt=null)):M(gt.id,gt.url),vt=gt.getMovie(gt.id)),"function"==typeof gt.oninitmovie&&setTimeout(gt.oninitmovie,1),ct(),!0):(_("noURL"),!1))},h=function(){setTimeout(d,1e3)},p=function(){pe.setTimeout(function(){U(bt+"useFlashBlock is false, 100% HTML5 mode is possible. Rebooting with preferFlash: false..."),gt.setup({preferFlash:!1}).reboot(),gt.didFlashBlock=!0,gt.beginDelayedInit()},1)},d=function(){var t,e=!1;gt.url&&(Lt||(Lt=!0,it.remove(pe,"load",h),st&&te&&!Zt?_("waitFocus"):(Mt||0<(t=gt.getMoviePercent())&&t<100&&(e=!0),setTimeout(function(){if(t=gt.getMoviePercent(),e)return Lt=!1,gt._wD(L("waitSWF")),void pe.setTimeout(h,1);Mt||(gt._wD(yt+": No Flash response within expected time. Likely causes: "+(0===t?"SWF load failed, ":"")+"Flash blocked or JS-Flash security error."+(gt.debugFlash?" "+L("checkSWF"):""),2),!re&&t&&(_("localFail",2),gt.debugFlash||_("tryDebug",2)),0===t&&gt._wD(L("swf404",gt.url),1),w("flashtojs",!1,": Timed out"+(re?" (Check flash security or flash blockers)":" (No plugin/missing SWF?)"))),!Mt&&ee&&(null===t?gt.useFlashBlock||0===gt.flashLoadTimeout?(gt.useFlashBlock&&I(),_("waitForever")):!gt.useFlashBlock&&G?p():(_("waitForever"),o({type:"ontimeout",ignoreInit:!0,error:{type:"INIT_FLASHBLOCK"}})):0===gt.flashLoadTimeout?_("waitForever"):!gt.useFlashBlock&&G?p():j(!0))},gt.flashLoadTimeout))))},f=function(){function t(){it.remove(pe,"focus",f)}return Zt||!te||(Zt=ee=!0,_("gotFocus"),Lt=!1,h()),t(),!0},ct=function(){Ht.length&&(gt._wD("SoundManager 2: "+Ht.join(" "),1),Ht=[])},ut=function(){ct();var t,e=[];if(gt.useHTML5Audio&&gt.hasHTML5){for(t in gt.audioFormats)gt.audioFormats.hasOwnProperty(t)&&e.push(t+" = "+gt.html5[t]+(!gt.html5[t]&&qt&&gt.flash[t]?" (using flash)":gt.preferFlash&&gt.flash[t]&&qt?" (preferring flash)":gt.html5[t]?"":" ("+(gt.audioFormats[t].required?"required, ":"")+"and no flash support)"));gt._wD("SoundManager 2 HTML5 support: "+e.join(", "),1)}},r=function(t){if(Mt)return!1;if(gt.html5Only)return _("sm2Loaded",1),Mt=!0,c(),w("onload",!0),!0;var e,n=!0;return gt.useFlashBlock&&gt.flashLoadTimeout&&!gt.getMoviePercent()||(Mt=!0),e={type:!st&&qt?"NO_FLASH":"INIT_TIMEOUT"},gt._wD("SoundManager 2 "+(Dt?"failed to load":"loaded")+" ("+(Dt?"Flash security/load error":"OK")+") "+String.fromCharCode(Dt?10006:10003),Dt?2:1),Dt||t?(gt.useFlashBlock&&gt.oMC&&(gt.oMC.className=P()+" "+(null===gt.getMoviePercent()?F.swfTimedout:F.swfError)),o({type:"ontimeout",error:e,ignoreInit:!0}),w("onload",!1),D(e),n=!1):w("onload",!0),Dt||(gt.waitForWindowLoad&&!Ot?(_("waitOnload"),it.add(pe,"load",c)):(gt.waitForWindowLoad&&Ot&&_("docLoaded"),c())),n},i=function(){var t,e=gt.setupOptions;for(t in e)e.hasOwnProperty(t)&&(gt[t]===fe?gt[t]=e[t]:gt[t]!==e[t]&&(gt.setupOptions[t]=gt[t]))},b=function(){if(Mt)return _("didInit"),!1;function t(){it.remove(pe,"load",gt.beginDelayedInit)}if(gt.html5Only)return Mt||(t(),gt.enabled=!0,r()),!0;g();try{vt._externalInterfaceTest(!1),O(!0,gt.flashPollingInterval||(gt.useHighPerformance?10:50)),gt.debugMode||vt._disableDebug(),gt.enabled=!0,w("jstoflash",!0),gt.html5Only||it.add(pe,"unload",n)}catch(t){return gt._wD("js/flash exception: "+t.toString()),w("jstoflash",!1),D({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),j(!0),r(),!1}return r(),t(),!0},m=function(){return!E&&(E=!0,i(),A(),!st&&gt.hasHTML5&&(gt._wD("SoundManager 2: No Flash detected"+(gt.useHTML5Audio?". Trying HTML5-only mode.":", enabling HTML5."),1),gt.setup({useHTML5Audio:!0,preferFlash:!1})),nt(),!st&&qt&&(Ht.push(T.needFlash),gt.setup({flashLoadTimeout:1})),St.removeEventListener&&St.removeEventListener("DOMContentLoaded",m,!1),g(),!0)},et=function(){return"complete"===St.readyState&&(m(),St.detachEvent("onreadystatechange",et)),!0},C=function(){Ot=!0,m(),it.remove(pe,"load",C)},ot(),it.add(pe,"focus",f),it.add(pe,"load",h),it.add(pe,"load",C),St.addEventListener?St.addEventListener("DOMContentLoaded",m,!1):St.attachEvent?St.attachEvent("onreadystatechange",et):(w("onload",!1),D({type:"NO_DOM2_EVENTS",fatal:!0}))}pe.SM2_DEFER!==fe&&SM2_DEFER||(t=new n),"object"==typeof module&&module&&"object"==typeof module.exports?(module.exports.SoundManager=n,module.exports.soundManager=t):"function"==typeof define&&define.amd&&define(function(){return{constructor:n,getInstance:function(t){if(!pe.soundManager&&t instanceof Function){var e=t(n);e instanceof n&&(pe.soundManager=e)}return pe.soundManager}}}),pe.SoundManager=n,pe.soundManager=t}(window),window.JST["apps/album/show/tpl/album_with_songs.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="album album--with-songs">\n    <div class="region-album-side">\n        <div class="region-album-meta"></div>\n    </div>\n    <div class="region-album-content">\n        <div class="region-album-songs"></div>\n    </div>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/album/show/tpl/details_meta.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="region-details-top">\n    <div class="region-details-title">\n        <h2><span class="title">'),i.push(n(this.label)),i.push('</span> <span class="sub"><a href="#music/albums?year='),i.push(n(this.year)),i.push('">'),i.push(n(this.year)),i.push("</a></span></h2>\n    </div>\n    "),this.rating&&(i.push('\n    <div class="region-details-rating">\n        '),i.push(n(this.rating)),i.push(" <i></i>\n    </div>\n    ")),i.push('\n</div>\n\n<div class="region-details-meta-below">\n\n    <ul class="meta">\n        '),this.artist&&(i.push("\n            <li><label>"),i.push(n(tr("artist"))),i.push(':</label> <span><a href="#music/artist/'),i.push(n(this.artistid)),i.push('">'),i.push(n(this.artist)),i.push("</a></span></li>\n        ")),i.push("\n        "),0<this.genre.length&&(i.push("\n            <li><label>"),i.push(n(t.ngettext("genre","genres",this.genre.length))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/albums","genre",this.genre)),i.push("</span></li>\n        ")),i.push("\n        "),this.style.length&&(i.push("\n            <li><label>"),i.push(n(t.ngettext("style","styles",this.style.length))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/albums","style",this.style)),i.push("</span></li>\n        ")),i.push("\n        "),this.albumlabel&&(i.push("\n            <li><label>"),i.push(n(tr("label"))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/albums","albumlabel",[this.albumlabel])),i.push("</span></li>\n        ")),i.push('\n    </ul>\n\n    <div class="description">'),i.push(n(this.description)),i.push('</div>\n\n    <ul class="inline-links">\n        <li class="btn-flat-play play">'),i.push(n(tr("Play"))),i.push('</li>\n        <li class="btn-flat-add add">'),i.push(n(tr("Queue"))),i.push('</li>\n        <li class="btn-flat-stream localplay">'),i.push(n(tr("Stream"))),i.push('</li>\n        <li class="more-actions dropdown">\n            <span class="btn-flat-more" data-toggle="dropdown" aria-expanded="true">'),i.push(n(tr("more"))),i.push('</span>\n            <ul class="dropdown-menu pull-right">\n                <li class="localadd">'),i.push(n(tr("Add to playlist"))),i.push('</li>\n                <li class="divider"></li>\n                <li class="dropdown-submenu internal-search">'),i.push(n(tr("Chorus Search"))),i.push('\n                    <ul class="dropdown-menu">\n                        '),i.push(helpers.entities.getAddonSearchMenuItems(this.label)),i.push('\n                    </ul>\n                </li>\n                <li class="dropdown-submenu external-search">'),i.push(n(tr("External Search"))),i.push('\n                    <ul class="dropdown-menu">\n                        <li data-type="google" data-query="'),i.push(n(this.artist)),i.push(" "),i.push(n(this.label)),i.push('">Google</li>\n                        <li data-type="soundcloud" data-query="'),i.push(n(this.artist)),i.push('">SoundCloud</li>\n                    </ul>\n                </li>\n                <li class="youtube-search" data-query="'),i.push(n(this.artist)),i.push(" "),i.push(n(this.label)),i.push('">'),i.push(n(tr("YouTube Search"))),i.push('</li>\n                <li class="divider"></li>\n                <li class="edit">'),i.push(n(tr("Edit"))),i.push("</li>\n            </ul>\n        </li>\n    </ul>\n\n</div>\n")}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/artist/show/tpl/details_meta.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="region-details-top">\n    <div class="region-details-title">\n        <h2>'),i.push(n(this.label)),i.push('</h2>\n    </div>\n</div>\n\n<div class="region-details-meta-below">\n\n    <ul class="meta">\n        '),0<this.genre.length&&(i.push("\n            <li><label>"),i.push(n(t.ngettext("genre","genres",this.genre.length))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/artists","genre",this.genre)),i.push("</span></li>\n        ")),i.push("\n        "),this.style.length&&(i.push("\n        <li><label>"),i.push(n(t.ngettext("style","styles",this.style.length))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/artists","style",this.style)),i.push("</span></li>\n        ")),i.push("\n        "),this.formed&&(i.push("\n            <li><label>"),i.push(n(tr("formed"))),i.push(":</label> <span>"),i.push(n(this.formed)),i.push("</span></li>\n        ")),i.push("\n        "),this.yearsactive&&0<this.yearsactive.length&&(i.push("\n            <li><label>"),i.push(n(tr("years active"))),i.push(":</label> <span>"),i.push(n(this.yearsactive)),i.push("</span></li>\n        ")),i.push("\n        "),this.born&&(i.push("\n            <li><label>"),i.push(n(tr("born"))),i.push(":</label> <span>"),i.push(n(this.born)),i.push("</span></li>\n        ")),i.push("\n        "),this.died&&(i.push("\n            <li><label>"),i.push(n(tr("died"))),i.push(":</label> <span>"),i.push(n(this.died)),i.push("</span></li>\n        ")),i.push("\n        "),this.disbanded&&(i.push("\n            <li><label>"),i.push(n(tr("disbanded"))),i.push(":</label> <span>"),i.push(n(this.disbanded)),i.push("</span></li>\n        ")),i.push('\n    </ul>\n\n    <div class="description">'),i.push(n(this.description)),i.push('</div>\n\n    <ul class="inline-links">\n        <li class="btn-flat-play play">'),i.push(n(tr("Play"))),i.push('</li>\n        <li class="btn-flat-add add">'),i.push(n(tr("Queue"))),i.push('</li>\n        <li class="btn-flat-stream localplay">'),i.push(n(tr("Stream"))),i.push('</li>\n        <li class="more-actions dropdown">\n            <span class="btn-flat-more" data-toggle="dropdown" aria-expanded="true">'),i.push(n(tr("more"))),i.push('</span>\n            <ul class="dropdown-menu pull-right">\n                <li class="localadd">'),i.push(n(tr("Add to playlist"))),i.push('</li>\n                <li class="divider"></li>\n                <li class="dropdown-submenu internal-search">'),i.push(n(tr("Chorus Search"))),i.push('\n                    <ul class="dropdown-menu">\n                        '),i.push(helpers.entities.getAddonSearchMenuItems(this.label)),i.push('\n                    </ul>\n                </li>\n                <li class="dropdown-submenu external-search">'),i.push(n(tr("External Search"))),i.push('\n                    <ul class="dropdown-menu">\n                        <li data-type="google" data-query="'),i.push(n(this.label)),i.push('">Google</li>\n                        <li data-type="soundcloud" data-query="'),i.push(n(this.label)),i.push('">SoundCloud</li>\n                    </ul>\n                </li>\n                <li class="youtube-search" data-query="'),i.push(n(this.label)),i.push('">'),i.push(n(tr("YouTube Search"))),i.push('</li>\n                <li class="divider"></li>\n                <li class="edit">'),i.push(n(tr("Edit"))),i.push("</li>\n            </ul>\n        </li>\n    </ul>\n\n</div>\n")}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/browser/list/tpl/back_button.jst"]=function(e){var n=[],i=(e=e||{}).safe,r=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<i class="mdi thumb"></i><div class="title">'),n.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}(t.gettext("Back"))),n.push("</div>\n")}).call(this)}.call(e),e.safe=i,e.escape=r,n.join("")},window.JST["apps/browser/list/tpl/file.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="thumb" style="background-image: url(\''),n.push(e(this.thumbnail)),n.push('\')"><div class="mdi play"></div></div>\n<div class="title" title="'),n.push(e(helpers.global.stripTags(this.labelHtml))),n.push('">'),n.push(this.labelHtml),n.push('</div>\n<ul class="actions">\n    <li class="menu dropdown">\n        <i data-toggle="dropdown" class="mdi"></i>\n        <ul class="dropdown-menu pull-right"></ul>\n    </li>\n</ul>\n')}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/browser/list/tpl/folder_layout.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="folder-layout">\n    <div class="loading-bar"><div class="inner"><div class="loader-small-inline"></div> <span>'),n.push(e(tr("Loading folder..."))),n.push('</span></div></div>\n    <div class="path"></div>\n    <ul class="actions">\n        <li class="dropdown sort-wrapper">\n            <i class="sort-toggle" data-toggle="dropdown" title="'),n.push(e(tr("Sort"))),n.push('"></i>\n            <ul class="sorts dropdown-menu pull-right">\n                <li data-sort="none">'),n.push(e(tr("default"))),n.push('<i></i></li>\n                <li data-sort="label">'),n.push(e(tr("title"))),n.push('<i></i></li>\n                <li data-sort="dateadded">'),n.push(e(tr("date added"))),n.push('<i></i></li>\n                <li data-sort="year">'),n.push(e(tr("year"))),n.push('<i></i></li>\n                <li data-sort="random">'),n.push(e(tr("random"))),n.push('<i></i></li>\n            </ul>\n        </li>\n        <li class="dropdown context-wrapper">\n            <i class="context-toggle" data-toggle="dropdown" title="'),n.push(e(tr("Actions"))),n.push('"></i>\n            <ul class="dropdown-menu pull-right">\n                <li class="play">'),n.push(e(tr("play files"))),n.push('<i></i></li>\n                <li class="queue">'),n.push(e(tr("queue files"))),n.push('<i></i></li>\n            </ul>\n        </li>\n    </ul>\n\n\n    <div class="folder-container">\n        <div class="files">\n        </div>\n        <div class="folders-pane">\n            <div class="back"></div>\n            <div class="folders">\n                <div class="intro">\n                    <h3><span class="mdi-navigation-arrow-back text-dim"></span> '),n.push(e(tr("Browse files and add-ons"))),n.push("</h3>\n                    <p>"),n.push(e(tr("This is where you can browse all Kodi content, not just what is in the library. Browse by source or add-on."))),n.push("</p>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/browser/list/tpl/path.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="title">'),e.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}(this.label)),e.push("</div>\n")}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/browser/list/tpl/source.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="source source-'),n.push(e(this.media)),n.push('">\n    '),n.push(e(this.label)),n.push("\n</div>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/browser/list/tpl/source_set.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push("<h3>"),e.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}(this.label)),e.push('</h3>\n<ul class="sources"></ul>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/cast/list/tpl/cast.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<a href="#'),n.push(e(this.origin)),n.push("?cast="),n.push(e(this.name)),n.push('" title="'),n.push(e(this.name)),n.push(" ("),n.push(e(this.role)),n.push(')">\n    <div class="thumb">\n        <img src="'),n.push(e(this.thumbnail)),n.push('" />\n    </div>\n    <div class="meta">\n        <strong>'),n.push(e(this.name)),n.push('</strong>\n        <span title="'),n.push(e(this.role)),n.push('">'),n.push(e(this.role)),n.push('</span>\n    </div>\n</a>\n<ul class="actions">\n    <li class="imdb" title="IMDb search '),n.push(e(this.name)),n.push('"></li>\n    <li class="google" title="Google search '),n.push(e(this.name)),n.push('"></li>\n</ul>\n')}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/category/list/tpl/item.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<a href="#'),n.push(e(this.url)),n.push('">\n    <span>'),n.push(e(this.title)),n.push("</span>\n</a>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/epg/list/tpl/channel.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push("<h3>"),n.push(e(this.channel)),n.push('</h3>\n<ul class="items">\n    <li class="play">'),n.push(e(tr("Play"))),n.push('</li>\n    <li class="record">'),n.push(e(tr("Record"))),n.push("</li>\n</ul>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/epg/list/tpl/programme.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="title">\n    <strong>'),n.push(e(this.label)),n.push('</strong>\n</div>\n<div class="date">\n    '),n.push(e(this.start.toString("h:mmtt").toLowerCase())),n.push(" - "),n.push(e(this.end.toString("h:mmtt").toLowerCase())),n.push(" ("),n.push(e(this.runtime)),n.push("min)<br />\n    "),n.push(e(this.start.toString("dddd, dS MMM"))),n.push('\n</div>\n<div class="plot">'),n.push(e(this.plot)),n.push('</div>\n<div class="entity-progress">\n    <div class="current-progress" style="width: '),n.push(e(this.progresspercentage)),n.push('%" title="'),n.push(e(Math.round(this.progresspercentage))),n.push("% "),n.push(e(tr("complete"))),n.push('"></div>\n</div>\n<ul class="actions">\n    '),this.isactive?(n.push('\n        <li class="play" title="'),n.push(e(tr("Play"))),n.push('"></li>\n        <li class="record" title="'),n.push(e(tr("Record"))),n.push('"></li>\n    ')):(n.push("\n        "),this.wasactive||(n.push('\n            <li class="toggle-timer" title="'),n.push(e(tr("Toggle timer"))),n.push('"></li>\n        ')),n.push("\n    ")),n.push("\n</ul>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/external/youtube/tpl/youtube.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<img src="'),n.push(e(this.thumbnail)),n.push('" class="thumb" />\n<h3>'),n.push(e(this.title)),n.push("</h3>\n"),this.addonEnabled?n.push('\n    <span class="play flat-btn action">Play in Kodi</span>\n    <span class="localplay flat-btn action">Play in browser</span>\n'):n.push('\n    <span class="play flat-btn action">Play in browser</span>\n'),n.push("\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/filter/show/tpl/filter_options.jst"]=function(e){var n=[],i=(e=e||{}).safe,r=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="options-search-wrapper">\n    <input class="options-search" value="" />\n</div>\n<div class="deselect-all">'),n.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}(t.gettext("Deselect all"))),n.push('</div>\n<ul class="selection-list"></ul>\n')}).call(this)}.call(e),e.safe=i,e.escape=r,n.join("")},window.JST["apps/filter/show/tpl/filters_bar.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<span class="filters-active-all">'),e.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}(this.filters)),e.push('</span><i class="remove"></i>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/filter/show/tpl/filters_ui.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="filters-container">\n\n    <div class="filters-current filter-pane">\n        <div class="nav-section"></div>\n\n        <h3 class="open-filters">'),i.push(n(t.gettext("Filters"))),i.push('<i></i></h3>\n        <div class="filters-active"></div>\n\n        <h3>'),i.push(n(t.gettext("Sort"))),i.push('</h3>\n        <div class="list sort-options"></div>\n    </div>\n\n    <div class="filters-page filter-pane">\n        <h3 class="close-filters">'),i.push(n(t.gettext("Select a filter"))),i.push('</h3>\n        <div class="list filters-list"></div>\n    </div>\n\n    <div class="filters-options filter-pane">\n        <h3 class="close-options">'),i.push(n(t.gettext("Select an option"))),i.push('</h3>\n        <div class="list filter-options-list"></div>\n    </div>\n\n</div>\n')}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/filter/show/tpl/list_item.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push(this.title),e.push("\n")}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/help/overview/tpl/overview.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push("<h1>"),n.push(e(tr("About Chorus"))),n.push("</h1>\n<h2>"),n.push(e(tr("Status report"))),n.push('</h2>\n<div class="help--overview--report">\n    <ul>\n\t<li class="report-chorus-version"><strong>Chorus '),n.push(e(tr("version"))),n.push('</strong><span></span></li>\n\t<li class="report-kodi-version"><strong>Kodi '),n.push(e(tr("version"))),n.push('</strong><span></span></li>\n\t<li class="report-websockets"><strong>'),n.push(e(tr("Remote control"))),n.push('</strong><span></span></li>\n\t<li class="report-local-audio"><strong>'),n.push(e(tr("Local audio"))),n.push('</strong><span></span></li>\n    </ul>\n</div>\n<div class="help--overview--header"></div>\n')}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/input/remote/tpl/remote_control.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div id="remote-background" class="close-remote"></div>\n<div class="remote kodi-remote">\n    <div class="toggle-visibility"></div>\n    <div class="playing-area">\n\n    </div>\n    <div class="main-controls">\n        <div class="direction">\n            <div class="pad">\n                <div class="ibut mdi-hardware-keyboard-arrow-left left input-button" data-type="Left"></div>\n                <div class="ibut mdi-hardware-keyboard-arrow-up up input-button" data-type="Up"></div>\n                <div class="ibut mdi-hardware-keyboard-arrow-down down input-button" data-type="Down"></div>\n                <div class="ibut mdi-hardware-keyboard-arrow-right right input-button" data-type="Right"></div>\n                <div class="ibut mdi-image-brightness-1 ok input-button" data-type="Select"></div>\n            </div>\n        </div>\n        <div class="buttons">\n            <div class="ibut mdi-action-settings-power power-button"></div>\n            <div class="ibut mdi-navigation-more-vert input-button" data-type="ContextMenu"></div>\n            <div class="ibut mdi-action-info info-button" data-type="Info"></div>\n        </div>\n    </div>\n    <div class="secondary-controls">\n        <div class="ibut mdi-hardware-keyboard-return input-button" data-type="Back"></div>\n        <div class="ibut mdi-av-stop player-button" data-type="Stop"></div>\n        <div class="ibut mdi-maps-store-mall-directory input-button" data-type="Home"></div>\n    </div>\n\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/input/remote/tpl/system.jst"]=function(t){function r(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?n(t):""}var s=[],e=(t=t||{}).safe,n=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},n=n||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var t,e,n,i;for(s.push('<ul class="system-menu__options options">\n    '),e=0,n=(i=this.actions).length;e<n;e++)t=i[e],s.push('\n        <li data-action="'),s.push(r(t.id)),s.push('">'),s.push(r(t.title)),s.push("</li>\n    ");s.push("\n</ul>\n")}).call(this)}.call(t),t.safe=e,t.escape=n,s.join("")},window.JST["apps/lab/apiBrowser/tpl/api_browser_landing.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="api-browser--landing page">\n    <h2>'),i.push(n(t.gettext("Kodi API browser"))),i.push('</h2>\n    <h4><a href="#lab">'),i.push(n(t.gettext("Chorus lab"))),i.push('</a></h4>\n    <div class="api-browser--content">\n        <p>'),i.push(n(t.gettext("This is a tool to test out the api. Select a method then execute it with parameters."))),i.push('</p>\n        <br />\n        <div class="alert alert-dismissable alert-warning">\n            <button type="button" class="close" data-dismiss="alert">×</button>\n            <h4>'),i.push(n(t.gettext("Warning"))),i.push("</h4>\n            <p>"),i.push(n(t.gettext("You could potentially damage your system with this and there are no sanity checks. Use at own risk."))),i.push("<br /></p>\n        </div>\n    </div>\n</div>\n")}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/lab/apiBrowser/tpl/api_method_item.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="api-method--item">\n    <h4 class="method">'),n.push(e(this.method)),n.push('</h4>\n    <p class="description">'),n.push(e(this.description)),n.push("</p>\n</div>\n\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/lab/apiBrowser/tpl/api_method_list.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="api-methods--list">\n    <p class="search-box"><input type="text" id="api-search" class="api-methods--search" /></p>\n    <ul class="items"></ul>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/lab/apiBrowser/tpl/api_method_page.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('\n<div class="api-method--info page">\n    <h2 class="method"><a href="http://kodi.wiki/view/JSON-RPC_API/v6#'),n.push(e(this.method)),n.push('" target="_blank">'),n.push(e(this.method)),n.push('</a></h2>\n    <p class="description">'),n.push(e(this.description)),n.push("</p>\n\n</div>\n\n"),"method"===this.type&&(n.push('\n    <div class="api-method--execute">\n        <h3>Execute <strong>'),n.push(e(this.method)),n.push('</strong> with these params:</h3>\n            <textarea class="api-method--params" placeholder=\'Eg. ["arg", "foo", true]\'></textarea>\n            <p class="description">Parameters get parsed by\n                <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse" target="_blank">JSON.parse</a>.\n                Check the console for response objects, you will get an \'unexpected token\' error if parsing failed.\n                Params should be an array \'[]\' matching below \'Method params\'. Only use double quotes for strings/keys.\n            </p>\n            <p class="description">\n                Pass params as array Eg. [true] or [255, ["born", "formed", "thumbnail"]] or [] or [255]. Brackets required.<br />\n                Pass params as object Eg. {songid: 255} or {songid: 255, fields: ["born", "formed", "thumbnail"]}. Braces required.<br />\n            </p>\n        <p><button class="btn btn-primary" id="send-command">Send Command</button></p>\n\n    </div>\n')),n.push('\n\n<div class="api-method--result" id="api-result"></div>\n\n<h3>'),"method"===this.type&&n.push("Method "),n.push('Params</h3>\n<div class="api-method--params"></div>\n\n'),"method"===this.type&&n.push('\n    <hr />\n    <h3>Method Returns</h3>\n    <div class="api-method--return"></div>\n'),n.push("\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/lab/iconBrowser/tpl/icon_browser_page.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<h3>Material Icons</h3>\n<ul id="icons-material"></ul>\n\n<h3>Custom Icons</h3>\n<ul id="icons-custom"></ul>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/lab/lab/tpl/lab_item.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<a class="lab-item" href="#'),n.push(e(this.path)),n.push('">\n    <h4>'),n.push(e(this.title)),n.push("</h4>\n    <p>"),n.push(e(this.description)),n.push("</p>\n</a>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/landing/show/tpl/landing_page.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<a id="landing-hero"></a>\n<div class="landing-sections">\n    <div id="landing-section-1"></div>\n    <div id="landing-section-2"></div>\n    <div id="landing-section-3"></div>\n    <div id="landing-section-4"></div>\n    <div id="landing-section-5"></div>\n    <div id="landing-section-6"></div>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/loading/show/tpl/loading_page.jst"]=function(e){var n=[],i=(e=e||{}).safe,r=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div id="loading-page">\n    <div class="spinner-double-section-far"></div>\n    <h2>'),n.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}(t.gettext("Just a sec..."))),n.push("</h2>\n</div>\n\n")}).call(this)}.call(e),e.safe=i,e.escape=r,n.join("")},window.JST["apps/localPlaylist/list/tpl/playlist.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<span class="item">\n    '),this.path?(n.push('\n        <a href="#'),n.push(e(this.path)),n.push('"'),this.active&&n.push(' class="active"'),n.push(">\n            "),n.push(e(this.title)),n.push("\n        </a>\n    ")):(n.push("\n        "),n.push(e(this.title)),n.push("\n    ")),n.push("\n</span>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/localPlaylist/list/tpl/playlist_layout.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="local-playlist-header">\n    <h2></h2>\n    <div class="dropdown">\n        <i data-toggle="dropdown"></i>\n        <ul class="dropdown-menu">\n            <li class="play">'),i.push(n(tr("Play in Kodi"))),i.push('</li>\n            <li class="localplay">'),i.push(n(tr("Play in browser"))),i.push('</li>\n            <li class="export">'),i.push(n(tr("Export list"))),i.push('</li>\n            <div class="divider"></div>\n            <li class="rename">'),i.push(n(tr("Rename playlist"))),i.push('</li>\n            <li class="clear">'),i.push(n(tr("Clear playlist"))),i.push('</li>\n            <li class="delete">'),i.push(n(tr("Delete playlist"))),i.push('</li>\n        </ul>\n    </div>\n</div>\n<div class="item-container">\n    <div class="empty-content">'),i.push(n(t.gettext("Empty playlist, you should probably add something to it?"))),i.push("</div>\n</div>\n")}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/localPlaylist/list/tpl/playlist_list.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<h3></h3>\n<ul class="lists options"></ul>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/localPlaylist/list/tpl/playlist_sidebar_layout.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="current-lists"></div>\n<div class="new-list">'),e.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}(tr("New playlist"))),e.push("</div>\n")}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/movie/show/tpl/content.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="section-content">\n    <h2>'),i.push(n(t.gettext("Synopsis"))),i.push("</h2>\n    "),this.mediaTrailer&&"youtube"===this.mediaTrailer.source&&(i.push('\n        <div class="trailer '),i.push(n(this.mediaTrailer.source)),i.push('">\n            <img src="'),i.push(this.mediaTrailer.img),i.push('" />\n        </div>\n    ')),i.push("\n    <p>"),i.push(n(this.plot)),i.push('</p>\n    <ul class="inline-links">\n        <li>'),i.push(helpers.url.imdbUrl(this.imdbnumber,"View on IMDb")),i.push("</li>\n    </ul>\n</div>\n\n"),0<this.cast.length&&(i.push('\n    <div class="section-content">\n        <h2>'),i.push(n(t.gettext("Full cast"))),i.push('</h2>\n        <div class="region-cast"></div>\n    </div>\n')),i.push('\n\n<div class="region-more-1"></div>\n<div class="region-more-2"></div>\n<div class="region-more-3"></div>\n<div class="region-more-4"></div>\n<div class="region-more-5"></div>\n')}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/movie/show/tpl/details_meta.jst"]=function(e){function s(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}var o=[],n=(e=e||{}).safe,i=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,n,i,r;if(o.push('<div class="region-details-top">\n    <div class="region-details-title">\n        <h2><span class="title">'),o.push(s(this.label)),o.push('</span> <span class="sub"><a href="#movies?year='),o.push(s(this.year)),o.push('">'),o.push(s(this.year)),o.push('</a></span></h2>\n    </div>\n    <div class="region-details-rating">\n        '),o.push(s(this.rating)),o.push(' <i></i>\n    </div>\n</div>\n\n<div class="region-details-meta-below">\n\n    <div class="region-details-subtext">\n        <div class="runtime">\n            '),o.push(s(helpers.global.formatTime(helpers.global.secToTime(this.runtime)))),o.push('\n        </div>\n    </div>\n\n    <div class="tagline">'),o.push(s(this.plotoutline)),o.push('</div>\n\n    <ul class="meta">\n        '),0<this.genre.length&&(o.push("\n            <li><label>"),o.push(s(t.gettext("genre"))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("movies","genre",this.genre)),o.push("</span></li>\n        ")),o.push("\n        "),0<this.director.length&&(o.push("\n            <li><label>"),o.push(s(t.ngettext("Director","Directors",this.director.length))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("movies","director",this.director)),o.push("</span></li>\n        ")),o.push("\n        "),0<this.writer.length&&(o.push("\n            <li><label>"),o.push(s(t.ngettext("Writer","Writers",this.writer.length))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("movies","writer",this.writer)),o.push("</span></li>\n        ")),o.push("\n        "),0<this.cast.length&&(o.push("\n            <li><label>"),o.push(s(t.gettext("Cast"))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("movies","cast",_.pluck(this.cast,"name"))),o.push("</span></li>\n        ")),o.push("\n        "),this.mpaa&&(o.push("\n            <li><label>"),o.push(s(t.gettext("rated"))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("movies","mpaa",[this.mpaa])),o.push("</span></li>\n        ")),o.push('\n    </ul>\n\n    <ul class="streams">\n        '),0<this.streamdetails.video.length&&(o.push("\n            <li><label>"),o.push(s(t.gettext("Video"))),o.push(":</label> <span>"),o.push(s(_.pluck(this.streamdetails.video,"label").join(", "))),o.push("</span></li>\n        ")),o.push("\n        "),0<this.streamdetails.audio.length&&(o.push("\n            <li><label>"),o.push(s(t.gettext("Audio"))),o.push(":</label> <span>"),o.push(s(_.pluck(this.streamdetails.audio,"label").join(", "))),o.push("</span></li>\n        ")),o.push("\n        "),0<this.streamdetails.subtitle.length&&""!==this.streamdetails.subtitle[0].label){for(o.push("\n            <li><label>"),o.push(s(t.ngettext("Subtitle","Subtitles",this.streamdetails.subtitle.length))),o.push(':</label>\n                <span class="dropdown"><span data-toggle="dropdown">'),o.push(s(_.pluck(this.streamdetails.subtitle,"label").join(", "))),o.push('</span>\n                <ul class="dropdown-menu">\n                    '),n=0,i=(r=this.streamdetails.subtitle).length;n<i;n++)e=r[n],o.push("\n                        <li>"),o.push(s(e.label)),o.push("</li>\n                    ");o.push("\n                </ul>\n                </span>\n            </li>\n        ")}o.push('\n    </ul>\n\n    <ul class="inline-links">\n        <li class="btn-flat-play play">'),o.push(s(t.gettext("Play"))),o.push('</li>\n        <li class="btn-flat-add add">'),o.push(s(tr("Queue"))),o.push('</li>\n        <li class="btn-flat-stream stream">'),o.push(s(t.gettext("Stream"))),o.push('</li>\n        <li class="btn-flat-watched watched">\n            '),o.push(s(t.gettext("set"))),o.push(' <span class="action-watched">'),o.push(s(t.gettext("watched"))),o.push('</span><span class="action-unwatched">'),o.push(s(t.gettext("unwatched"))),o.push('</span>\n        </li>\n        <li class="more-actions dropdown">\n            <span class="btn-flat-more" data-toggle="dropdown" aria-expanded="true">'),o.push(s(tr("more"))),o.push('</span>\n            <ul class="dropdown-menu pull-right">\n                <li class="download">'),o.push(s(tr("Download"))),o.push('</li>\n                <li class="divider"></li>\n                <li class="dropdown-submenu internal-search">'),o.push(s(tr("Chorus Search"))),o.push('\n                    <ul class="dropdown-menu">\n                        '),o.push(helpers.entities.getAddonSearchMenuItems(this.label)),o.push('\n                    </ul>\n                </li>\n                <li class="dropdown-submenu external-search">'),o.push(s(tr("External Search"))),o.push('\n                    <ul class="dropdown-menu">\n                        <li data-type="google" data-query="'),o.push(s(this.label)),o.push('">Google</li>\n                        <li data-type="imdb" data-query="'),o.push(s(this.label)),o.push('">IMDb</li>\n                        <li data-type="tmdb" data-query="'),o.push(s(this.label)),o.push('">TVDb</li>\n                    </ul>\n                </li>\n                <li class="youtube-search" data-query="'),o.push(s(this.label)),o.push('">'),o.push(s(tr("YouTube Search"))),o.push('</li>\n                <li class="divider"></li>\n                <li class="refresh">'),o.push(s(tr("Refresh"))),o.push('</li>\n                <li class="edit">'),o.push(s(tr("Edit"))),o.push("</li>\n            </ul>\n        </li>\n    </ul>\n</div>\n")}).call(this)}.call(e),e.safe=n,e.escape=i,o.join("")},window.JST["apps/movie/show/tpl/set.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="section-content">\n    <div class="set-collection">\n        <h2 class="set-name"></h2>\n        <div class="collection-items"></div>\n    </div>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/musicvideo/show/tpl/details_meta.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="region-details-top">\n    <div class="region-details-title">\n        <h2><span class="title">'),i.push(n(this.label)),i.push("</span></h2>\n    </div>\n    "),this.rating&&(i.push('\n        <div class="region-details-rating">\n            '),i.push(n(this.rating)),i.push(" <i></i>\n        </div>\n    ")),i.push('\n</div>\n\n<div class="region-details-meta-below">\n\n    <ul class="meta">\n        '),this.artist&&(i.push("\n            <li><label>"),i.push(n(tr("artist"))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/videos","artist",[this.artist])),i.push("</span></li>\n        ")),i.push("\n        "),this.album&&(i.push("\n            <li><label>"),i.push(n(tr("album"))),i.push(':</label> <span><a href="#music/videos?album='),i.push(n(this.album)),i.push('">'),i.push(n(this.album)),i.push("</a></span></li>\n        ")),i.push("\n        "),0<this.genre.length&&(i.push("\n            <li><label>"),i.push(n(t.ngettext("genre","genres",this.genre.length))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/videos","genre",this.genre)),i.push("</span></li>\n        ")),i.push("\n        "),0<this.director.length&&(i.push("\n            <li><label>"),i.push(n(t.ngettext("Director","Directors",this.director.length))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/videos","director",this.director)),i.push("</span></li>\n        ")),i.push("\n        "),0<this.studio.length&&(i.push("\n            <li><label>"),i.push(n(t.ngettext("Studio","Studios",this.studio.length))),i.push(":</label> <span>"),i.push(helpers.url.filterLinks("music/videos","studio",this.studio)),i.push("</span></li>\n        ")),i.push('\n    </ul>\n\n    <div class="description">'),i.push(n(this.plot)),i.push('</div>\n\n    <ul class="inline-links">\n        <li class="btn-flat-play play">'),i.push(n(tr("Play"))),i.push('</li>\n        <li class="btn-flat-add add">'),i.push(n(tr("Queue"))),i.push('</li>\n        <li class="btn-flat-stream localplay">'),i.push(n(tr("Stream"))),i.push('</li>\n        <li class="more-actions dropdown">\n            <span class="btn-flat-more" data-toggle="dropdown" aria-expanded="true">'),i.push(n(tr("more"))),i.push('</span>\n            <ul class="dropdown-menu pull-right">\n                <li class="download">'),i.push(n(tr("Download"))),i.push('</li>\n                <li class="divider"></li>\n                <li class="dropdown-submenu internal-search">'),i.push(n(tr("Chorus Search"))),i.push('\n                    <ul class="dropdown-menu">\n                        '),i.push(helpers.entities.getAddonSearchMenuItems(this.title)),i.push('\n                    </ul>\n                </li>\n                <li class="dropdown-submenu external-search">'),i.push(n(tr("External Search"))),i.push('\n                    <ul class="dropdown-menu">\n                        <li data-type="google" data-query="'),i.push(n(this.title)),i.push(" "),i.push(n(this.artist)),i.push('">Google</li>\n                    </ul>\n                </li>\n                <li class="youtube-search" data-query="'),i.push(n(this.title)),i.push(" "),i.push(n(this.artist)),i.push('">'),i.push(n(tr("YouTube Search"))),i.push('</li>\n                <li class="divider"></li>\n                <li class="edit">'),i.push(n(tr("Edit"))),i.push("</li>\n            </ul>\n        </li>\n    </ul>\n\n</div>\n")}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/navMain/show/tpl/navMain.jst"]=function(t){function l(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?n(t):""}var u=[],e=(t=t||{}).safe,n=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},n=n||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var t,e,n,i,r,s,o,a;for(u.push('<div id="nav-header"></div>\n<nav>\n    <ul>\n        '),n=0,r=(o=this.items).length;n<r;n++)if("undefined"!==(e=o[n]).path&&0===e.parent){if(u.push('\n            <li class="'),u.push(l(e.class)),u.push('">\n                <a href="#'),u.push(l(e.path)),u.push('">\n                    <i class="'),u.push(l(e.icon)),u.push('"></i>\n                    <span>'),u.push(l(e.title)),u.push("</span>\n                </a>\n\n                "),0!==e.children.length){for(u.push("\n                <ul>\n                    "),i=0,s=(a=e.children).length;i<s;i++)"undefined"!==(t=a[i]).path&&(u.push('\n                      <li><a href="#'),u.push(l(t.path)),u.push('">'),u.push(l(t.title)),u.push("</a></li>\n                    "));u.push("\n                </ul>\n                ")}u.push("\n            </li>\n        ")}u.push("\n    </ul>\n</nav>\n")}).call(this)}.call(t),t.safe=e,t.escape=n,u.join("")},window.JST["apps/navMain/show/tpl/nav_item.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push(this.link),e.push("\n")}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/navMain/show/tpl/nav_sub.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push("<h3>"),e.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}(this.title)),e.push('</h3>\n<ul class="items"></ul>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/player/show/tpl/player.jst"]=function(e){var n=[],i=(e=e||{}).safe,r=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="player">\n\n    <div class="controls-primary">\n        <div class="controls-primary-buttons">\n            <div class="control control-prev"></div>\n            <div class="control control-play"></div>\n            <div class="control control-next"></div>\n        </div>\n    </div>\n\n    <div class="controls-secondary">\n        <div class="volume slider-bar"></div>\n        <div class="controls-secondary-buttons">\n            <div class="control control-mute"></div>\n            <div class="control control-repeat"></div>\n            <div class="control control-shuffle"></div>\n            <div class="control control-menu"></div>\n        </div>\n    </div>\n\n    <div class="now-playing">\n        <div class="playing-thumb thumb">\n            <div class="mdi remote-toggle"></div>\n        </div>\n        <div class="playing-info">\n            <div class="playing-progress slider-bar"></div>\n            <div class="playing-time">\n                <div class="playing-time-current">0</div>\n                <div class="playing-time-duration">0:00</div>\n            </div>\n            <div class="playing-meta">\n                <div class="playing-title">'),n.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}(t.gettext("Nothing playing"))),n.push('</div>\n                <div class="playing-subtitle"></div>\n            </div>\n        </div>\n    </div>\n\n</div>\n')}).call(this)}.call(e),e.safe=i,e.escape=r,n.join("")},window.JST["apps/playlist/list/tpl/playlist_bar.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="playlist-header">\n    <ul class="player-toggle">\n        <li class="kodi">'),i.push(n(t.gettext("Kodi"))),i.push('</li>\n        <li class="local">'),i.push(n(t.gettext("Local"))),i.push('</li>\n    </ul>\n    <div class="playlist-menu dropdown">\n        <i data-toggle="dropdown" class="menu-toggle"></i>\n        <ul class="dropdown-menu pull-right">\n            <li class="dropdown-header">'),i.push(n(t.gettext("Current playlist"))),i.push('</li>\n            <li><a href="#" class="clear-playlist">'),i.push(n(t.gettext("Clear playlist"))),i.push('</a></li>\n            <li><a href="#" class="refresh-playlist">'),i.push(n(t.gettext("Refresh playlist"))),i.push('</a></li>\n            <li><a href="#" class="party-mode">'),i.push(n(t.gettext("Party mode"))),i.push(' <i class="mdi-navigation-check"></i></a></li>\n            <li class="dropdown-header">'),i.push(n(t.gettext("Kodi"))),i.push('</li>\n            <li><a href="#" class="save-playlist">'),i.push(n(t.gettext("Save Kodi playlist"))),i.push('</a></li>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class="playlists-wrapper">\n    <div class="kodi-playlists">\n        <ul class="media-toggle">\n            <li class="audio">'),i.push(n(t.gettext("Audio"))),i.push('</li>\n            <li class="video">'),i.push(n(t.gettext("Video"))),i.push('</li>\n        </ul>\n        <div class="kodi-playlist"></div>\n    </div>\n    <div class="local-playlists">\n        <div class="local-playlist"></div>\n    </div>\n</div>\n')}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/playlist/list/tpl/playlist_item.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="item-inner item-'),n.push(e(this.type)),n.push('">\n    <div class="artwork">\n        <div class="thumb" title="'),n.push(e(this.label)),n.push('" style="background-image: url(\''),n.push(e(this.thumbnail)),n.push('\')">\n            <div class="mdi play"></div>\n            '),this.canThumbsUp&&n.push('\n                <div class="mdi thumbs"></div>\n            '),n.push('\n        </div>\n    </div>\n    <div class="meta">\n        <div class="title"><a href="#'),n.push(e(this.url)),n.push('" title="'),n.push(e(this.label)),n.push('">'),n.push(e(this.label)),n.push("</a></div>\n        "),this.subtitle&&(n.push('\n        <div class="subtitle">'),n.push(e(this.subtitle)),n.push("</div>\n        ")),n.push('\n    </div>\n    <div class="remove"></div>\n</div>\n')}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/playlist/m3u/tpl/list.jst"]=function(t){function r(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?n(t):""}var s=[],e=(t=t||{}).safe,n=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},n=n||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var t,e,n,i;for(s.push("#EXTCPlayListM3U::M3U\n"),e=0,n=(i=this.items).length;e<n;e++)t=i[e],s.push("#EXTINF:"),s.push(r(t.duration)),s.push(","),s.push(r(t.artist.join("/"))),s.push(" - "),s.push(r(t.label)),s.push("\n"),s.push(r(t.file)),s.push("\n");s.push("\n")}).call(this)}.call(t),t.safe=e,t.escape=n,s.join("")},window.JST["apps/playlist/show/tpl/landing.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="playlist-page playlist-page__empty set-page">\n    <h3>'),i.push(n(t.gettext("Now playing - Playlists"))),i.push("</h3>\n    <p>"),i.push(n(t.gettext("Switch between Kodi and local playback via the tabs. You can toggle visibility with the arrow in the top right"))),i.push("</p>\n</div>\n")}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/pvr/recordingList/tpl/recording.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="title">\n    <strong>'),i.push(n(this.label)),i.push("</strong> <span>- "),i.push(n(this.channel)),i.push('</span>\n</div>\n<div class="date">\n    '),i.push(n(this.start.toString("h:mmtt").toLowerCase())),i.push(" -\n    "),"1970"!==this.end.toString("yyyy")?(i.push("\n        "),i.push(n(this.end.toString("h:mmtt").toLowerCase())),i.push("\n        ("),i.push(n(helpers.global.formatTime(helpers.global.secToTime(this.runtime)))),i.push(")\n    ")):(i.push("\n        "),i.push(n(tr("Now"))),i.push("\n    ")),i.push("\n\n    <br />"),i.push(n(this.start.toString("dddd, dS MMM"))),i.push('\n</div>\n<div class="plot">'),i.push(n(this.plot)),i.push('</div>\n<div class="entity-progress">\n    <div class="current-progress" style="width: '),i.push(n(this.progress)),i.push('%" title="'),i.push(n(this.progress)),i.push("% "),i.push(n(t.gettext("complete"))),i.push('"></div>\n</div>\n<ul class="actions">\n    <li class="play"></li>\n</ul>\n')}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/search/list/tpl/search_layout.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="search-inner">\n    <div class="entity-set entity-set-movie"></div>\n    <div class="entity-set entity-set-tvshow"></div>\n    <div class="entity-set entity-set-artist"></div>\n    <div class="entity-set entity-set-album"></div>\n    <div class="entity-set entity-set-song"></div>\n    <div class="entity-set entity-set-musicvideo"></div>\n    <div class="entity-set entity-set-loading"></div>\n    <div class="entity-set entity-set-addons"></div>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/search/list/tpl/search_sidebar.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="sidebar-section sidebar-section-media">\n    <h3>Local media</h3>\n    <ul class="search-media-links"></ul>\n</div>\n\n<div class="sidebar-section sidebar-section-addon">\n    <h3>Addons</h3>\n    <ul class="search-addon-links"></ul>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/search/show/tpl/landing.jst"]=function(e){var n=[],i=(e=e||{}).safe,r=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="search-page search-page__empty set-page">\n    <h3>'),n.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}(t.gettext("Enter your search above"))),n.push("</h3>\n</div>\n")}).call(this)}.call(e),e.safe=i,e.escape=r,n.join("")},window.JST["apps/settings/show/tpl/settings_sidebar.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="settings-sidebar">\n    <div class="settings-sidebar--section local-nav nav-sub"></div>\n    <div class="settings-sidebar--section kodi-nav"></div>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/shell/show/tpl/homepage.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div id="homepage"></div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/shell/show/tpl/shell.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div id="shell">\n\n    <a id="logo" href="#"></a>\n\n    <div id="nav-bar"></div>\n\n    <div id="header">\n\n        <h1 id="page-title">\n            <span class="context"></span>\n            <span class="title"></span>\n        </h1>\n\n        <ul class="mobile-menu">\n            <li><a href="#remote" class="mobile-menu--link__remote remote-toggle"><i></i></a></li>\n            <li><a href="#search" class="mobile-menu--link__search"><i></i></a></li>\n            <li><a href="#playlist" class="mobile-menu--link__playlist"><i></i></a></li>\n        </ul>\n\n        <div id="selected-region">\n            <div class="selected-text">\n                <span id="selected-count"></span>\n            </div>\n            <i data-toggle="dropdown" class="menu-toggle"></i>\n            <ul class="dropdown-menu pull-right">\n                <li class="selected-play">'),i.push(n(tr("Play in Kodi"))),i.push('</li>\n                <li class="selected-add">'),i.push(n(tr("Queue in Kodi"))),i.push('</li>\n                <li class="selected-localadd">'),i.push(n(tr("Add to playlist"))),i.push('</li>\n            </ul>\n        </div>\n\n        <div id="search-region">\n            <input id="search" title="Search">\n            <span id="do-search"></span>\n        </div>\n\n    </div>\n\n    <div id="main">\n\n        <div id="sidebar-one"></div>\n\n        <div id="content">'),i.push(n(tr("Loading things..."))),i.push('</div>\n\n    </div>\n\n    <div id="sidebar-two">\n        <div class="playlist-toggle-open"></div>\n        <div id="playlist-summary"></div>\n        <div id="playlist-bar"></div>\n    </div>\n\n    <div id="remote"></div>\n\n    <div id="player-wrapper">\n        <footer id="player-kodi"></footer>\n        <footer id="player-local"></footer>\n    </div>\n\n    <div class="player-menu-wrapper">\n        <ul class="player-menu">\n            <li class="video-scan">'),i.push(n(t.gettext("Scan video library"))),i.push('</li>\n            <li class="audio-scan">'),i.push(n(t.gettext("Scan audio library"))),i.push('</li>\n            <li class="send-input">'),i.push(n(t.gettext("Send text to Kodi"))),i.push('</li>\n            <li class="goto-lab">'),i.push(n(t.gettext("The lab"))),i.push('</li>\n            <li class="about">'),i.push(n(t.gettext("About Chorus"))),i.push('</li>\n        </ul>\n    </div>\n\n</div>\n\n<div id="fanart"></div>\n<div id="fanart-overlay"></div>\n\n<div id="snackbar-container"></div>\n\n<div class="modal fade" id="modal-window">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title"></h4>\n            </div>\n            <div class="modal-body"></div>\n            <div class="modal-footer"></div>\n        </div>\n    </div>\n</div>\n\n<div id="disconnected">\n    <div class="message">\n        <i class="mdi-file-cloud-off"></i>\n        <h2>'),i.push(n(tr("Lost connection to Kodi"))),i.push('</h2>\n        <p class="try-connect"><button class="reconnect btn btn-primary">'),i.push(n(tr("Attempt to reconnect"))),i.push('</button></p>\n        <p class="load-connect"><span class="loader-small-inline"></span><br />'),i.push(n(tr("Attempting reconnect"))),i.push('</p>\n    </div>\n</div>\n\n<div id="offscreen"></div>\n')}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/song/list/tpl/song.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<td class="cell-first">\n    <div class="thumb" style="background-image: url(\''),n.push(e(this.thumbnail)),n.push('\')">\n    </div>\n    <div class="track">'),n.push(e(this.track)),n.push('</div>\n    <div class="mdi play"></div>\n</td>\n<td class="cell-label song-title"><span class="crop">'),n.push(e(this.label)),n.push('</span></td>\n<td class="cell-label song-album"><a class="crop" href="#music/album/'),n.push(e(this.albumid)),n.push('">'),n.push(e(this.album)),n.push('</a></td>\n<td class="cell-label song-artist"><a class="crop" href="#music/artist/'),n.push(e(this.artistid)),n.push('">'),n.push(e(this.artist)),n.push('</a></td>\n<td class="cell-last">\n    <li class="thumbed-up"></li>\n    <div class="duration">'),n.push(e(this.displayDuration)),n.push('</div>\n    <ul class="actions">\n        <li class="mdi thumbs"></li>\n        <li class="mdi add"></li>\n        <li class="menu dropdown">\n            <i data-toggle="dropdown" class="mdi"></i>\n            <ul class="dropdown-menu pull-right"></ul>\n        </li>\n    </ul>\n</td>\n<td class="cell-remove song-remove">\n    <i class="mdi mdi-navigation-close"></i>\n</td>\n')}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/thumbs/list/tpl/thumbs_layout.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="thumbs-inner">\n    <div class="entity-set entity-set-movie"></div>\n    <div class="entity-set entity-set-tvshow"></div>\n    <div class="entity-set entity-set-episode"></div>\n    <div class="entity-set entity-set-artist"></div>\n    <div class="entity-set entity-set-album"></div>\n    <div class="entity-set entity-set-song"></div>\n    <div class="entity-set entity-set-musicvideo"></div>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/thumbs/list/tpl/thumbs_set.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<h2 class="set-header"></h2>\n<div class="set-results"></div>\n<div class="more"></div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["apps/tvshow/episode/tpl/content.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('\n<div class="section-content">\n    <h2>'),i.push(n(t.gettext("Synopsis"))),i.push("</h2>\n    <p>"),i.push(n(this.plot)),i.push("</p>\n</div>\n\n"),0<this.cast.length&&(i.push('\n    <div class="section-content">\n        <h2>'),i.push(n(tr("Full cast"))),i.push('</h2>\n        <div class="region-cast"></div>\n    </div>\n')),i.push('\n\n<div class="section-content section-full-width">\n    <h2>'),i.push(n(tr("Season"))),i.push(" "),i.push(n(this.season)),i.push('</h2>\n    <div class="region-season"></div>\n</div>\n')}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["apps/tvshow/episode/tpl/details_meta.jst"]=function(e){function s(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}var o=[],n=(e=e||{}).safe,i=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,n,i,r;if(o.push('<div class="region-details-top">\n    '),null!=this.showtitle&&o.push("\n\n    "),o.push('\n    <div class="region-details-title">\n        <h2>\n            <span class="title">'),o.push(s(this.label)),o.push('</span>\n            <span class="sub show-title"><a href="#'),o.push(s(this.url.split("/",2).join("/"))),o.push('">'),o.push(s(this.showtitle)),o.push('</a></span>\n            <span class="sub">S'),o.push(s(this.season)),o.push(" E"),o.push(s(this.episode)),o.push('</span>\n        </h2>\n    </div>\n    <div class="region-details-rating">\n        '),o.push(s(this.rating)),o.push(' <i></i>\n    </div>\n</div>\n<div class="region-details-meta-below">\n\n    <div class="region-details-subtext">\n\n        '),0<this.runtime&&(o.push('\n            <div class="runtime">\n                '),o.push(s(helpers.global.formatTime(helpers.global.secToTime(this.runtime)))),o.push("\n            </div>\n        ")),o.push('\n\n    </div>\n\n    <ul class="meta">\n        <li><label>'),o.push(s(t.gettext("Season"))),o.push(':</label> <span><a href="#tvshow/'),o.push(s(this.tvshowid)),o.push("/"),o.push(s(this.season)),o.push('">'),o.push(s(t.gettext("Season"))),o.push(" "),o.push(s(this.season)),o.push("</a></span></li>\n        "),this.firstaired&&(o.push("\n            <li><label>"),o.push(s(t.gettext("First aired"))),o.push(":</label> <span>"),o.push(s(this.firstaired)),o.push(" </span></li>\n        ")),o.push("\n        "),0<this.director.length&&(o.push("\n            <li><label>"),o.push(s(t.ngettext("Director","Directors",this.director.length))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("tvshows","director",this.director)),o.push("</span></li>\n        ")),o.push("\n        "),0<this.writer.length&&(o.push("\n            <li><label>"),o.push(s(t.ngettext("Writer","Writers",this.writer.length))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("tvshows","writer",this.writer)),o.push("</span></li>\n        ")),o.push("\n        "),0<this.cast.length&&(o.push("\n            <li><label>"),o.push(s(t.gettext("Cast"))),o.push(":</label> <span>"),o.push(helpers.url.filterLinks("tvshows","cast",_.pluck(this.cast,"name"))),o.push("</span></li>\n        ")),o.push('\n    </ul>\n\n    <ul class="streams">\n        '),0<this.streamdetails.video.length&&(o.push("\n            <li><label>"),o.push(s(t.gettext("Video"))),o.push(":</label> <span>"),o.push(s(_.pluck(this.streamdetails.video,"label").join(", "))),o.push("</span></li>\n        ")),o.push("\n        "),0<this.streamdetails.audio.length&&(o.push("\n            <li><label>"),o.push(s(t.gettext("Audio"))),o.push(":</label> <span>"),o.push(s(_.pluck(this.streamdetails.audio,"label").join(", "))),o.push("</span></li>\n        ")),o.push("\n        "),0<this.streamdetails.subtitle.length&&""!==this.streamdetails.subtitle[0].label){for(o.push("\n            <li><label>"),o.push(s(t.ngettext("Subtitle","Subtitles",this.streamdetails.subtitle.length))),o.push(':</label>\n                <span class="dropdown"><span data-toggle="dropdown">'),o.push(s(_.first(_.pluck(this.streamdetails.subtitle,"label")))),o.push('</span>\n                <ul class="dropdown-menu">\n                    '),n=0,i=(r=this.streamdetails.subtitle).length;n<i;n++)e=r[n],o.push("\n                        <li>"),o.push(s(e.label)),o.push("</li>\n                    ");o.push("\n                </ul>\n                </span>\n            </li>\n        ")}o.push('\n    </ul>\n\n    <ul class="inline-links">\n        <li class="btn-flat-play play">'),o.push(s(tr("Play"))),o.push('</li>\n        <li class="btn-flat-add add">'),o.push(s(tr("Queue"))),o.push('</li>\n        <li class="btn-flat-stream stream">'),o.push(s(tr("Stream"))),o.push('</li>\n        <li class="btn-flat-watched watched">\n            '),o.push(s(t.gettext("set"))),o.push(' <span class="action-watched">'),o.push(s(tr("watched"))),o.push('</span><span class="action-unwatched">'),o.push(s(tr("unwatched"))),o.push('</span>\n        </li>\n        <li class="more-actions dropdown">\n            <span class="btn-flat-more" data-toggle="dropdown" aria-expanded="true">'),o.push(s(tr("more"))),o.push('</span>\n            <ul class="dropdown-menu pull-right">\n                <li class="download">'),o.push(s(tr("Download"))),o.push('</li>\n                <li class="divider"></li>\n                <li class="dropdown-submenu internal-search">'),o.push(s(tr("Chorus Search"))),o.push('\n                    <ul class="dropdown-menu">\n                        '),o.push(helpers.entities.getAddonSearchMenuItems(this.showtitle)),o.push('\n                    </ul>\n                </li>\n                <li class="dropdown-submenu external-search">'),o.push(s(tr("External Search"))),o.push('\n                    <ul class="dropdown-menu">\n                        <li data-type="google" data-query="'),o.push(s(this.showtitle)),o.push(" "),o.push(s(this.label)),o.push('">Google</li>\n                        <li data-type="imdb" data-query="'),o.push(s(this.showtitle)),o.push('">IMDb</li>\n                        <li data-type="tvdb" data-query="'),o.push(s(this.showtitle)),o.push('">TVDb</li>\n                        <li data-type="tmdb" data-query="'),o.push(s(this.showtitle)),o.push('">TMDb</li>\n                    </ul>\n                </li>\n                <li class="youtube-search" data-query="'),o.push(s(this.showtitle)),o.push('">'),o.push(s(tr("YouTube Search"))),o.push('</li>\n                <li class="divider"></li>\n                <li class="refresh">'),o.push(s(tr("Refresh"))),o.push('</li>\n                <li class="edit">'),o.push(s(tr("Edit"))),o.push("</li>\n            </ul>\n        </li>\n    </ul>\n</div>\n")}).call(this)}.call(e),e.safe=n,e.escape=i,o.join("")},window.JST["apps/tvshow/season/tpl/details_meta.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="region-details-top">\n    <div class="region-details-title">\n        <h2>\n            <span class="title">'),n.push(e(tr("Season"))),n.push(" "),n.push(e(this.season)),n.push('</span>\n            <span class="sub"><a href="#tvshow/'),n.push(e(this.tvshowid)),n.push('">'),n.push(e(this.label)),n.push('</a></span>\n        </h2>\n    </div>\n    <div class="region-details-rating">\n        '),n.push(e(this.rating)),n.push(' <i></i>\n    </div>\n</div>\n<div class="region-details-meta-below">\n\n    <ul class="meta">\n        '),0<this.genre.length&&(n.push("\n        <li><label>"),n.push(e(tr("genre"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","genre",this.genre)),n.push("</span></li>\n        ")),n.push("\n        "),0<this.cast.length&&(n.push("\n        <li><label>"),n.push(e(tr("cast"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","cast",_.pluck(this.cast,"name"))),n.push("</span></li>\n        ")),n.push("\n        "),0<this.studio.length&&(n.push("\n        <li><label>"),n.push(e(tr("studio"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","studio",this.studio)),n.push("</span></li>\n        ")),n.push("\n        "),this.mpaa&&(n.push("\n        <li><label>"),n.push(e(tr("rated"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","mpaa",[this.mpaa])),n.push("</span></li>\n        ")),n.push("\n        <li><label>"),n.push(e(tr("episodes"))),n.push(':</label> <span><span class="episode-total">'),n.push(e(this.episode)),n.push("</span> "),n.push(e(tr("total"))),n.push(' (<span class="episode-unwatched">'),n.push(e(this.unwatched)),n.push("</span> "),n.push(e(tr("unwatched"))),n.push(')</span></li>\n    </ul>\n\n    <div class="description">'),n.push(e(this.plot)),n.push('</div>\n\n    <ul class="inline-links">\n        <li class="btn-flat-play play">'),n.push(e(tr("Play"))),n.push('</li>\n        <li class="btn-flat-add add">'),n.push(e(tr("Queue"))),n.push('</li>\n        <li class="btn-flat-watched watched">\n            '),n.push(e(tr("set"))),n.push(' <span class="action-watched">'),n.push(e(tr("watched"))),n.push('</span><span class="action-unwatched">'),n.push(e(tr("unwatched"))),n.push("</span>\n        </li>\n    </ul>\n\n</div>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["apps/tvshow/show/tpl/details_meta.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="region-details-top">\n    <div class="region-details-title">\n        <h2><span class="title">'),n.push(e(this.label)),n.push('</span> <span class="sub">'),n.push(e(this.year)),n.push('</span></h2>\n    </div>\n    <div class="region-details-rating">\n        '),n.push(e(this.rating)),n.push(' <i></i>\n    </div>\n</div>\n<div class="region-details-meta-below">\n\n    <ul class="meta">\n        '),0<this.genre.length&&(n.push("\n        <li><label>"),n.push(e(tr("genre"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","genre",this.genre)),n.push("</span></li>\n        ")),n.push("\n        "),0<this.cast.length&&(n.push("\n        <li><label>"),n.push(e(tr("cast"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","cast",_.pluck(this.cast,"name"))),n.push("</span></li>\n        ")),n.push("\n        "),0<this.studio.length&&(n.push("\n        <li><label>"),n.push(e(tr("studio"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","studio",this.studio)),n.push("</span></li>\n        ")),n.push("\n        "),this.mpaa&&(n.push("\n        <li><label>"),n.push(e(tr("rated"))),n.push(":</label> <span>"),n.push(helpers.url.filterLinks("tvshows","mpaa",[this.mpaa])),n.push("</span></li>\n        ")),n.push("\n        <li><label>"),n.push(e(tr("episodes"))),n.push(':</label> <span><span class="episode-total">'),n.push(e(this.episode)),n.push("</span> "),n.push(e(tr("total"))),n.push(' (<span class="episode-unwatched">'),n.push(e(this.unwatched)),n.push("</span> "),n.push(e(tr("unwatched"))),n.push(')</span></li>\n    </ul>\n\n    <div class="description">'),n.push(e(this.plot)),n.push('</div>\n\n    <ul class="inline-links">\n        <li class="btn-flat-play play">'),n.push(e(tr("Play"))),n.push('</li>\n        <li class="btn-flat-add add">'),n.push(e(tr("Queue"))),n.push('</li>\n        <li class="btn-flat-watched watched">\n            '),n.push(e(tr("set"))),n.push(' <span class="action-watched">'),n.push(e(tr("watched"))),n.push('</span><span class="action-unwatched">'),n.push(e(tr("unwatched"))),n.push('</span>\n        </li>\n        <li class="more-actions dropdown">\n            <span class="btn-flat-more" data-toggle="dropdown" aria-expanded="true">'),n.push(e(tr("more"))),n.push('</span>\n            <ul class="dropdown-menu pull-right">\n                <li class="dropdown-submenu internal-search">'),n.push(e(tr("Chorus Search"))),n.push('\n                    <ul class="dropdown-menu">\n                        '),n.push(helpers.entities.getAddonSearchMenuItems(this.label)),n.push('\n                    </ul>\n                </li>\n                <li class="dropdown-submenu external-search">'),n.push(e(tr("External Search"))),n.push('\n                    <ul class="dropdown-menu">\n                        <li data-type="google" data-query="'),n.push(e(this.label)),n.push('">Google</li>\n                        <li data-type="imdb" data-query="'),n.push(e(this.label)),n.push('">IMDb</li>\n                        <li data-type="tvdb" data-query="'),n.push(e(this.label)),n.push('">TVDb</li>\n                        <li data-type="tmdb" data-query="'),n.push(e(this.label)),n.push('">TMDb</li>\n                    </ul>\n                </li>\n                <li class="youtube-search" data-query="'),n.push(e(this.label)),n.push('">'),n.push(e(tr("YouTube Search"))),n.push('</li>\n                <li class="divider"></li>\n                <li class="dropdown-submenu">'),n.push(e(tr("Refresh"))),n.push('\n                    <ul class="dropdown-menu">\n                        <li class="refresh">'),n.push(e(tr("Show only"))),n.push('</li>\n                        <li class="refresh-episodes">'),n.push(e(tr("Show and episodes"))),n.push('</li>\n                    </ul>\n                </li>\n                <li class="edit">'),n.push(e(tr("Edit"))),n.push("</li>\n            </ul>\n        </li>\n    </ul>\n\n</div>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["components/form/tpl/form.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="form-inner">\n  <div class="form-content-region"></div>\n    <footer>\n        <ul class="inline-list">\n            <li>\n                <button type="submit" data-form-button="submit" class="btn btn-primary form-save">Save</button>\n            </li>\n            <li class="response">\n\n            </li>\n        </ul>\n    </footer>\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["components/form/tpl/form_item.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){this.titleHtml&&(e.push('\n    <label class="control-label">'),e.push(this.titleHtml),e.push("</label>\n")),e.push("\n\n"),"markup"===this.type?(e.push("\n    "),e.push(this.element),e.push("\n")):(e.push('\n    <div class="element">\n        '),"checkbox"!==this.type?(e.push("\n            "),e.push(this.element),e.push("\n        ")):(e.push('\n            <div class="togglebutton">\n                <label>'),e.push(this.element),e.push("</label>\n            </div>\n        ")),e.push("\n        "),this.description&&(e.push('\n        <div class="help-block description">'),e.push(this.description),e.push("</div>\n        ")),e.push("\n    </div>\n")),e.push("\n")}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["components/form/tpl/form_item_group.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){this.title&&(n.push('\n    <h3 class="group-title">'),this.icon&&(n.push('<i class="'),n.push(e(this.icon)),n.push('"></i> ')),n.push(e(this.title)),n.push("</h3>\n")),n.push('\n<div class="form-items"></div>\n')}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["components/form/tpl/form_item_imageselect.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="form-imageselect">\n    <ul class="form-imageselect__tabs">\n        <li data-pane="select" class="active">'),n.push(e(tr("Selector"))),n.push('</li>\n        <li data-pane="url">'),n.push(e(tr("URL"))),n.push('</li>\n    </ul>\n    <div class="form-imageselect__panes">\n        <div class="pane active" rel="select">\n            <ul class="form-imageselect__thumbs">\n                '),this.image&&(n.push('\n                    <li data-original="'),n.push(e(this.image.original)),n.push('" class="selected" style="background-image: url(\''),n.push(e(this.image.thumb)),n.push("')\"></li>\n                ")),n.push('\n            </ul>\n            <div class="form-imageselect__loader"><div class="loader-small-inline"></div> <span>'),n.push(e(tr("Searching for more images"))),n.push('</span></div>\n        </div>\n        <div class="pane" rel="url">\n            '),this.title&&(n.push('\n            <label class="control-label">'),n.push(e(this.title)),n.push("</label>\n            ")),n.push('\n            <div class="form-imageselect__url">\n                '),n.push(this.element),n.push("\n            </div>\n            "),this.description&&(n.push('\n                <div class="help-block description">'),n.push(this.description),n.push("</div>\n            ")),n.push("\n        </div>\n    </div>\n</div>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["views/card/tpl/card.jst"]=function(e){function r(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}var s=[],n=(e=e||{}).safe,i=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,n,i;if(s.push('<div class="card-'),s.push(r(this.type)),s.push('">\n    <div class="artwork">\n        <a href="#'),s.push(r(this.url)),s.push('" class="thumb" title="'),s.push(r(helpers.global.stripTags(this.labelHtml))),s.push('" style="background-image: url(\''),s.push(r(this.thumbnail)),s.push('\')"></a>\n        <div class="mdi play" title="'),s.push(r(tr("Play"))),s.push('"></div>\n        '),"channeltv"!==this.type&&"channelradio"!==this.type||s.push('\n          <div class="mdi record"></div>\n        '),s.push('\n    </div>\n    <div class="meta">\n        <div class="title"><a href="#'),s.push(r(this.url)),s.push('" title="'),s.push(r(helpers.global.stripTags(this.labelHtml))),s.push('">'),s.push(this.labelHtml),s.push("</a></div>\n        "),this.subtitleHtml&&(s.push('\n            <div class="subtitle">'),s.push(this.subtitleHtml),s.push("</div>\n        ")),s.push("\n    </div>\n    "),this.actions){for(e in s.push('\n        <ul class="actions">\n            '),i=this.actions)n=i[e],s.push('<li class="mdi '),s.push(r(e)),s.push('" title="'),s.push(r(n)),s.push('"></li>');s.push("\n        </ul>\n    ")}s.push("\n    "),this.menu&&s.push('\n        <div class="dropdown">\n            <i data-toggle="dropdown" class="mdi"></i>\n            <ul class="dropdown-menu"></ul>\n        </div>\n    '),s.push("\n    "),this.progress=null!=this.progress?this.progress:0,s.push('\n    <div class="entity-progress"><div class="current-progress" style="width: '),s.push(r(this.progress)),s.push('%" title="'),s.push(r(this.progress)),s.push("% "),s.push(r(t.gettext("complete"))),s.push('"></div></div>\n</div>\n')}).call(this)}.call(e),e.safe=n,e.escape=i,s.join("")},window.JST["views/card/tpl/card_placeholder.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push("<i></i>\n")}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["views/empty/tpl/empty_page.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="empty--page">\n    '),this.title&&(n.push('\n        <h2 class="empty--page-title">'),n.push(e(title)),n.push("</h2>\n    ")),n.push("\n\n    "),this.content&&(n.push('\n        <div class="empty--page-content">'),n.push(e(this.content)),n.push("</div>\n    ")),n.push("\n</div>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["views/empty/tpl/empty_results.jst"]=function(e){var n=[],i=(e=e||{}).safe,r=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="empty-result">\n    <h2>'),n.push(t.sprintf(tr("No %1$s found"),'<span class="empty-key">'+tr("results")+"</span>")),n.push('</h2>\n    <div class="empty-actions">\n        <div class="back-link"></div>\n    </div>\n</div>\n')}).call(this)}.call(e),e.safe=i,e.escape=r,n.join("")},window.JST["views/layouts/tpl/layout_details_header.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="layout-container details-header">\n\n    <div class="region-details-side"></div>\n\n    <div class="region-details-meta-wrapper"><div class="region-details-meta">\n\n        <div class="region-details-title"><span class="title"></span> <span class="sub"></span></div>\n\n        <div class="region-details-meta-below">\n            <div class="region-details-subtext"></div>\n            <div class="description"></div>\n        </div>\n\n    </div></div>\n\n    '),this.fanart&&(e.push('\n        <div class="region-details-fanart" style="background-image: url(\''),e.push(function(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""}(this.fanart)),e.push('\')"><div class="gradient"></div></div>\n    ')),e.push("\n</div>\n")}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["views/layouts/tpl/layout_with_header.jst"]=function(e){function n(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?s(t):""}var i=[],r=(e=e||{}).safe,s=e.escape;return e.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},s=s||(e.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){i.push('<div class="layout-container with-header">\n\n    <header class="region-header"></header>\n\n    <div class="region-content-wrapper">\n        <div class="entity-progress"><div class="current-progress" style="width: '),i.push(n(this.progress)),i.push('%" title="'),i.push(n(this.progress)),i.push("% "),i.push(n(t.gettext("complete"))),i.push('"></div></div>\n        <section class="region-content"></section>\n    </div>\n\n</div>\n')}).call(this)}.call(e),e.safe=r,e.escape=s,i.join("")},window.JST["views/layouts/tpl/layout_with_sidebar_first.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<div class="layout-container with-sidebar-first">\n\n    <div class="region-first-toggle"></div>\n    <section class="region-first">\n        <div class="region-first-primary"></div>\n        <div class="region-first-secondary"></div>\n    </section>\n\n    <section class="region-content-wrapper">\n        <div class="region-content-top"></div>\n        <div class="region-content"></div>\n    </section>\n\n</div>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")},window.JST["views/set/tpl/set.jst"]=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?r(t):""}var n=[],i=(t=t||{}).safe,r=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},r=r||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){n.push('<div class="set">\n    '),this.title&&(n.push('\n        <div class="set__header">\n            <h2 class="set__title">'),n.push(e(this.title)),n.push('</h2>\n            <div class="set__actions">\n                '),this.menu&&n.push('\n                <div class="dropdown">\n                    <i data-toggle="dropdown" class="mdi"></i>\n                    <ul class="dropdown-menu pull-right"></ul>\n                </div>\n                '),n.push("\n            </div>\n        </div>\n    ")),n.push('\n    <div class="set__items">\n        <'),n.push(e(this.childViewTag)),n.push(' class="set__collection '),n.push(e(this.childViewClass)),n.push('"></'),n.push(e(this.childViewTag)),n.push(">\n    </div>\n    "),this.more&&(n.push('\n        <div class="set__more">'),n.push(this.more),n.push("</div>\n    ")),n.push("\n</div>\n")}).call(this)}.call(t),t.safe=i,t.escape=r,n.join("")},window.JST["views/song/tpl/song_placeholder.jst"]=function(t){var e=[],n=(t=t||{}).safe,i=t.escape;return t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");var e=new String(t);return e.ecoSafe=!0,e},i=i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){e.push('<td colspan="6"><i></i></td>\n')}).call(this)}.call(t),t.safe=n,t.escape=i,e.join("")};;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
//# Our global objects
this.helpers = {};
this.config = {
  static: {
    appTitle: 'Kodi',
    jsonRpcEndpoint: 'jsonrpc',
    socketsHost: location.hostname,
    socketsPort: 9090,
    ajaxTimeout: 5000,
    connected: true,
    hashKey: 'kodi',
    defaultPlayer: 'auto',
    ignoreArticle: true,
    pollInterval: 10000,
    reverseProxy: false,
    albumArtistsOnly: true,
    searchIndexCacheExpiry: (24 * 60 * 60), // 1 day
    collectionCacheExpiry: (7 * 24 * 60 * 60), // 1 week (gets wiped on library update)
    addOnsLoaded: false,
    vibrantHeaders: false,
    lang: "en",
    kodiSettingsLevel: 'standard',
    playlistFocusPlaying: true,
    keyboardControl: 'kodi',
    disableThumbs: false,
    showDeviceName: false,
    refreshIgnoreNFO: true,
    largeBreakpoint: 910,
    apiKeyTMDB: '',
    apiKeyTVDB: '',
    apiKeyFanartTv: '',
    apiKeyYouTube: ''
  }
};

//# The App Instance
this.Kodi = (function(Backbone, Marionette) {

  const App = new Backbone.Marionette.Application();

  App.addRegions({
    root: "body"});

  //# Load custom config settings.
  App.on("before:start", () => config.static = _.extend(config.static, config.get('app', 'config:local', config.static)));

  App.vent.on("shell:ready", options => {
    return App.startHistory();
  });

  return App;
})(Backbone, Marionette);

$(document).ready(() => {
  // Initialise language support
  return helpers.translate.init(function() {
    // Start the app
    Kodi.start();
    // Start material
    $.material.init();
    // Bind to scroll/resize for redraw trigger
    return helpers.ui.bindOnScrollResize();
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Helper to return you to the same scroll position on the last page.
*/
helpers.backscroll = {
  lastPath: '',
  lastScroll: 0,

  setLast() {
    this.lastPath = location.hash;
    return this.lastScroll = document.body.scrollTop;
  },

  scrollToLast() {
    const scrollPos = this.lastPath === location.hash ? this.lastScroll : 0;
    if (scrollPos > 0) {
      return window.scrollTo(0, scrollPos);
    }
  }
};

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS207: Consider shorter variations of null checks
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Our cache storage, persists only for app lifecycle
  Eg. gets wiped when page reloaded.
*/
helpers.cache = {
  store: {},
  defaultExpiry: 406800 //# 7days
};

//# Set a cached object
helpers.cache.set = function(key, data, expires) {
  if (expires == null) { expires = helpers.cache.defaultExpiry; }
  helpers.cache.store[key] = {
    data,
    expires: expires + helpers.global.time(),
    key
  };
  return data;
};

//# Get a cached object
helpers.cache.get = function(key, fallback) {
  if (fallback == null) { fallback = false; }
  if ((helpers.cache.store[key] != null) && (helpers.cache.store[key].expires >= helpers.global.time())) {
    return helpers.cache.store[key].data;
  } else {
    return fallback;
  }
};

//# Delete a cached object
helpers.cache.del = function(key) {
  if (helpers.cache.store[key] != null) {
    return delete helpers.cache.store[key];
  }
};

//# Clear all caches
helpers.cache.clear = () => helpers.cache.store = {};

//# Update a property of a model in a backbone collection so we don't
//# have to clear the entire collection cache.
//# TODO: See if this can be replaced with: Backbone.fetchCache.clearItem(updatedModel)
helpers.cache.updateCollection = function(collectionKey, responseKey, modelId, property, value) {
  if ((Backbone.fetchCache._cache != null) && (Backbone.fetchCache._cache[collectionKey] != null) && (Backbone.fetchCache._cache[collectionKey].value.result != null)) {
    if (Backbone.fetchCache._cache[collectionKey].value.result[responseKey] != null) {
      return (() => {
        const result = [];
        for (var i in Backbone.fetchCache._cache[collectionKey].value.result[responseKey]) {
          var item = Backbone.fetchCache._cache[collectionKey].value.result[responseKey][i];
          if (item.id === modelId) {
            result.push(Backbone.fetchCache._cache[collectionKey].value.result[responseKey][parseInt(i)][property] = value);
          } else {
            result.push(undefined);
          }
        }
        return result;
      })();
    }
  }
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Config Helpers.
  - Use config.get/set with 'app' as the type, to get/set persistent settings (localstorage)
  - Use config.getLocal/setLocal to get set temp storage
*/

// A wrapper for getting a config value.
config.get = function(type, id, defaultData = '', callback) {
  const data = Kodi.request(`config:${type}:get`, id, defaultData);
  if (callback != null) {
    callback(data);
  }
  return data;
};

// A wrapper for setting a config value.
config.set = function(type, id, data, callback) {
  const resp = Kodi.request(`config:${type}:set`, id, data);
  if (callback != null) {
    callback(resp);
  }
  return resp;
};

// A wrapper for getting a local setting (static)
config.getLocal = (id, defaultData, callback) => config.get('static', id, defaultData, callback);

// A wrapper for setting a local setting (static)
config.setLocal = (id, data, callback) => config.set('static', id, data, callback);

config.setLocalApp = () => config.set('static', id, data, callback);

// A wrapper for getting an API Key.
config.getAPIKey = function(id, defaultData = '') {
  const key = config.getLocal(id, '');
  if (key === '') { return atob(defaultData); } else { return key; }
};

// Wrapper for getting a config value before app has started.
// Should always try and use config.get() before this.
config.preStartGet = function(id, defaultData = '') {
  if ((typeof localStorage !== 'undefined' && localStorage !== null) && (localStorage.getItem('config:app-config:local') != null)) {
    const config = JSON.parse(localStorage.getItem('config:app-config:local')).data;
    if (config[id] != null) {
      return config[id];
    }
  }
  return defaultData;
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Connection helpers. For live connecting and disconnecting from Kodi.
*/
helpers.connection = {};

//# Attempt to reconnect a disconnected shell.
helpers.connection.reconnect = success => helpers.connection.ping((function() {
  //# Successful reconnect!
  config.setLocal('connected', true);
  Kodi.execute('state:ws:init');
  return success();
}), () => Kodi.execute('shell:disconnect'));

//# Disconnect the shell.
helpers.connection.disconnect = () => config.setLocal('connected', false);

//# We manually call a ping to specify a reduced timeout.
helpers.connection.ping = function(success, fail) {
  const d = new Date();
  return $.ajax({
    url: helpers.url.baseKodiUrl("Ping"),
    timeout: 3000,
    contentType: 'application/json',
    type:'POST',
    data: JSON.stringify({jsonrpc: '2.0', method: 'JSONRPC.Ping', params: {}, id: d.getTime()}),
    success,
    error: fail
  });
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Entities mixins, all the common things we do/need on almost every collection

  example of usage:

  collection = new KodiCollection()
    .setEntityType 'collection'
    .setEntityKey 'movie'
    .setEntityFields 'small', ['thumbnail', 'title']
    .setEntityFields 'full', ['fanart', 'genre']
    .setMethod 'VideoLibrary.GetMovies'
    .setArgHelper 'fields'
    .setArgHelper 'limit'
    .setArgHelper 'sort'
    .applySettings()

*/
if (this.KodiMixins == null) { this.KodiMixins = {}; }


KodiMixins.Entities = {

  url() { return helpers.url.baseKodiUrl("Mixins"); },
  rpc: new Backbone.Rpc({
    useNamedParameters: true,
    namespaceDelimiter: ''
  }),


  /*
    Overrides!
  */

//  ## Add the options to the collection so we can use their args with rpc calls.
//  sync: (method, model, options) ->
//    if method is 'read'
//      this.options = options
//    Backbone.sync method, model, options
//
//  ## Parse the response.
//  parse: (resp, xhr) ->
//    respProp = @getEntityKey(@entityType + 'ResponseProperty')
//    if @entityType is 'model'
//      ## If fetched directly, look in movie details and mark as fully loaded
//      obj = if resp[respProp]? then resp[respProp] else resp
//      if resp[respProp]?
//        obj.fullyloaded = true
//      @parseModel @getEntityKey('type'), obj, obj[@getEntityKey('idProperty')]
//    else
//      ## collection
//      resp[respProp]



//  ###
//    Parse the model before adding to the collection
//    Here we can add generic goodies to all models.
//  ###
//  parseModel: (type, model, id) ->
//    model.id = id
//    model = App.request "images:path:entity", model
//    model.url = helpers.url.get type, id
//    model.type = type
//    model


  /*
    Apply all the defined settings.
  */
  applySettings() {
    //# @buildRpcRequest()
    if (this.entityType === 'model') {
      return this.setModelDefaultFields();
    }
  },


  /*
    What kind of entity are we dealing with. collection or model
  */
  entityType: 'model',
  setEntityType(type) {
    this.entityType = type;
    return this;
  },


  /*
    Entity Keys, properties that change between the entities
  */
  entityKeys: {
    type: '',
    modelResponseProperty: '',
    collectionResponseProperty: '',
    idProperty: ''
  },

  setEntityKey(key, value) {
    this.entityKeys[key] = value;
    return this;
  },

  //# Type is the only required, autodetect others.
  getEntityKey(key) {
    let ret;
    const {
      type
    } = this.entityKeys;
    switch (key) {
      case 'modelResponseProperty':
        ret = (this.entityKeys[key] != null) ? this.entityKeys[key] : type + 'details';
        break;
      case 'collectionResponseProperty':
        ret = (this.entityKeys[key] != null) ? this.entityKeys[key] : type + 's';
        break;
      case 'idProperty':
        ret = (this.entityKeys[key] != null) ? this.entityKeys[key] : type + 'id';
        break;
      default:
        ret = type;
    }
    return ret;
  },


  /*
    The types of fields we request, minimal for search, small for list, full for page.
  */
  entityFields: {
    minimal: [],
    small: [],
    full: []
  },

  setEntityFields(type, fields = []) {
    this.entityFields[type] = fields;
    return this;
  },

  getEntityFields(type) {
    const fields = this.entityFields.minimal;
    if (type === 'full') {
      return fields.concat(this.entityFields.small).concat(this.entityFields.full);
    } else if (type === 'small') {
      return fields.concat(this.entityFields.small);
    } else {
      return fields;
    }
  },

  //# Common model fields (not valid kodi response properties)
  modelDefaults: {
    id: 0,
    fullyloaded: false,
    thumbnail: '',
    thumbsUp: false
  },

  //# Define the model fields using a null default.
  setModelDefaultFields(defaultFields = {}) {
    defaultFields = _.extend(this.modelDefaults, defaultFields);
    return this.getEntityFields('full').map((field) =>
      (this.defaults[field] = ''));
  },


  /*
    JsonRPC common patterns and helpers.
  */
  callMethodName: '',
  callArgs: [],
  callIgnoreArticle: true,

  //# Set method
  setMethod(method) {
    this.callMethodName = method;
    return this;
  },

  //# Args must be set in the correct order!

  //# Set a static argument
  setArgStatic(callback) {
    this.callArgs.push( callback );
    return this;
  },

  //# Set a helper argument
  setArgHelper(helper, param1, param2) {
    const func = 'argHelper' + helper;
    this.callArgs.push( this[func](param1, param2) );
    return this;
  },

  //# Common arg patterns all checking if the params exist in options first.
  argCheckOption(option, fallback) {
    if ((this.options != null) && (this.options[option] != null)) {
      return this.options[option];
    } else {
      return fallback;
    }
  },

  //# Our arg helpers
  argHelperfields(type = 'small') {
    const arg = this.getEntityFields(type);
    return this.argCheckOption('fields', arg);
  },

  argHelpersort(method, order = 'ascending') {
    const arg = {method, order, ignorearticle: this.callIgnoreArticle};
    return this.argCheckOption('sort', arg);
  },

  argHelperlimit(start = 0, end = 'all') {
    const arg = {start};
    if (end !== 'all') {
      arg.end = end;
    }
    return this.argCheckOption('limit', arg);
  },

  argHelperfilter(name, value) {
    const arg = {};
    if (name != null) {
      arg[name] = value;
    }
    return this.argCheckOption('filter', arg);
  },

  //# Apply the methods + args to entity (build request)
  buildRpcRequest(type = 'read') {
    const req = [this.callMethodName];
    for (var arg of this.callArgs) {
      var func = 'argHelper' + arg;
      //# if a callback (collection)
      if (typeof func === 'function') {
        var key = 'arg' + req.length;
        req.push(key);
        this[key] = func;
      } else {
        //# if a string (model)
        req.push(arg);
      }
    }
    //# Set the method
    return req;
  }
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Handle errors.
*/
helpers.debug = {
  verbose: false
};


/*
  Debug styles

  @param severity
  The severity level: info, success, warning, error
*/
helpers.debug.consoleStyle = function(severity = 'error') {
  const defaults = {
    background: "#ccc",
    padding: "0 5px",
    color: "#444",
    "font-weight": "bold",
    "font-size": "110%"
  };

  const styles = [];
  const mods = {
    info: "#D8FEFE",
    success: "#CCFECD",
    warning: "#FFFDD9",
    error: "#FFCECD"
  };

  defaults.background = mods[severity];
  for (var prop in defaults) {
    styles.push(prop + ": " + defaults[prop]);
  }
  return styles.join("; ");
};


/*
  Basic debug message
*/
helpers.debug.msg = function(msg, severity = 'info', data) {
  if (typeof console !== 'undefined' && console !== null) {
    console.log(`%c ${msg}`, helpers.debug.consoleStyle(severity));
    if (data != null) {
      return console.log(data);
    }
  }
};


/*
  Log a debug error message.
*/
helpers.debug.log = function(msg, data = 'No data provided', severity = 'error', caller) {
  if (caller == null) { caller = arguments.callee.caller.toString(); }

  if ((data[0] != null) && (data[0].error === "Internal server error")) {
    //# Dont log anything
  } else {
    if (typeof console !== 'undefined' && console !== null) {
      console.log(`%c Error in: ${msg}`, helpers.debug.consoleStyle(severity), data);
      if (helpers.debug.verbose && (caller !== false)) {
        return console.log(caller);
      }
    }
  }
};


/*
  Request Error.
*/
helpers.debug.rpcError = function(commands, data) {
  const detail = {called: commands};
  let msg = '';
  if (data.error && data.error.message) {
    msg = '"' + data.error.message + '"';
    detail.error = data.error;
  } else {
    detail.error = data;
  }
  return helpers.debug.log(`jsonRPC request - ${msg}`, detail, 'error');
};

/*
  JSON Dump (pretty print)
*/
helpers.debug.syntaxHighlight = function(json) {
  json = JSON.stringify(json, null, 4);
  json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  const out = json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function(match) {
    let cls = 'number';
    if (/^"/.test(match)) {
      if (/:$/.test(match)) {
        cls = 'key';
      } else {
        cls = 'string';
      }
    } else if (/true|false/.test(match)) {
      cls = 'boolean';
    } else if (/null/.test(match)) {
      cls = 'null';
    }
    return '<span class="' + cls + '">' + match + '</span>';
  });
  return '<pre class="json-syntax-highlight">' + out + '</pre>';
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Entity Helpers
*/
helpers.entities = {};

// Create a UniqueID (uid) from a model object (raw)
// Numerical id is the preference, fallback to file
helpers.entities.createUid = function(model, type) {
  type = type ? type : model.type;
  const {
    id
  } = model;
  let uid = 'none';
  if ((typeof id === 'number') || (type === 'season')) {
    uid = id;
  } else {
    const {
      file
    } = model;
    if (file) {
      const hash = helpers.global.hashEncode(file);
      uid = 'path-' + hash.substring(0, 26);
    }
  }
  // Return pre-pending th type
  return type + '-' + uid;
};


//# Get fields for an entity given the set and type.
helpers.entities.getFields = function(set, type = 'small') {
  if (!_.isObject(set) || !set[type]) {
    [];
  }
  const fields = set.minimal;
  if (type === 'full') {
    return fields.concat(set.small).concat(set.full);
  } else if (type === 'small') {
    return fields.concat(set.small);
  } else {
    return fields;
  }
};

//# Build a subtitle based on the content.
helpers.entities.getSubtitle = function(model) {
  let subtitle = '';
  switch (model.type) {
    case 'song':
      if (model.artist) {
        subtitle = model.artist.join(',');
      }
      break;
    default:
      subtitle = '';
  }
  return subtitle;
};

//# Basic link to entity
helpers.entities.playingLink = model => `<a href='#${model.url}'>${_.escape(model.label)}</a>`;

//# Is watched
helpers.entities.isWatched = function(model) {
  let watched = false;
  if ((model != null) && model.get('playcount')) {
    watched = model.get('playcount') > 0 ? true : false;
  }
  return watched;
};

// Set progress on an entity.
helpers.entities.setProgress = function($el, progress) {
  progress = progress + '%';
  return $el.find('.current-progress').css('width', progress).attr('title', progress + ' ' + t.gettext('complete'));
};

//# Get default options
helpers.entities.buildOptions = function(options) {
  const defaultOptions = {useNamedParameters: true};
  // Only cache if we are not using filters.
  if (!options.filter) {
    defaultOptions.cache = true;
    defaultOptions.expires = config.get('static', 'collectionCacheExpiry');
  }
  return _.extend(defaultOptions, options);
};

//# Returns the Chorus search menu items for local and addon search.
helpers.entities.getAddonSearchMenuItems = function(query) {
  const addonSearches = Kodi.request("addon:search:enabled");
  let ret = '<li data-type="all" data-query="' + query + '">' + tr('Local media') + '</li>';
  if (addonSearches.length > 0) {
    ret += '<li class="divider"></li>';
    for (var addonSearch of addonSearches) {
      ret += '<li data-type="' + addonSearch.id + '" data-query="' + query + '">' +  tr(addonSearch.title)+ '</li>';
    }
  }
  return ret;
};

//# Wrapper for refreshing an entity. As a refresh removes the ID we need to wrap a bunch of extra logic around it.
//# ie: Show a confirm box, a few seconds after confirm, search for entity with the same title and redirect to the id
//# if we are on the same page AND deal with cache and thumbs up which both use IDs
//# This is NOT robust and overly complex! but should work 95% of the time.
helpers.entities.refreshEntity = function(model, controller, method, params = {}) {
  const title = model.get('label');
  const type = model.get('type');
  const originalPath = model.get('url');
  const refreshTimeout = type === 'tvshow' ? 10000 : 3000;
  const baseUrl = model.get('url').split('/').slice(0,-1).join('/');
  const thumbs = Kodi.request("thumbsup:check", model);
  params.ignorenfo = config.getLocal('refreshIgnoreNFO', true);
  // Show confirm box
  return Kodi.execute("ui:modal:confirm", tr('Are you sure?'), _.escape(t.sprintf(tr('Confirm refresh'), title)), function() {
    // Clear model from cache and remove thumbs up
    Backbone.fetchCache.clearItem(model);
    if (thumbs) {
      Kodi.request("thumbsup:toggle:entity", model);
    }
    // Do the refresh using the provided controller/method.
    return controller[method](model.get('id'), params, function(resp) {
      Kodi.execute("notification:show", tr("Refreshed media. Additional updates may still be occurring in the background"));
      // After a few seconds, search by title to try and get a new id, then refresh. Fallback to search page
      return setTimeout(function() {
        // Episodes redirect to season as might not have a lookup title
        if (title) {
          const opts = {
            limits: {start: 0, end: 1},
            filter: {'operator': 'is', 'field': 'title', 'value': title},
            sort: {method: 'none', order: 'descending'},
            success(collection) {
              if (collection.length) {
                const newModel = collection.first();
                if (thumbs) {
                  Kodi.request("thumbsup:toggle:entity", newModel);
                }
                if (originalPath === helpers.url.path()) {
                  return Kodi.navigate(baseUrl + "/" + newModel.get('id'), {trigger: true});
                }
              } else {
                Kodi.execute("notification:show", tr("Refreshed media not found, redirecting to search"));
                return Kodi.navigate("search/" + type + "/" + title, {trigger: true});
              }
            }
          };
          return Kodi.request(type + ":entities", opts);
        }
      }
      , refreshTimeout);
    });
  });
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Our generic global helpers so we dont have add complexity to our app.
*/
helpers.global = {};


//# Shuffle an array.
helpers.global.shuffle = function(array) {
  let i = array.length - 1;
  while (i > 0) {
    var j = Math.floor(Math.random() * (i + 1));
    var temp = array[i];
    array[i] = array[j];
    array[j] = temp;
    i--;
  }
  return array;
};


//# Get a random number within a range.
helpers.global.getRandomInt = (min, max) => Math.floor(Math.random() * ((max - min) + 1)) + min;


//# Get a timestamp in seconds
helpers.global.time = function() {
  const timestamp = new Date().getTime();
  return timestamp / 1000;
};


//# Boolean check for a needle in a haystack (like php in_array)
helpers.global.inArray = (needle, haystack) => _.indexOf(haystack, needle) > -1;


//# Set loading state
helpers.global.loading = (state = 'start') => {
  const op = state === 'start' ? 'add' : 'remove';
  if (this.Kodi != null) {
    return this.Kodi.execute("body:state", op, "loading");
  }
};


//# Format a number with the desired number of leading zeros
helpers.global.numPad = function(num, size) {
  const s = "000000000" + num;
  return s.substr(s.length - size);
};


//# Convert seconds to time
helpers.global.secToTime = function(totalSec = 0) {
  totalSec = Math.round(totalSec);
  const hours = parseInt(totalSec / 3600) % 24;
  const minutes = parseInt(totalSec / 60) % 60;
  const seconds = totalSec % 60;
  return {
    hours,
    minutes,
    seconds
  };
};


//# Convert time to seconds
helpers.global.timeToSec = function(time) {
  const hours = parseInt(time.hours) * (60 * 60);
  const minutes = parseInt(time.minutes) * 60;
  return parseInt(hours) + parseInt(minutes) + parseInt(time.seconds);
};


//# Convert EPG time to JS date
helpers.global.dateStringToObj = function(datetime) {
  if (!datetime) {
    return new Date(0); // Will equal start of epoch?
  } else {
    //# This will add the offset which should make the time correct as the EPG date time is UTC
    return new Date(datetime.replace(" ","T"));
  }
};

//# format a nowplaying time object for display
helpers.global.formatTime = function(time) {
  if ((time == null)) {
    return 0;
  } else {
    // Format time to hh:mm:ss or mm:ss
    let hrStr = "";
    if (time.hours > 0) {
      if (time.hours < 10) { hrStr = "0"; }
      hrStr += time.hours + ':';
    }
    return hrStr + (time.minutes<10 ? '0' : '') + time.minutes + ':' + (time.seconds<10 ? '0' : '') + time.seconds;
  }
};


//# Basic helper that returns a new object with a key/value set
helpers.global.paramObj = function(key, value) {
  const obj = {};
  obj[key] = value;
  return obj;
};


//# Escape a RegEx
helpers.global.regExpEscape = str => str.replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");


//# Check if a string starts with a given string
helpers.global.stringStartsWith = (start, data) => new RegExp('^' + helpers.global.regExpEscape(start)).test(data);


//# Strip a string from the beginning of another string
helpers.global.stringStripStartsWith = (start, data) => data.substring(start.length);


//# Turn an array of strings into a collective sentence.
//# eg. ['foo', 'bar', 'other'] = 'foo, bar and other'
//# Pluralise = 'foos, bars and others'
//# Returns HTML
helpers.global.arrayToSentence = function(arr, pluralise = true) {
  let str = '';
  const prefix = pluralise ? 's' : '';
  const last = arr.pop();
  if (arr.length > 0) {
    for (var i in arr) {
      var item = arr[i];
      str += '<strong>' + _.escape(item + prefix) + '</strong>';
      str += parseInt(i) !== (arr.length - 1) ? ', ' : '';
    }
    str += ' ' + t.gettext('and') + ' ';
  }
  return str += '<strong>' + _.escape(last + prefix) + '</strong>';
};


// Encode/Decode a string which is typically a file path that we want to use
// as an id and for classes. Url encoded file paths as classes break Sizzle.
helpers.global.hashEncode = value => Base64.encode(value);
helpers.global.hashDecode = value => Base64.decode(value);


//# Round the rating
helpers.global.rating = rating => Math.round(rating * 10) / 10;


//# Set the title
helpers.global.appTitle = function(playingItem = false) {
  let titlePrefix = '';
  if (_.isObject(playingItem) && (playingItem.label != null)) {
    titlePrefix = '▶ ' + playingItem.label + ' | ';
  }
  return document.title = titlePrefix + config.get('static', 'appTitle');
};

//# Open the local video player window
helpers.global.localVideoPopup = (path, height = 590) => window.open(path, "_blank", `toolbar=no, scrollbars=no, resizable=yes, width=925, height=${height}, top=100, left=100`);

//# Strip tags from a string
helpers.global.stripTags = function(string) {
  if (string != null) {
    return string.replace(/(<([^>]+)>)/ig,"");
  } else {
    return '';
  }
};

//# Round to decimal places.
helpers.global.round = (x, places = 0) => parseFloat(x.toFixed(places));

//# Given a position and total, return percent to 2 decimal places
helpers.global.getPercent = (pos, total, places = 2) => Math.floor((pos / total) * (100 * Math.pow(10, places))) / 100;

//# Trigger save dialog to save a text file
helpers.global.saveFileText = function(content, filename = 'untitled.txt') {
  try {
    const isFileSaverSupported = !!new Blob;
    if (isFileSaverSupported) {
      content = content.replace(String.fromCharCode(65279), "" );
      const blob = new Blob([content], {type: "text/plain;charset=utf-8"});
      return saveAs(blob, filename, true);
    }
  } catch (error) {
    return Kodi.execute("notification:show", tr('Saving is not supported by your browser'));
  }
};

helpers.global.removeBBCode = string => string.replace(/\[\/?(?:b|i|u|s|left|center|right|quote|code|list|img|spoil|color).*?\]/ig, '');
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  A collection of small jquery plugin helpers.
*/


// Remove a class matching a regex
// http://stackoverflow.com/a/18621161
//# usage: $('#hello').removeClassRegex(/^color-/)
$.fn.removeClassRegex = function(regex) {
  return $(this).removeClass((index, classes) => classes.split(/\s+/).filter(c => regex.test(c)).join(' '));
};

//# Remove classes starting with...
$.fn.removeClassStartsWith = function(startsWith) {
  return this.each(function(i, el) {
    const classes = el.className.split(" ").filter(c => c.lastIndexOf(startsWith, 0) !== 0);
    el.className = $.trim(classes.join(" "));
    return this;
  });
};

//# On scroll stop
//# http://stackoverflow.com/a/14035162
$.fn.scrollStopped = function(callback) {
  const $this = $(this);
  const self = this;
  return $this.scroll(function() {
    if ($this.data('scrollTimeout')) {
      clearTimeout($this.data('scrollTimeout'));
    }
    return $this.data('scrollTimeout', setTimeout(callback, 250, self));
  });
};

//# On resize stop
$.fn.resizeStopped = function(callback) {
  const $this = $(this);
  const self = this;
  return $this.resize(function() {
    if ($this.data('resizeTimeout')) {
      clearTimeout($this.data('resizeTimeout'));
    }
    return $this.data('resizeTimeout', setTimeout(callback, 250, self));
  });
};


//# Filter options via search box.
//# TODO: refactor.
$.fn.filterList = function(settings, callback) {
  const $this = $(this);
  const defaults = {
    hiddenClass: 'hidden',
    items: '.filter-options-list li',
    textSelector: '.option'
  };
  settings = $.extend(defaults, settings);
  return $this.on('keyup', () => {
    const val = $this.val().toLocaleLowerCase();
    const $list = $(settings.items).removeClass(settings.hiddenClass);
    if (val.length > 0) {
      $list.each(function(i, d) {
        const text = $(d).find(settings.textSelector).text().toLowerCase();
        if (text.indexOf(val) === -1) {
          return $(d).addClass(settings.hiddenClass);
        }
      });
    }
    if (typeof callback === "function") {
      return callback();
    }
  });
};


$(document).ready(function() {
  //# Hide dropdowns on click of item - why doesnt it do this already????
  $('.dropdown li').on('click', function() {
    return $(this).closest('.dropdown').removeClass('open');
  });
  return $('.dropdown').on('click', function() {
    return $(this).removeClass('open').trigger('hide.bs.dropdown');
  });
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Stream helpers
*/
helpers.stream = {};


/*
  Maps.
*/


//# Map for video stream sizes
helpers.stream.videoSizeMap = [
    {
      min: 0,
      max: 360,
      label: 'SD'
    },
    {
      min: 361,
      max: 480,
      label: '480'
    },
    {
      min: 481,
      max: 576,
      label: '576'
    },
    {
      min: 577,
      max: 720,
      label: '720p'
    },
    {
      min: 721,
      max: 1080,
      label: '1080p'
    },
    {
      min: 1081,
      max: 100000,
      label: '4K'
    }
  ];

//# Map for audio channels
helpers.stream.audioChannelMap = [
    {
      channels: 6,
      label: '5.1'
    },
    {
      channels:7,
      label: '6.1'
    },
    {
      channels: 8,
      label: '7.1'
    },
    {
      channels: 2,
      label: '2.1'
    },
    {
      channels: 1,
      label: 'mono'
    }
  ];

//# Map for language codes (using https://en.wikipedia.org/wiki/List_of_ISO_639_language_codes Set 2/B)
helpers.stream.langMap = {
  'und': 'Unknown',
  'aar': 'Afar',
  'abk': 'Abkhazian',
  'afr': 'Afrikaans',
  'aka': 'Akan',
  'alb': 'Albanian',
  'amh': 'Amharic',
  'ara': 'Arabic',
  'arg': 'Aragonese',
  'arm': 'Armenian',
  'asm': 'Assamese',
  'ava': 'Avaric',
  'ave': 'Avestan',
  'aym': 'Aymara',
  'aze': 'Azerbaijani',
  'bak': 'Bashkir',
  'bam': 'Bambara',
  'baq': 'Basque',
  'bel': 'Belarusian',
  'ben': 'Bengali',
  'bis': 'Bislama',
  'bos': 'Bosnian',
  'bre': 'Breton',
  'bul': 'Bulgarian',
  'bur': 'Burmese',
  'cat': 'Catalan',
  'cha': 'Chamorro',
  'che': 'Chechen',
  'chi': 'Chinese',
  'chv': 'Chuvash',
  'cor': 'Cornish',
  'cos': 'Corsican',
  'cre': 'Cree',
  'cze': 'Czech',
  'dan': 'Danish',
  'div': 'Maldivian',
  'dut': 'Dutch',
  'dzo': 'Dzongkha',
  'eng': 'English',
  'epo': 'Esperanto',
  'est': 'Estonian',
  'ewe': 'Ewe',
  'fao': 'Faroese',
  'fij': 'Fijian',
  'fin': 'Finnish',
  'fre': 'French',
  'fry': 'Western Frisian',
  'ful': 'Fulah',
  'geo': 'Georgian',
  'ger': 'German',
  'gla': 'Gaelic',
  'gle': 'Irish',
  'glg': 'Galician',
  'glv': 'Manx',
  'gre': 'Greek',
  'grn': 'Guarani',
  'guj': 'Gujarati',
  'hat': 'Haitian',
  'hau': 'Hausa',
  'heb': 'Hebrew',
  'her': 'Herero',
  'hin': 'Hindi',
  'hmo': 'Hiri Motu',
  'hrv': 'Croatian',
  'hun': 'Hungarian',
  'ibo': 'Igbo',
  'ice': 'Icelandic',
  'ido': 'Ido',
  'iii': 'Sichuan Yi',
  'iku': 'Inuktitut',
  'ile': 'Interlingue',
  'ina': 'Interlingua',
  'ind': 'Indonesian',
  'ipk': 'Inupiaq',
  'ita': 'Italian',
  'jav': 'Javanese',
  'jpn': 'Japanese',
  'kal': 'Kalaallisut',
  'kan': 'Kannada',
  'kas': 'Kashmiri',
  'kau': 'Kanuri',
  'kaz': 'Kazakh',
  'khm': 'Central Khmer',
  'kik': 'Kikuyu',
  'kin': 'Kinyarwanda',
  'kir': 'Kirghiz',
  'kom': 'Komi',
  'kon': 'Kongo',
  'kor': 'Korean',
  'kua': 'Kuanyama',
  'kur': 'Kurdish',
  'lao': 'Lao',
  'lat': 'Latin',
  'lav': 'Latvian',
  'lim': 'Limburgish',
  'lin': 'Lingala',
  'lit': 'Lithuanian',
  'ltz': 'Luxembourgish',
  'lub': 'Luba-Katanga',
  'lug': 'Ganda',
  'mac': 'Macedonian',
  'mah': 'Marshallese',
  'mal': 'Malayalam',
  'mao': 'Maori',
  'mar': 'Marathi',
  'may': 'Malay',
  'mlg': 'Malagasy',
  'mlt': 'Maltese',
  'mon': 'Mongolian',
  'nau': 'Nauru',
  'nav': 'Navajo',
  'nbl': 'South Ndebele',
  'nde': 'North Ndebele',
  'ndo': 'Ndonga',
  'nep': 'Nepali',
  'nno': 'Norwegian Nynorsk',
  'nob': 'Norwegian Bokmål',
  'nor': 'Norwegian',
  'nya': 'Chichewa',
  'oci': 'Occitan',
  'oji': 'Ojibwa',
  'ori': 'Oriya',
  'orm': 'Oromo',
  'oss': 'Ossetian',
  'pan': 'Punjabi',
  'per': 'Persian',
  'pli': 'Pali',
  'pol': 'Polish',
  'por': 'Portuguese',
  'pus': 'Pashto',
  'que': 'Quechua',
  'roh': 'Romansh',
  'rum': 'Romanian',
  'run': 'Rundi',
  'rus': 'Russian',
  'sag': 'Sango',
  'san': 'Sanskrit',
  'sin': 'Sinhalese',
  'slo': 'Slovak',
  'slv': 'Slovenian',
  'sme': 'Northern Sami',
  'smo': 'Samoan',
  'sna': 'Shona',
  'snd': 'Sindhi',
  'som': 'Somali',
  'sot': 'Southern Sotho',
  'spa': 'Spanish',
  'srd': 'Sardinian',
  'srp': 'Serbian',
  'ssw': 'Swati',
  'sun': 'Sundanese',
  'swa': 'Swahili',
  'swe': 'Swedish',
  'tah': 'Tahitian',
  'tam': 'Tamil',
  'tat': 'Tatar',
  'tel': 'Telugu',
  'tgk': 'Tajik',
  'tgl': 'Tagalog',
  'tha': 'Thai',
  'tib': 'Tibetan',
  'tir': 'Tigrinya',
  'ton': 'Tonga',
  'tsn': 'Tswana',
  'tso': 'Tsonga',
  'tuk': 'Turkmen',
  'tur': 'Turkish',
  'twi': 'Twi',
  'uig': 'Uighur',
  'ukr': 'Ukrainian',
  'urd': 'Urdu',
  'uzb': 'Uzbek',
  'ven': 'Venda',
  'vie': 'Vietnamese',
  'vol': 'Volapük',
  'wel': 'Welsh',
  'wln': 'Walloon',
  'wol': 'Wolof',
  'xho': 'Xhosa',
  'yid': 'Yiddish',
  'yor': 'Yoruba',
  'zha': 'Zhuang',
  'zul': 'Zulu'
};

/*
  Formatters.
*/

//# Textual representation of aspect ratio
helpers.stream.aspectRatio = function(rawAspect) {
  if (rawAspect < 1.3499) {
    return '1.33:1';
  }

  if (rawAspect < 1.5080) {
    return '1.37:1';
  }

  if (rawAspect < 1.719) {
    return '1.66:1';
  }

  if (rawAspect < 1.8147) {
    return '16:9';
  }

  if (rawAspect < 2.0174) {
    return '1.85:1';
  }

  if (rawAspect < 2.2738) {
    return '2.20:1';
  }

  if (rawAspect < 2.3749) {
    return '2.35:1';
  }

  if (rawAspect < 2.4739) {
    return '2.40:1';
  }

  if (rawAspect < 2.6529) {
    return '2.55:1';
  }

  return 'Unknown Aspect Ratio';
};

//# Format an array of video streams.
helpers.stream.videoFormat = function(videoStreams) {
  for (var i in videoStreams) {
    var stream = videoStreams[i];
    var match = {label: 'SD'};
    if (stream.height && (stream.height > 0)) {
       match = _.find( helpers.stream.videoSizeMap, function(res) { if (res.min < stream.height && stream.height <= res.max) { return true; } else { return false; }  });
     }
    videoStreams[i].label = stream.codec + ' ' + match.label + ' (' + stream.width + ' x ' + stream.height + ') [' + helpers.stream.aspectRatio(stream.aspect) + ']';
    videoStreams[i].shortlabel = stream.codec + ' ' + match.label;
    videoStreams[i].res = match.label;
  }
  return videoStreams;
};


//# Formatter for language codes
helpers.stream.formatLanguage = function(lang) {
  if (helpers.stream.langMap[lang]) {
    return helpers.stream.langMap[lang];
  } else {
    return lang;
  }
};


//# Format an array of audio streams.
helpers.stream.audioFormat = function(audioStreams) {
  for (var i in audioStreams) {
    var stream = audioStreams[i];
    var ch = _.findWhere(helpers.stream.audioChannelMap, {channels: stream.channels});
    ch = ch ? ch.label : stream.channels;
    var lang = '';
    if ((stream.language !== '') && (stream.language !== 'und')) {
      lang = ' (' + helpers.stream.formatLanguage(stream.language) + ')';
    }
    audioStreams[i].label = stream.codec + ' ' + ch + lang;
    audioStreams[i].shortlabel = stream.codec + ' ' + ch;
    audioStreams[i].ch = ch;
  }
  return audioStreams;
};


//# Format an array of subtitles
helpers.stream.subtitleFormat = function(subtitleStreams) {
  let i, stream;
  const distinctLanguages = [];
  const uniqueStreams = [];

  for (i in subtitleStreams) {
    stream = subtitleStreams[i];
    if (distinctLanguages.indexOf(subtitleStreams[i].language) === -1) {
      distinctLanguages.push(subtitleStreams[i].language);
      uniqueStreams.push(subtitleStreams[i]);
    }
  }

  for (i in uniqueStreams) {
    stream = uniqueStreams[i];
    uniqueStreams[i].label = helpers.stream.formatLanguage(stream.language);
    uniqueStreams[i].shortlabel = helpers.stream.formatLanguage(stream.language);
  }
		
  return uniqueStreams;
};


//# Format ALL streams
helpers.stream.streamFormat = function(streams) {
  const streamTypes = ['audio', 'video', 'subtitle'];
  for (var type of streamTypes) {
    if (streams[type] && (streams[type].length > 0)) {
      streams[type] = helpers.stream[type + 'Format'](streams[type]);
    } else {
      streams[type] = [];
    }
  }
  return streams;
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  For everything translatable.
*/

helpers.translate = {};

//# When a new language file (src/lang/*.po) is added, it must also be added
//# here as an available option.
helpers.translate.getLanguages = () => ({
  af: "Afrikaans (South Africa)",
  am: "Amharic (Ethiopia)",
  ar: "Arabic (Saudi Arabia)",
  ast: "Asturian (Spain)",
  az: "Azerbaijani",
  be: "Belarusian",
  bg: "Bulgarian",
  bs: "Bosnian",
  ca: "Catalan (Spain)",
  cs: "Czech",
  cy: "Welsh (United Kingdom)",
  da: "Danish",
  de: "German",
  el: "Greek",
  en: "English (United Kingdom)",
  en_au: "English (Australia)",
  en_nz: "English (New Zealand)",
  en_us: "English (United States)",
  eo: "Esperanto",
  es: "Spanish (Spain)",
  es_ar: "Spanish (Argentina)",
  es_mx: "Spanish (Mexico)",
  et: "Estonian",
  eu: "Basque (Spain)",
  fa: "Persian (Afghanistan)",
  fa_ir: "Persian (Iran)",
  fi: "Finnish",
  fo: "Faroese",
  fr: "French (France)",
  fr_ca: "French (Canada)",
  gl: "Galician (Spain)",
  he: "Hebrew (Israel)",
  hi: "Hindi (India)",
  hr: "Croatian",
  hu: "Hungarian",
  hy: "Armenian",
  id: "Indonesian",
  is: "Icelandic",
  it: "Italian",
  ja: "Japanese",
  kn: "Kannada (India)",
  ko: "Korean",
  lt: "Lithuanian",
  lv: "Latvian",
  mi: "Maori",
  mk: "Macedonian",
  ml: "Malayalam (India)",
  mn: "Mongolian",
  ms: "Malay",
  mt: "Maltese",
  my: "Burmese",
  nb: "Norwegian",
  nl: "Dutch",
  pl: "Polish",
  pt: "Portuguese (Portugal)",
  pt_br: "Portuguese (Brazil)",
  ro: "Romanian",
  ru: "Russian",
  si: "Sinhala (Sri Lanka)",
  sk: "Slovak",
  sl: "Slovenian",
  sq: "Albanian",
  sr: "Serbian",
  "sr_rs@latin": "Serbian (latin)",
  sv: "Swedish",
  szl: "Silesian",
  ta: "Tamil (India)",
  te: "Telugu (India)",
  tg: "Tajik",
  th: "Thai",
  tr: "Turkish",
  uk: "Ukrainian",
  uz: "Uzbek",
  vi: "Vietnamese",
  zh_cn: "Chinese (Simplified)",
  zh_tw: "Chinese (Traditional)"
});

//# Init language and translations.
helpers.translate.init = function(callback) {

  const defaultLang = config.get("static", "lang", "en");

  // Need to get the language key from local storage before the app has started
  // so this does a workaround to grab it direct from local storage.
  const lang = config.preStartGet("lang", defaultLang);

  // Load the correct language from settings.
  return $.getJSON("lang/_strings/" + lang + ".json", function(data) {
    window.t = new Jed(data);
    // If a key is missing, throw a console error.
    t.options["missing_key_callback"] = key => helpers.translate.missingKeyLog(key);
    // Do whatever needs to be done after language is ready (eg. start the app)
    return callback();
  });
};

//# Format a missing key in a .po format so it can be
//# easily added.
helpers.translate.missingKeyLog = function(key) {
  const item = '\n\n' +
         'msgctxt ""\n' +
         'msgid "' + key + '"\n' +
         'msgstr "' + key + '"\n';
  return helpers.debug.msg(item, 'warning');
};

/*
  Translate aliases.
*/
const tr = text => t.gettext(text);
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  UI helpers for the app.
*/
helpers.ui = {};

//# Bind to scroll and resize stop. This should only be bound once during app init.
helpers.ui.bindOnScrollResize = function() {
  $(window).scrollStopped(() => {
    return helpers.ui.requestTick();
  });
  return $(window).resizeStopped(() => {
    return helpers.ui.requestTick();
  });
};

//# Callback for resize/scroll stop, it uses requestAnimationFrame to trigger an event
//# when scrolling has actually stopped, this prevents locking the UI with a redraw.
//# Views, etc can listen to App.vent.on("ui:animate:stop") to trigger redraws.
//# Used by VirtualListView.
helpers.ui.isTicking = false;
helpers.ui.requestTick = function() {
  if (!helpers.ui.isTicking) {
    requestAnimationFrame( () => {
      Kodi.vent.trigger("ui:animate:stop");
      return helpers.ui.isTicking = false;
    });
  }
  return helpers.ui.isTicking = true;
};

//# Get a swatch from an image (Vibrant.js)
helpers.ui.getSwatch = function(imgSrc, callback) {
  const ret = {};
  const img = document.createElement('img');
  img.setAttribute('src', imgSrc);
  return img.addEventListener('load', function() {
    const vibrant = new Vibrant(img);
    const swatches = vibrant.swatches();
    for (var swatch in swatches) {
      if (swatches.hasOwnProperty(swatch) && swatches[swatch]) {
        var sw = swatches[swatch];
        ret[swatch] = {
          hex: sw.getHex(),
          rgb: _.map(sw.getRgb(), c => Math.round(c)),
          title: sw.getTitleTextColor(),
          body: sw.getBodyTextColor()
        };
      }
    }
    return callback(ret);
  });
};

//# Apply swatches to a header (Vibrant.js)
helpers.ui.applyHeaderSwatch = function(swatches) {
  if ((swatches != null) && (swatches.DarkVibrant != null) && (swatches.DarkVibrant.hex != null)) {
    // Check enabled first before applying.
    if (config.get('static', 'vibrantHeaders') === true) {
      const color = swatches.DarkVibrant;
      // Header background.
      const $header = $('.details-header');
      $header.css('background-color', color.hex);
      // Fanart gradient
      const rgb = color.rgb.join(',');
      const gradient = 'linear-gradient(to right, ' + color.hex + ' 0%, rgba(' + rgb + ',0.9) 30%, rgba(' + rgb + ',0) 100%)';
      return $('.region-details-fanart .gradient', $header).css('background-image', gradient);
    }
  }
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Handle urls.
*/
helpers.url = {};

//# Map generic entities to their urls.
helpers.url.map = {
  artist: 'music/artist/:id',
  album: 'music/album/:id',
  song: 'music/song/:id',
  movie: 'movie/:id',
  tvshow: 'tvshow/:id',
  season: 'tvshow/:id',
  episode: 'tvshow/:tvshowid/:season/:id',
  channeltv: 'pvr/tv/:id',
  channelradio: 'pvr/radio/:id',
  file: 'browser/file/:id',
  playlist: 'playlist/:id',
  musicvideo: 'music/video/:id'
};

//# Get base endpoint
helpers.url.baseKodiUrl = function(query = 'Kodi') {
  const path = (config.getLocal('jsonRpcEndpoint')) + "?" + query;
  if (config.getLocal('reverseProxy')) {
    return path;
  } else {
    return "/" + path;
  }
};

//# Get a url for a given model type.
helpers.url.get = function(type, id = '', replacements = {}) {
  //# Get the path from the map
  let path = '';
  if (helpers.url.map[type] != null) {
    path = helpers.url.map[type];
  }
  //# Replace the tokens in the path
  replacements[':id'] = id;
  for (var token in replacements) {
    id = replacements[token];
    path = path.replace(token, id);
  }
  return path;
};

//# From an array of people, make a set of links to their filter page.
helpers.url.filterLinks = function(entities, key, items, limit = 5) {
  const baseUrl = '#' + entities + '?' + key + '=';
  const links = [];
  for (var i in items) {
    var item = items[i];
    if (i < limit) {
      links.push('<a href="' + baseUrl + encodeURIComponent(item) + '">' + item + '</a>');
    }
  }
  return links.join(', ');
};


//# For a mixed style entity (playlist, now playing), tweak the url
helpers.url.playlistUrl = function(item) {
  if (item.type === 'song') {
    if (item.albumid !== '') {
      item.url = helpers.url.get('album', item.albumid);
    } else {
      item.url('music/albums');
    }
  }
  return item.url;
};

//# Get url args (removing any queries)
helpers.url.arg = function(arg = 'none') {
  const {
    hash
  } = location;
  const hashParts = hash.split('?');
  const args = hashParts[0].substring(1).split('/');
  if (arg === 'none') {
    return args;
  } else if (args[arg] != null) {
    return args[arg];
  } else {
    return '';
  }
};


//# Get Url params
//# Will automatically parse current url or the params provided e.g. 'foo=bar&duck=sauce'
helpers.url.params = function(params = 'auto') {
  let query;
  if (params === 'auto') {
    const p = document.location.href;
    if (p.indexOf('?') === -1) {
      return {};
    } else {
      let path;
      [path, query] = p.split('?');
    }
  }
  if (query == null) { query = params; }
  return _.object(_.compact(_.map(query.split('&'), function(item) { if (item) { return item.split('='); } })));
};


//# Get a query params string ready for appending to a url
helpers.url.buildParams = function(params) {
  const q = [];
  for (var key in params) {
    var val = params[key];
    q.push(key + '=' + encodeURIComponent(val));
  }
  return '?' + q.join('&');
};


//# Alter the params by suppling options to add or remove
//# Add is an object with key: val pairs, Remove is an array of keys to remove.
//# Returns a full url path (no # symbol)
helpers.url.alterParams = function(add = {}, remove = []) {
  const curParams = helpers.url.params();
  if (remove.length > 0) {
    for (var k of remove) {
      delete curParams[k];
    }
  }
  const params = _.extend(curParams, add);
  return helpers.url.path() + helpers.url.buildParams(params);
};


//# Get the current path.
helpers.url.path = function() {
  const p = document.location.hash;
  const [path, query] = p.split('?');
  return path.substring(1);
};


//# Create a Imdb Link, abstraction as imdbid might also be used for tmdb id?
helpers.url.imdbUrl = function(imdbNumber, text) {
  const url = `http://www.imdb.com/title/${imdbNumber}/`;
  return `<a href='${url}' class='imdblink' target='_blank'>${t.gettext(text)}</a>`;
};


//# Parse trailer url
helpers.url.parseTrailerUrl = function(trailer) {
  const ret = {source: '', id: '', img: '', url: ''};
  const urlParts = helpers.url.params(trailer);
  if (trailer.indexOf('youtube') > -1) {
    ret.source = 'youtube';
    ret.id = urlParts.videoid;
    ret.img = `http://img.youtube.com/vi/${ret.id}/0.jpg`;
    ret.url = `https://www.youtube.com/watch?v=${ret.id}`;
  }
  return ret;
};

//# Is current protocol https
helpers.url.isSecureProtocol = function() {
  const secure = (typeof document !== 'undefined' && document !== null) && (document.location.protocol === "https:") ? true : false;
  return secure;
};
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
(function(Backbone) {
  let methods;
  const _sync = Backbone.sync;

  Backbone.sync = function(method, entity, options = {}) {
    _.defaults(options, {
    beforeSend: _.bind(methods.beforeSend,  entity),
    complete:   _.bind(methods.complete,    entity)
  }
    );

    const sync = _sync(method, entity, options);

    if (!entity._fetch && (method === "read")) {
      return entity._fetch = sync;
    }
  };

  return methods = {
    beforeSend() {
      return this.trigger("sync:start", this);
    },

    complete() {
      return this.trigger("sync:stop", this);
    }
  };
})(Backbone);
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
(function(Backbone) {

  return _.extend(Backbone.Marionette.Application.prototype, {

    navigate(route, options = {}) {
      // route = "#" + route if route.charAt(0) is "/"
      return Backbone.history.navigate(route, options);
    },

    getCurrentRoute() {
      const frag = Backbone.history.fragment;
      if (_.isEmpty(frag)) { return null; } else { return frag; }
    },

    startHistory() {
      if (Backbone.history) {
        return Backbone.history.start();
      }
    },

    register(instance, id) {
      if (this._registry == null) { this._registry = {}; }
      return this._registry[id] = instance;
    },

    unregister(instance, id) {
      return delete this._registry[id];
    },

    resetRegistry() {
      const oldCount = this.getRegistrySize();
      for (var key in this._registry) {
        var controller = this._registry[key];
        controller.region.close();
      }
      const msg = `There were ${oldCount} controllers in the registry, there are now ${this.getRegistrySize()}`;
      if (this.getRegistrySize() > 0) { return console.warn(msg, this._registry); } else { return console.log(msg); }
    },

    getRegistrySize() {
      return _.size(this._registry);
    }
  }
  );
})(Backbone);
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// Extend Marionettes template renderer to use JST.
(function(Marionette) {
  return _.extend(Marionette.Renderer, {

    // So we don't have to add this to every template key.
    extension: [".jst"],

    // Override the default render method.
    render(template, data) {
      const path = this.getTemplate(template);
      if (!path) { throw `Template ${template} not found!`; }
      return path(data);
    },

    // Add 'tpl' as the part of the path so we don't have to call it each time.
    getTemplate(template) {
      let path = this.insertAt(template.split("/"), -1, "tpl").join("/");
      path = path + this.extension;
      if (JST[path]) { return JST[path]; }
    },

    insertAt(array, index, item) {
      array.splice(index, 0, item);
      return array;
    }
  }
  );
})(Marionette);
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  return Entities.Collection = class Collection extends Backbone.Collection {

    //# Return the raw entities stored against this collection
    //# as an array of json objects (not models)
    //# TODO: Remove this and use toJSON() instead
    getRawCollection() {
      const objs = [];
      if (this.models.length > 0) {
        for (var model of this.models) {
          objs.push(model.attributes);
        }
      }
      return objs;
    }

    //# Set our custom cache keys.
    getCacheKey(options) {
      const key = this.constructor.name;
      return key;
    }

    //# Automatically sort a collection based on the params
    //# passed from the controller.
    autoSort(params) {
      if (params.sort) {
        const order = params.order ? params.order : 'asc';
        return this.sortCollection(params.sort, order);
      }
    }

    //# Change sort comparator.
    sortCollection(property, order = 'asc') {
      if (property === 'random') {
        this.comparator = false;
        this.reset(this.shuffle(), {silent:true});
      } else {
        this.comparator = model => {
          return this.ignoreArticleParse(model.get(property));
        };
        if (order === 'desc') {
          this.comparator = this.reverseSortBy(this.comparator);
        }
        this.sort();
      }
    }

    //# Reverse descending sort
    //# http://stackoverflow.com/a/12220415
    reverseSortBy(sortByFunction) {
      return function(left, right) {
        const l = sortByFunction(left);
        const r = sortByFunction(right);
        if (l === undefined) {
          return -1;
        }
        if (r === undefined) {
          return 1;
        }
        if (l < r) { return 1; } else if (l > r) { return -1; } else { return 0; }
      };
    }

    //# Ignore article in list sorting.
    ignoreArticleParse(string) {
      const articles = ["'", '"', 'the ', 'a '];
      if ((typeof string === 'string') && config.get('static', 'ignoreArticle', true)) {
        string = string.toLowerCase();
        let parsed = false;
        for (var s of articles) {
          if (parsed) {
            continue;
          }
          if (helpers.global.stringStartsWith(s, string)) {
            string = helpers.global.stringStripStartsWith(s, string);
            parsed = true;
          }
        }
      }
      return string;
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  //# https://github.com/jmorrell/backbone-filtered-collection
  return Entities.Filtered = class Filtered extends FilteredCollection {

    //# Allows filtering against multiple values of the same key.
    filterByMultiple(key, values = []) {
      return this.filterBy(key, model => helpers.global.inArray(model.get(key), values));
    }

    //# Allows filtering against multiple values of the same key
    //# where the data is an array
    filterByMultipleArray(key, values = []) {
      return this.filterBy(key, function(model) {
        let match = false;
        for (var v of model.get(key)) {
          if (helpers.global.inArray(v, values)) {
            match = true;
          }
        }
        return match;
      });
    }

    //# Like filterbymultiplearray but allows for key to be an object
    //# picking out the key from that object.
    filterByMultipleObject(key, property, values = []) {
      return this.filterBy(key, function(model) {
        let match = false;
        const items = _.pluck(model.get(key), property);
        for (var v of items) {
          if (helpers.global.inArray(v, values)) {
            match = true;
          }
        }
        return match;
      });
    }

    filterByUnwatched() {
      return this.filterBy('unwatched', function(model) {
        let unwatched = 1;
        if (model.get('type') === 'tvshow') {
          unwatched = model.get('episode') - model.get('watchedepisodes');
        } else if ((model.get('type') === 'movie') || (model.get('type') === 'episode')) {
          unwatched = model.get('playcount') > 0 ? 0 : 1;
        }
        return unwatched > 0;
      });
    }

    filterByWatched() {
      return this.filterBy('watched', function(model) {
        let watched = 1;
        if (model.get('type') === 'tvshow') {
          watched = model.get('watchedepisodes');
        } else if ((model.get('type') === 'movie') || (model.get('type') === 'episode')) {
          watched = model.get('playcount') > 0 ? 1 : 0;
        }
        return watched > 0;
      });
    }

    filterByThumbsUp(key) {
      return this.filterBy(key, model => App.request("thumbsup:check", model));
    }

    filterByInProgress(key) {
      return this.filterBy(key, function(model) {
        const inprogress = (model.get('progress') > 0) && (model.get('progress') < 100) ? true : false;
        return inprogress;
      });
    }

    filterByString(key, query) {
      return this.filterBy('search', function(model) {
        if (query.length < 3) { //# 2 character min
          return false;
        } else {
          const value = model.get(key).toLowerCase();
          return (value.indexOf(query.toLowerCase()) > -1);
        }
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS103: Rewrite code to no longer use __guard__, or convert again using --optional-chaining
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  return Entities.Model = class Model extends Backbone.Model {

    //# Set our custom cache keys.
    constructor(...args) {
      super(...args);
      this.saveSuccess = this.saveSuccess.bind(this);
      this.saveError = this.saveError.bind(this);
    }

    getCacheKey(options) {
      const key = this.constructor.name;
      return key;
    }

    destroy(options = {}) {
      _.defaults(options,
        {wait: true});

      this.set({_destroy: true});
      return super.destroy(options);
    }

    isDestroyed() {
      return this.get("_destroy");
    }

    save(data, options = {}) {
      const isNew = this.isNew();

      _.defaults(options, {
        wait: true,
        success:  _.bind(this.saveSuccess, this, isNew, options.collection),
        error:    _.bind(this.saveError, this)
      }
      );

      this.unset("_errors");
      return super.save(data, options);
    }

    saveSuccess(isNew, collection) {
      if (isNew) { //# model is being created
        if (collection) { collection.add(this); }
        if (collection) { collection.trigger("model:created", this); }
        return this.trigger("created", this);
      } else { //# model is being updated
        if (collection == null) { ({
          collection
        } = this); } //# if model has collection property defined, use that if no collection option exists
        if (collection) { collection.trigger("model:updated", this); }
        return this.trigger("updated", this);
      }
    }

    saveError(model, xhr, options) {
      //# set errors directly on the model unless status returned was 500 or 404
      if ((xhr.status !== 500) && (xhr.status !== 404)) { return this.set({_errors: __guard__($.parseJSON(xhr.responseText), x => x.errors)}); }
    }
  };
});


function __guard__(value, transform) {
  return (typeof value !== 'undefined' && value !== null) ? transform(value) : undefined;
};// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  App configuration settings, items stored in local storage and are
  specific to the browser/user instance. Not Kodi settings.
*/
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  var API = {

    storageKey: 'config:app',

    //# Get a loaded collection
    getCollection() {
      const collection = new Entities.ConfigAppCollection();
      collection.fetch();
      return collection;
    },

    //# Get a single config item
    getConfig(id, collection) {
      if (collection == null) { collection = API.getCollection(); }
      return collection.find({id});
    }
  };

  //# The config model
  let Cls = (Entities.ConfigApp = class ConfigApp extends Entities.Model {
    static initClass() {
      this.prototype.defaults =
        {data: {}};
    }
  });
  Cls.initClass();

  //# The config collection
  Cls = (Entities.ConfigAppCollection = class ConfigAppCollection extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.ConfigApp;
      this.prototype.localStorage = new Backbone.LocalStorage(API.storageKey);
    }
  });
  Cls.initClass();


  //# Handler to return a single local setting.
  App.reqres.setHandler("config:app:get", function(configId, defaultData) {
    const model = API.getConfig(configId);
    if (model != null) {
      return model.get('data');
    } else {
      return defaultData;
    }
  });


  //# Handler to set/update a single local setting.
  App.reqres.setHandler("config:app:set", function(configId, configData) {
    const collection = API.getCollection();
    const model = API.getConfig(configId, collection);
    if (model != null) {
      return model.save({data: configData});
    } else {
      collection.create({id: configId, data: configData});
      return configData;
    }
  });


  //# Handler to return a single static setting (forgotten on page reload).
  App.reqres.setHandler("config:static:get", function(configId, defaultData) {
    const data = (config.static[configId] != null) ? config.static[configId] : defaultData;
    return data;
  });


  //# Handler to set a single static setting (forgotten on page reload).
  return App.reqres.setHandler("config:static:set", function(configId, data) {
    config.static[configId] = data;
    return data;
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  let Cls = (Entities.ExternalEntity = class ExternalEntity extends Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        id: '',
        title: '',
        desc: '',
        thumbnail: '',
        url: '',
        type: '',
        provider: ''
      };
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Entities.ExternalCollection = class ExternalCollection extends Entities.Collection {
      static initClass() {
        this.prototype.model = Entities.ExternalEntity;
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  var API = {

    // Using the Kodi API key
    apiKey: 'ZWQ0Yjc4NGY5NzIyNzM1OGIzMWNhNGRkOTY2YTA0ZjE=',

    // V3 of API
    baseURL: 'http://webservice.fanart.tv/v3/',

    // Max image count
    maxImageCount: 15,

    artistFieldTranslate: {
      artistbackground: 'fanart',
      artistthumb: 'thumbnail'
    },

    //# Make a call to API
    call(path, params, callback) {
      const defaultParams =
        {api_key: config.getAPIKey('apiKeyFanartTv', this.apiKey)};
      params = _.extend(defaultParams, params);
      const url = this.baseURL + path + helpers.url.buildParams(params);
      const req = $.getJSON(url, resp => callback(resp));
      return req.fail(err => callback({status: 'error'}));
    },

    //# Add original and thumb properties to an image collection
    parseImageUrls(artType, collection) {
      if (collection.status && (collection.status === 'error')) {
        return [];
      }
      const items = [];
      const artTypes = this[artType + 'FieldTranslate'];
      for (var type in artTypes) {
        var field = artTypes[type];
        if (collection[type] != null) {
          collection[type] = collection[type].slice(0, this.maxImageCount);
          for (var i in collection[type]) {
            var item = collection[type][i];
            var row = item;
            row.thumbnail = this.getThumbnailUrl(item.url);
            row.provider = 'fanarttv';
            row.type = field;
            items.push(row);
          }
        }
      }
      return items;
    },

    //# Note - this might break in the future, API does not provide a thumb
    getThumbnailUrl: url => {
      return url.replace('assets.fanart.tv/', 'fanart.tv/detailpreview/');
    },

    //# Get Images
    images(type, id, callback) {
      return this.call(type + '/' + id, {}, resp => {
        return callback(this.parseImageUrls('artist', resp));
      });
    },

    //# Return a collection for an music search
    getMusicArtCollection(name, callback) {
      const cacheKey = 'fanarttv:' + encodeURIComponent(name);
      const cache = config.getLocal(cacheKey, []);
      if (cache.length > 0) {
        return API.createCollection(cache, callback);
      } else {
        return App.execute("musicbrainz:artist:entity", name, function(model) {
          if (model.get('id')) {
            return API.images('music', model.get('id'), results => API.createCollection(results, callback));
          } else {
            return API.createCollection([], callback);
          }
        });
      }
    },

    //# Create a collection from raw items
    createCollection(items, callback) {
      return callback(new Entities.ExternalCollection(items));
    }
  };


  //# Return the first matching entity on a name lookup
  return App.commands.setHandler("fanarttv:artist:image:entities", (name, callback) => API.getMusicArtCollection(name, callback));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  var API = {

    // V2 of API
    baseURL: 'http://musicbrainz.org/ws/2/',

    // Max count
    maxCount: 1,

    //# Make a call to API
    call(path, params, callback) {
      const url = this.baseURL + path + helpers.url.buildParams(params) + '&fmt=json';
      return $.getJSON(url, resp => callback(resp));
    },

    //# Find an artist, key is the search key, eg 'artist' or 'mbid'. id is the search query eg artist name or mbid.
    findArtist(key, id, callback) {
      return this.call('artist/', {query: key + ':' + id}, function(resp) {
        const collection = new Entities.ExternalCollection(API.parseArtist(resp));
        return callback(collection);
      });
    },

    //# Parse artist xml response
    parseArtist(resp) {
      let items = [];
      if (resp.artists && resp.artists.length) {
        items = resp.artists;
        items = _.map(items, function(item) {
          item.artistType = item.type;
          item.title = item.name;
          item.type = 'artist';
          item.provider = 'musicbrainz';
          return item;
        });
      }
      return items;
    }
  };


  //# Return the first matching entity on a name lookup
  return App.commands.setHandler("musicbrainz:artist:entity", (name, callback) => API.findArtist('artist', name, collection => callback(collection.first())));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  var API = {

    // API Key
    apiKey: 'NzFiYTFmMDdlZDBmYzhmYjM2MWNmMDRhNThkNzUwNTE=',

    // V3 of API
    baseURL: 'https://api.themoviedb.org/3/',

    // Image base path
    baseImageURL: 'https://image.tmdb.org/t/p/',

    // Default lang
    defaultLang: 'en',

    // Max image count
    maxImageCount: 15,

    // Default thumb sizes
    thumbSize: {
      backdrops: 'w300',
      posters: 'w185'
    },

    fieldTranslate: {
      backdrops: 'fanart',
      posters: 'thumbnail'
    },

    //# Make a call to API
    call(path, params, callback) {
      const defaultParams =
        {api_key: config.getAPIKey('apiKeyTMDB', this.apiKey)};
      params = _.extend(defaultParams, params);
      const url = this.baseURL + path + helpers.url.buildParams(params) + '&callback=?';
      return $.getJSON(url, resp => callback(resp));
    },

    //# Get an image url, Sizes are:
    //# - Backdrop: w300, w780, w1280, original
    //# - Poster: w92, w154, w185, w342, w500, w780, original
    //# - Profile: w45, w185, h632, original
    //# - Stills: w92, w185, w300, original
    //# @see https://developers.themoviedb.org/3/configuration/get-api-configuration
    getImageURL(path, size = 'original') {
      return this.baseImageURL + size + path;
    },

    //# Parse response into an images collection
    parseImages(collection) {
      const items = [];
      for (var type in API.fieldTranslate) {
        var field = API.fieldTranslate[type];
        collection[type] = collection[type].slice(0, this.maxImageCount);
        for (var i in collection[type]) {
          var item = collection[type][i];
          item.id = item.file_path;
          item.url = this.getImageURL(item.file_path, 'original');
          item.thumbnail = this.getImageURL(item.file_path, this.thumbSize[type]);
          item.type = field;
          item.provider = 'moviedb';
          items.push(item);
        }
      }
      return items;
    },

    //# Find a movie
    find(id, source = 'imdb_id', callback) {
      return this.call('find/' + id, {external_source: source}, callback);
    },

    //# Get Images
    images(type, tmdbId, callback) {
      return this.call(type + '/' + tmdbId + '/images', {include_image_language: this.defaultLang + ',null'}, resp => {
        return callback(this.parseImages(resp));
      });
    },

    //# Get an image collection
    getCollection(options, callback) {
      const opts = _.extend({lookupType: 'imdb_id', lookupId: '', type: 'movie'}, options);
      const cacheKey = 'moviedb:' + JSON.stringify(opts);
      const cache = config.getLocal(cacheKey, []);
      if (cache.length > 0) {
        return API.createCollection(cache, callback);
      } else {
        return API.find(opts.lookupId, opts.lookupType, function(resp) {
          const resKey = opts.type + '_results';
          if (resp[resKey] && (resp[resKey].length > 0)) {
            const item = _.first(resp[resKey]);
            return API.images(opts.type, item.id, function(resp) {
              config.setLocal(cacheKey, resp);
              return API.createCollection(resp, callback);
            });
          } else {
            return API.createCollection([], callback);
          }
        });
      }
    },

    //# Create a collection from raw items
    createCollection(items, callback) {
      return callback(new Entities.ExternalCollection(items));
    }
  };



  //# Find movie images via IMDb ID
  App.commands.setHandler("themoviedb:movie:image:entities", function(lookupId, callback) {
    const options = {lookupId};
    return API.getCollection(options, callback);
  });

  //# Find tv images via IMDb ID
  return App.commands.setHandler("themoviedb:tv:image:entities", function(lookupId, callback) {
    const lookupType = lookupId.lastIndexOf('tt', 0) === 0 ? 'imdb_id' : 'tvdb_id';
    const options = {lookupId, lookupType, type: 'tv'};
    return API.getCollection(options, callback);
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Youtube collection
*/
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  var API = {

    apiKey: 'QUl6YVN5Qnh2YVI2bUNuVVdOOGN2MlRpUFJtdUVoMEZ5a0JUQUgw',
    searchUrl: 'https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoDefinition=any&videoEmbeddable=true&order=relevance&safeSearch=none',
    maxResults: 5,

    kodiUrl: 'plugin://plugin.video.youtube/?action=play_video&videoid=',
    ytURL: 'https://youtu.be/',

    getSearchUrl() {
      return this.searchUrl + '&key=' + config.getAPIKey('apiKeyYouTube', this.apiKey);
    },

    parseItems(response) {
      const items = [];
      const enabled = App.request("addon:isEnabled", {addonid: 'plugin.video.youtube'}) ? true : false;
      for (var i in response.items) {
        var item = response.items[i];
        var resp = {
          id: item.id.videoId,
          title: item.snippet.title,
          label: item.snippet.title,
          desc: item.snippet.description,
          thumbnail: item.snippet.thumbnails.medium.url,
          url: API.ytURL + item.id.videoId,
          addonEnabled: enabled
        };
        items.push(resp);
      }
      return items;
    }
  };


  const Cls = (Entities.YouTubeCollection = class YouTubeCollection extends Entities.ExternalCollection {
    static initClass() {
      this.prototype.model = Entities.ExternalEntity;
      this.prototype.url = API.getSearchUrl();
    }
    sync(method, collection, options) {
      options.dataType = "jsonp";
      options.timeout = 5000;
      return Backbone.sync(method, collection, options);
    }
    parse(resp) {
      return API.parseItems(resp);
    }
  });
  Cls.initClass();


  App.commands.setHandler("youtube:search:entities", function(query, options = {}, callback) {
    const yt = new Entities.YouTubeCollection();
    const data = _.extend({q: query, maxResults: API.maxResults}, options);
    return yt.fetch({
      data,
      success(collection) {
        return callback(collection);
      },
      error(collection) {
        return helpers.debug.log('Youtube search error', 'error', collection);
      }
    });
  });

  return App.commands.setHandler("youtube:trailer:entities", (title, callback) => App.execute("youtube:search:entities", title + ' trailer', {}, function(collection) {
    collection.map(function(item) {
      item.set({
        type: 'trailer',
        url: API.kodiUrl + item.id
      });
      return item;
    });
    return callback(collection);
  }));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {


  //# Filter entity.

  let Cls = (Entities.Filter = class Filter extends Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        alias: '',
        type: 'string',
        key: '',
        sortOrder: 'asc',
        title: '',
        active: false
      };
    }
  });
  Cls.initClass();

  Cls = (Entities.FilterCollection = class FilterCollection extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.Filter;
    }
  });
  Cls.initClass();


  Cls = (Entities.FilterOption = class FilterOption extends Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        key: '',
        value: '',
        title: ''
      };
    }
  });
  Cls.initClass();

  Cls = (Entities.FilterOptionCollection = class FilterOptionCollection extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.Filter;
    }
  });
  Cls.initClass();


  //# Sort entity.

  Cls = (Entities.FilterSort = class FilterSort extends Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        alias: '',
        type: 'string',
        defaultSort: false,
        defaultOrder: 'asc',
        key: '',
        active: false,
        order: 'asc',
        title: ''
      };
    }
  });
  Cls.initClass();

  Cls = (Entities.FilterSortCollection = class FilterSortCollection extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.FilterSort;
    }
  });
  Cls.initClass();


  //# Sort entity.

  Cls = (Entities.FilterActive = class FilterActive extends Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        key: '',
        values: [],
        title: ''
      };
    }
  });
  Cls.initClass();

  Cls = (Entities.FilterActiveCollection = class FilterActiveCollection extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.FilterActive;
    }
  });
  Cls.initClass();


  //# Requests.

  App.reqres.setHandler('filter:filters:entities', collection => new Entities.FilterCollection(collection));

  App.reqres.setHandler('filter:filters:options:entities', collection => new Entities.FilterOptionCollection(collection));

  App.reqres.setHandler('filter:sort:entities', collection => new Entities.FilterSortCollection(collection));

  return App.reqres.setHandler('filter:active:entities', collection => new Entities.FilterActiveCollection(collection));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  let Cls = (Entities.FormItem = class FormItem extends Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        id: 0,
        title: '',
        type: '',
        element: '',
        options: [],
        defaultValue: '',
        description: '',
        children: [],
        attributes: {},
        class: '',
        suffix: '',
        prefix: '',
        formState: {}
      };
    }
  });
  Cls.initClass();

  Cls = (Entities.Form = class Form extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.FormItem;
    }
  });
  Cls.initClass();


  var API = {

    applyState(item, formState) {
      item.formState = formState;
      item.defaultValue = item.defaultValue ? item.defaultValue : '';
      // Use 'valueProperty' to override where the value comes from (default is the id of the element)
      const property = item.valueProperty ? item.valueProperty : item.id;
      if (formState[property] != null) {
        item.defaultValue = this.formatDefaultValue(item.format, formState[property]);
        item.defaultsApplied = true;
      }
      return item;
    },

    formatDefaultValue(format, value) {
      if ((format === 'array.string') || (format === 'array.integer')) {
        return value.join('; ');
      } else if ((format === 'integer') && (value !== '')) {
        return parseInt(value);
      } else {
        return value;
      }
    },

    formatSubmittedValues(item, values) {
      if (item.format && (values[item.id] != null)) {
        if (item.format === 'array.string') {
          values[item.id] = values[item.id] !== '' ? _.map(values[item.id].split(';'), v => v.trim()) : [];
        } else if (item.format === 'array.integer') {
          values[item.id] = values[item.id] !== '' ? _.map(values[item.id].split(';'), v => parseInt(v.trim())) : [];
        } else if (item.format === 'integer') {
          values[item.id] = parseInt(values[item.id]);
        } else if (item.format === 'float') {
          values[item.id] = parseFloat(values[item.id]);
        } else if (item.format === 'prevent.submit') {
          delete values[item.id];
        }
      }
      return values;
    },

    processItems(items, formState = {}, isChild = false) {
      const collection = [];
      for (var item of items) {
        item = this.applyState(item, formState);
        if (item.children && (item.children.length > 0)) {
          item.children = API.processItems(item.children, formState, true);
        }
        collection.push(item);
      }
      return collection;
    },

    processSubmitted(items, formState = {}, isChild = false) {
      for (var item of items) {
        formState = this.formatSubmittedValues(item, formState);
        if (item.children && (item.children.length > 0)) {
          formState = API.processSubmitted(item.children.toJSON(), formState, true);
        }
      }
      return formState;
    },

    toCollection(items) {
      for (var i in items) {
        var item = items[i];
        if (item.children && (item.children.length > 0)) {
          var childCollection = new Entities.Form(item.children);
          items[i].children = childCollection;
        }
      }
      return new Entities.Form(items);
    }
  };


  //# Return a collection of form items parsed with the form state
  App.reqres.setHandler("form:item:entities", (form = [], formState = {}) => API.toCollection(API.processItems(form, formState)));

  //# Apply correct formatting to submitted values
  return App.reqres.setHandler("form:value:entities", (form = [], formState = {}) => API.processSubmitted(form, formState));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  const API = {

    cacheSynced(entities, callback) {
      return entities.on('cachesync', function() {
        callback();
        return helpers.global.loading("end");
      });
    },

    xhrsFetch(entities, callback) {
      const xhrs = _.chain([entities]).flatten().pluck("_fetch").value();
      return $.when(...xhrs).done(function() {
        callback();
        return helpers.global.loading("end");
      });
    }
  };


  //# When entity fetched use the xhrs response to trigger done.
  return App.commands.setHandler("when:entity:fetched", function(entities, callback) {
    helpers.global.loading("start");
    //# When collections are returned from cache they don't seem to have
    //# params so am using this as our check if it is an xhrs request or
    //# a cachehit.
    //# TODO: Keep an eye on this - https://github.com/madglory/backbone-fetch-cache/issues/113
    if (!entities.params) {
      return API.cacheSynced(entities, callback);
    } else {
      return API.xhrsFetch(entities, callback);
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  Backbone.fetchCache.localStorage = false;

  return (function() {
    const Cls = (KodiEntities.Collection = class Collection extends App.Entities.Collection {
      static initClass() {
        this.prototype.rpc = new Backbone.Rpc({
          namespaceDelimiter: ''
        });
      }

      //# Common jsonrpc settings.
      url() { return helpers.url.baseKodiUrl(this.constructor.name); }

      //# Add the options to the collection so we can use their args with rpc calls.
      sync(method, model, options) {
        if (method === 'read') {
          this.options = options;
        }
        return Backbone.sync(method, model, options);
      }

      //# Set our custom cache keys.
      getCacheKey(options) {
        this.options = options;
        let key = this.constructor.name;
        for (var k of ['filter', 'sort', 'limit', 'file']) {
          if (options[k]) {
            for (var prop in options[k]) {
              var val = options[k][prop];
              key += ':' + prop + ':' + val;
            }
          }
        }
        return key;
      }

      //# When using cache, it doesn't respect the jsonrpc parsing
      //# so we use this to parse all collection results using cache.
      getResult(response, key) {
        this.responseKey = key;
        const result = response.jsonrpc && response.result ? response.result : response;
        return result[key];
      }

      //# Common arg patterns all checking if the params exist in options first.
      argCheckOption(option, fallback) {
        if ((this.options != null) && (this.options[option] != null)) {
          return this.options[option];
        } else {
          return fallback;
        }
      }

      //# Sort.
      argSort(method, order = 'ascending') {
        const arg = {method, order, ignorearticle: this.isIgnoreArticle()};
        return this.argCheckOption('sort', arg);
      }

      //# Limit.
      argLimit(start = 0, end = 'all') {
        const arg = {start};
        if (end !== 'all') {
          arg.end = end;
        }
        return this.argCheckOption('limit', arg);
      }

      //# Filter.
      argFilter(name, value) {
        let arg = {};
        if (name != null) {
          arg[name] = value;
        } else {
          arg = undefined;
        }
        return this.argCheckOption('filter', arg);
      }

      //# Allow replacing fields (fields) or adding additional fields (addFields) via options.
      //# Both expect an array.
      argFields(fields) {
        if ((this.options != null) && (this.options.fields != null)) {
          ({
            fields
          } = this.options);
        }
        if ((this.options != null) && (this.options.addFields != null)) {
          for (var field of this.options.addFields) {
            if (!helpers.global.inArray(field, fields)) {
              fields.push(field);
            }
          }
        }
        return fields;
      }

      //# Should we ignore article when sorting?
      isIgnoreArticle() {
        return config.getLocal('ignoreArticle', true);
      }

      //# Get Args
      getArgs(defaults) {
        const args = (this.options != null) ? _.extend(defaults, this.options) : defaults;
        return args;
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", (KodiEntities, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (KodiEntities.Model = class Model extends App.Entities.Model {
    static initClass() {
      this.prototype.rpc = new Backbone.Rpc({
        useNamedParameters: true,
        namespaceDelimiter: ''
      });
      this.prototype.modelDefaults = {
        fullyloaded: false,
        thumbnail: '',
        thumbsUp: 0,
        parsed: false,
        progress: 0
      };
    }

    initialize() {
      if (this.methods) {
        // On model update (eg edit) reload the model
        return App.vent.on('entity:kodi:update', uid => {
          if (this.get('uid') === uid) {
            const fields = App.request(this.get('type') + ":fields");
            if (fields && (fields.length > 0)) {
              return this.fetch({properties: fields, success: updatedModel => {
                return Backbone.fetchCache.clearItem(updatedModel);
              }
              });
            }
          }
        });
      }
    }

    url() { return helpers.url.baseKodiUrl(this.constructor.name); }

    //# This is our generic way of updating things that need to be
    //# added or changed on all models prior to creation, should be
    //# called during model.parse()
    parseModel(type, model, id) {
      if (!model.parsed) {

        // Setup some additional attributes
        if (id !== 'mixed') {
          model.id = id;
        }
        if (model.rating) {
          model.rating = helpers.global.rating(model.rating);
        }
        if (model.streamdetails && _.isObject(model.streamdetails)) {
          model.streamdetails = helpers.stream.streamFormat(model.streamdetails);
        }
        if (model.resume) {
          model.progress = model.resume.position === 0 ? 0 : Math.round((model.resume.position / model.resume.total) * 100);
        }
        if (model.trailer) {
          model.mediaTrailer = helpers.url.parseTrailerUrl(model.trailer);
        }
        if (model.starttime) {
          model.start = helpers.global.dateStringToObj(model.starttime);
        }
        if (model.endtime) {
          model.end = helpers.global.dateStringToObj(model.endtime);
        }

        // artwork is in art map since kodi 19. Fallbacks of poster to thumb have been removed
        if ((type === 'movie') || (type === 'tvshow') || (type === 'season')) {
          model.fanart = 'fanart' in model.art ? model.art.fanart : undefined;
          model.thumbnail = (() => {
            if ('poster' in model.art) { return model.art.poster; } else if ('thumb' in model.art) { return model.art.thumb; }
          })();
        }

        if ((type === 'tvshow') || (type === 'season')) {
          model.progress = helpers.global.round(((model.watchedepisodes / model.episode) * 100), 2);
        }
        if ((type === 'episode') || ((type === 'movie') && (model.progress === 0))) {
          model.progress = model.playcount === 0 ? 0 : 100;
        }
        if ((type === 'album') || (type === 'artist')) {
          model.progress = 0;
        }

        // Set URL.
        if (type === 'episode') {
          model.url = helpers.url.get(type, id, {':tvshowid': model.tvshowid, ':season': model.season});
        } else if (type === 'channel') {
          //# Check pvr for subtype
          if (model.channeltype === 'tv') { type = "channeltv"; } else { type = "channelradio"; }
          model.url = helpers.url.get(type, id);
        } else {
          model.url = helpers.url.get(type, id);
        }

        model = App.request("images:path:entity", model);
        model.type = type;
        model.uid = helpers.entities.createUid(model, type);
        model.parsed = true;
      }
      return model;
    }

    //# Parse fields into defaults. Sets all to null.
    parseFieldsToDefaults(fields, defaults = {}) {
      for (var field of fields) {
        defaults[field] = '';
      }
      return defaults;
    }

    // Check the response, it might be cached and parsing can be skipped.
    //
    // @param [Object] Response from the API
    // @param [String] The key to check against.
    // @return [Object] the response with the fullyloaded property set if parsing can be skipped.
    //
    checkResponse(response, checkKey) {
      const obj = (response[checkKey] != null) ? response[checkKey] : response;
      if (response[checkKey] != null) {
        obj.fullyloaded = true;
      }
      return obj;
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    availableProviders: ['video', 'audio', 'executable'],

    fields: {
      minimal: ['addonid', 'name', 'type', 'thumbnail', 'label'],
      small: ['author', 'broken', 'description', 'version', 'enabled', 'extrainfo', 'summary'],
      full: ['fanart', 'path']
    },

    //# Fetch an entity collection.
    getCollection(type, callback) {
      const addonController = App.request("command:kodi:controller", 'auto', 'AddOn');
      return addonController.getEnabledAddons(true, function(addons) {
        const collection = new KodiEntities.AddonCollection(API.parseAddons(addons, type));
        return callback(collection);
      });
    },

    //# Parse the addons, adding a provides property and setup other properties we'll need
    parseAddons(addons, type) {
      const ret = [];
      for (var i in addons) {
        var addon = addons[i];
        addon.provides = [];
        addon.label = addon.name;
        addon = App.request("images:path:entity", addon);
        for (var extra of addon.extrainfo) {
          // We use the extrainfo to filter to only addons that provide content
          if (_.isObject(extra) && (extra.key === 'provides') && extra.value && helpers.global.inArray(extra.value, API.availableProviders)) {
            addon.provides.push(extra.value);
          }
        }
        // If addon provides and filter matches, add to collection
        if ((addon.provides.length > 0) && (helpers.global.inArray(type, addon.provides) || (type === 'all'))) {
          addon.providesDefault = _.first(addon.provides);
          addon.subtitle = tr(addon.providesDefault);
          ret.push(API.parsePath(addon));
        }
      }
      return ret;
    },

    //# Create a path for the addon depending on its function
    parsePath(addon) {
      if (helpers.global.inArray('executable', addon.provides)) {
        addon.url = 'addon/execute/' + addon.addonid;
      } else {
        const media = addon.providesDefault.replace('audio', 'music');
        addon.url = 'browser/' + media + '/' + encodeURIComponent('plugin://' + addon.addonid + '/');
      }
      return addon;
    }
  };


  /*
   Models and collections.
  */

  //# Single Addon model.
  let Cls = (KodiEntities.Addon = class Addon extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.idAttribute = "addonid";
    }
    defaults() {
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), {});
    }
  });
  Cls.initClass();

  //# Addon collection
  Cls = (KodiEntities.AddonCollection = class AddonCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Addon;
    }
  });
  Cls.initClass();


  /*
   Request Handlers.
  */

  //# Get a addon collection, optionally filtered by provider type
  return App.reqres.setHandler("addon:entities", (type = 'all', callback) => API.getCollection(type, callback));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  var API = {

    fields: {
      minimal: ['thumbnail'],
      small: ['playcount', 'artistid', 'artist', 'genre', 'albumlabel', 'year', 'dateadded', 'style'],
      full: ['fanart', 'mood', 'description', 'rating', 'type', 'theme']
    },

    //# Fetch a single album
    getAlbum(id, options) {
      const album = new App.KodiEntities.Album();
      album.set({albumid: parseInt(id), properties: helpers.entities.getFields(API.fields, 'full')});
      album.fetch(options);
      return album;
    },

    //# Fetch an album collection.
    getAlbums(options) {
      const collection = new KodiEntities.AlbumCollection();
      collection.fetch(helpers.entities.buildOptions(options));
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single album model.
  let Cls = (KodiEntities.Album = class Album extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {
        read: ['AudioLibrary.GetAlbumDetails', 'albumid', 'properties']
      };
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {albumid: 1, album: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      //# If fetched directly, look in album details and mark as fully loaded
      const obj = (resp.albumdetails != null) ? resp.albumdetails : resp;
      obj.title = obj.label;
      if (resp.albumdetails != null) {
        obj.fullyloaded = true;
      }
      return this.parseModel('album', obj, obj.albumid);
    }
  });
  Cls.initClass();

  //# Albums collection
  Cls = (KodiEntities.AlbumCollection = class AlbumCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Album;
      this.prototype.methods = {read: ['AudioLibrary.GetAlbums', 'properties', 'limits', 'sort', 'filter']};
    }
    args() { return this.getArgs({
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit(),
      sort: this.argSort('title', 'ascending'),
      filter: this.argFilter()
    }); }
    parse(resp, xhr) { return this.getResult(resp, 'albums'); }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  //# Get a single album
  App.reqres.setHandler("album:entity", (id, options = {}) => API.getAlbum(id, options));

  //# Get an album collection
  App.reqres.setHandler("album:entities", (options = {}) => API.getAlbums(options));

  //# Get full field/property list for entity
  return App.reqres.setHandler("album:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  var API = {

    fields: {
      minimal: [],
      small: ['thumbnail', 'mood', 'genre', 'style'],
      full: ['fanart', 'born', 'formed', 'description', 'died', 'disbanded', 'yearsactive', 'instrument', 'musicbrainzartistid']
    },

    //# Fetch a single artist
    getArtist(id, options) {
      const artist = new App.KodiEntities.Artist();
      artist.set({artistid: parseInt(id), properties: helpers.entities.getFields(API.fields, 'full')});
      artist.fetch(options);
      return artist;
    },

    //# Fetch an artist collection.
    getArtists(options) {
      const collection = new KodiEntities.ArtistCollection();
      collection.fetch(helpers.entities.buildOptions(options));
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single artist model.
  let Cls = (KodiEntities.Artist = class Artist extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {
        read: ['AudioLibrary.GetArtistDetails', 'artistid', 'properties']
      };
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {artistid: 1, artist: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      //# If fetched directly, look in artist details and mark as fully loaded
      const obj = (resp.artistdetails != null) ? resp.artistdetails : resp;
      if (resp.artistdetails != null) {
        obj.fullyloaded = true;
      }
      return this.parseModel('artist', obj, obj.artistid);
    }
  });
  Cls.initClass();

  //# Artists collection
  Cls = (KodiEntities.ArtistCollection = class ArtistCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Artist;
      this.prototype.methods = {read: ['AudioLibrary.GetArtists', 'albumartistsonly', 'properties', 'limits', 'sort', 'filter']};
    }
    args() { return this.getArgs({
      albumartistsonly: config.getLocal('albumArtistsOnly', true),
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit(),
      sort: this.argSort('title', 'ascending'),
      filter: this.argFilter()
    }); }
    parse(resp, xhr) { return this.getResult(resp, 'artists'); }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  //# Get a single artist
  App.reqres.setHandler("artist:entity", (id, options = {}) => API.getArtist(id, options));

  //# Get an artist collection
  App.reqres.setHandler("artist:entities", function(options = {}) {
    // If using filters, search all artists
    if (options.filter && (options.albumartistsonly !== true)) {
      options.albumartistsonly = false;
    }
    return API.getArtists(options);
  });

  //# Get full field/property list for entity
  return App.reqres.setHandler("artist:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  const API = {

    fields: {
      minimal: ['name'],
      small: ['order', 'role', 'thumbnail', 'origin', 'url'],
      full: []
    },

    //# Fetch an entity collection.
    getCollection(cast, origin) {
      for (var i in cast) {
        var item = cast[i];
        cast[i].origin = origin;
      }
      const collection = new KodiEntities.CastCollection(cast);
      return collection;
    }
  };


  /*
   Models and collections.
  */

  //# Single Casts model.
  let Cls = (KodiEntities.Cast = class Cast extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.idAttribute = "order";
    }
    defaults() {
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'small'), {});
    }
    parse(obj, xhr) {
      obj.url = '?cast=' + obj.name;
      return obj;
    }
  });
  Cls.initClass();

  //# Castss collection
  Cls = (KodiEntities.CastCollection = class CastCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Cast;
    }
  });
  Cls.initClass();


  /*
   Request Handlers.
  */

  //# Get an cast collection
  return App.reqres.setHandler("cast:entities", (cast, origin) => API.getCollection(cast, origin));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    fields: {
      minimal: [],
      small: ['title', 'runtime', 'starttime', 'endtime', 'genre', 'progress'],
      full: ["plot", "plotoutline", "progresspercentage", "episodename", "episodenum", "episodepart", "firstaired", "hastimer", "isactive", "parentalrating", "wasactive", "thumbnail", "rating", "originaltitle", "cast", "director", "writer", "year", "imdbnumber", "hastimerrule", "hasrecording", "recording", "isseries"]
    },

    //# Fetch a single entity
    getEntity(channelid, options) {
      const entity = new App.KodiEntities.Broadcast();
      entity.set({channelid: parseInt(channelid), properties: helpers.entities.getFields(API.fields, 'full')});
      entity.fetch(options);
      return entity;
    },

    //# Fetch an entity collection.
    getCollection(options) {
      const defaultOptions = {useNamedParameters: true};
      options = _.extend(defaultOptions, options);
      const collection = new KodiEntities.BroadcastCollection();
      collection.fetch(options);
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single Channel model.
  let Cls = (KodiEntities.Broadcast = class Broadcast extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {read: ['PVR.GetBroadcasts', 'channelid', 'properties']};
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {channelid: 1, channel: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      const obj = (resp.broadcasts != null) ? resp.broadcasts : resp;
      if (resp.broadcasts != null) {
        obj.fullyloaded = true;
      }
      return this.parseModel('broadcast', obj, obj.broadcastid);
    }
  });
  Cls.initClass();

  //# Channel collection
  Cls = (KodiEntities.BroadcastCollection = class BroadcastCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Broadcast;
      this.prototype.methods = {read: ['PVR.GetBroadcasts', 'channelid', 'properties', 'limits']};
    }
    args() { return this.getArgs({
      channelid: this.argCheckOption('channelid', 0),
      properties: helpers.entities.getFields(API.fields, 'full'),
      limits: this.argLimit()
    }); }
    parse(resp, xhr) {
      return this.getResult(resp, 'broadcasts');
    }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  // Get a single channel
  App.reqres.setHandler("broadcast:entity", (collection, channelid) => API.getEntity(collection, parseInt(channelid)));

  //# Get an channel collection
  return App.reqres.setHandler("broadcast:entities", function(channelid, options = {}) {
    options.channelid = parseInt(channelid);
    return API.getCollection(options);
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {


  /*
    API Helpers
  */

  var API = {

    fields: {
      minimal: ['title'],
      small: ['thumbnail', 'playcount', 'lastplayed', 'dateadded', 'episode', 'season', 'rating', 'file', 'cast', 'showtitle', 'tvshowid', 'uniqueid', 'resume', 'firstaired'],
      full: ['fanart', 'plot', 'director', 'writer', 'runtime', 'streamdetails']
    },

    //# Fetch a single entity
    getEntity(id, options) {
      const entity = new App.KodiEntities.Episode();
      entity.set({episodeid: parseInt(id), properties:  helpers.entities.getFields(API.fields, 'full')});
      entity.fetch(options);
      return entity;
    },

    //# Fetch an entity collection.
    getCollection(options) {
      const defaultOptions = {cache: false, expires: config.get('static', 'collectionCacheExpiry'), useNamedParameters: true};
      options = _.extend(defaultOptions, options);
      const collection = new KodiEntities.EpisodeCollection();
      collection.fetch(options);
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single Episodes model.
  let Cls = (KodiEntities.Episode = class Episode extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {read: ['VideoLibrary.GetEpisodeDetails', 'episodeid', 'properties']};
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {episodeid: 1, episode: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      const obj = (resp.episodedetails != null) ? resp.episodedetails : resp;
      if (resp.episodedetails != null) {
        obj.fullyloaded = true;
      }
      obj.unwatched = obj.playcount > 0 ? 0 : 1;
      return this.parseModel('episode', obj, obj.episodeid);
    }
  });
  Cls.initClass();

  //# Episodes collection
  Cls = (KodiEntities.EpisodeCollection = class EpisodeCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Episode;
      this.prototype.methods = {read: ['VideoLibrary.GetEpisodes', 'tvshowid', 'season', 'properties', 'limits', 'sort', 'filter']};
    }
    args() { return this.getArgs({
      tvshowid: this.argCheckOption('tvshowid', undefined),
      season: this.argCheckOption('season', undefined),
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit(),
      sort: this.argSort("episode", "ascending"),
      filter: this.argCheckOption('filter', undefined)
    }); }
    parse(resp, xhr) { return this.getResult(resp, 'episodes'); }
  });
  Cls.initClass();

  //# Episode Custom collection, assumed passed an array of raw entity data.
  Cls = (KodiEntities.EpisodeCustomCollection = class EpisodeCustomCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Episode;
    }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  // Get a single episode
  App.reqres.setHandler("episode:entity", (id, options = {}) => API.getEntity(id, options));

  //# Get an episode collection
  App.reqres.setHandler("episode:entities", (options = {}) => API.getCollection(options));

  //# Get an episode collection
  App.reqres.setHandler("episode:tvshow:entities", function(tvshowid, season, options = {}) {
    if (tvshowid !== 'all') {
      options.tvshowid = tvshowid;
      if (season !== 'all') {
        options.season = season;
      }
    }
    return API.getCollection(options);
  });

  //# Given an array of models, return as collection.
  App.reqres.setHandler("episode:build:collection", items => new KodiEntities.EpisodeCustomCollection(items));

  //# Get full field/property list for entity
  return App.reqres.setHandler("episode:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    fields: {
      minimal: ['title', 'file', 'mimetype'],
      small: ['thumbnail', 'dateadded'],
      full: ['fanart', 'streamdetails']
    },
    addonFields: ['path', 'name'],

    sources: [
      {media: 'video', label: 'Video', type: 'source', provides: 'video'},
      {media: 'music', label: 'Music', type: 'source', provides: 'audio'},
      {media: 'music', label: 'Audio add-ons', type: 'addon', provides: 'audio', addonType: 'xbmc.addon.audio', content: 'unknown'},
      {media: 'video', label: 'Video add-ons', type: 'addon', provides: 'files', addonType: 'xbmc.addon.video', content: 'unknown'}
    ],

    directorySeparator: '/',

    //# Fetch a single entity
    getEntity(id, options) {
      const entity = new App.KodiEntities.File();
      entity.set({file: id, properties:  helpers.entities.getFields(API.fields, 'full')});
      entity.fetch(options);
      return entity;
    },

    //# Fetch an entity collection.
    getCollection(type, options) {
      let collection;
      const defaultOptions = {cache: true, useNamedParameters: true};
      options = _.extend(defaultOptions, options);
      if (type === 'sources') {
        collection = new KodiEntities.SourceCollection();
      } else {
        collection = new KodiEntities.FileCollection();
      }
      collection.fetch(options);
      return collection;
    },

    //# Split a collection into files and folders
    parseToFilesAndFolders(collection) {
      const all = collection.getRawCollection();
      const collections = {};
      collections.file = new KodiEntities.FileCustomCollection(_.where(all, {filetype: 'file'}));
      collections.directory = new KodiEntities.FileCustomCollection(_.where(all, {filetype: 'directory'}));
      return collections;
    },

    //# Get a source media types, we don't use backbone.rpc because it's multiple
    //# calls seem really flaky on collections as it is geared towards models.
    //# This allows better parsing anyway as we can add the media to each model.
    //# We also parse in available addon sources.
    getSources() {
      let source;
      const commander = App.request("command:kodi:controller", 'auto', 'Commander');
      const commands = [];
      let collection = new KodiEntities.SourceCollection();
      for (source of this.sources) {
        if (source.type === 'source') {
          commands.push({method: 'Files.GetSources', params: [source.media]});
        }
        if (source.type === 'addon') {
          commands.push({method: 'Addons.GetAddons', params: [source.addonType, source.content, true, this.addonFields]});
        }
      }
      //# Parse the source response and create a collection
      commander.multipleCommands(commands, resp => {
        for (var i in resp) {
          var item = resp[i];
          source = this.sources[i];
          var responseKey = source.type + 's';
          if (item[responseKey]) {
            for (var model of item[responseKey]) {
              model.media = source.media;
              model.sourcetype = source.type;
              if (source.type === 'addon') {
                model.file = this.createAddonFile(model);
                model.label = model.name;
              }
              model.url = this.createFileUrl(source.media, model.file);
              collection.add(model);
            }
          }
        }
        collection = this.addPlaylists(collection);
        return collection.trigger('cachesync');
      });
      return collection;
    },

    //# Turn the full source collection into collection sets.
    parseSourceCollection(collection) {
      const all = collection.getRawCollection();
      collection = [];
      for (var source of this.sources) {
        var items = _.where(all, {media: source.media});
        if ((items.length > 0) && (source.type === 'source')) {
          source.sources = new KodiEntities.SourceCollection(items);
          source.url = 'browser/' + source.media;
          collection.push(source);
        }
      }
      return new KodiEntities.SourceSetCollection(collection);
    },

    //# Create a url for this file/folder
    createFileUrl(media, file) {
      return 'browser/' + media + '/' + encodeURIComponent(file);
    },

    //# Create a url for an addon
    createAddonFile(addon) {
      return 'plugin://' + addon.addonid + this.directorySeparator;
    },

    //# Parse files for extra data
    parseFiles(items, media) {
      for (var i in items) {
        var item = items[i];
        if (!item.parsed) {
          item = App.request("images:path:entity", item);
          items[i] = this.correctFileType(item);
          items[i].media = media;
          items[i].player = this.getPlayer(media);
          items[i].url = this.createFileUrl(media, item.file);
          items[i].parsed = true;
          items[i].defaultSort = parseInt(i);
          items[i].label = helpers.global.removeBBCode(item.label);
        }
      }
      return items;
    },

    //# Add music and video playlist sources.
    addPlaylists(collection) {
      const types = ['video', 'music'];
      for (var type of types) {
        var model = this.createPathModel(type, t.gettext('Playlists'), 'special://profile/playlists/' + type);
        model.sourcetype = 'playlist';
        collection.add(model);
      }
      return collection;
    },

    //# The damn kodi api is returning folders with a filetype of 'file' !!??!
    //# So we do some extra checking and parsing to correct the filetype.
    //# TODO: follow up with montelese and topfs
    correctFileType(item) {
      const directoryMimeTypes = ['x-directory/normal'];
      if (item.mimetype && helpers.global.inArray(item.mimetype, directoryMimeTypes)) {
        item.filetype = 'directory';
      }
      return item;
    },

    //# Parse a path and attempt to make a collection from it
    createPathCollection(file, sourcesCollection) {
      const items = [];
      let parentSource = {};
      const allSources = sourcesCollection.getRawCollection();
      for (var source of allSources) {
        if (parentSource.file) { //# only match on the first found
          continue;
        }
        if (helpers.global.stringStartsWith(source.file, file)) {
          parentSource = source;
        }
      }
      if (parentSource.file) {
        items.push(parentSource);
        let basePath = parentSource.file;
        const pathParts = helpers.global.stringStripStartsWith(parentSource.file, file).split(this.directorySeparator);
        const excludedPaths = App.request("addon:excludedPaths", parentSource.addonid);
        for (var part of pathParts) {
          if (part !== '') {
            basePath += part + this.directorySeparator;
            if (excludedPaths.indexOf(basePath) === -1) { //# Don't add excluded paths
              items.push(this.createPathModel(parentSource.media, part, basePath));
            }
          }
        }
      }
      return new KodiEntities.FileCustomCollection(items);
    },

    //# Create a model structure for a virtual path entity.
    createPathModel(media, label, file) {
      const model = {
        label,
        file,
        media,
        url: this.createFileUrl(media, file)
      };
      return model;
    },

    //# fix the naming discrepancy between files and the rest of the app :(
    getPlayer(media) {
      if (media === 'music') {
        'audio';
      }
      return media;
    }
  };


  /*
   Models and collections.
  */

  //# Single File model.
  let Cls = (KodiEntities.EmptyFile = class EmptyFile extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.idAttribute = "file";
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {filetype: 'directory', media: '', label: '', url: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
  });
  Cls.initClass();

  //# Single File model.
  Cls = (KodiEntities.File = class File extends KodiEntities.EmptyFile {
    static initClass() {
      this.prototype.methods = {read: ['Files.GetFileDetails', 'file', 'properties']};
    }
    parse(resp, xhr) {
      const obj = (resp.filedetails != null) ? resp.filedetails : resp;
      if (resp.filedetails != null) {
        obj.fullyloaded = true;
      }
      return obj;
    }
  });
  Cls.initClass();

  //# Files collection
  Cls = (KodiEntities.FileCollection = class FileCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.File;
      this.prototype.methods = {read: ['Files.GetDirectory', 'directory', 'media', 'properties', 'sort']};
    }
    args() { return this.getArgs({
      directory: this.argCheckOption('file', ''),
      media: this.argCheckOption('media', ''),
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      sort: this.argSort('none', 'ascending')
    }); }
    parse(resp, xhr) {
      const items = this.getResult(resp, 'files');
      return API.parseFiles(items, this.options.media);
    }
  });
  Cls.initClass();


  //# Files custom collection (for splitting into files and folders)
  Cls = (KodiEntities.FileCustomCollection = class FileCustomCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.File;
    }
  });
  Cls.initClass();

  //# Sources model.
  Cls = (KodiEntities.Source = class Source extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.idAttribute = "file";
      this.prototype.defaults = {
        label: '',
        file: '',
        media: '',
        url: ''
      };
    }
  });
  Cls.initClass();

  //# Files collection
  Cls = (KodiEntities.SourceCollection = class SourceCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Source;
    }
  });
  Cls.initClass();


  //# Sources set model.
  Cls = (KodiEntities.SourceSet = class SourceSet extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.idAttribute = "file";
      this.prototype.defaults = {
        label: '',
        sources: ''
      };
    }
  });
  Cls.initClass();

  //# Files collection
  Cls = (KodiEntities.SourceSetCollection = class SourceSetCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Source;
    }
  });
  Cls.initClass();


  /*
   Request Handlers.
  */

  // Get a single file
  App.reqres.setHandler("file:entity", (id, options = {}) => API.getEntity(id, options));

  // Create a new file entity with info extracted from the url
  App.reqres.setHandler("file:url:entity", function(media, hash) {
    const file = decodeURIComponent(hash);
    return new KodiEntities.EmptyFile({media, file, url: API.createFileUrl(media, file)});
});

  //# Get an file collection
  App.reqres.setHandler("file:entities", (options = {}) => API.getCollection('files', options));

  // Get a path collection, requires a sources collection
  App.reqres.setHandler("file:path:entities", (file, sourceCollection) => API.createPathCollection(file, sourceCollection));

  //# Get an file/directory collection
  App.reqres.setHandler("file:parsed:entities", collection => API.parseToFilesAndFolders(collection));

  //# Get all sources.
  App.reqres.setHandler("file:source:entities", media => API.getSources());

  //# Create a new source sub collection sources.
  App.reqres.setHandler("file:source:media:entities", collection => API.parseSourceCollection(collection));

  //# Get a source media types
  return App.reqres.setHandler("file:source:mediatypes", () => API.availableSources);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  const API = {

    fields: {
      minimal: ['title'],
      small: ['thumbnail'],
      full: []
    },

    //# Fetch a single entity, requires a channel collection passed.
    getEntity(collection, genre) {
      return collection.findWhere({title: genre});
    },

    //# Fetch an entity collection.
    getCollection(type, options) {
      const collection = new KodiEntities.GenreAudioCollection();
      collection.fetch(helpers.entities.buildOptions(options));
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single Genre model.
  KodiEntities.Genre = class Genre extends App.KodiEntities.Model {
    defaults() {
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), {});
    }
    parse(obj, xhr) {
      obj.fullyloaded = true;
      obj.url = 'music/genre/' + encodeURIComponent(obj.title);
      return obj;
    }
  };

  //# Genres audio collection
  const Cls = (KodiEntities.GenreAudioCollection = class GenreAudioCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Genre;
      this.prototype.methods = {read: ['AudioLibrary.GetGenres', 'properties', 'limits', 'sort']};
    }
    args() { return this.getArgs({
      properties: helpers.entities.getFields(API.fields, 'small'),
      limits: this.argLimit(),
      sort: this.argSort('title', 'ascending')
    }); }
    parse(resp, xhr) {
      return this.getResult(resp, 'genres');
    }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  // Get a single genre
  App.reqres.setHandler("genre:entity", (collection, genre) => API.getEntity(collection, genre));

  //# Get a genre collection
  return App.reqres.setHandler("genre:entities", (type = 'audio', options = {}) => API.getCollection(type, options));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    fields: {
      minimal: ['title', 'art'],
      small: ['playcount', 'lastplayed', 'dateadded', 'resume', 'rating', 'year', 'file', 'genre', 'writer', 'director', 'cast', 'set', 'studio', 'mpaa', 'tag'],
      full: ['plotoutline', 'imdbnumber', 'runtime', 'streamdetails', 'plot', 'trailer', 'sorttitle', 'originaltitle', 'country']
    },

    //# Fetch a single entity
    getEntity(id, options) {
      const entity = new App.KodiEntities.Movie();
      entity.set({movieid: parseInt(id), properties:  helpers.entities.getFields(API.fields, 'full')});
      entity.fetch(options);
      return entity;
    },

    //# Fetch an entity collection.
    getCollection(options) {
      const collection = new KodiEntities.MovieCollection();
      collection.fetch(helpers.entities.buildOptions(options));
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single Movie model.
  let Cls = (KodiEntities.Movie = class Movie extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {read: ['VideoLibrary.GetMovieDetails', 'movieid', 'properties']};
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {movieid: 1, movie: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      const obj = (resp.moviedetails != null) ? resp.moviedetails : resp;
      if (resp.moviedetails != null) {
        obj.fullyloaded = true;
      }
      obj.unwatched = obj.playcount > 0 ? 0 : 1;
      return this.parseModel('movie', obj, obj.movieid);
    }
  });
  Cls.initClass();

  //# Movies collection
  Cls = (KodiEntities.MovieCollection = class MovieCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Movie;
      this.prototype.methods = {read: ['VideoLibrary.GetMovies', 'properties', 'limits', 'sort', 'filter']};
    }
    args() { return this.getArgs({
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit(),
      sort: this.argSort('title', 'ascending'),
      filter: this.argFilter()
    }); }
    parse(resp, xhr) { return this.getResult(resp, 'movies'); }
  });
  Cls.initClass();

  //# Movie Custom collection, assumed passed an array of raw entity data.
  Cls = (KodiEntities.MovieCustomCollection = class MovieCustomCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Movie;
    }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  // Get a single movie
  App.reqres.setHandler("movie:entity", (id, options = {}) => API.getEntity(id, options));

  //# Get an movie collection
  App.reqres.setHandler("movie:entities", (options = {}) => API.getCollection(options));

  //# Given an array of models, return as collection.
  App.reqres.setHandler("movie:build:collection", items => new KodiEntities.MovieCustomCollection(items));

  //# Get full field/property list for entity
  return App.reqres.setHandler("movie:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  var API = {

    fields: {
      minimal: ['title'],
      small: ['thumbnail', 'file', 'genre', 'artist', 'year', 'playcount', 'dateadded', 'streamdetails', 'album', 'resume', 'director', 'rating'],
      full: ['fanart', 'studio', 'plot', 'track', 'tag']
    },

    //# Fetch a single artist
    getVideo(id, options) {
      const artist = new App.KodiEntities.MusicVideo();
      artist.set({musicvideoid: parseInt(id), properties: helpers.entities.getFields(API.fields, 'full')});
      artist.fetch(options);
      return artist;
    },

    //# Fetch an artist collection.
    getVideos(options) {
      const collection = new KodiEntities.MusicVideoCollection();
      collection.fetch(helpers.entities.buildOptions(options));
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single video model.
  let Cls = (KodiEntities.MusicVideo = class MusicVideo extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {
        read: ['VideoLibrary.GetMusicVideoDetails', 'musicvideoid', 'properties']
      };
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {musicvideoid: 1, title: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      const obj = (resp.musicvideodetails != null) ? resp.musicvideodetails : resp;
      if (resp.musicvideodetails != null) {
        obj.fullyloaded = true;
      }
      return this.parseModel('musicvideo', obj, obj.musicvideoid);
    }
  });
  Cls.initClass();

  //# Video collection
  Cls = (KodiEntities.MusicVideoCollection = class MusicVideoCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.MusicVideo;
      this.prototype.methods = {read: ['VideoLibrary.GetMusicVideos', 'properties', 'limits', 'sort', 'filter']};
    }
    args() { return this.getArgs({
      properties: this.argFields(helpers.entities.getFields(API.fields, 'full')),
      limits: this.argLimit(),
      sort: this.argSort('title', 'ascending'),
      filter: this.argFilter()
    }); }
    parse(resp, xhr) { return this.getResult(resp, 'musicvideos'); }
  });
  Cls.initClass();

  //# Video Custom collection, assumed passed an array of raw entity data.
  Cls = (KodiEntities.MusicVideoCustomCollection = class MusicVideoCustomCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.MusicVideo;
    }
  });
  Cls.initClass();


  /*
   Request Handlers.
  */

  //# Get a single video
  App.reqres.setHandler("musicvideo:entity", (id, options = {}) => API.getVideo(id, options));

  //# Get an video collection
  App.reqres.setHandler("musicvideo:entities", (options = {}) => API.getVideos(options));

  //# Get full field/property list for entity
  App.reqres.setHandler("musicvideo:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));

  //# Given an array of models, return as collection.
  return App.reqres.setHandler("musicvideo:build:collection", items => new KodiEntities.MusicVideoCustomCollection(items));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    fields: {
      minimal: ['title', 'thumbnail', 'file'],
      small: ['artist', 'genre', 'year', 'rating', 'album', 'track', 'duration', 'playcount', 'dateadded', 'episode', 'artistid', 'albumid', 'tvshowid'],
      full: ['fanart']
    },

    //# Types that can be thumbed up
    canThumbsUp: ['song', 'movie', 'episode'],

    //# Fetch an entity collection.
    getCollection(options) {
      const defaultOptions = {cache: false, useNamedParameters: true};
      options = _.extend(defaultOptions, options);
      const collection = new KodiEntities.PlaylistCollection();
      collection.fetch(options);
      return collection;
    },

    //# Attempt to get the type of a playlist item by parsing the properties
    getType(item, media) {
      let type = 'file';
      if ((item.id !== undefined) && (item.id !== '')) {
        if (media === 'audio') {
          type = 'song';
        } else if (media === 'video') {
          if (item.episode !== '') {
            type = 'episode';
          } else {
            type = 'movie';
          }
        }
      }
      return type;
    },

    //# Enrich the playlist item with as much extra data as possible.
    parseItems(items, options) {
      for (var i in items) {
        var item = items[i];
        item.position = parseInt(i);
        items[i] = this.parseItem(item, options);
      }
      return items;
    },

    parseItem(item, options) {
      item.playlistid = options.playlistid;
      item.media = options.media;
      item.player = 'kodi';
      if (!item.type || (item.type === 'unknown')) {
        item.type = API.getType(item, options.media);
      }
      if (item.type === 'file') {
        item.id = item.file;
      }
      item.uid = helpers.entities.createUid(item);
      item.canThumbsUp = helpers.global.inArray(item.type, API.canThumbsUp);
      item.thumbsUp = false;
      return item;
    }
  };


  /*
   Models and collections.
  */

  //# Single Playlist model.
  let Cls = (KodiEntities.PlaylistItem = class PlaylistItem extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.idAttribute = "position";
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {position: 0});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      resp.fullyloaded = true;
      const model = this.parseModel(resp.type, resp, resp.id);
      model.url = helpers.url.playlistUrl(model);
      return model;
    }
  });
  Cls.initClass();

  //# Playlists collection
  Cls = (KodiEntities.PlaylistCollection = class PlaylistCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.PlaylistItem;
      this.prototype.methods = {read: ['Playlist.GetItems', 'playlistid', 'properties', 'limits']};
    }
    args() { return this.getArgs({
      playlistid: this.argCheckOption('playlistid', 0),
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit()
    }); }
    parse(resp, xhr) {
      const items = this.getResult(resp, 'items');
      return API.parseItems(items, this.options);
    }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  //# Get an playlist collection
  App.reqres.setHandler("playlist:kodi:entities", function(media = 'audio') {
    const playlist = App.request("command:kodi:controller", media, 'PlayList');
    const options = {};
    options.media = media;
    options.playlistid = playlist.getPlayer();
    const collection = API.getCollection(options);
    collection.sortCollection('position', 'asc');
    return collection;
  });

  //# Expose the Api object for now-playing usage.
  return App.reqres.setHandler("playlist:kodi:entity:api", () => API);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    fieldsChannel: {
      minimal: ['thumbnail'],
      small: ['channeltype', 'hidden', 'locked', 'channel', 'lastplayed', 'broadcastnow', 'isrecording'],
      full: []
    },

    fieldsRecording: {
      minimal: ['channel', 'file', 'title'],
      small: ['resume', 'plot', 'genre', 'playcount', 'starttime', 'endtime', 'runtime', 'icon', 'art', 'streamurl', 'directory', 'radio', 'isdeleted', 'channeluid'],
      full: []
    },


    //# Fetch a single channel entity
    getChannelEntity(id, options = {}) {
      const entity = new App.KodiEntities.Channel();
      entity.set({channelid: parseInt(id), properties: helpers.entities.getFields(API.fieldsChannel, 'full')});
      entity.fetch(options);
      return entity;
    },

    //# Fetch an channel entity collection.
    getChannelCollection(options) {
      const defaultOptions = {useNamedParameters: true};
      options = _.extend(defaultOptions, options);
      const collection = new KodiEntities.ChannelCollection();
      collection.fetch(options);
      return collection;
    },

    //# Fetch a single recording entity
    getRecordingEntity(id, options = {}) {
      const entity = new App.KodiEntities.Recording();
      entity.set({recordingid: parseInt(id), properties: helpers.entities.getFields(API.fieldsRecording, 'full')});
      entity.fetch(options);
      return entity;
    },

    //# Fetch an recording entity collection.
    getRecordingCollection(options) {
      const defaultOptions = {useNamedParameters: true};
      options = _.extend(defaultOptions, options);
      const collection = new KodiEntities.RecordingCollection();
      collection.fetch(options);
      return collection;
    }
  };


  /*
   Models and collections.
  */

  //# Single Channel model
  let Cls = (KodiEntities.Channel = class Channel extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {read: ['PVR.GetChannelDetails', 'channelid', 'properties']};
    }
    defaults() {
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fieldsChannel, 'full'), {});
    }
    parse(resp, xhr) {
      const obj = (resp.channeldetails != null) ? resp.channeldetails : resp;
      if (resp.channeldetails != null) {
        obj.fullyloaded = true;
      }
      return this.parseModel('channel', obj, obj.channelid);
    }
  });
  Cls.initClass();

  //# Channel collection
  Cls = (KodiEntities.ChannelCollection = class ChannelCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Channel;
      this.prototype.methods = {read: ['PVR.GetChannels', 'channelgroupid', 'properties', 'limits']};
    }
    args() { return this.getArgs({
      channelgroupid: this.argCheckOption('group', 0),
      properties: helpers.entities.getFields(API.fieldsChannel, 'small'),
      limits: this.argLimit()
    }); }
    parse(resp, xhr) {
      return this.getResult(resp, 'channels');
    }
  });
  Cls.initClass();


  //# Recording model
  Cls = (KodiEntities.Recording = class Recording extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {read: ['PVR.GetRecordingDetails', 'recordingid', 'properties']};
    }
    defaults() {
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fieldsRecording, 'full'), {});
    }
    parse(obj, xhr) {
      obj.fullyloaded = true;
      obj.player = obj.radio ? 'audio' : 'video';
      return this.parseModel('recording', obj, obj.recordingid);
    }
  });
  Cls.initClass();

  //# Recording collection
  Cls = (KodiEntities.RecordingCollection = class RecordingCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Recording;
      this.prototype.methods = {read: ['PVR.GetRecordings', 'properties', 'limits']};
    }
    args() { return this.getArgs({
      properties: helpers.entities.getFields(API.fieldsRecording, 'small'),
      limits: this.argLimit()
    }); }
    parse(resp, xhr) {
      return this.getResult(resp, 'recordings');
    }
  });
  Cls.initClass();


  /*
   Request Handlers.
  */

  // Get a single channel
  App.reqres.setHandler("channel:entity", (channelid, options = {}) => API.getChannelEntity(channelid, options));

  //# Get an channel collection
  App.reqres.setHandler("channel:entities", function(group = 'alltv', options = {}) {
    options.group = group;
    return API.getChannelCollection(options);
  });

  // Get a single recording
  App.reqres.setHandler("recording:entity", (channelid, options = {}) => API.getRecordingEntity(channelid, options));

  //# Get an recording collection
  return App.reqres.setHandler("recording:entities", function(group = 'alltv', options = {}) {
    options.group = group;
    return API.getRecordingCollection(options);
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  const API = {

    fields: {
      minimal: ['season', 'art'],
      small: ['showtitle', 'playcount', 'thumbnail', 'tvshowid', 'episode', 'watchedepisodes'],
      full: []
    },

    //# Fetch a single entity, requires a season collection passed.
    getEntity(collection, season) {
      return collection.findWhere({season});
    },

    //# Fetch an entity collection.
    getCollection(options) {
      const defaultOptions = {cache: false, expires: config.get('static', 'collectionCacheExpiry'), useNamedParameters: true};
      options = _.extend(defaultOptions, options);
      const collection = new KodiEntities.SeasonCollection();
      collection.fetch(options);
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single Seasons model.
  KodiEntities.Season = class Season extends App.KodiEntities.Model {
    defaults() {
      const fields = _.extend(this.modelDefaults, {seasonid: 1, season: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      const obj = (resp.seasondetails != null) ? resp.seasondetails : resp;
      if (resp.seasondetails != null) {
        obj.fullyloaded = true;
      }
      obj.unwatched = obj.episode - obj.watchedepisodes;
      return this.parseModel('season', obj, obj.tvshowid + '/' + obj.season);
    }
  };

  //# Seasons collection
  const Cls = (KodiEntities.SeasonCollection = class SeasonCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Season;
      this.prototype.methods = {read: ['VideoLibrary.GetSeasons', 'tvshowid', 'properties', 'limits', 'sort']};
    }
    args() { return this.getArgs({
      tvshowid: this.argCheckOption('tvshowid', 0),
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit(),
      sort: this.argSort("season", "ascending")
    }); }
    parse(resp, xhr) {
      return this.getResult(resp, 'seasons');
    }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  // Get a single season
  App.reqres.setHandler("season:entity", (collection, season) => API.getEntity(collection, season));

  //# Get an season collection
  App.reqres.setHandler("season:entities", function(tvshowid, options = {}) {
    options.tvshowid = tvshowid;
    return API.getCollection(options);
  });

  //# Get full field/property list for entity
  return App.reqres.setHandler("season:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  const API = {

    settingsType: {
      sections: "SettingSectionCollection",
      categories: "SettingCategoryCollection",
      settings: "SettingCollection"
    },

    // Items s with matching ids will be skipped, weather ignored as it had no usable elements.
    // Update: As of v17+ we might be able to use weather but requires a select.
    ignoreKeys: ['weather'],

    fields: {
      minimal: ['settingstype'],
      small: ['title', 'control', 'options', 'parent', 'enabled', 'type', 'value', 'enabled', 'default', 'help', 'path', 'description', 'section', 'category'],
      full: []
    },

    getSettingsLevel() {
      return config.getLocal('kodiSettingsLevel', 'standard');
    },

    // Fetch a single entity
    getEntity(id, collection) {
      const model = collection.where({method: id}).shift();
      return model;
    },

    // Fetch an entity collection.
    getCollection(options = {type: 'sections'}) {
      const collectionMethod = this.settingsType[options.type];
      const collection = new (KodiEntities[collectionMethod])();
      options.useNamedParameters = true;
      collection.fetch(options);
      if (options.section && (options.type === 'settings')) {
        collection.where({section: options.section});
      }
      return collection;
    },

    // Get an array of settings categories. Categories are an array of category ids/keys.
    getSettings(section, categories = [], callback) {
      const commander = App.request("command:kodi:controller", 'auto', 'Commander');
      const commands = [];
      const items = [];
      $(categories).each((i, category) => {
        return commands.push({method: 'Settings.GetSettings', params: [this.getSettingsLevel(), {"section": section, "category": category}]});
    });
      return commander.multipleCommands(commands, resp => {
        for (var i in resp) {
          var item = resp[i];
          var catId = categories[i];
          items[catId] = this.parseCollection(item.settings, 'settings');
        }
        return callback(items);
      });
    },

    // Parse response items before creating collection.
    parseCollection(itemsRaw = [], type = 'settings') {
      const items = [];
      for (var method in itemsRaw) {
        // If not ignored add parsed to items.
        var item = itemsRaw[method];
        if (_.lastIndexOf(this.ignoreKeys, item.id) === -1) {
          items.push(this.parseItem(item, type));
        }
      }
      return items;
    },

    // Parse a single setting item
    parseItem(item, type = 'settings') {
      item.settingstype = type;
      item.title = item.label;
      item.description = item.help;
      item.path = 'settings/kodi/' + item.id;
      return item;
    },

    // Save a collection of settings (values from settings forms)
    saveSettings(data, callback) {
      const commander = App.request("command:kodi:controller", 'auto', 'Commander');
      const commands = [];
      for (var key in data) {
        var val = data[key];
        commands.push({method: 'Settings.SetSettingValue', params: [key, this.valuePreSave(val)]});
      }
      return commander.multipleCommands(commands, resp => {
        if (callback) {
          return callback(resp);
        }
      });
    },

    // Final parsing before save
    valuePreSave(val) {
      // If int, cast as int
      if (val === String(parseInt(val))) {
        val = parseInt(val);
      }
      return val;
    }
  };

  /*
   Models and collections.
  */

  //# Single API Setting model.
  KodiEntities.Setting = class Setting extends App.KodiEntities.Model {
    defaults() {
      const fields = _.extend(this.modelDefaults, {id: 0, params: {}});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'small'), fields);
    }
  };

  //# Sections collection
  let Cls = (KodiEntities.SettingSectionCollection = class SettingSectionCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Setting;
      this.prototype.methods = {read: ['Settings.GetSections']};
    }
    parse(resp, xhr) {
      const items = this.getResult(resp, this.options.type);
      return API.parseCollection(items, this.options.type);
    }
  });
  Cls.initClass();

  //# Categories collection
  Cls = (KodiEntities.SettingCategoryCollection = class SettingCategoryCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Setting;
      this.prototype.methods = {read: ['Settings.GetCategories', 'level', 'section']};
    }
    args() { return this.getArgs({
      level: API.getSettingsLevel(),
      section: this.argCheckOption('section', 0)
    }); }
    parse(resp, xhr) {
      const items = this.getResult(resp, this.options.type);
      return API.parseCollection(items, this.options.type);
    }
  });
  Cls.initClass();

  //# Setting collection
  Cls = (KodiEntities.SettingCollection = class SettingCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Setting;
      this.prototype.methods = {read: ['Settings.GetSettings', 'level']};
    }
    args() { return this.getArgs({
      level: API.getSettingsLevel()}); }
    parse(resp, xhr) {
      const items = this.getResult(resp, this.options.type);
      return API.parseCollection(items, this.options.type);
    }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  // Get a list of settings
  App.reqres.setHandler("settings:kodi:entities", (options = {}) => API.getCollection(options));

  // Get a filtered list of settings for a section
  App.reqres.setHandler("settings:kodi:filtered:entities", (options = {}) => API.getSettings(options.section, options.categories, items => options.callback(items)));

  // Save an object of settings
  return App.commands.setHandler("settings:kodi:save:entities", (data= {}, callback) => API.saveSettings(data, callback));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  var API = {

    songsByIdMax: 50, //# Jsonrpc freaks out if too many in the batch!

    fields: {
      minimal: ['title', 'file'],
      small: ['thumbnail', 'artist', 'artistid', 'album', 'albumid', 'lastplayed', 'track', 'year', 'duration'],
      full: ['fanart', 'genre', 'disc', 'rating', 'albumartist']
    },

    //# Fetch a single song
    getSong(id, options) {
      const artist = new App.KodiEntities.Song();
      artist.set({songid: parseInt(id), properties: helpers.entities.getFields(API.fields, 'full')});
      artist.fetch(options);
      return artist;
    },

    //# Fetch a song collection.
    getFilteredSongs(options) {
      const songs = new KodiEntities.SongFilteredCollection();
      songs.fetch(helpers.entities.buildOptions(options));
      return songs;
    },

    //# Retrieve collection of songs by type and ids, type can be albumid, artistid or songid
    //# ids is an array of ids for the provided type. Returns song collection
    getCustomSongsCollection(type, ids, callback) {
      if (type === 'songid') {
        return this.getSongsByIds(ids, -1, callback);
      } else {
        let items = [];
        const options = {filter: {}};
        let req = 0;
        return (() => {
          const result = [];
          for (var i in ids) {
            var id = ids[i];
            options.filter[type] = id;
            //# On success, concat models into items and if last request then callback
            options.success = function(collection) {
              items = items.concat(collection.toJSON());
              req++;
              if (req === ids.length) {
                collection = new KodiEntities.SongCustomCollection(items);
                return callback(collection);
              }
            };
            //# Get each set of songs
            result.push(this.getFilteredSongs(options));
          }
          return result;
        })();
      }
    },

    //# Turn a collection of songs, e.g. all artist songs
    //# into an array of album song collections keyed by albumid.
    parseSongsToAlbumSongs(songs) {
      const songsRaw = songs.getRawCollection();
      const parsedRaw = {};
      let collections = [];
      //# Parse the songs into sets.
      for (var song of songsRaw) {
        if (!parsedRaw[song.albumid]) {
          parsedRaw[song.albumid] = [];
        }
        parsedRaw[song.albumid].push(song);
      }
      //# Turn the sets into collections.
      for (var albumid in parsedRaw) {
        var songSet = parsedRaw[albumid];
        var year = songSet[0].year ? songSet[0].year : 0;
        collections.push({
          songs: new KodiEntities.SongCustomCollection(songSet),
          albumid: parseInt(albumid),
          sort: (0 - parseInt(year))
        });
      }
      collections = _.sortBy(collections, 'sort');
      return collections;
    },

    //# Get a list of songs via an array of ids only, we don't use Backbone.jsonrpc for this
    //# as we are doing multiple commands. Specific sets are stored in cache.
    getSongsByIds(songIds = [], max = -1, callback) {
      let collection;
      const commander = App.request("command:kodi:controller", 'auto', 'Commander');
      songIds = this.getLimitIds(songIds, max);
      const cacheKey = 'songs-' + songIds.join('-');
      const items = [];
      const cache = helpers.cache.get(cacheKey, false);
      if (cache) {
        //# Cache hit
        collection = new KodiEntities.SongCustomCollection(cache);
        if (callback) {
          callback(collection);
        }
      } else {
        //# No cache
        const model = new KodiEntities.Song();
        const commands = [];
        for (var id of songIds) {
          commands.push({method: 'AudioLibrary.GetSongDetails', params: [id, helpers.entities.getFields(API.fields, 'small')] });
        }
        if (commands.length > 0) {
          commander.multipleCommands(commands, resp => {
            for (var item of _.flatten([resp])) {
              items.push(model.parseModel('song', item.songdetails, item.songdetails.songid));
            }
            helpers.cache.set(cacheKey, items);
            collection = new KodiEntities.SongCustomCollection(items);
            if (callback) {
              return callback(collection);
            }
          });
        }
      }
      return collection;
    },

    //# reduce a set of song ids to max allowed
    getLimitIds(ids, max) {
      max = max === -1 ? this.songsByIdMax : max;
      const ret = [];
      for (var i in ids) {
        var id = ids[i];
        if (i < max) {
          ret.push(id);
        }
      }
      return ret;
    }
  };


  //# Single song model.
  let Cls = (KodiEntities.Song = class Song extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {read: ['AudioLibrary.GetSongDetails', 'songid', 'properties']};
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {songid: 1, artist: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      //# If fetched directly, look in artist details and mark as fully loaded
      const obj = (resp.songdetails != null) ? resp.songdetails : resp;
      if (resp.songdetails != null) {
        obj.fullyloaded = true;
      }
      return this.parseModel('song', obj, obj.songid);
    }
  });
  Cls.initClass();

  //# Song Filtered collection
  Cls = (KodiEntities.SongFilteredCollection = class SongFilteredCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Song;
      this.prototype.methods = {read: ['AudioLibrary.GetSongs', 'properties', 'limits', 'sort', 'filter']};
    }
    args() { return this.getArgs({
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit(),
      sort: this.argSort("track", "ascending"),
      filter: this.argFilter()
    }); }
    parse(resp, xhr) { return this.getResult(resp, 'songs'); }
  });
  Cls.initClass();

  //# Song Custom collection, assumed passed an array of raw entity data.
  Cls = (KodiEntities.SongCustomCollection = class SongCustomCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.Song;
    }
  });
  Cls.initClass();

  //# Song search index collection (absolute minimal fields).
  //# TODO: Now we are using named params, this can probably be removed
  Cls = (KodiEntities.SongSearchIndexCollection = class SongSearchIndexCollection extends KodiEntities.SongFilteredCollection {
    static initClass() {
      this.prototype.methods = {read: ['AudioLibrary.GetSongs']};
    }
  });
  Cls.initClass();


  //# Get a single song.
  App.reqres.setHandler("song:entity", (id, options = {}) => API.getSong(id, options));

  //# Get a song collection - Filters are a must!
  App.reqres.setHandler("song:entities", (options = {}) => API.getFilteredSongs(options));

  //# Get a custom song collection (albums, artists, songs).
  App.reqres.setHandler("song:custom:entities", (type, ids, callback) => API.getCustomSongsCollection(type, ids, callback));

  //# Given an array of models, return as collection.
  App.reqres.setHandler("song:build:collection", items => new KodiEntities.SongCustomCollection(items));

  //# Get a filtered song collection.
  App.reqres.setHandler("song:byid:entities", (songIds = [], callback) => API.getSongsByIds(songIds, -1, callback));

  //# Parse a song collection into albums
  App.reqres.setHandler("song:albumparse:entities", songs => API.parseSongsToAlbumSongs(songs));

  //# Get full field/property list for entity
  return App.reqres.setHandler("song:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    fields: {
      minimal: ['title', 'art'],
      small: ['playcount', 'lastplayed', 'dateadded', 'episode', 'rating', 'year', 'file', 'genre', 'watchedepisodes', 'cast', 'studio', 'mpaa', 'tag'],
      full: ['imdbnumber', 'episodeguide', 'plot', 'sorttitle', 'originaltitle', 'premiered']
    },

    //# Fetch a single entity
    getEntity(id, options) {
      const entity = new App.KodiEntities.TVShow();
      entity.set({tvshowid: parseInt(id), properties:  helpers.entities.getFields(API.fields, 'full')});
      entity.fetch(options);
      return entity;
    },

    //# Fetch an entity collection.
    getCollection(options) {
      const collection = new KodiEntities.TVShowCollection();
      collection.fetch(helpers.entities.buildOptions(options));
      return collection;
    }
  };

  /*
   Models and collections.
  */

  //# Single TVShows model.
  let Cls = (KodiEntities.TVShow = class TVShow extends App.KodiEntities.Model {
    static initClass() {
      this.prototype.methods = {read: ['VideoLibrary.GetTVShowDetails', 'tvshowid', 'properties']};
    }
    defaults() {
      const fields = _.extend(this.modelDefaults, {tvshowid: 1, tvshow: ''});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'full'), fields);
    }
    parse(resp, xhr) {
      const obj = (resp.tvshowdetails != null) ? resp.tvshowdetails : resp;
      if (resp.tvshowdetails != null) {
        obj.fullyloaded = true;
      }
      obj.unwatched = obj.episode - obj.watchedepisodes;
      return this.parseModel('tvshow', obj, obj.tvshowid);
    }
  });
  Cls.initClass();

  //# TVShows collection
  Cls = (KodiEntities.TVShowCollection = class TVShowCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.TVShow;
      this.prototype.methods = {read: ['VideoLibrary.GetTVShows', 'properties', 'limits', 'sort', 'filter']};
    }
    args() { return this.getArgs({
      properties: this.argFields(helpers.entities.getFields(API.fields, 'small')),
      limits: this.argLimit(),
      sort: this.argSort('title', 'ascending'),
      filter: this.argFilter()
    }); }
    parse(resp, xhr) { return this.getResult(resp, 'tvshows'); }
  });
  Cls.initClass();

  /*
   Request Handlers.
  */

  // Get a single tvshow
  App.reqres.setHandler("tvshow:entity", (id, options = {}) => API.getEntity(id, options));

  //# Get an tvshow collection
  App.reqres.setHandler("tvshow:entities", (options = {}) => API.getCollection(options));

  //# Get full field/property list for entity
  return App.reqres.setHandler("tvshow:fields", (type = 'full') => helpers.entities.getFields(API.fields, type));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// Entities for the API Browser.
//
// @param [Object] The entities object
// @param [Object] The full application object
// @param [Object] Backbone
// @param [Object] Marionette
// @param [Object] jQuery
// @param [Object] lodash (underscore)
//
this.Kodi.module("KodiEntities", function(KodiEntities, App, Backbone, Marionette, $, _) {

  /*
    API Helpers
  */

  var API = {

    dictionary: {},

    fields: {
      minimal: [],
      small: ['method', 'description', 'thumbnail', 'params', 'permission', 'returns', 'type', 'namespace', 'methodname'],
      full: []
    },

    //# Fetch a single entity
    getEntity(id, collection) {
      const model = collection.where({id}).shift();
      return model;
    },

    //# Fetch an entity collection.
    getCollection(options = {}) {
      const collection = new KodiEntities.ApiMethodCollection();
      collection.fetch(helpers.entities.buildOptions(options));
      return collection;
    },

    parseCollection(itemsRaw = [], type = 'method') {
      const items = [];
      for (var method in itemsRaw) {
        var item = itemsRaw[method];
        item.method = method;
        item.id = method;
        API.dictionary[item.id] = item.id;
        if (type === 'type') {
          item.params = _.extend({}, item);
          item.description = 'API Type';
        }
        item.type = type;
        var methodParts = method.replace('.', '[SPLIT]').split('[SPLIT]');
        item.namespace = methodParts[0];
        item.methodname = methodParts[1];
        items.push(item);
      }
      return items;
    }
  };


  /*
   Models and collections.
  */

  //# Single API Method model.
  KodiEntities.ApiMethod = class ApiMethod extends App.KodiEntities.Model {
    defaults() {
      const fields = _.extend(this.modelDefaults, {id: 1, params: {}});
      return this.parseFieldsToDefaults(helpers.entities.getFields(API.fields, 'small'), fields);
    }
  };

  //# Method collection
  const Cls = (KodiEntities.ApiMethodCollection = class ApiMethodCollection extends App.KodiEntities.Collection {
    static initClass() {
      this.prototype.model = KodiEntities.ApiMethod;
      this.prototype.methods = {read: ['JSONRPC.Introspect', 'getdescriptions', 'getmetadata']};
    }
    args() { return this.getArgs({
      getdescriptions: true,
      getmetadata: true
    }); }
    parse(resp, xhr) {
      const methods = API.parseCollection(this.getResult(resp, 'methods'), 'method');
      const types = API.parseCollection(this.getResult(resp, 'types'), 'type');
      return methods.concat(types);
    }
  });
  Cls.initClass();


  /*
   Request Handlers.
  */

  //# Get an single method collection
  App.reqres.setHandler("introspect:entity", (id, collection) => API.getEntity(id, collection));

  //# Get the introspect collection of methods
  App.reqres.setHandler("introspect:entities", (options = {}) => API.getCollection(options));

  //# Get a dictionary of all known methods/types, must be called after fetch
  return App.reqres.setHandler("introspect:dictionary", () => API.dictionary);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
/*
  Custom saved playlists, saved in local storage
*/
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  var API = {

    savedFields: [
      'id', 'uid', 'position', 'file', 'type', 'label', 'thumbnail', 'artist', 'album', 'albumid', 'artistid',
      'artistid', 'tvshowid', 'tvshow', 'year', 'rating', 'duration', 'track', 'url', 'season', 'episode', 'title'
    ],

    playlistKey: 'localplaylist:list',
    playlistItemNamespace: 'localplaylist:item:',
    thumbsUpNamespace: 'thumbs:',
    localPlayerNamespace: 'localplayer:',

    getPlaylistKey(key) {
      return this.playlistItemNamespace + key;
    },

    getThumbsKey(media) {
      return this.thumbsUpNamespace + media;
    },

    getlocalPlayerKey(media = 'audio') {
      return this.localPlayerNamespace + media;
    },

    //# Get a collection of lists
    getListCollection(type = 'list') {
      const collection = new Entities.localPlaylistCollection();
      collection.fetch();
      collection.where({type});
      return collection;
    },

    addList(model) {
      const collection = this.getListCollection();
      model.id = this.getNextId();
      collection.create(model);
      return model.id;
    },

    getNextId() {
      let nextId;
      const collection = API.getListCollection();
      const items = collection.getRawCollection();
      if (items.length === 0) {
        nextId = 1;
      } else {
        const lastItem = _.max(items, item => item.id);
        nextId = lastItem.id + 1;
      }
      return nextId;
    },

    //# Get a collection of playlist items.
    getItemCollection(listId) {
      const collection = new Entities.localPlaylistItemCollection([], {key: listId});
      collection.fetch();
      return collection;
    },

    //# Add a collection to a playlist
    addItemsToPlaylist(playlistId, collection) {
      let items;
      if (_.isArray(collection)) {
        items = collection;
      } else {
        items = collection.getRawCollection();
      }
      collection = this.getItemCollection(playlistId);
      let pos = collection.length;
      for (var item of items) {
        collection.create(API.getSavedModelFromSource(item, pos));
        pos++;
      }
      return collection;
    },

    //# Parse a library item into a model structure to save
    getSavedModelFromSource(item, position) {
      const newItem = {};
      for (var fieldName of this.savedFields) {
        if (item[fieldName]) {
          newItem[fieldName] = item[fieldName];
        }
      }
      newItem.position = parseInt(position);

      const idfield = item.type + 'id';
      newItem[idfield] = item[idfield];
      return newItem;
    },

    //# remove all items from a list
    clearPlaylist(playlistId) {
      let model;
      const collection = this.getItemCollection(playlistId);
      while ((model = collection.first())) {
        model.destroy();
      }
    }
  };


  //# The a list reference
  let Cls = (Entities.localPlaylist = class localPlaylist extends Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        id: 0,
        name: '',
        media: '', //# song / movie / artist / etc.
        type: 'list'
      };
    }
  });
  Cls.initClass(); //# list / thumbsup / local

  //# The a list reference collection
  Cls = (Entities.localPlaylistCollection = class localPlaylistCollection extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.localPlaylist;
      this.prototype.localStorage = new Backbone.LocalStorage(API.playlistKey);
    }
  });
  Cls.initClass();


  //# The saved list item
  Cls = (Entities.localPlaylistItem = class localPlaylistItem extends Entities.Model {
    static initClass() {
      this.prototype.idAttribute = "position";
    }
    defaults() {
      const fields = {};
      for (var f of API.savedFields) {
        fields[f] = '';
      }
      return fields;
    }
  });
  Cls.initClass();

  //# The config collection
  Cls = (Entities.localPlaylistItemCollection = class localPlaylistItemCollection extends Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.localPlaylistItem;
    }
    initialize(model, options) {
      return this.localStorage = new Backbone.LocalStorage(API.getPlaylistKey(options.key));
    }
  });
  Cls.initClass();


  /*
    Saved Playlists
  */

  //# Handler to save a new playlist
  App.reqres.setHandler("localplaylist:add:entity", (name, media, type = 'list') => API.addList({name, media, type}));

  //# Handler to remove a playlist
  App.commands.setHandler("localplaylist:remove:entity", function(id) {
    const collection = API.getListCollection();
    const model = collection.findWhere({id: parseInt(id)});
    return model.destroy();
  });

  //# Handler to get saved lists
  App.reqres.setHandler("localplaylist:entities", () => API.getListCollection());

  //# Handler to clear all items from a list
  App.commands.setHandler("localplaylist:clear:entities", playlistId => API.clearPlaylist(playlistId));

  //# Handler to get a single saved list
  App.reqres.setHandler("localplaylist:entity", function(id) {
    const collection = API.getListCollection();
    return collection.findWhere({id: parseInt(id)});
});

  //# Handler to get list items
  App.reqres.setHandler("localplaylist:item:entities", playlistId => API.getItemCollection(playlistId));

  //# Handler to add items to a playlist
  App.reqres.setHandler("localplaylist:item:add:entities", (playlistId, collection) => API.addItemsToPlaylist(playlistId, collection));

  //# Handler to update the order of items in the playlist. This will
  //# rebuild the list including only positions found in order.
  App.reqres.setHandler("localplaylist:item:updateorder", function(playlistId, order) {
    const newList = [];
    const collection = API.getItemCollection(playlistId);
    for (var newPos in order) {
      var oldPos = order[newPos];
      var model = collection.findWhere({position: parseInt(oldPos)}).toJSON();
      model.position = newPos;
      model.id = newPos;
      newList.push(model);
    }
    API.clearPlaylist(playlistId);
    return API.addItemsToPlaylist(playlistId, newList);
  });


  /*
    Thumbs up lists
  */

  //# Handler toggle thumbs up on an entity
  App.reqres.setHandler("thumbsup:toggle:entity", function(model) {
    const media = model.get('type');
    const collection = API.getItemCollection(API.getThumbsKey(media));
    const existing = collection.findWhere({id: model.get('id')});
    if (existing) {
      existing.destroy();
    } else {
      collection.create(API.getSavedModelFromSource(model.attributes, model.get('id')));
    }
    return collection;
  });

  //# Handler to get a thumbs up collection
  App.reqres.setHandler("thumbsup:get:entities", media => API.getItemCollection(API.getThumbsKey(media)));

  //# Has a model being thumbed up?
  App.reqres.setHandler("thumbsup:check", function(model) {
    if (model != null) {
      const collection = API.getItemCollection(API.getThumbsKey(model.get('type')));
      const existing = collection.findWhere({id: model.get('id')});
      return _.isObject(existing);
    } else {
      return false;
    }
  });


  /*
    Local player lists
  */

  //# Handler to get a local player playlist collection
  App.reqres.setHandler("localplayer:get:entities", (media = 'audio') => API.getItemCollection(API.getlocalPlayerKey(media)));

  //# Handler to clear all items from a list
  App.commands.setHandler("localplayer:clear:entities", (media = 'audio') => API.clearPlaylist(API.getlocalPlayerKey(media)));

  //# Handler to add items to a playlist
  return App.reqres.setHandler("localplayer:item:add:entities", (collection, media = 'audio') => API.addItemsToPlaylist(API.getlocalPlayerKey(media), collection));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  const API = {

    localKey: 'mainNav',

    getItems() {
      const navCollection = this.getLocalCollection();
      let items = navCollection.getRawCollection();
      if (items.length === 0) {
        items = this.getDefaultItems();
      }
      return items;
    },

    getDefaultItems(onlyVisible = true){
      const nav = [];

      //# Music.
      nav.push({id: 1, title: tr("Music"), path: 'music', icon: 'mdi-av-my-library-music', classes: 'nav-music', parent: 0});
      nav.push({id: 2, title: tr("Music"), path: 'music', icon: '', classes: '', parent: 1});
      nav.push({id: 6, title: tr("Genres"), path: 'music/genres', icon: '', classes: '', parent: 1});
      nav.push({id: 7, title: tr("Top music"), path: 'music/top', icon: '', classes: '', parent: 1});
      nav.push({id: 3, title: tr("Artists"), path: 'music/artists', icon: '', classes: '', parent: 1});
      nav.push({id: 4, title: tr("Albums"), path: 'music/albums', icon: '', classes: '', parent: 1});
      nav.push({id: 8, title: tr("Videos"), path: 'music/videos', icon: '', classes: '', parent: 1});

      //# Movies.
      nav.push({id: 11, title: tr("Movies"), path: 'movies/recent', icon: 'mdi-av-movie', classes: 'nav-movies', parent: 0});
      nav.push({id: 12, title: tr("Movies"), path: 'movies/recent', icon: '', classes: '', parent: 11});
      nav.push({id: 13, title: tr("All movies"), path: 'movies', icon: '', classes: '', parent: 11});

      //# TV.
      nav.push({id: 21, title: tr("TV shows"), path: 'tvshows/recent', icon: 'mdi-hardware-tv', classes: 'nav-tv', parent: 0});
      nav.push({id: 22, title: tr("TV shows"), path: 'tvshows/recent', icon: '', classes: '', parent: 21});
      nav.push({id: 23, title: tr("All TV shows"), path: 'tvshows', icon: '', classes: '', parent: 21});

      //# Browser.
      nav.push({id: 31, title: tr("Browser"), path: 'browser', icon: 'mdi-action-view-list', classes: 'nav-browser', parent: 0});

      //# PVR
      nav.push({id: 81, title: tr("PVR"), path: 'pvr/tv', icon: 'mdi-action-settings-input-antenna', classes: 'pvr-link', parent: 0, visibility: "addon:pvr:enabled"});
      nav.push({id: 82, title: tr("TV Channels"), path: 'pvr/tv', icon: '', classes: '', parent: 81});
      nav.push({id: 83, title: tr("Radio Stations"), path: 'pvr/radio', icon: '', classes: '', parent: 81});
      nav.push({id: 84, title: tr("Recordings"), path: 'pvr/recordings', icon: '', classes: '', parent: 81});

      //# Addons
      nav.push({id: 71, title: tr("Add-ons"), path: 'addons/all', icon: 'mdi-action-extension', classes: 'nav-addons', parent: 0});
      nav.push({id: 72, title: tr("all"), path: 'addons/all', icon: '', classes: '', parent: 71});
      nav.push({id: 73, title: tr("video"), path: 'addons/video', icon: '', classes: '', parent: 71});
      nav.push({id: 74, title: tr("audio"), path: 'addons/audio', icon: '', classes: '', parent: 71});
      // Placeholder for pictures (75)
      nav.push({id: 76, title: tr("executable"), path: 'addons/executable', icon: '', classes: '', parent: 71});
      nav.push({id: 77, title: tr("settings"), path: 'settings/addons', icon: '', classes: '', parent: 71});

      //# Thumbs up.
      nav.push({id: 41, title: tr("Thumbs up"), path: 'thumbsup', icon: 'mdi-action-thumb-up', classes: 'nav-thumbs-up', parent: 0});

      //# Playlists.
      nav.push({id: 42, title: tr("Playlists"), path: 'playlists', icon: 'mdi-action-assignment', classes: 'playlists', parent: 0});

      //# Settings.
      nav.push({id: 51, title: tr("Settings"), path: 'settings/web', icon: 'mdi-action-settings', classes: 'nav-settings', parent: 0});
      nav.push({id: 52, title: tr("Web interface"), path: 'settings/web', icon: '', classes: '', parent: 51});
      nav.push({id: 54, title: tr("Main Menu"), path: 'settings/nav', icon: '', classes: '', parent: 51});
      nav.push({id: 53, title: tr("Add-ons"), path: 'settings/addons', icon: '', classes: '', parent: 51});
      nav.push({id: 55, title: tr("Search"), path: 'settings/search', icon: '', classes: '', parent: 51});


      //# Help
      nav.push({id: 61, title: tr("Help"), path: 'help', icon: 'mdi-action-help', classes: 'nav-help', parent: 0});

      //# Return only visible or all
      if (onlyVisible) {
        return this.checkVisibility(nav);
      } else {
        return nav;
      }
    },

    //# Nav items can have a visibility property, if this is set, the request handler
    //# is called for that value which should return true or false depending if that
    //# item is visible.  e.g. pvr links check if pvr is enabled.
    checkVisibility(items) {
      const newItems = [];
      for (var item of items) {
        if (item.visibility != null) {
          if (App.request(item.visibility)) {
            newItems.push(item);
          }
        } else {
          newItems.push(item);
        }
      }
      return newItems;
    },

    //# Get a collection from local storage.
    getLocalCollection() {
      const collection = new Entities.LocalNavMainCollection([], {key: this.localKey});
      collection.fetch();
      return collection;
    },

    //# Get a full standard structure
    getStructure() {
      const navParsed = this.sortStructure(this.getItems());
      const navCollection = new Entities.NavMainCollection(navParsed);
      return navCollection;
    },

    //# Get only child items from a given parent
    getChildStructure(parentId) {
      const nav = this.getDefaultItems(false);
      const parent = _.findWhere(nav, {id: parentId});
      const childItems = _.where(nav, {parent: parentId});
      parent.items = new Entities.NavMainCollection(childItems);
      return new Entities.NavMain(parent);
    },

    //# Sort the structure into a hierarchy.
    sortStructure(structure) {
      let model;
      const children = {};
      //# Parse the children from via the parent.
      for (model of structure) {
        //# Translate the titles while we are here
        if ((model.path != null) && (model.parent !== 0)) {
          model.title = t.gettext( model.title );
          //# Parse into children
          if (children[model.parent] == null) { children[model.parent] = []; }
          children[model.parent].push(model);
        }
      }
      //# Add the parsed children to the parents.
      const newParents = [];
      for (var i in structure) {
        model = structure[i];
        if (model.path != null) {
          if (model.parent === 0) {
            model.children = children[model.id];
            newParents.push(model);
          }
        }
      }
      return newParents;
    },

    // Returns the ID for the given path (no hash)
    getIdfromPath(path) {
      const model = _.findWhere(this.getDefaultItems(), {path});
      if (model != null) { return model.id; } else { return 1; }
    },

    // Save current form to local storage collection
    saveLocal(items) {
      const collection = this.clearLocal();
      for (var i in items) {
        var item = items[i];
        collection.create(item);
      }
      return collection;
    },

    //# remove all items from a list
    clearLocal() {
      let model;
      const collection = this.getLocalCollection();
      while ((model = collection.first())) {
        model.destroy();
      }
      return collection;
    }
  };


  //# NavMain model
  let Cls = (Entities.NavMain = class NavMain extends App.Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        id: 0,
        title: 'Untitled',
        path: '',
        description: '',
        icon: '',
        classes: '',
        parent: 0,
        children: []
      };
    }
  });
  Cls.initClass();

  //# NavMain collection
  Cls = (Entities.NavMainCollection = class NavMainCollection extends App.Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.NavMain;
    }
  });
  Cls.initClass();

  //# NavMain local storage collection
  Cls = (Entities.LocalNavMainCollection = class LocalNavMainCollection extends App.Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.NavMain;
      this.prototype.localStorage = new Backbone.LocalStorage(API.localKey);
    }
  });
  Cls.initClass();


  //# Handler to return the collection, parent is path to parent.
  App.reqres.setHandler("navMain:entities", function(parent = 'all') {
    if (parent === 'all') {
      return API.getStructure();
    } else {
      const parentId = API.getIdfromPath(parent);
      return API.getChildStructure(parentId);
    }
  });

  //# Turn an array of link objects into a collection.
  App.reqres.setHandler("navMain:array:entities", function(items) {
    // Auto populate ids from paths
    for (var i in items) {
      var item = items[i];
      items[i].id = item.path;
    }
    return new Entities.NavMainCollection(items);
  });

  //# Update mainNav local storage entities
  App.reqres.setHandler("navMain:update:entities", items => API.saveLocal(items));

  //# Update mainNav local storage entities
  return App.reqres.setHandler("navMain:update:defaults", items => API.clearLocal());
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Entities", function(Entities, App, Backbone, Marionette, $, _) {

  const API = {

    localKey: 'searchAddons',

    //# Get a collection from local storage.
    getLocalCollection() {
      const collection = new Entities.LocalSearchAddonsCollection([], {key: this.localKey});
      collection.fetch();
      return collection;
    },

    // Save current form to local storage collection
    saveLocal(items) {
      const collection = this.clearLocal();
      for (var i in items) {
        var item = items[i];
        collection.create(item);
      }
      return collection;
    },

    //# remove all items from a list
    clearLocal() {
      let model;
      const collection = this.getLocalCollection();
      while ((model = collection.first())) {
        model.destroy();
      }
      return collection;
    }
  };

  //# Model
  let Cls = (Entities.SearchAddons = class SearchAddons extends App.Entities.Model {
    static initClass() {
      this.prototype.defaults = {
        id: '',
        url: '',
        title: 'Untitled',
        media: 'music'
      };
    }
  });
  Cls.initClass();

  //# Local storage collection
  Cls = (Entities.LocalSearchAddonsCollection = class LocalSearchAddonsCollection extends App.Entities.Collection {
    static initClass() {
      this.prototype.model = Entities.SearchAddons;
      this.prototype.localStorage = new Backbone.LocalStorage(API.localKey);
    }
  });
  Cls.initClass();

  //# Get local storage entities
  App.reqres.setHandler("searchAddons:entities", items => API.getLocalCollection());

  //# Update local storage entities
  App.reqres.setHandler("searchAddons:update:entities", items => API.saveLocal(items));

  //# Clear local storage entities
  return App.reqres.setHandler("searchAddons:update:defaults", () => API.clearLocal());
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Controllers", (Controllers, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Controllers.Base = class Base extends Backbone.Marionette.Controller {
    static initClass() {

      this.prototype.params = {};
    }

    constructor(options = {}) {
      super(options);
      this.region = options.region || App.request("default:region");
      this.params = helpers.url.params();
      this._instance_id = _.uniqueId("controller");
      App.execute("register:instance", this, this._instance_id);
    }

    close(...args) {
      delete this.region;
      delete this.options;
      super.close(args);
      return App.execute("unregister:instance", this, this._instance_id);
    }

    show(view) {
      this.listenTo(view, "close", this.close);
      return this.region.show(view);
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Router", function(Router, App, Backbone, Marionette, $, _) {

  return Router.Base = class Base extends Marionette.AppRouter {

    before( route, params ) {
      //# Kick of loading.
      App.execute("loading:show:page");
      return App.execute("selected:clear:items");
    }

    after(route, params) {
      //# After route set the body classes
      return this.setBodyClasses();
    }

    //# Update the body class
    setBodyClasses() {
      const $body = App.getRegion('root').$el;
      $body.removeClassRegex(/^section-/);
      $body.removeClassRegex(/^page-/);
      let section = helpers.url.arg(0);
      if (section === '') {
        section = 'home';
      }
      $body.addClass('section-' + section);
      return $body.addClass('page-' + helpers.url.arg().join('-'));
    }
  };
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", (Views, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Views.CollectionView = class CollectionView extends Backbone.Marionette.CollectionView {
    static initClass() {
      this.prototype.itemViewEventPrefix = "childview";
    }
    onShow() {
      return $("img.lazy").lazyload({
        threshold : 200
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", (Views, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Views.CompositeView = class CompositeView extends Backbone.Marionette.CompositeView {
    static initClass() {
      this.prototype.itemViewEventPrefix = "childview";
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", function(Views, App, Backbone, Marionette, $, _) {

  return Views.ItemView = class ItemView extends Backbone.Marionette.ItemView {

    // Close dropdown on blur
    onShow() {
      return this.menuBlur();
    }

    //# Toggle menu open class on row. Call this in onShow().
    menuBlur() {
      $('.dropdown', this.$el).on('show.bs.dropdown', () => {
        return this.$el.addClass('menu-open');
      });
      $('.dropdown', this.$el).on('hide.bs.dropdown', () => {
        return this.$el.removeClass('menu-open');
      });
      return $('.dropdown', this.$el).on('click', function() {
        return $(this).removeClass('open').trigger('hide.bs.dropdown');
      });
    }

    //# Trigger watched and pass the view so the dom can be actioned on.
    toggleWatched(e) {
      return this.trigger("toggle:watched", {view: this});
    }

    //# Adds the watched class if required
    watchedAttributes(baseClass = ''){
      const classes = [baseClass];
      if (App.request("thumbsup:check", this.model)) {
        classes.push('thumbs-up');
      }
      if (helpers.entities.isWatched(this.model)) {
        classes.push('is-watched');
      }
      return {
        class: classes.join(' ')
      };
    }

    //# Method to enable toggle selection. Needs to be added as an event to the
    //# view that utilizes it
    toggleSelect(e) {
      if (e.ctrlKey || e.metaKey) {
        e.preventDefault();
        // Disable selection with items with prevent-select
        // TODO: make it work on mixed collections (thumbsup) or move check elsewhere
        if (!this.$el.hasClass('prevent-select') && (helpers.url.arg(0) !== 'thumbsup')) {
          this.$el.toggleClass('selected');
          const op = this.$el.hasClass('selected') ? 'add' : 'remove';
          return App.execute("selected:update:items", op, this.model.toJSON());
        }
      }
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", function(Views, App, Backbone, Marionette, $, _) {

  return (Views.LayoutView = class LayoutView extends Backbone.Marionette.LayoutView {

    //# Workaround for dropdowns not closing on click
    onShow() {
      return App.execute("ui:dropdown:bind:close", this.$el);
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", function(Views, App, Backbone, Marionette, $, _) {

  const _remove = Marionette.View.prototype.remove;

  return _.extend(Marionette.View.prototype, {

    // Build a link. Link text gets escaped.
    themeLink(name, url, options = {}) {
      _.defaults(options, {
        external: false,
        className: ''
      }
      );

      const attrs = {};

      if (options.external) {
        attrs.target = '_blank';
        attrs.href = url;
      } else {
        attrs.href = '#' + url;
      }

      if (options.className !== '') {
        attrs.class = options.className;
      }

      return $("<a>").attr(attrs).text(name).wrap('<div/>').parent().html();
    },

    // Make a tag. Contents can be HTML (they are not escaped)
    themeTag(el, attrs, value) {
      return $(`<${el}>`).attr(attrs).html(value).wrap('<div/>').parent().html();
    },

    // Formats dynamic text using filers. Returns HTML.
    formatText(text, addInLineBreaks = false) {
      // Filter via bb code (used in browser folder names)
      const res = XBBCODE.process({
        text,
        removeMisalignedTags: true,
        addInLineBreaks
      });
      if (res.error === !false) {
        helpers.debug.msg('formatText error: ' + res.errorQueue.join(', '), 'warning', res);
      }
      // return updated text
      return res.html;
    },

    //# Populate a dropdown menu with items from the model
    populateMenu(type = '') {
      let menu = '';
      const baseSelector = 'dropdown-menu';
      if (this.model.get('menu')) {
        const object = this.model.get('menu');
        for (var key in object) {
          var val = object[key];
          if (key.lastIndexOf('divider', 0) === 0) {
            key = 'divider';
          }
          menu += this.themeTag('li', {class: key}, val);
        }
        const selector = type !== '' ? type + ' .' + baseSelector : baseSelector;
        return this.$el.find('.' + selector).html(menu);
      }
    },

    populateModelMenu() {
      return this.populateMenu();
    },

    populateSetMenu() {
      return this.populateMenu('set__actions');
    }
  }
  );
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", (Views, App, Backbone, Marionette, $, _) => //# This is an extension of the list view that shows a placeholder until
//# the child view is visible which greatly improves performance by removing
//# 95% of the markup added to to the dom that is not visible until you
//# scroll to it.
//#
//# Inspiration: http://blog.sprint.ly/post/42929468986/web-ui-rendering-performance
//# Made this easy: https://github.com/customd/jquery-visible
(function() {
  const Cls = (Views.VirtualListView = class VirtualListView extends Views.CollectionView {
    static initClass() {
      this.prototype.originalCollection = {};
      this.prototype.preload = 20;
      this.prototype.originalChildView = {};
      this.prototype.buffer = 30;
      this.prototype.cardSelector = '.card';
      this.prototype.animateFrameTrigger = "ui:animate:stop";
      this.prototype.placeHolderViewName = 'CardViewPlaceholder';

      //# When a link is clicked we store the scroll position so if they go back
      //# they are scrolled to the correct position
      this.prototype.events =
        {"click a": "storeScroll"};
    }

    //# Initial render before scrolling
    addChild(child, ChildView, index) {
      if (index > this.preload) {
        ChildView = App.Views[this.placeHolderViewName];
      }
      return Backbone.Marionette.CollectionView.prototype.addChild.apply(this, arguments);
    }


    //# Store the various views and bind scroll.
    initialize() {
      this.originalChildView = this.getOption('childView');
      this.placeholderChildView = App.Views[this.placeHolderViewName];
      return App.vent.on(this.animateFrameTrigger, () => {
        return this.renderItemsInViewport();
      });
    }

    //# incase the view re-rendered when we are not at the top.
    onRender() {
      return this.renderItemsInViewport();
    }

    //# Our callback for updating the viewport with visible items.
    renderItemsInViewport() {
      const $cards = $(this.cardSelector, this.$el);
      const visibleIndexes = [];
      //# Get visible cards (show all if collection is less than preload)
      $cards.each((i, d) => {
        if (($cards.length <= this.preload) || $(d).visible(true)) {
          return visibleIndexes.push(i);
        }
      });
      // Check we have visible items before building a range
      let visibleRange = [];
      if (visibleIndexes.length > 0) {
        let min = _.min(visibleIndexes);
        let max = _.max(visibleIndexes);
        //# Add the buffer.
        min = (min - this.buffer) < 0 ? 0 : (min - this.buffer);
        max = (max + this.buffer) >= $cards.length ? ($cards.length - 1) : (max + this.buffer);
        visibleRange = __range__(min, max, true);
      }
      //# Loop over the cards, show visible, hide the rest
      return $cards.each((i, d) => {
        if ($(d).hasClass('ph') && helpers.global.inArray(i, visibleRange)) {
          return $(d).replaceWith(this.getRenderedChildView($(d).data('model'), this.originalChildView, i));
        } else if (!$(d).hasClass('ph') && !helpers.global.inArray(i, visibleRange)) {
          return $(d).replaceWith(this.getRenderedChildView($(d).data('model'), this.placeholderChildView, i));
        }
      });
    }

    //# Returns the child item with a new view, would be nice if marionette had a
    //# 'updateChildView' method but this will do.
    getRenderedChildView(child, ChildView, index) {
      let childViewOptions = this.getOption('childViewOptions');
      childViewOptions = Marionette._getValue(childViewOptions, this, [child, index]);
      const view = this.buildChildView(child, ChildView, childViewOptions);
      this.proxyChildEvents(view);
      return view.render().$el;
    }

    storeScroll() {
      return helpers.backscroll.setLast();
    }

    onShow() {
      return helpers.backscroll.scrollToLast();
    }
  });
  Cls.initClass();
  return Cls;
})());

function __range__(left, right, inclusive) {
  let range = [];
  let ascending = left < right;
  let end = !inclusive ? right : ascending ? right + 1 : right - 1;
  for (let i = left; ascending ? i < end : i > end; ascending ? i++ : i--) {
    range.push(i);
  }
  return range;
};// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", function(Views, App, Backbone, Marionette, $, _) {

  let Cls = (Views.CardView = class CardView extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = "views/card/card";
      this.prototype.tagName = "li";
  
      this.prototype.events = {
        "click .dropdown > i": "populateModelMenu",
        "click .thumbs" : "toggleThumbs",
        "click" : "toggleSelect"
      };
  
      this.prototype.modelEvents =
        {'change': 'modelChange'};
    }

    toggleThumbs() {
      App.request("thumbsup:toggle:entity", this.model);
      return this.$el.toggleClass('thumbs-up');
    }

    attributes() {
      const classes = ['card', 'card-loaded'];
      if (App.request("thumbsup:check", this.model)) {
        classes.push('thumbs-up');
      }
      return {
        class: classes.join(' ')
      };
    }

    onBeforeRender() {
      if ((this.model.get('labelHtml') == null)) {
        this.model.set('labelHtml', this.model.escape('label'));
      }
      if ((this.model.get('subtitleHtml') == null)) {
        return this.model.set('subtitleHtml', this.model.escape('subtitle'));
      }
    }

    onRender() {
      return this.$el.data('model', this.model);
    }

    onShow() {
      return $('.dropdown', this.$el).on('click', function() {
        return $(this).removeClass('open').trigger('hide.bs.dropdown');
      });
    }

    //# Make the links external
    makeLinksExternal() {
      return $('.title, .thumb', this.$el).attr('href', this.model.get('url')).attr('target', '_blank');
    }

    //# This triggers when a model has been updated, instances can add updates to setMeta()
    //# so init is not used (which doesn't get called on a re-render)
    modelChange() {
      if (_.isFunction(this.setMeta)) {
        this.setMeta();
      }
      return this.render();
    }
  });
  Cls.initClass();


  return (function() {
    Cls = (Views.CardViewPlaceholder = class CardViewPlaceholder extends App.Views.ItemView {
      static initClass() {
        this.prototype.template = "views/card/card_placeholder";
      }
      attributes() {
        return {
          class: 'card ph'
        };
      }
      onRender() {
        return this.$el.data('model', this.model);
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", (Views, App, Backbone, Marionette, $, _) => // Use this for details meta header areas
(function() {
  const Cls = (Views.DetailsItem = class DetailsItem extends App.Views.ItemView {
    static initClass() {
      this.prototype.events = {
        "click .watched"             : "toggleWatched",
        "click .internal-search li"  : "internalSearch",
        "click .external-search li"  : "externalSearch",
        "click .youtube-search"      : "youtubeSearch"
      };
      this.prototype.modelEvents =
        // This triggers a re-render on model update
        {'change': 'modelChange'};
    }
    modelChange() {
      return this.render();
    }
    onRender() {
      if (this.model.get('fanart')) {
        this.$el.closest('.detail-container').find('.region-details-fanart').css('background-image', 'url(' + this.model.get('fanart') + ')');
      }
      return $('.description', this.$el).attr('title', tr('Click for more')).on('click', function(e) {
        return $(this).toggleClass('expanded');
      });
    }
    //# Search using contextual query
    internalSearch(e) {
      const $li = $(e.target);
      return App.execute('search:go', 'internal', $li.data('query'), $li.data('type'));
    }
    externalSearch(e) {
      const $li = $(e.target);
      return App.execute('search:go', 'external', $li.data('query'), $li.data('type'));
    }
    youtubeSearch(e) {
      const $li = $(e.target);
      return App.execute("youtube:search:popup", $li.data('query'));
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", function(Views, App, Backbone, Marionette, $, _) {

  let Cls = (Views.EmptyViewPage = class EmptyViewPage extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = "views/empty/empty_page";
      this.prototype.regions =
        {regionEmptyContent:  ".empty--page"};
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Views.EmptyViewResults = class EmptyViewResults extends App.Views.ItemView {
      static initClass() {
        this.prototype.template = "views/empty/empty_results";
        this.prototype.regions =
          {regionEmptyContent:  ".empty-result"};
      }
      onRender() {
        if (this.options && this.options.emptyKey) {
          $('.empty-key', this.$el).text(tr(this.options.emptyKey));
        }
        if (this.options && this.options.emptyBackUrl) {
          return $('.back-link', this.$el).html(this.themeLink(tr('Go back'), this.options.emptyBackUrl));
        }
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", function(Views, App, Backbone, Marionette, $, _) {

  let Cls = (Views.LayoutWithSidebarFirstView = class LayoutWithSidebarFirstView extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = "views/layouts/layout_with_sidebar_first";
      this.prototype.regions = {
        regionSidebarFirst:  ".region-first-primary",
        regionContent:  ".region-content"
      };
      this.prototype.events =
        {"click .region-first-toggle": "toggleRegionFirst"};
    }
    toggleRegionFirst() {
      return this.$el.toggleClass('region-first-open');
    }
    // Allow dynamically adding multiple sidebar views to a region
    appendSidebarView(viewId, appendView) {
      $('.region-first-secondary', this.$el).append('<div id="' + viewId + '">');
      this.regionManager.addRegion(viewId, '#' + viewId);
      return this[viewId].show(appendView);
    }
  });
  Cls.initClass();

  Cls = (Views.LayoutWithHeaderView = class LayoutWithHeaderView extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = "views/layouts/layout_with_header";
      this.prototype.regions = {
        regionHeader:  ".region-header",
        regionContentTop:  ".region-content-top",
        regionContent:  ".region-content"
      };
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Views.LayoutDetailsHeaderView = class LayoutDetailsHeaderView extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = "views/layouts/layout_details_header";
        this.prototype.regions = {
          regionSide:  ".region-details-side",
          regionTitle:  ".region-details-title",
          regionMeta: ".region-details-meta", //# Using this region removes the below regions.
          regionMetaSideFirst:  ".region-details-meta-side-first",
          regionMetaSideSecond:  ".region-details-meta-side-second",
          regionMetaBelow:  ".region-details-meta-below",
          regionFanart:  ".region-details-fanart"
        };
      }
      onRender() {
        //# Get swatches
        return helpers.ui.getSwatch(this.model.get('thumbnail'), swatches => helpers.ui.applyHeaderSwatch(swatches));
      }
      initialize() {
        if (!this.model.get('progress')) {
          return this.model.set({progress: 0});
        }
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", function(Views, App, Backbone, Marionette, $, _) {

  //# Shard functionality between composite and layout set views
  //# Template is also shared
  const API = {

    createModel(options = {}) {
      const defaultMenu = {selectall: tr('Toggle select all')};
      const model = _.extend({childViewTag: 'div', ChildViewClass: ''}, options);
      if (!options.noMenuDefault) {
        model.menu = _.isObject(options.menu) ? _.extend(defaultMenu, options.menu) : defaultMenu;
      }
      return new Backbone.Model(model);
    },

    toggleSelectAll($el) {
      const $ctx = $('.set__collection', $el);
      return $('.card, .song', $ctx).toggleClass('selected').each(function(i, d) {
        const $d = $(d);
        const op = $(d).hasClass('selected') ? 'add' : 'remove';
        return App.execute("selected:update:items", op, $d.data('model').toJSON());
      });
    }
  };


  //# A composite set view with a title, actions and collection
  let Cls = (Views.SetCompositeView = class SetCompositeView extends App.Views.CompositeView {
    static initClass() {
      this.prototype.template = 'views/set/set';
      this.prototype.childView = App.Views.CardView;
      this.prototype.tagName = 'div';
      this.prototype.className = "set__wrapper";
      this.prototype.childViewContainer = ".set__collection";
      this.prototype.events = {
        "click .dropdown > i": "populateSetMenu",
        "click .selectall": "toggleSelectAll"
      };
    }

    initialize() {
      return this.createModel();
    }

    // Create a model from options.
    createModel() {
      return this.model = API.createModel(this.options);
    }

    toggleSelectAll() {
      return API.toggleSelectAll(this.$el);
    }
  });
  Cls.initClass();


  //# A set view is a layout view with a title, actions and collection
  return (function() {
    Cls = (Views.SetLayoutView = class SetLayoutView extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = 'views/set/set';
        this.prototype.tagName = 'div';
        this.prototype.className = "set__wrapper";
        this.prototype.regions =
          {regionCollection: ".set__collection"};
        this.prototype.events = {
          "click .dropdown > i": "populateSetMenu",
          "click .selectall": "toggleSelectAll"
        };
      }

      initialize() {
        return this.createModel();
      }

      // Create a model from options.
      createModel() {
        return this.model = API.createModel(this.options);
      }

      toggleSelectAll() {
        return API.toggleSelectAll(this.$el);
      }
    });
    Cls.initClass();
    return Cls;
  })();
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Views", (Views, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Views.SongViewPlaceholder = class SongViewPlaceholder extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = "views/song/song_placeholder";
      this.prototype.tagName = 'tr';
    }
    attributes() {
      return {
        class: 'song ph'
      };
    }
    onRender() {
      return this.$el.data('model', this.model);
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Components.Form", function(Form, App, Backbone, Marionette, $, _) {

  Form.Controller = class Controller extends App.Controllers.Base {

    initialize(options = {}) {
      const config = options.config ? options.config : {};

      this.formLayout = this.getFormLayout(config);

      this.listenTo(this.formLayout, "show", () => {
        this.formBuild(options.form, options.formState, config);
        $.material.init();
        if (config && (typeof config.onShow === 'function')) {
          return config.onShow(options);
        }
      });

      this.listenTo(this.formLayout, "form:submit", () => {
        return this.formSubmit(options);
      });

      return this;
    }

    formSubmit(options) {
      let data = Backbone.Syphon.serialize(this.formLayout);
      data = App.request("form:value:entities", options.form, data);
      return this.processFormSubmit(data, options);
    }

    processFormSubmit(data, options) {
      if (options.config && (typeof options.config.callback === 'function')) {
        return options.config.callback(data, this.formLayout);
      }
    }

    getFormLayout(options = {}) {
      return new Form.FormWrapper({
        config: options});
    }

    formBuild(form = [], formState = {}, options = {}) {
      const collection = App.request("form:item:entities", form, formState);
      const buildView = new Form.Groups({
        collection});
      return this.formLayout.formContentRegion.show(buildView);
    }
  };


  App.reqres.setHandler("form:render:items", function(form, formState, options = {}) {
    const collection = App.request("form:item:entities", form, formState);
    return new Form.Groups({
      collection});
  });

  App.reqres.setHandler("form:wrapper", function(options = {}) {
    const formController = new Form.Controller(options);
    return formController.formLayout;
  });

  return App.reqres.setHandler("form:popup:wrapper", function(options = {}) {
    const originalCallback = options.config.callback;
    options.config.callback = function(data, layout) {
      App.execute("ui:modal:close");
      return originalCallback(data, layout);
    };
    const formController = new Form.Controller(options);
    const formContent = formController.formLayout.render().$el;
    formController.formLayout.trigger('show');
    const popupStyle = options.config.editForm ? 'edit-form' : 'form';
    const titleHtml = options.titleHtml != null ? options.titleHtml : _.escape(options.title);
    return App.execute("ui:modal:form:show", titleHtml, formContent, popupStyle);
  });
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Components.Form", function(Form, App, Backbone, Marionette, $, _) {


  //# Full form wrapper
  let Cls = (Form.FormWrapper = class FormWrapper extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = "components/form/form";
      this.prototype.tagName = "form";
  
      this.prototype.regions = {
        formContentRegion: ".form-content-region",
        formResponse:      ".response"
      };
  
      this.prototype.triggers = {
        "click .form-save"                  : "form:submit",
        "click [data-form-button='cancel']" : "form:cancel"
      };
  
      this.prototype.modelEvents = {
        "change:_errors"  : "changeErrors",
        "sync:start"      : "syncStart",
        "sync:stop"       : "syncStop"
      };
    }

    initialize() {
      this.config = this.options.config;
      return this.on("form:save", msg => {
        return this.addSuccessMsg(msg);
      });
    }

    attributes() {
      let attrs = {class: 'component-form'};
      if (this.options.config && this.options.config.attributes) {
        attrs = _.extend(attrs, this.options.config.attributes);
      }
      return attrs;
    }

    onRender() {
      return _.defer(() => {
        if (this.config.focusFirstInput) { this.focusFirstInput(); }
        $('.btn').ripples({color: 'rgba(255,255,255,0.1)'});
        App.vent.trigger("form:onshow", this.config);
        // Bind button triggers
        $('.form-item .form-button', this.$el).on('click', function(e) {
          e.preventDefault();
          if ($(this).data('trigger')) {
            return App.execute($(this).data('trigger'));
          }
        });
        if (this.config.tabs) {
          return this.makeTabs(this.$el);
        }
      });
    }

    focusFirstInput() {
      return this.$(":input:visible:enabled:first").focus();
    }

    changeErrors(model, errors, options) {
      if (this.config.errors) {
        if (_.isEmpty(errors)) { return this.removeErrors(); } else { return this.addErrors(errors); }
      }
    }

    removeErrors() {
      return this.$(".error").removeClass("error").find("small").remove();
    }

    addErrors(errors = {}) {
      return (() => {
        const result = [];
        for (var name in errors) {
          var array = errors[name];
          result.push(this.addError(name, array[0]));
        }
        return result;
      })();
    }

    addError(name, error) {
      const el = this.$(`[name='${name}']`);
      const sm = $("<small>").text(error);
      return el.after(sm).closest(".row").addClass("error");
    }

    addSuccessMsg(msg) {
      const $el = $(".response", this.$el);
      $el.text(msg).show();
      return setTimeout((() => $el.fadeOut()), 5000);
    }

    makeTabs($ctx) {
      const $tabs = $('<ul>').addClass('form-tabs');
      $('.group-title', $ctx).each((i, d) => $('<li>')
      .html($(d).html())
      .click(function(e) {
        $('.group-parent').hide();
        $(d).closest('.group-parent').show();
        $(e.target).closest('.form-tabs').find('li').removeClass('active');
        return $(e.target).addClass('active');}).appendTo($tabs));
      $('.form-groups', $ctx).before($tabs);
      $tabs.find('li').first().trigger('click');
      return $ctx.addClass('with-tabs');
    }
  });
  Cls.initClass();


  //# Form item element - very basic copy of drupals form api format
  Cls = (Form.Item = class Item extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'components/form/form_item';
      this.prototype.tagName = 'div';
    }

    initialize() {
      // Base and base material attributes
      let el;
      const name = this.model.get('name') ? this.model.get('name') : this.model.get('id');
      const baseAttrs = _.extend({id: 'form-edit-' + this.model.get('id'), name, class: ''}, this.model.get('attributes'));
      const materialBaseAttrs = _.extend({}, baseAttrs);
      materialBaseAttrs.class += ' form-control';

      // Escape raw titles.
      if ((this.model.get('titleHtml') == null)) {
        this.model.set('titleHtml', this.model.escape('title'));
      }

      // Create an element based on the type, extending base attrs
      switch (this.model.get('type')) {

        case 'checkbox':
          var attrs = {type: 'checkbox', value: 1, class: 'form-checkbox'};
          if (this.model.get('defaultValue') === true) {
            attrs.checked = 'checked';
          }
          el = this.themeTag('input', _.extend(baseAttrs, attrs), '');
          break;

        case 'textfield': case 'number': case 'date': case 'imageselect':
          var textfields = ['textfield', 'imageselect'];
          var inputType = helpers.global.inArray(this.model.get('type'), textfields) ? 'text' : this.model.get('type');
          attrs = {type: inputType, value: this.model.get('defaultValue')};
          el = this.themeTag('input', _.extend(materialBaseAttrs, attrs), '');
          break;

        case 'hidden':
          attrs = {type: 'hidden', value: this.model.get('defaultValue'), class: 'form-hidden'};
          el = this.themeTag('input', _.extend(baseAttrs, attrs), '');
          break;

        case 'button':
          attrs = {class: 'form-button btn btn-secondary'};
          if (this.model.get('trigger')) {
            attrs['data-trigger'] = this.model.get('trigger');
          }
          el = this.themeTag('button', _.extend(baseAttrs, attrs), this.model.get('value'));
          break;

        case 'textarea':
          el = this.themeTag('textarea', materialBaseAttrs, this.model.get('defaultValue'));
          break;

        case 'markup':
          attrs = {class: 'form-markup'};
          el = this.themeTag('div', attrs, this.model.get('markup'));
          break;

        case 'select':
          var options = '';
          var object = this.model.get('options');
          for (var key in object) {
            var val = object[key];
            attrs = {value: key};
            var value = this.model.get('defaultValue');
            if (String(value) === String(key)) {
              attrs.selected = 'selected';
            }
            options += this.themeTag('option', attrs, val);
          }
          el = this.themeTag('select', _.extend(baseAttrs, {class: 'form-control'}), options);
          break;

        default:
          el = null;
      }

      if (el) {
        return this.model.set({element: el});
      }
    }

    attributes() {
      let elClasses = [];
      const elAttrs = this.model.get('attributes');
      if (elAttrs.class) {
        elClasses = _.map(elAttrs.class.split(' '), c => 'form-item-' + c);
      }
      return {class: 'form-item form-group form-type-' + this.model.get('type') + ' form-edit-' + this.model.get('id') + ' ' + elClasses.join(' ')};
    }

    onRender() {
      return _.defer(() => {
        if (this.model.get('prefix')) {
          this.$el.before(this.model.get('prefix'));
        }
        if (this.model.get('suffix')) {
          return this.$el.after(this.model.get('suffix'));
        }
      });
    }
  });
  Cls.initClass();

  //# Form item list
  Cls = (Form.Group = class Group extends App.Views.CompositeView {
    static initClass() {
      this.prototype.template = 'components/form/form_item_group';
      this.prototype.tagName = 'div';
      this.prototype.childViewContainer = '.form-items';
    }
    // Dynamically assign child view depending on type
    getChildView(item) {
      if (item.get('type') === 'imageselect') {
        return Form.ItemImageSelect;
      } else {
        // Default
        return Form.Item;
      }
    }
    attributes() {
      return {
        class: 'form-group group-parent ' + this.model.get('class')
      };
    }
    initialize() {
      const children = this.model.get('children');
      if (children.length === 0) {
        return this.model.set('title', '');
      } else {
        return this.collection = children;
      }
    }
  });
  Cls.initClass();

  Cls = (Form.Groups = class Groups extends App.Views.CollectionView {
    static initClass() {
      this.prototype.childView = Form.Group;
      this.prototype.className = 'form-groups';
    }
  });
  Cls.initClass();

  /*
    Custom Widgets that extend Form.Item
  */

  //# Image selector widget (gets assigned in getChildView within Form.Group)
  return (function() {
    Cls = (Form.ItemImageSelect = class ItemImageSelect extends Form.Item {
      static initClass() {
        this.prototype.template = 'components/form/form_item_imageselect';
      }
      //# Add the current image and assign as default
      initialize() {
        super.initialize(...arguments);
        const thumb = App.request("images:path:get", this.model.get('defaultValue'), this.model.get('id'));
        return this.model.set({image: {original: this.model.get('defaultValue'), thumb}});
      }
      //# We wait til render to fetch the external images and build the UI
      onRender() {
        const item = this.model.get('formState');
        const field = this.model.get('id');
        const metadataHandler = this.model.get('metadataImageHandler');
        const metadataLookup = this.model.get('metadataLookupField');
        // els in use.
        const $wrapper = $('.form-imageselect', this.$el);
        const $thumbs = $('.form-imageselect__thumbs', this.$el);
        const $input = $('.form-imageselect__url input', this.$el);
        const $tabs = $('.form-imageselect__tabs', this.$el);
        const $panes = $('.form-imageselect__panes', this.$el);
        // tabs toggle
        $tabs.on('click', 'li', function(e) {
          $tabs.find('li').removeClass('active');
          $(this).addClass('active');
          $panes.find('.pane').removeClass('active');
          return $panes.find('.pane[rel=' + $(this).data('pane') + ']').addClass('active');
        });
        // Load images and allow selection
        $thumbs.on('click', 'li', function(e) {
          $thumbs.find('li').removeClass('selected');
          return $input.val($(this).addClass('selected').data('original'));
        });
        return _.defer(function() {
          if (metadataHandler && metadataLookup && item[metadataLookup]) {
            $wrapper.addClass('images-loading');
            return App.execute(metadataHandler, item[metadataLookup], function(collection) {
              for (var image of collection.where({type: field})) {
                $('<li>').data('original', image.get('url'))
                  .css('background-image', 'url(' + image.get('thumbnail') + ')')
                  .attr('title', image.get('title')).appendTo($thumbs);
              }
              return $wrapper.removeClass('images-loading');
            });
          }
        });
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp", function(AddonApp, App, Backbone, Marionette, $, _) {

  const Cls = (AddonApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "addons/:type"            : "list",
        "addon/execute/:id" : "execute"
      };
    }
  });
  Cls.initClass();

  var API = {

    // Get list page
    list(type) {
      return new AddonApp.List.Controller({
        type});
    },

    // Execute addon
    execute(id) {
      API.addonController().executeAddon(id, helpers.url.params(), () => Kodi.execute("notification:show", tr('Executed addon')));
      return App.navigate("addons/executable", {trigger: true});
    },

    // Get the addon controller
    addonController() {
      return App.request("command:kodi:controller", 'auto', 'AddOn');
    },

    // Get all enabled addons
    getEnabledAddons(callback) {
      let addons = [];
      // If loaded, return from static
      if (config.getLocal("addOnsLoaded", false) === true) {
        addons = config.getLocal("addOnsEnabled", []);
        if (callback) {
          callback(addons);
        }
      } else {
        // Not loaded, lookup and set to static
        this.addonController().getEnabledAddons(true, function(addons) {
          config.setLocal("addOnsEnabled", addons);
          config.setLocal("addOnsLoaded", true);
          config.set('app', "addOnsSearchSettings", API.getSearchSettings(addons));
          if (callback) {
            return callback(addons);
          }
        });
      }
      return addons;
    },

    //# Get search settings
    getSearchSettings(addons) {
      const searchSettings = [];
      for (var addon of addons) {
        var searchSetting = App.request("addon:search:settings:" + addon.addonid);
        if (searchSetting) {
          if (!_.isArray(searchSetting)) {
            searchSetting = [searchSetting];
          }
          for (var i in searchSetting) {
            var set = searchSetting[i];
            set.id = addon.addonid + '.' + i;
            searchSettings.push(set);
          }
        }
      }
      return searchSettings;
    },

    // Given a filter check if addon is enabled, if addons not loaded returns false.
    isAddOnEnabled(filter = {}, callback) {
      const addons = this.getEnabledAddons(callback);
      return _.findWhere(addons, filter);
    }
  };


  App.on("before:start", function() {
    new AddonApp.Router({
      controller: API});
    // Store enabled addons.
    return API.getEnabledAddons(resp => App.vent.trigger("navMain:refresh"));
  });
      // Addons loaded to cache, hopefully before required


  // Request is addon enabled.
  App.reqres.setHandler('addon:isEnabled', (filter, callback) => API.isAddOnEnabled(filter, function(enabled) { if (callback) { return callback(enabled); } }));

  // Request is addon enabled.
  App.reqres.setHandler('addon:enabled:addons', callback => API.getEnabledAddons(function(addons) { if (callback) { return callback(addons); } }));

  // Request excluded breadcrumb paths
  App.reqres.setHandler('addon:excludedPaths', function(addonId) {
    let excludedPaths;
    if (addonId != null) {
      excludedPaths = App.request("addon:excludedPaths:" + addonId);
    }
    if ((excludedPaths == null)) {
      excludedPaths = [];
    }
    return excludedPaths;
  });

  // Request excluded breadcrumb paths
  return App.reqres.setHandler('addon:search:enabled', function() {
    let settings = config.get('app', "addOnsSearchSettings", []);
    settings = settings.concat(App.request('searchAddons:entities').toJSON());
    return settings;
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.GoogleMusic", function(GoogleMusic, App, Backbone, Marionette, $, _) {

  const API = {

    addonId: 'plugin.audio.googlemusic.exp',

    searchAddon: {
      id: this.addonId,
      url: 'plugin://plugin.audio.googlemusic.exp/?path=search_result&type=track&query=[QUERY]',
      title: 'GoogleMusic',
      media: 'music'
    }
  };


  //# Provide search settings
  return App.reqres.setHandler("addon:search:settings:" + API.addonId, () => API.searchAddon);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.List", function(List, App, Backbone, Marionette, $, _) {


  //# Main controller
  return List.Controller = class Controller extends App.Controllers.Base {

    //# Setup
    initialize(options) {
      this.type = options.type;
      return App.request("addon:entities", this.type, collection => {
        collection.sortCollection('name');
        this.layout = this.getLayoutView(collection);
        this.listenTo(this.layout, "show", () => {
          this.renderList(collection);
          return this.renderSidebar();
        });
        return App.regionContent.show(this.layout);
      });
    }

    //# Render items
    renderList(collection) {
      const view = new List.Addons({
        collection});
      return this.layout.regionContent.show(view);
    }

    //# Get the base layout
    getLayoutView(collection) {
      return new List.ListLayout({
        collection});
    }

    //# Add side nav
    renderSidebar() {
      const settingsNavView = App.request("navMain:children:show", 'addons/all', 'Add-ons');
      return this.layout.regionSidebarFirst.show(settingsNavView);
    }
  };
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "addon-list";
    }
  });
  Cls.initClass();

  Cls = (List.Teaser = class Teaser extends App.Views.CardView {
    static initClass() {
      this.prototype.tagName = "li";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.Addons = class Addons extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.Teaser;
        this.prototype.emptyView = App.Views.EmptyViewResults;
        this.prototype.tagName = "ul";
        this.prototype.sort = 'name';
        this.prototype.className = "card-grid--square";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.MixCloud", function(MixCloud, App, Backbone, Marionette, $, _) {

  const API = {

    addonId: 'plugin.audio.mixcloud',

    searchAddon: {
      id: this.addonId,
      url: 'plugin://plugin.audio.mixcloud/?mode=30&key=cloudcast&offset=0&query=[QUERY]',
      title: 'MixCloud',
      media: 'music'
    }
  };

  //# Provide search settings
  return App.reqres.setHandler("addon:search:settings:" + API.addonId, () => API.searchAddon);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.Pvr", function(Pvr, App, Backbone, Marionette, $, _) {

  const API = {

    isEnabled() {
      return App.request("addon:isEnabled", {type: 'kodi.pvrclient'});
    }
  };

  //# Is a pvr client enabled (used for menu visibility).
  return App.reqres.setHandler("addon:pvr:enabled", () => API.isEnabled());
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.Radio", function(Radio, App, Backbone, Marionette, $, _) {

  const API = {

    addonId: 'plugin.audio.radio_de',

    searchAddon: {
      id: this.addonId,
      url: 'plugin://plugin.audio.radio_de/stations/search/[QUERY]',
      title: 'Radio',
      media: 'music'
    }
  };


  //# Provide search settings
  return App.reqres.setHandler("addon:search:settings:" + API.addonId, () => API.searchAddon);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.SoundCloud", function(Soundcloud, App, Backbone, Marionette, $, _) {

  const API = {

    addonId: 'plugin.audio.soundcloud',

    searchAddon: {
      id: this.addonId,
      url: 'plugin://plugin.audio.soundcloud/search/?query=[QUERY]',
      title: 'SoundCloud',
      media: 'music'
    }
  };

  //# Provide search settings
  return App.reqres.setHandler("addon:search:settings:" + API.addonId, () => API.searchAddon);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AddonApp.YouTube", function(Soundcloud, App, Backbone, Marionette, $, _) {

  const API = {

    addonId: 'plugin.video.youtube',

    searchAddon: {
      url: 'plugin://plugin.video.youtube/search/?q=[QUERY]',
      title: 'YouTube',
      media: 'video'
    }
  };

  //# Provide search settings
  App.reqres.setHandler("addon:search:settings:" + API.addonId, () => API.searchAddon);

  //#
  //# Get any excluded paths that should not appear in breadcrumbs.
  //#
  //# Called via App.request("addon:excludedPaths", addonId)
  //#
  //# Eg. the youtube path "special" and "kodion" is used but both are
  //# invalid paths when requesting that url, yet they appear in breadcrumbs
  //# because they are part of the base url for other pages.
  //#
  //# Note the naming convention of the handler has the plugin id in it.
  //#
  return App.reqres.setHandler("addon:excludedPaths:" + API.addonId, () => [
    'plugin://plugin.video.youtube/special/',
    'plugin://plugin.video.youtube/kodion/search/',
    'plugin://plugin.video.youtube/kodion/',
    'plugin://plugin.video.youtube/channel/',
  ]);
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AlbumApp", function(AlbumApp, App, Backbone, Marionette, $, _) {

  const Cls = (AlbumApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "music/albums"      : "list",
        "music/album/:id"   : "view"
      };
    }
  });
  Cls.initClass();

  const API = {

    list() {
      return new AlbumApp.List.Controller();
    },

    view(id) {
      return new AlbumApp.Show.Controller({
        id});
    },

    action(op, view) {
      const {
        model
      } = view;
      const playlist = App.request("command:kodi:controller", 'audio', 'PlayList');
      switch (op) {
        case 'play':
          return App.execute("command:audio:play", 'albumid', model.get('albumid'));
        case 'add':
          return playlist.add('albumid', model.get('albumid'));
        case 'localadd':
          return App.execute("localplaylist:addentity", 'albumid', model.get('albumid'));
        case 'localplay':
          var localPlaylist = App.request("command:local:controller", 'audio', 'PlayList');
          return localPlaylist.play('albumid', model.get('albumid'));
        default:
      }
    }
  };
        //# nothing


  App.on("before:start", () => new AlbumApp.Router({
    controller: API}));

  App.commands.setHandler('album:action', (op, model) => API.action(op, model));

  App.reqres.setHandler('album:action:items', () => ({
    actions: {thumbs: 'Thumbs up'},
    menu: {add: tr('Queue in Kodi'), 'divider-1': '', localadd: tr('Add to playlist'), localplay: tr('Play in browser'), 'divider-2': '', edit: tr('Edit')}
  }));

  return App.commands.setHandler('album:edit', function(model) {
    const loadedModel = App.request("album:entity", model.get('id'));
    return App.execute("when:entity:fetched", loadedModel, () => {
      return new AlbumApp.Edit.Controller({
        model: loadedModel});
    });
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AlbumApp.Edit", function(Edit, App, Backbone, Marionette, $, _) {

  return Edit.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      let form;
      this.model = this.getOption('model');
      const options = {
        titleHtml: '<span>' + tr('Edit') + '</span>' + this.model.escape('title'),
        form: this.getStructure(),
        formState: this.model.attributes,
        config: {
          attributes: {class: 'edit-form'},
          editForm: true,
          tabs: true,
          callback: (data, formView) => {
            return this.saveCallback(data, formView);
          }
        }
      };
      return form = App.request("form:popup:wrapper", options);
    }

    getStructure() {
      return [
        {
          title: 'General',
          id: 'general',
          children:[
            {id: 'title', title: tr('Title'), type: 'textfield'},
            {id: 'artist', title: tr('Artist'), type: 'textfield', format: 'array.string'},
            {id: 'description', title: tr('Description'), type: 'textarea'},
            {id: 'albumlabel', title: tr('Label'), type: 'textfield'},
            {id: 'year', title: tr('Year'), type: 'number', format: 'integer', attributes: {class: 'half-width', step: 1, min: 0, max: 9999}},
            {id: 'rating', title: tr('Rating'), type: 'number', format: 'float', attributes: {class: 'half-width', step: 0.1, min: 0, max: 10}, suffix: '<div class="clearfix"></div>'},
          ]
        },
        {
          title: 'Tags',
          id: 'tags',
          children:[
            {id: 'genre', title: tr('Genres'), type: 'textfield', format: 'array.string'},
            {id: 'style', title: tr('Styles'), type: 'textfield', format: 'array.string'},
            {id: 'theme', title: tr('Themes'), type: 'textarea', format: 'array.string'},
            {id: 'mood', title: tr('Moods'), type: 'textarea', format: 'array.string'},
          ]
        }
      ];
    }

    //# Save the settings to Kodi
    saveCallback(data, formView) {
      const controller = App.request("command:kodi:controller", 'audio', 'AudioLibrary');
      return controller.setAlbumDetails(this.model.get('id'), data, () => {
        Kodi.vent.trigger('entity:kodi:update', this.model.get('uid'));
        return Kodi.execute("notification:show", t.sprintf(tr("Updated %1$s details"), 'album'));
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AlbumApp.List", function(List, App, Backbone, Marionette, $, _) {

  var API = {

    bindTriggers(view) {
      App.listenTo(view, 'childview:album:play', (list, item) => App.execute('album:action', 'play', item));
      App.listenTo(view, 'childview:album:add', (list, item) => App.execute('album:action', 'add', item));
      App.listenTo(view, 'childview:album:localadd', (list, item) => App.execute('album:action', 'localadd', item));
      App.listenTo(view, 'childview:album:localplay', (list, item) => App.execute('album:action', 'localplay', item));
      return App.listenTo(view, 'childview:album:edit', (parent, item) => App.execute('album:edit', item.model));
    },

    getAlbumsList(collection) {
      const view = new List.Albums({
        collection});
      API.bindTriggers(view);
      return view;
    }
  };


  //# Main controller
  List.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      const collection = App.request("album:entities");
      return App.execute("when:entity:fetched", collection, () => {

        //# Set available filters
        collection.availableFilters = this.getAvailableFilters();

        //# Top level menu path for filters
        collection.sectionId = 'music';

        //# If present set initial filter via url
        App.request('filter:init', this.getAvailableFilters());

        this.layout = this.getLayoutView(collection);

        //# Render subviews on show
        this.listenTo(this.layout, "show", () => {
          this.renderList(collection);
          return this.getFiltersView(collection);
        });
        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new List.ListLayout({
        collection});
    }

    //# Available sort and filter options
    //# See filter_app.js for available options
    getAvailableFilters() {
      return {
        sort: ['label', 'year', 'rating', 'artist', 'dateadded', 'random'],
        filter: ['year', 'genre', 'style', 'albumlabel', 'thumbsUp']
      };
    }

    //# Apply filter view and provide a handler for applying changes
    getFiltersView(collection) {
      const filters = App.request('filter:show', collection);
      this.layout.regionSidebarFirst.show(filters);
      //# Listen to when the filters change and re-render.
      return this.listenTo(filters, "filter:changed", () => {
        return this.renderList(collection);
      });
    }

    //# Get the list view with filters applied.
    renderList(collection) {
      App.execute("loading:show:view", this.layout.regionContent);
      const filteredCollection = App.request('filter:apply:entities', collection);
      const view = API.getAlbumsList(filteredCollection);
      return this.layout.regionContent.show(view);
    }
  };


  //# handler for other modules to get a list view.
  return App.reqres.setHandler("album:list:view", collection => API.getAlbumsList(collection));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AlbumApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "album-list with-filters";
    }
  });
  Cls.initClass();

  Cls = (List.AlbumTeaser = class AlbumTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        "click .play"               : "album:play",
        "click .dropdown .add"      : "album:add",
        "click .dropdown .localadd" : "album:localadd",
        "click .dropdown .localplay" : "album:localplay",
        "click .dropdown .edit"     : "album:edit"
      };
    }
    initialize() {
      super.initialize(...arguments);
      if (this.model != null) {
        this.setMeta();
        return this.model.set(App.request('album:action:items'));
      }
    }
    setMeta() {
      if (this.model) {
        return this.model.set({subtitleHtml: this.themeLink(this.model.get('artist'), helpers.url.get('artist', this.model.get('artistid')))});
      }
    }
  });
  Cls.initClass();

  Cls = (List.Empty = class Empty extends App.Views.EmptyViewResults {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.className = "album-empty-result";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.Albums = class Albums extends App.Views.VirtualListView {
      static initClass() {
        this.prototype.childView = List.AlbumTeaser;
        this.prototype.emptyView = List.Empty;
        this.prototype.tagName = "ul";
        this.prototype.sort = 'artist';
        this.prototype.className = "card-grid--square";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AlbumApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  var API = {

    bindTriggers(view) {
      App.listenTo(view, 'album:play', item => App.execute('album:action', 'play', item));
      App.listenTo(view, 'album:add', item => App.execute('album:action', 'add', item));
      App.listenTo(view, 'album:localadd', item => App.execute('album:action', 'localadd', item));
      App.listenTo(view, 'album:localplay', item => App.execute('album:action', 'localplay', item));
      return App.listenTo(view, 'album:edit', item => App.execute('album:edit', item.model));
    },

    //# Return a set of albums with songs.
    //# Songs is expected to be an array of song collections
    //# keyed by albumid. The only thing that should be calling this is artists.
    getAlbumsFromSongs(songs) {
      const albumsCollectionView = new Show.WithSongsCollection();
      //# What happens when we add a child to this mofo
      albumsCollectionView.on("add:child", albumView => {
        return App.execute("when:entity:fetched", album, () => {
          const {
            model
          } = albumView;
          //# Add the teaser.
          const teaser = new Show.AlbumTeaser({model});
          API.bindTriggers(teaser);
          albumView.regionMeta.show(teaser);
          //# Add the songs.
          const songSet = _.findWhere(songs, {albumid: model.get('albumid')});
          const songView = App.request("song:list:view", songSet.songs);
          return albumView.regionSongs.show(songView);
        });
      });
      //# Loop over albums/song collections
      for (var albumSet of songs) {
        //# Get the album.
        var album = App.request("album:entity", albumSet.albumid, { success(album) {
          return albumsCollectionView.addChild(album, Show.WithSongsLayout);
        }
      }
        );
      }
      //# Return the collection view
      return albumsCollectionView;
    }
  };


  //# When viewing a full page we call the controller
  Show.Controller = class Controller extends App.Controllers.Base {

    //# The Album page.
    initialize(options) {
      const id = parseInt(options.id);
      const album = App.request("album:entity", id);
      //# Fetch the artist
      return App.execute("when:entity:fetched", album, () => {
        //# Get the layout.
        this.layout = this.getLayoutView(album);
        //# Ensure background removed when we leave.
        this.listenTo(this.layout, "destroy", () => {
          return App.execute("images:fanart:set", 'none');
        });
        //# Listen to the show of our layout.
        this.listenTo(this.layout, "show", () => {
          this.getMusic(id);
          return this.getDetailsLayoutView(album);
        });
        //# Add the layout to content.
        return App.regionContent.show(this.layout);
      });
    }

    //# Get the base layout
    getLayoutView(album) {
      return new Show.PageLayout({
        model: album});
    }

    //# Build the details layout.
    getDetailsLayoutView(album) {
      const headerLayout = new Show.HeaderLayout({model: album});
      this.listenTo(headerLayout, "show", () => {
        const teaser = new Show.AlbumDetailTeaser({model: album});
        API.bindTriggers(teaser);
        const detail = new Show.Details({model: album});
        this.listenTo(detail, "show", () => {
          return API.bindTriggers(detail);
        });
        headerLayout.regionSide.show(teaser);
        return headerLayout.regionMeta.show(detail);
      });
      return this.layout.regionHeader.show(headerLayout);
    }


    //# Get a list of all the music for this artist parsed into albums.
    getMusic(id) {
      const options =
        {filter: {albumid: id}};
      //# Get all the songs and parse them into separate album collections.
      const songs = App.request("song:entities", options);
      return App.execute("when:entity:fetched", songs, () => {
        const albumView = new Show.WithSongsLayout();
        const songView = App.request("song:list:view", songs);
        this.listenTo(albumView, "show", () => {
          return albumView.regionSongs.show(songView);
        });
        return this.layout.regionContent.show(albumView);
      });
    }
  };


  //# Return a set of albums with songs.
  return App.reqres.setHandler("albums:withsongs:view", songs => API.getAlbumsFromSongs(songs));
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("AlbumApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  //# Album with songs.

  let Cls = (Show.WithSongsLayout = class WithSongsLayout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/album/show/album_with_songs';
      this.prototype.className = 'album-wrapper';
      this.prototype.regions = {
        regionMeta: '.region-album-meta',
        regionSongs: '.region-album-songs'
      };
    }
  });
  Cls.initClass();

  Cls = (Show.WithSongsCollection = class WithSongsCollection extends App.Views.CollectionView {
    static initClass() {
      this.prototype.childView = Show.WithSongsLayout;
      this.prototype.tagName = "div";
      this.prototype.sort = 'year';
      this.prototype.className = "albums-wrapper";
    }
  });
  Cls.initClass();

  //# Full page views.

  Cls = (Show.PageLayout = class PageLayout extends App.Views.LayoutWithHeaderView {
    static initClass() {
      this.prototype.className = 'album-show detail-container';
    }
  });
  Cls.initClass();

  Cls = (Show.HeaderLayout = class HeaderLayout extends App.Views.LayoutDetailsHeaderView {
    static initClass() {
      this.prototype.className = 'album-details';
    }
  });
  Cls.initClass();

  Cls = (Show.Details = class Details extends App.Views.DetailsItem {
    static initClass() {
      this.prototype.template = 'apps/album/show/details_meta';
      this.prototype.triggers = {
        "click .play"       : "album:play",
        "click .add"        : "album:add",
        "click .localadd"   : "album:localadd",
        "click .localplay"  : "album:localplay",
        "click .edit"       : "album:edit"
      };
    }
  });
  Cls.initClass();

  Cls = (Show.AlbumTeaser = class AlbumTeaser extends App.AlbumApp.List.AlbumTeaser {
    static initClass() {
      this.prototype.tagName = "div";
    }
    initialize() {
      this.setMeta();
      return this.model.set(App.request('album:action:items'));
    }
    setMeta() {
      return this.model.set({
        subtitleHtml: this.themeLink(this.model.get('year'), 'music/albums?year=' + this.model.get('year'))});
    }
    attributes() {
      return this.watchedAttributes('card-minimal');
    }
  });
  Cls.initClass();

  return (Show.AlbumDetailTeaser = class AlbumDetailTeaser extends Show.AlbumTeaser {
    attributes() {
      return this.watchedAttributes('card-detail');
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ArtistApp", function(ArtistApp, App, Backbone, Marionette, $, _) {

  const Cls = (ArtistApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "music/artists"     : "list",
        "music/artist/:id"  : "view"
      };
    }
  });
  Cls.initClass();

  const API = {

    list() {
      return new ArtistApp.List.Controller();
    },

    view(id) {
      return new ArtistApp.Show.Controller({
        id});
    },

    action(op, view) {
      const {
        model
      } = view;
      const playlist = App.request("command:kodi:controller", 'audio', 'PlayList');
      switch (op) {
        case 'play':
          return App.execute("command:audio:play", 'artistid', model.get('artistid'));
        case 'add':
          return playlist.add('artistid', model.get('artistid'));
        case 'localadd':
          return App.execute("localplaylist:addentity", 'artistid', model.get('artistid'));
        case 'localplay':
          var localPlaylist = App.request("command:local:controller", 'audio', 'PlayList');
          return localPlaylist.play('artistid', model.get('artistid'));
        default:
      }
    }
  };
          //# nothing


  App.on("before:start", () => new ArtistApp.Router({
    controller: API}));

  App.commands.setHandler('artist:action', (op, model) => API.action(op, model));

  App.reqres.setHandler('artist:action:items', () => ({
    actions: {thumbs: tr('Thumbs up')},
    menu: {add: tr('Queue in Kodi'), 'divider-1': '', localadd: tr('Add to playlist'), localplay: tr('Play in browser'), 'divider-1': '', edit: tr('Edit')}
  }));

  return App.commands.setHandler('artist:edit', function(model) {
    const loadedModel = App.request("artist:entity", model.get('id'));
    return App.execute("when:entity:fetched", loadedModel, () => {
      return new ArtistApp.Edit.Controller({
        model: loadedModel});
    });
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ArtistApp.Edit", function(Edit, App, Backbone, Marionette, $, _) {

  return Edit.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      let form;
      this.model = this.getOption('model');
      const options = {
        titleHtml: '<span>' + tr('Edit') + '</span>' + this.model.escape('artist'),
        form: this.getStructure(),
        formState: this.model.attributes,
        config: {
          attributes: {class: 'edit-form'},
          editForm: true,
          tabs: true,
          callback: (data, formView) => {
            return this.saveCallback(data, formView);
          }
        }
      };
      return form = App.request("form:popup:wrapper", options);
    }

    getStructure() {
      return [
        {
          title: 'General',
          id: 'general',
          children:[
            {id: 'artist', title: tr('Title'), type: 'textfield'},
            {id: 'description', title: tr('Description'), type: 'textarea'},
            {id: 'formed', title: tr('Formed'), type: 'textfield', attributes: {class: 'half-width'}},
            {id: 'disbanded', title: tr('Disbanded'), type: 'textfield', attributes: {class: 'half-width'}, suffix: '<div class="clearfix"></div>'},
            {id: 'born', title: tr('Born'), type: 'textfield', attributes: {class: 'half-width'}},
            {id: 'died', title: tr('Died'), type: 'textfield', attributes: {class: 'half-width'}, suffix: '<div class="clearfix"></div>'},
            {id: 'yearsactive', title: tr('Years Active'), type: 'textfield', format: 'array.string'},
          ]
        },
        {
          title: 'Tags',
          id: 'tags',
          children:[
            {id: 'genre', title: tr('Genres'), type: 'textfield', format: 'array.string'},
            {id: 'style', title: tr('Styles'), type: 'textfield', format: 'array.string'},
            {id: 'instrument', title: tr('Instruments'), type: 'textarea', format: 'array.string'},
            {id: 'mood', title: tr('Moods'), type: 'textarea', format: 'array.string'},
          ]
        }
      ];
    }

    //# Save the settings to Kodi
    saveCallback(data, formView) {
      const controller = App.request("command:kodi:controller", 'audio', 'AudioLibrary');
      return controller.setArtistDetails(this.model.get('id'), data, () => {
        Kodi.vent.trigger('entity:kodi:update', this.model.get('uid'));
        return Kodi.execute("notification:show", t.sprintf(tr("Updated %1$s details"), 'album'));
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ArtistApp.List", function(List, App, Backbone, Marionette, $, _) {

  var API = {

    bindTriggers(view) {
      App.listenTo(view, 'childview:artist:play', (list, item) => App.execute('artist:action', 'play', item));
      App.listenTo(view, 'childview:artist:add', (list, item) => App.execute('artist:action', 'add', item));
      App.listenTo(view, 'childview:artist:localadd', (list, item) => App.execute('artist:action', 'localadd', item));
      App.listenTo(view, 'childview:artist:localplay', (list, item) => App.execute('artist:action', 'localplay', item));
      return App.listenTo(view, 'childview:artist:edit', (parent, item) => App.execute('artist:edit', item.model));
    },

    getArtistList(collection) {
      const view = new List.Artists({
        collection});
      API.bindTriggers(view);
      return view;
    }
  };


  //# Main controller
  List.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      const collection = App.request("artist:entities");
      return App.execute("when:entity:fetched", collection, () => {

        //# Set available filters
        collection.availableFilters = this.getAvailableFilters();

        //# Top level menu path for filters
        collection.sectionId = 'music';

        //# If present set initial filter via url
        App.request('filter:init', this.getAvailableFilters());

        this.layout = this.getLayoutView(collection);

        this.listenTo(this.layout, "show", () => {
          this.renderList(collection);
          return this.getFiltersView(collection);
        });

        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new List.ListLayout({
        collection});
    }

    //# Available sort and filter options
    //# See filter_app.js for available options
    getAvailableFilters() {
      return {
        sort: ['label', 'random'],
        filter: ['mood', 'genre', 'style', 'thumbsUp']
      };
    }

    //# Apply filter view and provide a handler for applying changes
    getFiltersView(collection) {
      const filters = App.request('filter:show', collection);
      this.layout.regionSidebarFirst.show(filters);
      //# Listen to when the filters change and re-render.
      return this.listenTo(filters, "filter:changed", () => {
        return this.renderList(collection);
      });
    }

    //# Get the list view with filters applied.
    renderList(collection) {
      App.execute("loading:show:view", this.layout.regionContent);
      const filteredCollection = App.request('filter:apply:entities', collection);
      const view = API.getArtistList(filteredCollection);
      return this.layout.regionContent.show(view);
    }
  };


  //# handler for other modules to get a list view.
  return App.reqres.setHandler("artist:list:view", collection => API.getArtistList(collection));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ArtistApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "artist-list with-filters";
    }
  });
  Cls.initClass();

  Cls = (List.ArtistTeaser = class ArtistTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        "click .play" : "artist:play",
        "click .dropdown .add" : "artist:add",
        "click .dropdown .localadd" : "artist:localadd",
        "click .dropdown .localplay" : "artist:localplay",
        "click .dropdown .edit" : "artist:edit"
      };
    }

    initialize() {
      super.initialize(...arguments);
      if (this.model != null) {
        return this.model.set(App.request('album:action:items'));
      }
    }
  });
  Cls.initClass();

  Cls = (List.Empty = class Empty extends App.Views.EmptyViewResults {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.className = "artist-empty-result";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.Artists = class Artists extends App.Views.VirtualListView {
      static initClass() {
        this.prototype.childView = List.ArtistTeaser;
        this.prototype.emptyView = List.Empty;
        this.prototype.tagName = "ul";
        this.prototype.className = "card-grid--wide";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ArtistApp.Show", function(Show, App, Backbone, Marionette, $, _) {


  const API = {

    bindTriggers(view) {
      App.listenTo(view, 'artist:play', item => App.execute('artist:action', 'play', item));
      App.listenTo(view, 'artist:add', item => App.execute('artist:action', 'add', item));
      App.listenTo(view, 'artist:localadd', item => App.execute('artist:action', 'localadd', item));
      App.listenTo(view, 'artist:localplay', item => App.execute('artist:action', 'localplay', item));
      return App.listenTo(view, 'artist:edit', item => App.execute('artist:edit', item.model));
    }
  };

  return Show.Controller = class Controller extends App.Controllers.Base {

    //# The Artist page.
    initialize(options) {
      const id = parseInt(options.id);
      const artist = App.request("artist:entity", id);

      //# Fetch the artist
      return App.execute("when:entity:fetched", artist, () => {
        //# Get the layout.
        this.layout = this.getLayoutView(artist);
        //# Ensure background removed when we leave.
        this.listenTo(this.layout, "destroy", () => {
          return App.execute("images:fanart:set", 'none');
        });
        //# Listen to the show of our layout.
        this.listenTo(this.layout, "show", () => {
          this.getMusic(id);
          return this.getDetailsLayoutView(artist);
        });
        //# Add the layout to content.
        return App.regionContent.show(this.layout);
      });
    }

    //# Get the base layout
    getLayoutView(artist) {
      return new Show.PageLayout({
        model: artist});
    }

    //# Build the details layout.
    getDetailsLayoutView(artist) {
      const headerLayout = new Show.HeaderLayout({model: artist});
      this.listenTo(headerLayout, "show", () => {
        const teaser = new Show.ArtistTeaser({model: artist});
        API.bindTriggers(teaser);
        const detail = new Show.Details({model: artist});
        this.listenTo(detail, "show", () => {
          return API.bindTriggers(detail);
        });
        headerLayout.regionSide.show(teaser);
        return headerLayout.regionMeta.show(detail);
      });
      return this.layout.regionHeader.show(headerLayout);
    }

    //# Get a list of all the music for this artist parsed into albums.
    getMusic(id) {
      // Might take a while so show loader
      const loading = App.request("loading:get:view", tr('Loading albums'));
      this.layout.regionContent.show(loading);
      // Set artist id for fetch
      const options =
        {filter: {artistid: id}};
      // Get all the songs and parse them into separate album collections.
      const songs = App.request("song:entities", options);
      return App.execute("when:entity:fetched", songs, () => {
        const songsCollections = App.request("song:albumparse:entities", songs);
        const albumsCollection = App.request("albums:withsongs:view", songsCollections);
        return this.layout.regionContent.show(albumsCollection);
      });
    }
  };
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ArtistApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  let Cls = (Show.PageLayout = class PageLayout extends App.Views.LayoutWithHeaderView {
    static initClass() {
      this.prototype.className = 'artist-show detail-container';
    }
  });
  Cls.initClass();

  Cls = (Show.HeaderLayout = class HeaderLayout extends App.Views.LayoutDetailsHeaderView {
    static initClass() {
      this.prototype.className = 'artist-details';
    }
  });
  Cls.initClass();

  Cls = (Show.Details = class Details extends App.Views.DetailsItem {
    static initClass() {
      this.prototype.template = 'apps/artist/show/details_meta';
      this.prototype.triggers = {
        "click .play"       : "artist:play",
        "click .add"        : "artist:add",
        "click .localadd"   : "artist:localadd",
        "click .localplay"  : "artist:localplay",
        "click .edit"       : "artist:edit"
      };
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Show.ArtistTeaser = class ArtistTeaser extends App.ArtistApp.List.ArtistTeaser {
      static initClass() {
        this.prototype.tagName = "div";
      }
      initialize() {
        return this.model.set({actions: {thumbs: tr('Thumbs up')}});
      }
      attributes() {
        return this.watchedAttributes('card-detail');
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */

//# Soundmanager config.
//# Must be run before app init

soundManager.setup({
  url: 'lib/soundmanager/swf/',
  flashVersion: 9,
  preferFlash: true,
  useHTML5Audio: true,
  useFlashBlock: false,
  flashLoadTimeout: 3000,
  debugMode: false,
  noSWFCache: true,
  debugFlash: false,
  flashPollingInterval: 1000,
  html5PollingInterval: 1000,
  onready() {
    return $(window).trigger('audiostream:ready');
  },
  ontimeout() {
    $(window).trigger('audiostream:timeout');
    soundManager.flashLoadTimeout = 0; // When restarting, wait indefinitely for flash
    soundManager.onerror = {}; // Prevent an infinite loop, in case it's not flashblock
    return soundManager.reboot();
  }  // Reboot
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("BrowserApp", function(BrowserApp, App, Backbone, Marionette, $, _) {

  const Cls = (BrowserApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "browser"           : "list",
        "browser/:media/:id"  : "view"
      };
    }
  });
  Cls.initClass();

  const API = {

    list() {
      return new BrowserApp.List.Controller;
    },

    view(media, id) {
      return new BrowserApp.List.Controller({
        media,
        id
      });
    }
  };


  return App.on("before:start", () => new BrowserApp.Router({
    controller: API}));
});


;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("BrowserApp.List", function(List, App, Backbone, Marionette, $, _) {

  var API = {

    bindFileTriggers(view) {
      App.listenTo(view, 'childview:file:play', (set, item) => {
        const playlist = App.request("command:kodi:controller", item.model.get('player'), 'PlayList');
        return playlist.play('file', item.model.get('file'));
      });
      App.listenTo(view, 'childview:file:queue', (set, item) => {
        const playlist = App.request("command:kodi:controller", item.model.get('player'), 'PlayList');
        return playlist.add('file', item.model.get('file'));
      });
      return App.listenTo(view, 'childview:file:download', (set, item) => {
        return App.request("command:kodi:controller", 'auto', 'Files').downloadFile(item.model.get('file'));
      });
    },

    bindFolderTriggers(view) {
      App.listenTo(view, 'childview:folder:play', (set, item) => {
        return App.request("command:kodi:controller", item.model.get('player'), 'PlayList').play('directory', item.model.get('file'));
      });
      return App.listenTo(view, 'childview:folder:queue', (set, item) => {
        return App.request("command:kodi:controller", item.model.get('player'), 'PlayList').add('directory', item.model.get('file'));
      });
    },

    getFileListView(collection) {
      const fileView = new List.FileList({
        collection});
      API.bindFileTriggers(fileView);
      return fileView;
    },

    getFolderListView(collection) {
      const folderView = new List.FolderList({
        collection});
      App.listenTo(folderView, 'childview:folder:open', (set, item) => {
        return App.navigate(item.model.get('url'), {trigger: true});
    });
      API.bindFolderTriggers(folderView);
      return folderView;
    }
  };



  const Cls = (List.Controller = class Controller extends App.Controllers.Base {
    static initClass() {
  
      this.prototype.sourceCollection = {};
      this.prototype.backButtonModel = {};
    }

    initialize(options = {}) {
      this.layout = this.getLayout();
      this.listenTo(this.layout, "show", () => {
        this.getSources(options);
        return this.getFolderLayout();
      });
      return App.regionContent.show(this.layout);
    }

    getLayout() {
      return new List.ListLayout();
    }

    getFolderLayout() {
      const options = {sortSettings: this.getSort()};
      this.folderLayout = new List.FolderLayout(options);
      this.listenTo(this.folderLayout, 'browser:sort', (sort, $el) => {
        return this.setSort(sort, $el);
      });
      this.listenTo(this.folderLayout, 'browser:play', view => {
        if (this.model) {
          return App.request("command:kodi:controller", this.model.get('player'), 'PlayList').play('directory', this.model.get('file'));
        }
      });
      this.listenTo(this.folderLayout, 'browser:queue', view => {
        if (this.model) {
          return App.request("command:kodi:controller", this.model.get('player'), 'PlayList').add('directory', this.model.get('file'));
        }
      });
      return this.layout.regionContent.show(this.folderLayout);
    }

    setSort(sort, $el) {
      const sortSettings = this.getSort();
      if (sortSettings.method === sort) {
        sortSettings.order = sortSettings.order === 'ascending' ? 'descending' : 'ascending';
      }
      if ($el) {
        $el.removeClassStartsWith('order-').addClass('order-' + sortSettings.order).addClass('active');
      }
      sortSettings.method = sort;
      if (sortSettings.method) {
        config.set('app', 'browserSort', sortSettings);
      }
      if (this.model) {
        return this.getFolder(this.model);
      }
    }

    getSort() {
      return config.get('app', 'browserSort', {method: 'none', order: 'ascending'});
    }


    //# Get the source lists
    getSources(options) {
      const sources = App.request("file:source:entities", 'video');
      return App.execute("when:entity:fetched", sources, () => {
        //# Store the sources collection for later
        this.sourceCollection = sources;
        //# Parse into sets
        const sets = App.request("file:source:media:entities", sources);
        const setView = new List.SourcesSet({collection: sets});
        this.layout.regionSidebarFirst.show(setView);
        this.listenTo(setView, 'childview:childview:source:open', (set, item) => {
          return this.getFolder(item.model);
        });
        return this.loadFromUrl(options);
      });
    }

    loadFromUrl(options) {
      if (options.media && options.id) {
        const model = App.request("file:url:entity", options.media, options.id);
        return this.getFolder(model);
      }
    }

    getFolder(model) {
      this.model = model;
      //# Do a virtual navigate and load up the folder view
      App.navigate(model.get('url'));
      //# Get the collection
      const sortSettings = this.getSort();
      const collection = App.request("file:entities", {file: model.get('file'), media: model.get('media'), sort: sortSettings});
      const pathCollection = App.request("file:path:entities", model.get('file'), this.sourceCollection);
      this.getPathList(pathCollection);
      return App.execute("when:entity:fetched", collection, () => {
        //# parse and render
        const collections = App.request("file:parsed:entities", collection);
        this.getFolderList(collections.directory);
        return this.getFileList(collections.file);
      });
    }

    getFolderListView(collection) {
      const folderView = new List.FolderList({
        collection});
      this.listenTo(folderView, 'childview:folder:open', (set, item) => {
        return this.getFolder(item.model);
      });
      API.bindFolderTriggers(folderView);
      return folderView;
    }

    getFolderList(collection) {
      this.folderLayout.regionFolders.show(this.getFolderListView(collection));
      return this.getBackButton();
    }

    getFileListView(collection) {
      return API.getFileListView(collection);
    }

    getFileList(collection) {
      return this.folderLayout.regionFiles.show(this.getFileListView(collection));
    }

    getPathList(collection) {
      const pathView = new List.PathList({
        collection});
      this.folderLayout.regionPath.show(pathView);
      this.setBackModel(collection);
      return this.listenTo(pathView, 'childview:folder:open', (set, item) => {
        return this.getFolder(item.model);
      });
    }

    setBackModel(pathCollection) {
      // Back button should be the second last model
      if (pathCollection.length >= 2) {
        return this.backButtonModel = pathCollection.models[pathCollection.length - 2];
      } else {
        return this.backButtonModel = {};
      }
    }

    getBackButton() {
      if (this.backButtonModel.attributes) {
        const backView = new List.Back({
          model: this.backButtonModel});
        this.folderLayout.regionBack.show(backView);
        return this.listenTo(backView, 'folder:open', model => {
          return this.getFolder(model.model);
        });
      } else {
        return this.folderLayout.regionBack.empty();
      }
    }

    // Get view with a collection of files only
    getFileViewByPath(path, media, callback) {
      const collection = App.request("file:entities", {file: path, media});
      return App.execute("when:entity:fetched", collection, () => {
        const view = this.getFileListView(collection);
        if (callback) {
          return callback(view);
        }
      });
    }
  });
  Cls.initClass();


  // Get view with a collection of files only
  App.reqres.setHandler("browser:file:view", collection => API.getFileListView(collection));

  // Get view with a collection of files only
  return App.reqres.setHandler("browser:directory:view", collection => API.getFolderListView(collection));
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("BrowserApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "browser-page";
    }
  });
  Cls.initClass();


  /*
    Sources
  */

  Cls = (List.Source = class Source extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/browser/list/source';
      this.prototype.tagName = 'li';
      this.prototype.triggers =
        {'click .source' : 'source:open'};
    }
    attributes() {
      return {
        class: 'type-' + this.model.get('sourcetype')
      };
    }
  });
  Cls.initClass();

  //# Our composite view allows adding another view via the 'childViewContainer' el
  //# which is in the template
  Cls = (List.Sources = class Sources extends App.Views.CompositeView {
    static initClass() {
      this.prototype.template = 'apps/browser/list/source_set';
      this.prototype.childView = List.Source;
      this.prototype.tagName = "div";
      this.prototype.childViewContainer = 'ul.sources';
      this.prototype.className = "source-set";
    }
    initialize() {
      //# We need to tell the child view where to get its collection
      return this.collection = this.model.get('sources');
    }
  });
  Cls.initClass();

  Cls = (List.SourcesSet = class SourcesSet extends App.Views.CollectionView {
    static initClass() {
      this.prototype.childView = List.Sources;
      this.prototype.tagName = "div";
      this.prototype.className = "sources-sets";
    }
  });
  Cls.initClass();


  /*
    Folder
  */

  Cls = (List.FolderLayout = class FolderLayout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/browser/list/folder_layout';
      this.prototype.className = "folder-page-wrapper";
      this.prototype.regions = {
        regionPath: '.path',
        regionFolders: '.folders',
        regionFiles: '.files',
        regionBack: '.back'
      };
      this.prototype.triggers = {
        'click .play' : 'browser:play',
        'click .queue' : 'browser:queue'
      };
      this.prototype.events =
        {'click .sorts li' : 'sortList'};
    }
    sortList(e) {
      $('.sorts li', this.$el).removeClass('active');
      return this.trigger('browser:sort', $(e.target).data('sort'), $(e.target));
    }
    onRender() {
      $('.sorts li', this.$el).addClass('order-' + this.options.sortSettings.order);
      return $('.sorts li[data-sort=' + this.options.sortSettings.method + ']', this.$el).addClass('active');
    }
  });
  Cls.initClass();


  Cls = (List.Item = class Item extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/browser/list/file';
      this.prototype.tagName = 'li';
    }
    initialize() {
    // Parse title text
      return this.model.set({labelHtml: this.formatText(this.model.get('label'))});
    }

    onBeforeRender() {
      if (!this.model.get('labelHtml')) {
        return this.model.set({labelHtml: this.model.escape('label')});
      }
    }
  });
  Cls.initClass();

  Cls = (List.Folder = class Folder extends List.Item {
    static initClass() {
      this.prototype.className = 'folder';
      this.prototype.triggers = {
        'click .title' : 'folder:open',
        'dblclick .title' : 'file:play',
        'click .play' : 'folder:play',
        'click .queue' : 'folder:queue'
      };
      this.prototype.events =
        {"click .dropdown > i": "populateModelMenu"};
    }
    initialize() {
      const menu = {queue: tr('Queue in Kodi')};
      return this.model.set({menu});
    }
  });
  Cls.initClass();

  Cls = (List.EmptyFiles = class EmptyFiles extends App.Views.EmptyViewPage {
    static initClass() {
      this.prototype.tagName = 'li';
    }
    initialize() {
      return this.model.set({id: 'empty', content: t.gettext('no media in this folder')});
    }
  });
  Cls.initClass();

  Cls = (List.File = class File extends List.Item {
    static initClass() {
      this.prototype.className = 'file';
      this.prototype.triggers = {
        'click .play' : 'file:play',
        'dblclick .title' : 'file:play',
        'click .queue' : 'file:queue',
        'click .download' : 'file:download'
      };
      this.prototype.events =
        {"click .dropdown > i": "populateModelMenu"};
    }
    initialize() {
      const menu = {queue: tr('Queue in Kodi')};
      if ((this.model.get('filetype') === 'file') && (this.model.get('file').lastIndexOf('plugin://', 0) !== 0)) {
        menu.download = tr('Download');
      }
      return this.model.set({menu});
    }
  });
  Cls.initClass();


  Cls = (List.FolderList = class FolderList extends App.Views.CollectionView {
    static initClass() {
      this.prototype.tagName = 'ul';
      this.prototype.className = 'browser-folder-list';
      this.prototype.childView = List.Folder;
    }
  });
  Cls.initClass();

  Cls = (List.FileList = class FileList extends App.Views.CollectionView {
    static initClass() {
      this.prototype.tagName = 'ul';
      this.prototype.className = 'browser-file-list';
      this.prototype.childView = List.File;
      this.prototype.emptyView = List.EmptyFiles;
    }
  });
  Cls.initClass();

  /*
    Path
  */

  Cls = (List.Path = class Path extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/browser/list/path';
      this.prototype.tagName = 'li';
      this.prototype.triggers =
        {'click .title' : 'folder:open'};
    }
  });
  Cls.initClass();

  Cls = (List.PathList = class PathList extends App.Views.CollectionView {
    static initClass() {
      this.prototype.tagName = 'ul';
      this.prototype.childView = List.Path;
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.Back = class Back extends App.Views.ItemView {
      static initClass() {
        this.prototype.template = 'apps/browser/list/back_button';
        this.prototype.tagName = 'div';
        this.prototype.className = 'back-button';
        this.prototype.triggers = {
          'click .title' : 'folder:open',
          'click i' : 'folder:open'
        };
      }
    });
    Cls.initClass();
    return Cls;
  })();
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CastApp", function(CastApp, App, Backbone, Marionette, $, _) {


  const API = {

    getCastCollection(cast, origin) {
      return App.request("cast:entities", cast, origin);
    },

    getCastView(collection) {
      const view = new CastApp.List.CastList({
        collection});
      App.listenTo(view, 'childview:cast:google', (parent, child) => window.open('https://www.google.com/webhp?#q=' + encodeURIComponent(child.model.get('name'))));
      App.listenTo(view, 'childview:cast:imdb', (parent, child) => window.open('http://www.imdb.com/find?s=nm&q=' + encodeURIComponent(child.model.get('name'))));
      return view;
    }
  };


  return App.reqres.setHandler('cast:list:view', function(cast, origin) {
    const collection = API.getCastCollection(cast, origin);
    return API.getCastView(collection);
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CastApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.CastTeaser = class CastTeaser extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/cast/list/cast';
      this.prototype.tagName = "li";
      this.prototype.triggers = {
        "click .imdb"       : "cast:imdb",
        "click .google"    : "cast:google"
      };
    }
    onRender() {
      return _.defer(function() {
        // Prevent broken images
        const defaultThumb = App.request("images:path:get", '');
        return $('img', this.$el).on('error', function(e) {
          return $(this).attr('src', defaultThumb);
        });
      });
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.CastList = class CastList extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.CastTeaser;
        this.prototype.tagName = "ul";
        this.prototype.className = "cast-full";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CategoryApp", function(CategoryApp, App, Backbone, Marionette, $, _) {

  //# This is a generic app for category listings (eg Genres)

  const Cls = (CategoryApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes =
        {"music/genres"   : "musicGenres"};
    }
  });
  Cls.initClass();


  const API = {

    musicGenres() {
      return new CategoryApp.List.Controller({
        entityKey: 'genre:entities',
        media: 'audio',
        subNavParent: 'music'
      });
    }
  };



  return App.on("before:start", () => new CategoryApp.Router({
    controller: API}));
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CategoryApp.List", function(List, App, Backbone, Marionette, $, _) {


  //# Main controller
  return List.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {
      const collection = App.request(this.getOption('entityKey'), this.getOption('media'));
      return App.execute("when:entity:fetched", collection, () => {

        this.layout = this.getLayoutView(collection);
        this.listenTo(this.layout, "show", () => {
          this.renderList(collection);
          return this.getSubNav();
        });

        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new List.Layout({
        collection});
    }

    renderList(collection) {
      const view = new List.CategoryList({
        collection});
      return this.layout.regionContent.show(view);
    }

    getSubNav() {
      const subNav = App.request("navMain:children:show", this.getOption('subNavParent'), 'Sections');
      return this.layout.regionSidebarFirst.show(subNav);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CategoryApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "category-list";
    }
  });
  Cls.initClass();

  Cls = (List.Item = class Item extends App.Views.CardView {
    static initClass() {
      this.prototype.template = 'apps/category/list/item';
      this.prototype.tagName = "li";
      this.prototype.className = "card category";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.CategoryList = class CategoryList extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.Item;
        this.prototype.tagName = "ul";
        this.prototype.className = "card-grid--square";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp", function(CommandApp, App, Backbone, Marionette, $, _) {

  const API = {
    // Return current playlist controller.
    currentAudioPlaylistController() {
      const stateObj = App.request("state:current");
      return App.request("command:" + stateObj.getPlayer() + ":controller", 'audio', 'PlayList');
    },

    // Return current playlist controller.
    currentVideoPlayerController() {
      const stateObj = App.request("state:current");
      // Switch method depending on player
      const method =  stateObj.getPlayer() === 'local' ? 'VideoPlayer' : 'PlayList';
      return App.request("command:" + stateObj.getPlayer() + ":controller", 'video', method);
    }
  };

  /*
    Kodi.
  */

  //# Kodi: Execute a command
  App.reqres.setHandler("command:kodi:player", function(method, params, callback) {
    const commander = new CommandApp.Kodi.Player('auto');
    return commander.sendCommand(method, params, callback);
  });

  //# Kodi: Get a controller for a specific player type and media
  App.reqres.setHandler("command:kodi:controller", (media = 'auto', controller) => new (CommandApp.Kodi[controller])(media));

  /*
    Local.
  */

  //# Local: Execute a command
  App.reqres.setHandler("command:local:player", function(method, params, callback) {
    const commander = new CommandApp.Local.Player('audio');
    return commander.sendCommand(method, params, callback);
  });

  //# Local: Get a controller for a specific player type and media
  App.reqres.setHandler("command:local:controller", (media = 'auto', controller) => new (CommandApp.Local[controller])(media));

  /*
    Wrappers single command for playing in kodi and local.
  */

  //# Play Audio in kodi or local depending on active player.
  App.commands.setHandler("command:audio:play", (type, value) => API.currentAudioPlaylistController().play(type, value));

  //# Queue Audio in kodi or local depending on active player.
  App.commands.setHandler("command:audio:add", (type, value) => API.currentAudioPlaylistController().add(type, value));

  //# Play Video in kodi or local depending on active player.
  App.commands.setHandler("command:video:play", function(model, type, resume = 0, callback) {
    const value = model.get(type);
    return API.currentVideoPlayerController().play(type, value, model, resume, function(resp) {
      // Problem: Home OSD to display when you 'add to playlist and play' when it is not empty
      // This might cause other issues but tested ok for me, so hack implemented!
      // TODO: Investigate, feels like a Kodi bug, but maybe not also.
      const stateObj = App.request("state:current");
      if (stateObj.getPlayer() === 'kodi') {
        // If player is kodi, force full screen to full. This hides the home OSD.
        const kodiVideo = App.request("command:kodi:controller", 'video', 'GUI');
        return kodiVideo.setFullScreen(true, callback);
      }
    });
  });

  /*
    Commands that are generally used by settings pages.
  */

  //# Clean audio library.
  App.commands.setHandler("command:kodi:audio:clean", () => App.request("command:kodi:controller", 'auto', 'AudioLibrary').clean());

  //# Clean audio library.
  App.commands.setHandler("command:kodi:video:clean", () => App.request("command:kodi:controller", 'auto', 'VideoLibrary').clean());


  //# Startup tasks.
  return App.addInitializer(function() {});
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Api.Base = class Base extends Marionette.Object {
    static initClass() {

      this.prototype.ajaxOptions = {};
    }

    initialize(options = {}) {
      $.jsonrpc.defaultUrl = helpers.url.baseKodiUrl("Base");
      return this.setOptions(options);
    }

    setOptions(options) {
      return this.ajaxOptions = options;
    }

    multipleCommands(commands, callback, fail) {
      const obj = $.jsonrpc(commands, this.ajaxOptions);
      obj.fail(error => {
        this.doCallback(fail, error);
        return this.onError(commands, error);
      });
      obj.done(response => {
        response = this.parseResponse(commands, response);
        this.triggerMethod("response:ready", response);
        if (callback != null) {
          return this.doCallback(callback, response);
        }
      });
      return obj;
    }

    singleCommand(command, params, callback, fail) {
      command = {method: command, url: helpers.url.baseKodiUrl(command)};
      if ((params != null) && ((params.length > 0) || _.isObject(params))) {
        command.params = params;
      }
      const obj = this.multipleCommands([command], callback, fail);
      return obj;
    }

    parseResponse(commands, response) {
      let results = [];
      for (var i in response) {
        var result = response[i];
        if (result.result || (result.result === false)) {
          results.push(result.result);
        } else {
          this.onError(commands[i], result);
        }
      }
      if ((commands.length === 1) && (results.length === 1)) {
        results = results[0];
      }
      return results;
    }

    paramObj(key, val) {
      return helpers.global.paramObj(key, val);
    }

    doCallback(callback, response) {
      if (callback != null) {
        return callback(response);
      }
    }

    onError(commands, error) {
      return helpers.debug.rpcError(commands, error);
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", function(Api, App, Backbone, Marionette, $, _) {


  //# Base commander with shared functionality.
  let Cls = (Api.Commander = class Commander extends Api.Base {
    static initClass() {
  
      this.prototype.playerActive = 0; //# default to audio
      this.prototype.playerName = 'music';
      this.prototype.playerForced = false; //# If false will check active player before a command
  
      //# Applies to player and playlists.
      this.prototype.playerIds = {
        audio: 0,
        video: 1
      };
  
  
      //# Namespace should be added in each extending class
      this.prototype.commandNameSpace = 'JSONRPC';
    }

    setPlayer(player) {
      if ((player === 'audio') || (player === 'video')) {
        this.playerActive = this.playerIds[player];
        this.playerName = player;
        return this.playerForced = true;
      }
    }

    getPlayer() {
      return this.playerActive;
    }

    getPlayerName() {
      return this.playerName;
    }

    //# get the player name via the id (eg return audio, video)
    playerIdToName(playerId) {
      let playerName;
      playerName;
      for (var name in this.playerIds) {
        var id = this.playerIds[name];
        if (id === playerId) {
          playerName = name;
        }
      }
      return playerName;
    }

    //# Namespace can be overridden when called
    getCommand(command, namespace = this.commandNameSpace) {
      return namespace + '.' + command;
    }

    //# Send a command
    sendCommand(command, params, callback, fail) {
      return this.singleCommand(this.getCommand(command), params, (resp => {
        return this.doCallback(callback, resp);
      }
      ), err => {
        return this.doCallback(fail, err);
      });
    }
  });
  Cls.initClass();


  //# Player commander.
  return (function() {
    Cls = (Api.Player = class Player extends Api.Commander {
      static initClass() {
  
        this.prototype.commandNameSpace = 'Player';
        this.prototype.playlistApi = {};
      }

      initialize(media = 'audio') {
        this.setPlayer(media);
        return this.playlistApi = App.request("playlist:kodi:entity:api");
      }

      getParams(params = [], callback) {
        let defaultParams;
        if (this.playerForced) {
          defaultParams = [this.playerActive];
          return this.doCallback(callback, defaultParams.concat(params));
        } else {
          return this.getActivePlayers(activeId => {
            defaultParams = [activeId];
            return this.doCallback(callback, defaultParams.concat(params));
          });
        }
      }

      getActivePlayers(callback) {
        return this.singleCommand(this.getCommand("GetActivePlayers"), {}, resp => {
          if (resp.length > 0) {
            this.playerActive = resp[0].playerid;
            this.playerName = this.playerIdToName(this.playerActive);
            this.triggerMethod("player:ready", this.playerActive);
            return this.doCallback(callback, this.playerActive);
          } else {
            return this.doCallback(callback, this.playerActive);
          }
        });
      }

      sendCommand(command, params = [], callback, fail) {
        return this.getParams(params, playerParams => {
          return this.singleCommand(this.getCommand(command), playerParams, (resp => {
            return this.doCallback(callback, resp);
          }
          ), err => {
            return this.doCallback(fail, err);
          });
        });
      }

      playEntity(type, value, options = {}, callback) {
        const params = {'item': this.paramObj(type, value), 'options': options};
        if (type === 'position') {
          params.item.playlistid = this.getPlayer();
        }
        return this.singleCommand(this.getCommand('Open', 'Player'), params, resp => {
          if (!App.request('sockets:active')) {
            // App.request 'player:kodi:timer', 'start'
            App.request('state:kodi:update');
          }
          return this.doCallback(callback, resp);
        });
      }

      setPartyMode(op = 'toggle', callback) {
        return this.sendCommand('SetPartymode', [op], resp => {
          return this.doCallback(callback, resp);
        });
      }

      getPlaying(callback) {
        const obj = {active: false, properties: false, item: false};
        return this.singleCommand(this.getCommand('GetActivePlayers'), {}, resp => {
          if (resp.length > 0) {
            obj.active = resp[0]; //# Only use the first active player (cant think of 2 running at the same time?)
            const commands = [];
            const itemFields = helpers.entities.getFields(this.playlistApi.fields, 'full');
            const playerFields = ["playlistid", "speed", "position", "totaltime", "time", "percentage", "shuffled", "repeat", "canrepeat", "canshuffle", "canseek", "partymode"];
            commands.push({method: this.getCommand('GetProperties'), params: [obj.active.playerid, playerFields]});
            commands.push({method: this.getCommand('GetItem'), params: [obj.active.playerid, itemFields]});
            return this.multipleCommands(commands, playing => {
              obj.properties = playing[0];
              obj.item = playing[1].item;
              return this.doCallback(callback, obj);
            });
          } else {
            return this.doCallback(callback, false);
          }
        });
      }
    });
    Cls.initClass();
    return Cls;
  })();
}); //# nothing playing
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Application commander.
(function() {
  const Cls = (Api.AddOn = class AddOn extends Api.Commander {
    constructor(...args) {
      super(...args);
      this.getEnabledAddons = this.getEnabledAddons.bind(this);
      this.getAllAddons = this.getAllAddons.bind(this);
    }

    static initClass() {

      this.prototype.commandNameSpace = 'Addons';

      this.prototype.addonAllFields = [
        "name",
        "version",
        "summary",
        "description",
        "path",
        "author",
        "thumbnail",
        "disclaimer",
        "fanart",
        "dependencies",
        "broken",
        "extrainfo",
        "rating",
        "enabled"
      ];
    }

    // Get an array of addons from the api
    getAddons(type = "unknown", enabled = true, fields = [], callback) {
      return this.singleCommand(this.getCommand('GetAddons'), [type, "unknown", enabled, fields], resp => {
        return this.doCallback(callback, resp.addons);
      });
    }

    // If load set then get all the addon fields else get basics
    getEnabledAddons(load = true, callback) {
      const fields = load ? this.addonAllFields : ["name"];
      return this.getAddons("unknown", true, fields, resp => {
        return this.doCallback(callback, resp);
      });
    }

    // If load set then get all the addon fields else get basics
    getAllAddons(callback) {
      return this.getAddons("unknown", "all", this.addonAllFields, resp => {
        return this.doCallback(callback, resp);
      });
    }

    // Execute an addon
    executeAddon(addonId, params = {}, callback) {
      const opts = {addonid: addonId};
      if (!_.isEmpty(params)) {
        opts.params = params;
      }
      return this.singleCommand(this.getCommand('ExecuteAddon'), opts, resp => {
        return this.doCallback(callback, resp.addons);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Application commander.
(function() {
  const Cls = (Api.Application = class Application extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'Application';
    }

    getProperties(callback) {
      return this.singleCommand(this.getCommand('GetProperties'), [["volume", "muted", "version"]], resp => {
        return this.doCallback(callback, resp);
      });
    }

    setVolume(volume, callback) {
      return this.singleCommand(this.getCommand('SetVolume'), [volume], resp => {
        return this.doCallback(callback, resp);
      });
    }

    toggleMute(callback) {
      const stateObj = App.request("state:kodi");
      return this.singleCommand(this.getCommand('SetMute'), [!stateObj.getState('muted')], resp => {
        return this.doCallback(callback, resp);
      });
    }

    quit(callback) {
      return this.singleCommand(this.getCommand('Quit'), [], resp => {
        return this.doCallback(callback, resp);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Audio Library
(function() {
  const Cls = (Api.AudioLibrary = class AudioLibrary extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'AudioLibrary';
    }

    //# Set a album value
    setAlbumDetails(id, fields = {}, callback) {
      let params = {albumid: id};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('SetAlbumDetails'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Set a artist value
    setArtistDetails(id, fields = {}, callback) {
      let params = {artistid: id};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('SetArtistDetails'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Set a song value
    setSongDetails(id, fields = {}, callback) {
      let params = {songid: id};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('SetSongDetails'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Scan library
    scan(callback) {
      return this.singleCommand(this.getCommand('Scan'), resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Clean library
    clean(callback) {
      return this.singleCommand(this.getCommand('Clean'), {showdialogs: false}, resp => {
        return this.doCallback(callback, resp);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Input commander
(function() {
  const Cls = (Api.Files = class Files extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'Files';
    }

    //# Prepare a file for download
    prepareDownload(file, callback) {
      return this.singleCommand(this.getCommand('PrepareDownload'), [file], resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Returns a download path for a file
    downloadPath(file, callback) {
      return this.prepareDownload(file, resp => {
        return this.doCallback(callback, resp.details.path);
      });
    }

    //# Callback for a download button, will initiate a download
    downloadFile(file) {
      const dl = window.open('about:blank', 'download');
      return this.downloadPath(file, path => dl.location = path);
    }

    //# Callback for video stream popup
    videoStream(file, background = '', player = 'html5') {
      const st = helpers.global.localVideoPopup('about:blank');
      return this.downloadPath(file, path => st.location = "videoPlayer.html?player=" + player + '&src=' + encodeURIComponent(path) + '&bg=' + encodeURIComponent(background));
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# GUI
(function() {
  const Cls = (Api.GUI = class GUI extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'GUI';
    }

    setFullScreen(fullscreen = true, callback) {
      return this.sendCommand("SetFullscreen", [fullscreen], resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# See http://kodi.wiki/view/JSON-RPC_API/v6#GUI.Window for types
    activateWindow(window, params = [], callback) {
      return this.sendCommand("ActivateWindow", [window, params], resp => {
        return this.doCallback(callback, resp);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Input commander
(function() {
  const Cls = (Api.Input = class Input extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'Input';
    }

    //# Send a text string
    sendText(text, callback) {
      return this.singleCommand(this.getCommand('SendText'), [text], resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Set a single input
    sendInput(type, params = [], callback) {
      return this.singleCommand(this.getCommand(type), params, resp => {
        this.doCallback(callback, resp);
        if (!App.request('sockets:active')) {
          return App.request('state:kodi:update', callback);
        }
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Playlist requires some player functionality but is also its
//# own thing so it extends the player.
(function() {
  const Cls = (Api.PlayList = class PlayList extends Api.Player {
    static initClass() {

      this.prototype.commandNameSpace = 'Playlist';
    }

    //# Play an item. Rules:
    //# - If in the playlist already, play that item
    //# - If currently playing, insert it next and play
    //# - If not playing clear playlist, add and play
    //# - If resume > 0 will resume from that point
    play(type, value, model, resume = 0, callback) {
      // Get items in the playlist
      return this.getItems(currentPlaylist => {
        // If item is already in th playlist, play that
        const plItem = {type: type.replace('id', ''), id: value};
        const inPlaylist = currentPlaylist.items ? _.findWhere(currentPlaylist.items, plItem) : false;
        if (inPlaylist) {
          return this.playPosition(inPlaylist.position, resume, callback);
        } else {
          // Item needs to be added to playlist
          const stateObj = App.request("state:kodi");
          //# If playing, queue up next.
          if (stateObj.isPlaying(this.getPlayerName())) {
            const pos = currentPlaylist.items ? (stateObj.getPlaying('position') + 1) : 0;
            return this.insertAndPlay(type, value, pos, resume, callback);
          } else {
            return this.clear(() => {
              return this.insertAndPlay(type, value, 0, resume, callback);
            });
          }
        }
      });
    }

    //# Add a collection of models wrapper, will clear if not playing
    addCollection(collection, position = 0, callback) {
      const stateObj = App.request("state:kodi");
      //# If playing, queue up next.
      if (stateObj.isPlaying(this.getPlayerName())) {
        position = (stateObj.getPlaying('position') + 1);
        this.addCollectionItems(collection, position, callback);
      } else {
        this.clear(() => {
          return this.addCollectionItems(collection, position, callback);
        });
      }
      return position;
    }

    //# Add a collection of models
    addCollectionItems(collection, position = 0, callback) {
      App.execute("notification:show", t.gettext("Adding items to the queue"));
      const models = collection.getRawCollection();
      const player = this.getPlayer();
      const commands = [];
      //# build a set of commands so we can add all the models with one request.
      for (var i in models) {
        var model = models[i];
        var pos = parseInt(position) + parseInt(i);
        var type = model.type === 'file' ? 'file' : model.type + 'id';
        var params = [player, pos, this.paramObj(type, model[type])];
        commands.push({method: this.getCommand('Insert'), params});
      }
      return this.multipleCommands(commands, resp => {
        this.doCallback(callback, resp);
        return this.refreshPlaylistView();
      });
    }

    // Add a collection of models.
    playCollection(collection, position = 0) {
      let pos;
      return pos = this.addCollection(collection, position, resp => {
        this.playEntity('position', parseInt(pos), {}, () => {});
        return this.refreshPlaylistView();
      });
    }

    //# Add a item to the end of the playlist
    add(type, value) {
      return this.playlistSize(size => {
        return this.insert(type, value, size);
      });
    }

    //# Remove an item from the list
    remove(position, callback) {
      return this.singleCommand(this.getCommand('Remove'), [this.getPlayer(), parseInt(position)], resp => {
        this.refreshPlaylistView();
        return this.doCallback(callback, resp);
      });
    }

    //# Clear a playlist.
    clear(callback) {
      return this.singleCommand(this.getCommand('Clear'), [this.getPlayer()], resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Insert a song at a position
    insert(type, value, position = 0, callback) {
      return this.singleCommand(this.getCommand('Insert'), [this.getPlayer(), parseInt(position), this.paramObj(type,value)], resp => {
        this.refreshPlaylistView();
        return this.doCallback(callback, resp);
      });
    }

    //# Get items in a playlist
    getItems(callback) {
      return this.singleCommand(this.getCommand('GetItems'), [this.getPlayer(), ['title']], resp => {
        return this.doCallback(callback, this.parseItems(resp));
      });
    }

    //# Add position to each item in the playlist
    parseItems(resp) {
      if (resp.items) {
        resp.items = _.map(resp.items, function(item, idx) {
          item.position = parseInt(idx);
          return item;
        });
      }
      return resp;
    }

    //# Insert a song at a position and play it
    insertAndPlay(type, value, position = 0, resume = 0, callback) {
      return this.insert(type, value, position, resp => {
        return this.playPosition(position, resume, callback);
      });
    }

    //# Play a position in the playlist with optional resume
    playPosition(position = 0, resume = 0, callback) {
      return this.playEntity('position', parseInt(position), {}, () => {
        if (resume > 0) {
          // Seek to resume point if not 0. Setting option {resume: true} does not work :(
          App.execute("player:kodi:progress:update", resume);
        }
        return this.doCallback(callback);
      });
    }

    //# Get the size of the current playlist
    playlistSize(callback) {
      return this.getItems(resp => {
        const position = (resp.items != null) ?  resp.items.length : 0;
        return this.doCallback(callback, position);
      });
    }

    //# Refresh playlist
    refreshPlaylistView() {
      const wsActive = App.request("sockets:active");
      if (!wsActive) {
        return App.execute("playlist:refresh", 'kodi', this.playerName);
      }
    }

    //# Move Item
    moveItem(media, id, position1, position2, callback) {
      const idProp = media === 'file' ? 'file' : media + 'id';
      return this.singleCommand(this.getCommand('Remove'), [this.getPlayer(), parseInt(position1)], resp => {
        return this.insert(idProp, id, position2, () => {
          return this.doCallback(callback, position2);
        });
      });
    }
  });
  Cls.initClass();
  return Cls;
})());

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# PVR
(function() {
  const Cls = (Api.PVR = class PVR extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'PVR';
    }

    //# Start recording a channel
    setRecord(id, fields = {}, callback) {
      let params = {channel: id, record: 'toggle'};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('Record'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Toggle timer on a broadcast
    toggleTimer(id, timerRule = false, callback) {
      const params = {broadcastid: id, timerrule: timerRule};
      return this.singleCommand(this.getCommand('ToggleTimer'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Add timer on a broadcast
    addTimer(id, timerRule = false, callback) {
      const params = {broadcastid: id, timerrule: timerRule};
      return this.singleCommand(this.getCommand('AddTimer'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Remove a timer id
    deleteTimer(id, callback) {
      const params = {timerid: id};
      return this.singleCommand(this.getCommand('DeleteTimer'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# GUI
(function() {
  const Cls = (Api.Settings = class Settings extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'Settings';
    }

    getSettingValue(value, callback) {
      return this.sendCommand("getSettingValue", [value], resp => {
        return this.doCallback(callback, resp.value);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Application commander.
(function() {
  const Cls = (Api.System = class System extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'System';
    }

    getProperties(callback) {
      const properties = ["canshutdown", "cansuspend", "canhibernate", "canreboot"];
      return this.singleCommand(this.getCommand('GetProperties'), [properties], resp => {
        return this.doCallback(callback, resp);
      });
    }

    hibernate(callback) {
      return this.singleCommand(this.getCommand('Hibernate'), [], resp => {
        return this.doCallback(callback, resp);
      });
    }

    reboot(callback) {
      return this.singleCommand(this.getCommand('Reboot'), [], resp => {
        return this.doCallback(callback, resp);
      });
    }

    shutdown(callback) {
      return this.singleCommand(this.getCommand('Shutdown'), [], resp => {
        return this.doCallback(callback, resp);
      });
    }

    suspend(callback) {
      return this.singleCommand(this.getCommand('Suspend'), [], resp => {
        return this.doCallback(callback, resp);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Kodi", (Api, App, Backbone, Marionette, $, _) => //# Video Library
(function() {
  const Cls = (Api.VideoLibrary = class VideoLibrary extends Api.Commander {
    static initClass() {

      this.prototype.commandNameSpace = 'VideoLibrary';
    }

    //# Set a episode value
    setEpisodeDetails(id, fields = {}, callback) {
      let params = {episodeid: id};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('SetEpisodeDetails'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Set a movie value
    setMovieDetails(id, fields = {}, callback) {
      let params = {movieid: id};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('SetMovieDetails'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Set a tvshow value
    setTVShowDetails(id, fields = {}, callback) {
      let params = {tvshowid: id};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('SetTVShowDetails'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Set a music video value
    setMusicVideoDetails(id, fields = {}, callback) {
      let params = {musicvideoid: id};
      params = _.extend(params, fields);
      return this.singleCommand(this.getCommand('SetMusicVideoDetails'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Scan library
    scan(callback) {
      return this.singleCommand(this.getCommand('Scan'), resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Clean library
    clean(callback) {
      return this.singleCommand(this.getCommand('Clean'), {showdialogs: false}, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Toggle watched on a collection. op is 'watched' or 'unwatched'
    toggleWatchedCollection(collection, op, callback) {
      for (var i in collection.models) {
        var model = collection.models[i];
        this.toggleWatched(model, op);
      }
      return this.doCallback(callback, true);
    }

    //# Toggle watched status. op is 'watched' or 'unwatched'
    toggleWatched(model, op = 'auto', callback) {
      let setPlaycount;
      if (op === 'auto') {
        setPlaycount = model.get('playcount') > 0 ? 0 : 1;
      } else if (op === 'watched') {
        setPlaycount = 1;
      } else if (op === 'unwatched') {
        setPlaycount = 0;
      }
      const fields = helpers.global.paramObj('playcount', setPlaycount);
      if (model.get('type') === 'movie') {
        this.setMovieDetails(model.get('id'), fields, () => {
          App.vent.trigger('entity:kodi:update', model.get('uid'));
          return this.doCallback(callback, setPlaycount);
        });
      }
      if (model.get('type') === 'episode') {
        return this.setEpisodeDetails(model.get('id'), fields, () => {
          App.vent.trigger('entity:kodi:update', model.get('uid'));
          return this.doCallback(callback, setPlaycount);
        });
      }
    }

    //# Refresh a movie
    refreshMovie(id, params, callback) {
      params = _.extend({movieid: id, ignorenfo: false}, params);
      return this.singleCommand(this.getCommand('RefreshMovie'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Refresh a tvshow
    refreshTVShow(id, params, callback) {
      params = _.extend({tvshowid: id, ignorenfo: false}, params);
      return this.singleCommand(this.getCommand('RefreshTVShow'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }

    //# Refresh an episode
    refreshEpisode(id, params, callback) {
      params = _.extend({episodeid: id, ignorenfo: false}, params);
      return this.singleCommand(this.getCommand('RefreshEpisode'), params, resp => {
        return this.doCallback(callback, resp);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Local", function(Api, App, Backbone, Marionette, $, _) {

  return Api.Base = class Base extends Marionette.Object {

    localLoad(model, callback) {

      //# Local state obj
      const stateObj = App.request("state:local");

      //# If no valid model passed tell the UI we have stopped
      if ((model == null)) {
        stateObj.setPlaying('playing', false);
        this.localStateUpdate();
        return;
      }

      //# Unique browser playback id
      stateObj.setState('currentPlaybackId', 'browser-' + model.get('id'));

      //# Get the download path for the file.
      const files = App.request("command:kodi:controller", 'video', 'Files');
      return files.downloadPath(model.get('file'), path => {

        //# Clone soundmanager
        const sm = soundManager;

        //# Stop anything currently playing
        this.localStop();

        //# Create a sm object and load it into the state
        stateObj.setState('localPlay', sm.createSound({
          id: stateObj.getState('currentPlaybackId'),
          url: path,
          autoplay: false,
          autoLoad: true,
          stream: true,
          volume: stateObj.getState('volume'),
          onerror() {
            return console.log('SM ERROR!');
          },
          onplay: () => {
            stateObj.setPlayer('local');
            stateObj.setPlaying('playing', true);
            stateObj.setPlaying('paused', false);
            stateObj.setPlaying('playState', 'playing');
            stateObj.setPlaying('position', model.get('position'));
            stateObj.setPlaying('itemChanged', true);
            stateObj.setPlaying('item', model.attributes);
            stateObj.setPlaying('totaltime', helpers.global.secToTime( model.get('duration') ));
            //# Set volume
            //# Trigger listeners
            return this.localStateUpdate();
          },
          onstop: () => {
            stateObj.setPlaying('playing', false);
            //# trigger listeners (remove classes, etc)
            return this.localStateUpdate();
          },
          onpause: () => {
            stateObj.setPlaying('paused', true);
            stateObj.setPlaying('playState', 'paused');
            //# trigger listeners
            return this.localStateUpdate();
          },
          onresume: () => {
            stateObj.setPlaying('paused', false);
            stateObj.setPlaying('playState', 'playing');
            //# trigger listeners
            return this.localStateUpdate();
          },
          onfinish: () => {
            return this.localFinished();
          },
          whileplaying() {
            const pos = parseInt(this.position) / 1000;
            const dur = parseInt( model.get('duration') ); //# @duration is also available (represents loaded not total)
            const percentage = Math.round((pos / dur) * 100);
            stateObj.setPlaying('time', helpers.global.secToTime(pos));
            stateObj.setPlaying('percentage', percentage);
            return App.execute('player:local:progress:update', percentage, helpers.global.secToTime(pos));
          }
        })
        );

        //# stuff after load
        return this.doCallback(callback);
      });
    }


    //# What to do when finished.
    localFinished() {
      return this.localGoTo('next');
    }

    //# Wrapper for playing current item.
    localPlay() {
      return this.localCommand('play');
    }

    //# Wrapper for stopping current item.
    localStop() {
      return this.localCommand('stop');
    }

    //# Wrapper for pausing current item.
    localPause() {
      return this.localCommand('pause');
    }

    localPlayPause() {
      const stateObj = App.request("state:local");
      if (stateObj.getPlaying('paused')) {
        return this.localCommand('play');
      } else {
        return this.localCommand('pause');
      }
    }

    //# Set volume
    localSetVolume(volume) {
      return this.localCommand('setVolume', volume);
    }

    //# Wrapper for calling a command on the current soundmanager sound.
    localCommand(command, param) {
      const stateObj = App.request("state:local");
      const currentItem = stateObj.getState('localPlay');
      if (currentItem !== false) {
        currentItem[command](param);
      }
      return this.localStateUpdate();
    }

    //# Go to next/prev item adhering to repeat and shuffle
    localGoTo(param) {
      //# Get current playlist and state
      const collection = App.request("localplayer:get:entities");
      const stateObj = App.request("state:local");
      const currentPos = stateObj.getPlaying('position');
      let posToPlay = false;
      //# Need songs to continue.
      if (collection.length > 0) {
        //# Repeat this item
        if (stateObj.getState('repeat') === 'one') {
          posToPlay = currentPos;
        } else if (stateObj.getState('shuffled') === true) {
          //# Shuffle
          //# TODO: store what positions have been played so we dont repeat
          posToPlay = helpers.global.getRandomInt(0, collection.length - 1);
        } else {
          //# Next action
          if (param === 'next') {
            //# repeat all, back to the start
            if ((currentPos === (collection.length - 1)) && (stateObj.getState('repeat') === 'all')) {
              posToPlay = 0;
            } else if (currentPos < collection.length) {
              //# Standard next
              posToPlay = currentPos + 1;
            }
            this.localStateNext();
          }
          //# Prev action
          if (param === 'previous') {
            //# repeat all, go to the end
            if ((currentPos === 0) && (stateObj.getState('repeat') === 'all')) {
              posToPlay = collection.length - 1;
            } else if (currentPos > 0) {
              //# Standard prev
              posToPlay = currentPos - 1;
            }
          }
        }
      }
      //# Check we have a position to play, if so, play it.
      if (posToPlay !== false) {
        const model = collection.findWhere({position: parseInt(posToPlay)});
        return this.localLoad(model, () => {
          this.localPlay();
          return this.localStateUpdate();
        });
      }
    }

    //# Seek to a percentage in the song
    localSeek(param) {
      const stateObj = App.request("state:local");
      const localPlay = stateObj.getState('localPlay');
      if (localPlay !== false) {
        const newPos = (param.percentage / 100) * localPlay.duration;
        const sound = soundManager.getSoundById(stateObj.getState('currentPlaybackId'));
        return sound.setPosition(newPos);
      }
    }

    //# Set repeat state (cycle is available).
    localRepeat(param) {
      const stateObj = App.request("state:local");
      if (param !== 'cycle') {
        return stateObj.setState('repeat', param);
      } else {
        let newState = false;
        const states = ['off', 'all', 'one'];
        for (var i in states) {
          var state = states[i];
          i = parseInt(i);
          if (newState !== false) {
            continue;
          }
          if (stateObj.getState('repeat') === state) {
            if (i !== (states.length - 1)) {
              var key = i + 1;
              newState = states[key];
            } else {
              newState = 'off';
            }
          }
        }
        return stateObj.setState('repeat', newState);
      }
    }

    //# Toggle shuffle
    localShuffle() {
      const stateObj = App.request("state:local");
      const currentShuffle = stateObj.getState('shuffled');
      return stateObj.setState('shuffled', !currentShuffle);
    }

    //# Triggers when something changes in the player.
    localStateUpdate() {
      return App.vent.trigger("state:local:changed");
    }

    //# Trigger when we have moved to the next song
    localStateNext() {
      return App.vent.trigger("state:local:next");
    }

    paramObj(key, val) {
      return helpers.global.paramObj(key, val);
    }

    doCallback(callback, response) {
      if (typeof callback === 'function') {
        return callback(response);
      }
    }

    onError(commands, error) {
      return helpers.debug.rpcError(commands, error);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Local", function(Api, App, Backbone, Marionette, $, _) {


  //# Base commander with shared functionality.
  Api.Commander = class Commander extends Api.Base {};
    //# See Api.Base for soundmanager abstraction

  //# Player commander.
  return Api.Player = class Player extends Api.Commander {

    playEntity(type = 'position', position, callback) {
      const collection = App.request("localplayer:get:entities");
      const model = collection.findWhere({position});
      return this.localLoad(model, () => {
        this.localPlay();
        //# Start playback of playlist position x
        return this.doCallback(callback, position);
      });
    }

    //# Mimics Kodi Player Commands.
    sendCommand(command, param) {
      switch (command) {
        case 'GoTo':
          this.localGoTo(param);
          break;
        case 'PlayPause':
          this.localPlayPause();
          break;
        case 'Seek':
          this.localSeek(param);
          break;
        case 'SetRepeat':
          //# param can be 'cycle', 'off', 'all' or 'one'
          this.localRepeat(param);
          break;
        case 'SetShuffle':
          //# Toggles shuffle
          this.localShuffle();
          break;
        case 'Stop':
          this.localStop();
          break;
        default:
      }
          //# nothing
      return this.localStateUpdate();
    }

    //# Start, stop, toggle local party mode
    setPartyMode(op = 'toggle', callback) {
      return App.execute('playlist:local:partymode', op, resp => {
        return this.doCallback(callback, resp);
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Local", function(Api, App, Backbone, Marionette, $, _) {

  //# Application commander.
  return Api.Application = class Application extends Api.Commander {

    getProperties(callback) {
      const stateObj = App.request("state:local");
      const resp = {
        volume: stateObj.getState('volume'),
        muted: stateObj.getState('muted')
      };
      return this.doCallback(callback, resp);
    }

    setVolume(volume, callback) {
      const stateObj = App.request("state:local");
      stateObj.setState('volume', volume);
      this.localSetVolume(volume);
      return this.doCallback(callback, volume);
    }

    toggleMute(callback) {
      const stateObj = App.request("state:local");
      let volume = 0;
      if (stateObj.getState('muted')) {
        //# unmute (last vol)
        volume = stateObj.getState('lastVolume');
        stateObj.setState('muted', false);
      } else {
        //# set mute
        stateObj.setState('lastVolume', stateObj.getState('volume'));
        stateObj.setState('muted', true);
        volume = 0;
      }
      this.localSetVolume(volume);
      return this.doCallback(callback, volume);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Local", function(Api, App, Backbone, Marionette, $, _) {


  //# Playlist requires some player functionality but is also its
  //# own thing so it extends the player.
  return Api.PlayList = class PlayList extends Api.Player {

    //# Play an item.
    play(type, value, resume = 0) {
      return this.getSongs(type, value, songs => {
        return this.playCollection(songs);
      });
    }

    //# Queue an item.
    add(type, value) {
      return this.getSongs(type, value, songs => {
        return this.addCollection(songs);
      });
    }

    //# Play a collection of song models.
    playCollection(models) {
      models = this.itemsJson(models);
      //# TODO: Add logic for if something is already playing (like kodi controller)
      return this.clear(() => {
        return this.insertAndPlay(models, 0);
      });
    }

    //# Add a item to the end of the playlist
    addCollection(models) {
      models = this.itemsJson(models);
      return this.playlistSize(size => {
        return this.insert(models, size);
      });
    }

    //# Remove an item from the list
    remove(position, callback) {
      return this.getItems(collection => {
        const raw = this.itemsJson(collection);
        const ret = [];
        for (var pos in raw) {
          var item = raw[pos];
          if (parseInt(pos) !== parseInt(position)) {
            ret.push(item);
          }
        }
        return this.clear(() => {
          collection = this.addItems(ret);
          return this.doCallback(callback, collection);
        });
      });
    }

    //# Clear a playlist.
    clear(callback) {
      const collection = App.execute("localplayer:clear:entities");
      this.refreshPlaylistView();
      return this.doCallback(callback, collection);
    }

    //# Insert a song at a position models can be a sing model or an array. Expects raw json (not collection)
    insert(models, position = 0, callback) {
      return this.getItems(collection => {
        let model, ret;
        const raw = this.itemsJson(collection);
        if (raw.length === 0) {
          //# Empty list
          ret = _.flatten( [models] );
        } else if (parseInt(position) >= raw.length) {
          //# Adding to the end of a list
          ret = raw;
          for (model of _.flatten( [models] )) {
            ret.push(model);
          }
        } else {
          //# Insert in the middle of a list
          ret = [];
          for (var pos in raw) {
            var item = raw[pos];
            if (parseInt(pos) === parseInt(position)) {
              for (model of _.flatten( [models] )) {
                ret.push(model);
              }
            }
            ret.push(item);
          }
        }
        return this.clear(() => {
          collection = this.addItems(ret);
          return this.doCallback(callback, collection);
        });
      });
    }

    //# Add items to the end of a list
    addItems(items) {
      App.request("localplayer:item:add:entities", items);
      this.updatePlayingPosition(items);
      this.refreshPlaylistView();
      return items;
    }

    //# Get the songs in a collection based on type type/value.
    getSongs(type, value, callback) {
      //# If a single song.
      if (type === 'songid') {
        return App.request("song:byid:entities", [value], songs => {
          return this.doCallback(callback, songs.getRawCollection());
        });
      } else {
        //# Else it's a filtered collection (artist, album, etc)
        const songs = App.request("song:entities", {filter: helpers.global.paramObj(type, value)});
        return App.execute("when:entity:fetched", songs, () => {
          return this.doCallback(callback, songs.getRawCollection());
        });
      }
    }

    //# Get items in a playlist
    getItems(callback) {
      const collection = App.request("localplayer:get:entities");
      return this.doCallback(callback, collection);
    }

    //# If collection, normalise to JSON, if JSON pass through.
    itemsJson(collection) {
      const items = _.isArray(collection) ? collection : collection.toJSON();
      return items;
    }

    //# Insert a song at a position and play it
    insertAndPlay(models, position = 0, callback) {
      return this.insert(models, position, resp => {
        return this.playEntity('position', parseInt(position), {}, () => {
          return this.doCallback(callback, position);
        });
      });
    }

    //# Get the size of the current playlist
    playlistSize(callback) {
      return this.getItems(resp => {
        return this.doCallback(callback, resp.length);
      });
    }

    //# Refresh playlist
    refreshPlaylistView() {
      return App.execute("playlist:refresh", 'local', 'audio');
    }

    //# Move Item
    moveItem(media, id, position1, position2, callback) {
      return this.getItems(collection => {
        const raw = collection.getRawCollection();
        const item = raw[position1];
        return this.remove(position1, () => {
          return this.insert(item, position2, () => {
            return this.doCallback(callback, position2);
          });
        });
      });
    }

    //# After items in playlist have changed, this updates the playing position
    //# TODO: Make this less buggy, does weird things when tracks changed in party mode
    updatePlayingPosition(collection) {
      const stateObj = App.request("state:local");
      if (stateObj.isPlaying()) {
        const model = stateObj.getPlaying('item');
        if (model.uid) {
          let set = false;
          let pos = 0;
          const object = this.itemsJson(collection);
          for (var i in object) {
            var m = object[i];
            if (set === true) {
              continue;
            }
            if (m.uid === model.uid) {
              pos = parseInt(i);
              set = true;
            }
          }
          model.position = pos;
          stateObj.setPlaying('item', model);
          return stateObj.setPlaying('position', pos);
        }
      }
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("CommandApp.Local", function(Api, App, Backbone, Marionette, $, _) {

  return Api.VideoPlayer = class VideoPlayer extends Api.Player {

    // files controller
    getKodiFilesController() {
      return new App.CommandApp.Kodi.Files;
    }

    // Play wrapper to match kodi controller
    play(type, value, model) {
      return this.videoStream(model.get('file'), model.get('fanart'));
    }

    // Callback for video stream popup
    videoStream(file, background = '', player = 'html5') {
      const st = helpers.global.localVideoPopup('about:blank');
      return this.getKodiFilesController().downloadPath(file, path => st.location = "videoPlayer.html?player=" + player + '&src=' + encodeURIComponent(path) + '&bg=' + encodeURIComponent(background));
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("EPGApp", function(EPGApp, App, Backbone, Marionette, $, _) {

  const Cls = (EPGApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "pvr/tv/:channelid"       : "tv",
        "pvr/radio/:channelid"    : "radio"
      };
    }
  });
  Cls.initClass();

  const API = {

    tv(channelid) {
      return new EPGApp.List.Controller({
        channelid,
        type: "tv"
      });
    },

    radio(channelid) {
      return new EPGApp.List.Controller({
        channelid,
        type: "radio"
      });
    },

    action(op, view) {
      const {
        model
      } = view;
      const player = App.request("command:kodi:controller", 'auto', 'Player');
      const pvr = App.request("command:kodi:controller", 'auto', 'PVR');
      switch (op) {
        case 'play':
          return player.playEntity('channelid', model.get('channelid'));
        case 'record':
          return pvr.setRecord(model.get('channelid'), {}, () => App.execute("notification:show", tr("Channel recording toggled")));
        case 'timer':
          return pvr.toggleTimer(model.get('id'));
        default:
      }
    }
  };
          // nothing

  //# This is shared with a channel action (sidebar)
  App.commands.setHandler('broadcast:action', (op, view) => API.action(op, view));

  return App.on("before:start", () => new EPGApp.Router({
    controller: API}));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("EPGApp.List", function(List, App, Backbone, Marionette, $, _) {

  const API = {

    bindTriggers(view) {
      App.listenTo(view, 'childview:broadcast:play', (parent, child) => App.execute('broadcast:action', 'play', child));
      App.listenTo(view, 'childview:broadcast:record', (parent, child) => App.execute('broadcast:action', 'record', child));
      return App.listenTo(view, 'childview:broadcast:timer', (parent, child) => App.execute('broadcast:action', 'timer', child));
    },

    bindChannelTriggers(view) {
      App.listenTo(view, 'broadcast:play', child => App.execute('broadcast:action', 'play', child));
      App.listenTo(view, 'broadcast:record', child => App.execute('broadcast:action', 'record', child));
      return App.listenTo(view, 'broadcast:timer', child => App.execute('broadcast:action', 'timer', child));
    }
  };

  //# Main controller
  return List.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {
      const model = App.request('channel:entity', options.channelid);
      return App.execute("when:entity:fetched", model, () => {
        const collection = App.request("broadcast:entities", options.channelid);

        //# When fetched.
        return App.execute("when:entity:fetched", collection, () => {

          //# Get and setup the layout
          this.layout = this.getLayoutView(collection);
          this.listenTo(this.layout, "show", () => {
            this.getSubNav(model);
            this.getChannelActions(model);
            return this.renderProgrammes(collection);
          });

          //# Render the layout
          return App.regionContent.show(this.layout);
        });
      });
    }

    getLayoutView(collection) {
      return new List.Layout({
        collection});
    }

    renderProgrammes(collection) {
      const view = new List.EPGList({
        collection});
      API.bindTriggers(view);
      return this.layout.regionContent.show(view);
    }

    getSubNav(model) {
      const subNav = App.request("navMain:children:show", 'pvr/tv', 'PVR');
      return this.layout.regionSidebarFirst.show(subNav);
    }

    getChannelActions(model) {
      const view = new List.ChannelActions({
        model});
      API.bindChannelTriggers(view);
      return this.layout.appendSidebarView('channel-actions', view);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("EPGApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "epg-page";
    }
  });
  Cls.initClass();

  Cls = (List.ChannelActions = class ChannelActions extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/epg/list/channel';
      this.prototype.className = 'nav-sub';
      this.prototype.triggers =
        {'click .play'         : 'broadcast:play'};
      this.prototype.events =
        {'click .record'       : 'toggleRecord'};
    }
    toggleRecord() {
      console.log($('.airing'));
      $('.airing').toggleClass('has-timer');
      return this.trigger('broadcast:record', this);
    }
  });
  Cls.initClass();

  Cls = (List.ProgrammeList = class ProgrammeList extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/epg/list/programme';
      this.prototype.tagName = "li";
      this.prototype.className = "pvr-card card";
      this.prototype.triggers =
        {'click .play'         : 'broadcast:play'};
      this.prototype.events = {
        'click .record'       : 'toggleRecord',
        'click .toggle-timer' : 'toggleTimer'
      };
    }
    onRender() {
      //# Add a class to indicate the programme has finished
      if (this.model.attributes.wasactive) { this.$el.addClass("aired"); }
      if (this.model.attributes.isactive) { this.$el.addClass("airing"); }
      if (this.model.attributes.hastimer) { return this.$el.addClass("has-timer"); }
    }
    toggleRecord() {
      this.$el.toggleClass('has-timer');
      return this.trigger('broadcast:record', this);
    }
    toggleTimer() {
      this.$el.toggleClass('has-timer');
      return this.trigger('broadcast:timer', this);
    }
  });
  Cls.initClass();


  return (function() {
    Cls = (List.EPGList = class EPGList extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.ProgrammeList;
        this.prototype.tagName = "ul";
        this.prototype.className = "programmes";
        this.prototype.emptyView = App.Views.EmptyViewResults;
        this.prototype.emptyViewOptions =
          {emptyKey: 'EPG data'};
      }
      onShow() {
        const $airing = this.$el.find('.airing');
        if ($airing.length) {
          return $(window).scrollTop($airing.offset().top-150);
        }
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ExternalApp", function(ExternalApp, App, Backbone, Marionette, $, _) {});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ExternalApp.Youtube", function(Youtube, App, Backbone, Marionette, $, _) {

  var API = {

    getSearchView(query, viewName, title = '', options = {}, callback) {
      return App.execute("youtube:search:entities", query, options, function(collection) {
        const view = new (Youtube[viewName])({
          collection,
          title
        });
        App.listenTo(view, 'childview:youtube:play', function(parent, item) {
          if (item.model.get('addonEnabled')) {
            return API.playKodi(item.model.get('id'));
          } else {
            return API.playLocal(item.model.get('id'));
          }
        });
        App.listenTo(view, 'childview:youtube:localplay', (parent, item) => API.playLocal(item.model.get('id')));
        return callback(view);
      });
    },

    playLocal(id) {
      const localPlayer = "videoPlayer.html?yt=" + id;
      return helpers.global.localVideoPopup(localPlayer, 530);
    },

    playKodi(id) {
      const playlist = App.request("command:kodi:controller", 'video', 'PlayList');
      return playlist.play('file', 'plugin://plugin.video.youtube/play/?video_id=' + id);
    }
  };


  App.commands.setHandler("youtube:search:view", (query, callback) => API.getSearchView(query, 'List', '', {}, callback));

  App.commands.setHandler("youtube:search:popup", query => API.getSearchView(query, 'List', '', {}, function(view) {
    const $footer = $('<a>', {class: 'btn btn-primary', href: 'https://www.youtube.com/results?search_query=' + query, target: '_blank'});
    $footer.html('More videos');
    return App.execute("ui:modal:show", _.escape(query), view.render().$el, $footer);
  }));

  return App.commands.setHandler("youtube:list:view", (query, title, options = {}, callback) => API.getSearchView(query, 'CardList', title, options, callback));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ExternalApp.Youtube", function(Youtube, App, Backbone, Marionette, $, _) {

  let Cls = (Youtube.Item = class Item extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/external/youtube/youtube';
      this.prototype.tagName = 'li';
      this.prototype.triggers = {
        'click .play': 'youtube:play',
        'click .localplay': 'youtube:localplay'
      };
      this.prototype.events =
        {'click .action': 'closeModal'};
    }
    closeModal() {
      return App.execute("ui:modal:close");
    }
  });
  Cls.initClass();

  Cls = (Youtube.List = class List extends App.Views.CollectionView {
    static initClass() {
      this.prototype.childView = Youtube.Item;
      this.prototype.tagName = 'ul';
      this.prototype.className = 'youtube-list';
    }
  });
  Cls.initClass();

  Cls = (Youtube.Card = class Card extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        'click .play': 'youtube:play',
        'click .localplay': 'youtube:localplay'
      };
    }
    initialize() {
      return this.getMeta();
    }
    getMeta() {
      if (this.model) {
        this.model.set({subtitleHtml: this.themeLink('YouTube', this.model.get('url'), {external: true})});
        if (this.model.get('addonEnabled')) {
          return this.model.set({menu: {localplay: 'Local play'}});
        }
      }
    }
    onRender() {
      return this.makeLinksExternal();
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Youtube.CardList = class CardList extends App.Views.SetCompositeView {
      static initClass() {
        this.prototype.childView = Youtube.Card;
        this.prototype.className = "section-content card-grid--musicvideo";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("FilterApp", function(FilterApp, App, Backbone, Marionette, $, _) {

  var API = {

    /*
      Settings/fields
    */

    sortFields: [
      {
        alias: 'title',
        type: 'string',
        defaultSort: true,
        defaultOrder: 'asc',
        key: 'title'
      },
      {
        alias: 'title',
        type: 'string',
        defaultSort: true,
        defaultOrder: 'asc',
        key: 'label'
      },
      {
        alias: 'year',
        type: 'number',
        key: 'year',
        defaultOrder: 'desc'
      },
      {
        alias: 'date added',
        type: 'string',
        key: 'dateadded',
        defaultOrder: 'desc'
      },
      {
        alias: 'rating',
        type: 'float',
        key: 'rating',
        defaultOrder: 'desc'
      },
      {
        alias: 'artist',
        type: 'string',
        key: 'artist',
        defaultOrder: 'asc'
      },
      {
        alias: 'random',
        type: 'other',
        key: 'random',
        defaultOrder: 'asc'
      },
      {
        alias: 'album',
        type: 'string',
        key: 'album',
        defaultOrder: 'asc'
      }
    ],

    //# See applyFilter() for how filterCallback are handled.
    filterFields: [
      {
        alias: 'year',
        type: 'number',
        key: 'year',
        sortOrder: 'desc',
        filterCallback: 'multiple'
      },
      {
        alias: 'genre',
        type: 'array',
        key: 'genre',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'mood',
        type: 'array',
        key: 'mood',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'style',
        type: 'array',
        key: 'style',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'unwatched',
        type: "boolean",
        key: 'unwatched',
        sortOrder: 'asc',
        filterCallback: 'unwatched'
      },
      {
        alias: 'watched',
        type: "boolean",
        key: 'watched',
        sortOrder: 'asc',
        filterCallback: 'watched'
      },
      {
        alias: 'in progress',
        type: "boolean",
        key: 'inprogress',
        sortOrder: 'asc',
        filterCallback: 'inprogress'
      },
      {
        alias: 'writer',
        type: 'array',
        key: 'writer',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'director',
        type: 'array',
        key: 'director',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'tag',
        type: 'array',
        key: 'tag',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'actor',
        type: 'object',
        property: 'name',
        key: 'cast',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'set',
        type: 'string',
        property: 'set',
        key: 'set',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'rated',
        type: 'string',
        property: 'mpaa',
        key: 'mpaa',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'studio',
        type: 'array',
        property: 'studio',
        key: 'studio',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'label',
        type: 'string',
        property: 'albumlabel',
        key: 'albumlabel',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'Thumbs up',
        type: "boolean",
        key: 'thumbsUp',
        sortOrder: 'asc',
        filterCallback: 'thumbsup'
      },
      {
        alias: 'album',
        type: 'string',
        key: 'album',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      },
      {
        alias: 'artist',
        type: 'array',
        key: 'artist',
        sortOrder: 'asc',
        filterCallback: 'multiple'
      }
    ],

    //# Wrapper for returning the available fields for sort/filter
    //# Available fields are defined in the entity controller and passed
    //# to the filter view where they are stored in cache.
    getFilterFields(type) {
      const key = type + 'Fields';
      const fields = API[key];
      //# Get available and only return fields available to this entity
      const availableFilters = API.getAvailable();
      const available = availableFilters[type];
      const ret = [];
      for (var field of fields) {
        if (helpers.global.inArray(field.key, available)) {
          ret.push(field);
        }
      }
      return ret;
    },


    /*
      Storage
    */

    //# Store filters namespace
    storeFiltersNamespace: 'filter:store:',

    getStoreNameSpace(type) {
      return API.storeFiltersNamespace + type;
    },

    //# Memory store the current filters
    setStoreFilters(filters = {}, type = 'filters') {
      const store = {};
      store[helpers.url.path()] = filters;
      helpers.cache.set(API.getStoreNameSpace(type), store);
      return App.vent.trigger('filter:changed', filters);
    },

    //# Get the current filters for this page
    getStoreFilters(type = 'filters') {
      const store = helpers.cache.get(API.getStoreNameSpace(type), {});
      const path = helpers.url.path();
      const filters = store[path] ? store[path] : {};
      const ret = {};
      if (!_.isEmpty(filters)) {
        for (var key in filters) {
          var val = filters[key];
          if (val.length > 0) {
            ret[key] = val;
          }
        }
      }
      return ret;
    },

    //# Update a given key with new values
    updateStoreFiltersKey(key, values = []) {
      const filters = API.getStoreFilters();
      filters[key] = values;
      API.setStoreFilters(filters);
      return filters;
    },

    //# Get a specific key values
    getStoreFiltersKey(key) {
      const filters = API.getStoreFilters();
      const filter = filters[key] ? filters[key] : [];
      return filter;
    },

    //# Set current sort.
    setStoreSort(method, order = 'asc') {
      const sort = {method, order};
      return API.setStoreFilters(sort, 'sort');
    },

    //# Get current sort.
    getStoreSort() {
      let sort = API.getStoreFilters('sort');
      if (!sort.method) {
        const defaults = _.findWhere(API.getFilterFields('sort'), {defaultSort: true});
        sort = {method: defaults.key, order: defaults.defaultOrder};
      }
      return sort;
    },

    //# Set available filters
    setAvailable(available) {
      return API.setStoreFilters(available, 'available');
    },

    //# Get available filters
    getAvailable() {
      return API.getStoreFilters('available');
    },


    /*
      Parsing
    */

    //# Swap the order.
    toggleOrder(order) {
      order = order === 'asc' ? 'desc' : 'asc';
      return order;
    },

    //# Parse the defaults with context of the current page
    parseSortable(items) {
      //# Set the current state
      const params = API.getStoreSort(false, 'asc');
      //# loop over the items and set the active and toggle order if active
      for (var i in items) {
        var item = items[i];
        items[i].active = false;
        items[i].order = item.defaultOrder;
        if (params.method && (item.key === params.method)) {
          items[i].active = true;
          items[i].order = this.toggleOrder(params.order);
        } else if (item.defaultSort && (params.method === false)) {
          items[i].active = true;
        }
      }
      return items;
    },

    //# Parse the active state int the current filters
    parseFilterable(items) {
      const active = API.getFilterActive();
      for (var i in items) {
        var val = items[i];
        var activeItem = _.findWhere(active, {key: val.key});
        items[i].active = activeItem !== undefined;
      }
      return items;
    },

    //# Extract the available options for a given filter from the attached collection.
    getFilterOptions(key, collection) {
      const values = App.request('filter:store:key:get', key);
      //# Filter settings for this key.
      const s = API.getFilterSettings(key);
      const items = [];
      //# Get the properties requested
      let collectionItems = collection.pluck(key);
      //# Deal with more complex nested properties (e.g. cast)
      if ((s.filterCallback === 'multiple') && (s.type === 'object')) {
        //# Limit to first 5 for each otherwise it kills the browser.
        const limited = [];
        for (var item of collectionItems) {
          for (var i in item) {
            var data = item[i];
            if (i < 5) {
              limited.push(data[s.property]);
            }
          }
        }
        collectionItems = limited;
      }
      //# Reduce the list to an array of unique items.
      _.map(_.uniq(_.flatten(collectionItems)), val => items.push({key, value: val, active: helpers.global.inArray(val,values)}));
      return items;
    },


    /*
      Apply filters
    */

    //# Apply filters to a collection.
    applyFilters(collection) {
      const sort = API.getStoreSort();
      collection.sortCollection(sort.method, sort.order);
      let filteredCollection = new App.Entities.Filtered(collection);
      const object = API.getStoreFilters();
      for (var key in object) {
        var values = object[key];
        if (values.length > 0) {
          filteredCollection = API.applyFilter(filteredCollection, key, values);
        }
      }
      return filteredCollection;
    },

    //# Apply a single filter key
    //# See entities/_base/filtered.js for custom filter methods
    applyFilter(collection, key, vals) {
      //# Get the filter settings available for this key and switch on the callback.
      const s = API.getFilterSettings(key);
      switch (s.filterCallback) {
        //# If multiple values allowed
        case 'multiple':
          if (s.type === 'array') {
            collection.filterByMultipleArray(key, vals); //# data is an array
          } else if (s.type === 'object') {
            collection.filterByMultipleObject(key, s.property, vals); //# data is an array of objects
          } else {
            collection.filterByMultiple(key, vals); //# data is not array
          }
          break;
        case 'unwatched':
          collection.filterByUnwatched();
          break;
        case 'watched':
          collection.filterByWatched();
          break;
        case 'inprogress':
          collection.filterByInProgress();
          break;
        case 'thumbsup':
          collection.filterByThumbsUp();
          break;
        default:
          collection;
      }
      return collection;
    },

    //# Get settings for a given filter
    getFilterSettings(key, availableOnly = true) {
      const filters = availableOnly === true ? API.getFilterFields('filter') : API.filterFields;
      return _.findWhere(filters, {key});
    },

    //# Get the active filters.
    getFilterActive() {
      const items = [];
      const object = API.getStoreFilters();
      for (var key in object) {
        var values = object[key];
        if (values.length > 0) {
          items.push({key, values});
        }
      }
      return items;
    }
  };



  /*
    Handlers.
  */

  //# Views and collections.

  //# Return the filters view
  App.reqres.setHandler('filter:show', function(collection) {
    API.setAvailable(collection.availableFilters);
    const filters = new FilterApp.Show.Controller({
      refCollection: collection});
    const view = filters.getFilterView();
    return view;
  });

  //# Return the filter options collection
  App.reqres.setHandler('filter:options', function(key, collection) {
    //# Get the options collection based on values in the collection.
    const options = API.getFilterOptions(key, collection);
    const optionsCollection = App.request('filter:filters:options:entities', options);
    //# Set the order of the options collection.
    const filterSettings = API.getFilterSettings(key);
    optionsCollection.sortCollection('value', filterSettings.sortOrder);
    //# Return collection
    return optionsCollection;
  });

  //# Get an active filter collection.
  App.reqres.setHandler('filter:active',  () => App.request('filter:active:entities', API.getFilterActive()));

  //# Apply filters to a collection.
  App.reqres.setHandler('filter:apply:entities', function(collection)  {
    API.setAvailable(collection.availableFilters);
    const newCollection = API.applyFilters(collection);
    App.vent.trigger('filter:filtering:stop');
    return newCollection;
  });

  //# Get a sortable collection
  App.reqres.setHandler('filter:sortable:entities', () => App.request('filter:sort:entities', API.parseSortable(API.getFilterFields('sort'))));

  //# Get a filter collection
  App.reqres.setHandler('filter:filterable:entities', () => App.request('filter:filters:entities', API.parseFilterable(API.getFilterFields('filter'))));

  //# Set a filter using a url param eg ?director=name
  App.reqres.setHandler('filter:init', function(availableFilters) {
    const params = helpers.url.params();
    if (!_.isEmpty(params)) {
      // Clear existing filters first
      API.setStoreFilters({});
      // Set sort, no validation here, wrong param might break something
      if (params.sort) {
        const order = params.order ? params.order : 'asc';
        API.setStoreSort(params.sort, order);
      }
      // Set Filter
      return (() => {
        const result = [];
        for (var key of availableFilters.filter) {
        // is one of the params an available filter
          if (params[key]) {
            var values = API.getStoreFiltersKey(key);
            var filterSettings = API.getFilterSettings(key, false);
            // If the filter doesn't exist, add and save.
            if (!helpers.global.inArray(params[key], values)) {
              if (filterSettings.type === 'number') {
                values.push(parseInt(params[key]));
              } else {
                values.push(decodeURIComponent(params[key]));
              }
              result.push(API.updateStoreFiltersKey(key, values));
            } else {
              result.push(undefined);
            }
          } else {
            result.push(undefined);
          }
        }
        return result;
      })();
    }
  });

  //# Storage.

  //# Store a filter set
  App.reqres.setHandler('filter:store:set', function(filters) {
    API.setStoreFilters(filters);
    return filters;
  });

  //# Get a Stored a filter set
  App.reqres.setHandler('filter:store:get', () => API.getStoreFilters());

  //# Get a Stored a filter set for a given key
  App.reqres.setHandler('filter:store:key:get', key => API.getStoreFiltersKey(key));

  //# Update a key in a stored filter set.
  App.reqres.setHandler('filter:store:key:update', (key, values = []) => API.updateStoreFiltersKey(key, values));

  //# Toggle a value in a key and return the updated values
  //# This feels long winded, maybe one day refactor/compress.
  App.reqres.setHandler('filter:store:key:toggle', function(key, value) {
    const values = API.getStoreFiltersKey(key);
    let ret = [];
    //# Remove.
    if (_.indexOf(values, value) > -1) {
      const newValues = [];
      for (var i of values) {
        if (i !== value) {
          newValues.push(i);
        }
      }
      ret = newValues;
    } else {
      //# Add.
      values.push(value);
      ret = values;
    }
    API.updateStoreFiltersKey(key, ret);
    return ret;
  });

  //# Store a sort
  App.reqres.setHandler('filter:sort:store:set', (method, order = 'asc') => API.setStoreSort(method, order));

  //# Get a sort, fallback to default
  return App.reqres.setHandler('filter:sort:store:get', () => API.getStoreSort());
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("FilterApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  return Show.Controller = class Controller extends App.Controllers.Base {

    getFilterView() {
      const collection = this.getOption('refCollection');
      this.layoutFilters = this.getLayoutView(collection);

      //# Render subviews.
      this.listenTo(this.layoutFilters, "show", () => {
        this.getSort();
        this.getFilters();
        this.getActive();
        return this.getSections();
      });

      //# Change panes.
      this.listenTo(this.layoutFilters, 'filter:layout:close:filters', () => {
        return this.stateChange('normal');
      });
      this.listenTo(this.layoutFilters, 'filter:layout:close:options', () => {
        return this.stateChange('filters');
      });
      this.listenTo(this.layoutFilters, 'filter:layout:open:filters', () => {
        return this.stateChange('filters');
      });
      this.listenTo(this.layoutFilters, 'filter:layout:open:options', () => {
        return this.stateChange('options');
      });

      //# Return layout view.
      return this.layoutFilters;
    }


    //# Get the base layout
    getLayoutView(collection) {
      return new Show.FilterLayout({
        collection});
    }


    getSort() {
      const sortCollection = App.request('filter:sortable:entities');
      const sortView = new Show.SortList({
        collection: sortCollection});
      this.layoutFilters.regionSort.show(sortView);
      //# Listen to click.
      return App.listenTo(sortView, "childview:filter:sortable:select", (parentview, childview) => {
        App.request('filter:sort:store:set', childview.model.get('key'), childview.model.get('order'));
        this.layoutFilters.trigger('filter:changed');
        return this.getSort();
      });
    }


    getFilters(clearOptions = true) {
      const filterCollection = App.request('filter:filterable:entities');
      const filtersView = new Show.FilterList({
        collection: filterCollection});
      //# On filterable click.
      App.listenTo(filtersView, "childview:filter:filterable:select", (parentview, childview) => {
        const key = childview.model.get('key');
        if (childview.model.get('type') === 'boolean') {  //# No options
          App.request('filter:store:key:toggle', key, childview.model.get('alias'));
          return this.triggerChange();
        } else {
          this.getFilterOptions(key);
          return this.stateChange('options');
        }
      });
      //# Render the filters.
      this.layoutFilters.regionFiltersList.show(filtersView);
      //# Empty the options ready for a change.
      if (clearOptions) {
        return this.layoutFilters.regionFiltersOptions.empty();
      }
    }


    getActive() {
      const activeCollection = App.request('filter:active');
      const optionsView = new Show.ActiveList({
        collection: activeCollection});
      this.layoutFilters.regionFiltersActive.show(optionsView);
      //# Get a new filtered collection and the current keys.
      App.listenTo(optionsView, "childview:filter:option:remove", (parentview, childview) => {
        const key = childview.model.get('key');
        App.request('filter:store:key:update', key, []);
        return this.triggerChange();
      });
      //# Bind to new and open filter pane
      App.listenTo(optionsView, "childview:filter:add", (parentview, childview) => {
        return this.stateChange('filters');
      });
      //# Add/remove filter bar
      return this.getFilterBar();
    }

    getFilterOptions(key) {
      //# Create the options list view and add to dom
      const optionsCollection = App.request('filter:options', key, this.getOption('refCollection'));
      const optionsView = new Show.OptionList({
        collection: optionsCollection});
      this.layoutFilters.regionFiltersOptions.show(optionsView);
      //# Get a new filtered collection and the current keys.
      App.listenTo(optionsView, "childview:filter:option:select", (parentview, childview) => {
        const value = childview.model.get('value');
        childview.view.$el.find('.option').toggleClass('active');
        App.request('filter:store:key:toggle', key, value);
        return this.triggerChange(false);
      }); //# dont clear options.
      //# Deselect all
      return App.listenTo(optionsView, 'filter:option:deselectall', parentview => {
        parentview.view.$el.find('.option').removeClass('active');
        App.request('filter:store:key:update', key, []);
        return this.triggerChange(false);
      }); //# dont clear options.
    }

    //# When something has changed. rerender the actives and notify other watchers.
    triggerChange(clearOptions = true) {
      App.vent.trigger('filter:filtering:start');
      this.getFilters(clearOptions);
      this.getActive();
      App.navigate(helpers.url.path());
      return this.layoutFilters.trigger('filter:changed');
    }


    //# Deal with the filters bar showing all active filters
    getFilterBar() {
      const currentFilters = App.request('filter:store:get');
      const list = _.flatten(_.values(currentFilters));
      const $wrapper = $('.layout-container');
      const $list = $('.region-content-top', $wrapper);
      if (list.length > 0) {
        const bar = new Show.FilterBar({filters: list});
        $list.html(bar.render().$el);
        $wrapper.addClass('filters-active');
        return App.listenTo(bar, 'filter:remove:all', () => {
          App.request('filter:store:set', {});
          this.triggerChange();
          return this.stateChange('normal');
        });
      } else {
        return $wrapper.removeClass('filters-active');
      }
    }


    //# state changes (slide the filter panes in and out)
    stateChange(state = 'normal') {
      const $wrapper = this.layoutFilters.$el.find('.filters-container');
      switch (state) {
        case 'filters':
          return $wrapper.removeClass('show-options').addClass('show-filters');
        case 'options':
          return $wrapper.addClass('show-options').removeClass('show-filters');
        default:
          return $wrapper.removeClass('show-options').removeClass('show-filters');
      }
    }


    //# Populate the sections with structure from mainNav.
    getSections() {
      const collection = this.getOption('refCollection');
      if (collection.sectionId) {
        const nav = App.request("navMain:children:show", collection.sectionId, 'Sections');
        return this.layoutFilters.regionNavSection.show(nav);
      }
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("FilterApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  /*
    Base.
  */

  let Cls = (Show.FilterLayout = class FilterLayout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/filter/show/filters_ui';
      this.prototype.className = "side-bar";
      this.prototype.regions = {
        regionSort: '.sort-options',
        regionFiltersActive: '.filters-active',
        regionFiltersList: '.filters-list',
        regionFiltersOptions: '.filter-options-list',
        regionNavSection: '.nav-section'
      };
      this.prototype.triggers = {
        'click .close-filters' : 'filter:layout:close:filters',
        'click .close-options' : 'filter:layout:close:options',
        'click .open-filters' : 'filter:layout:open:filters'
      };
    }
  });
  Cls.initClass();

  Cls = (Show.ListItem = class ListItem extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/filter/show/list_item';
      this.prototype.tagName = 'li';
    }
  });
  Cls.initClass();

  Cls = (Show.List = class List extends App.Views.CollectionView {
    static initClass() {
      this.prototype.childView = Show.ListItem;
      this.prototype.tagName = "ul";
      this.prototype.className = "selection-list";
    }
  });
  Cls.initClass();


  /*
    Extends.
  */


  //# Sort.

  Cls = (Show.SortListItem = class SortListItem extends Show.ListItem {
    static initClass() {
      this.prototype.triggers =
        {"click .sortable": "filter:sortable:select"};
    }
    initialize() {
      const classes = ['option', 'sortable'];
      if (this.model.get('active') === true) {
        classes.push('active');
      }
      classes.push('order-' + this.model.get('order'));
      const tag = this.themeTag('span', {'class': classes.join(' ')}, t.gettext(this.model.get('alias')));
      return this.model.set({title: tag});
    }
  });
  Cls.initClass();

  Cls = (Show.SortList = class SortList extends Show.List {
    static initClass() {
      this.prototype.childView = Show.SortListItem;
    }
  });
  Cls.initClass();


  //# Filter

  Cls = (Show.FilterListItem = class FilterListItem extends Show.ListItem {
    static initClass() {
      this.prototype.triggers =
        {"click .filterable": "filter:filterable:select"};
    }
    initialize() {
      const classes = ['option', 'option filterable'];
      if (this.model.get('active')) {
        classes.push('active');
      }
      const tag = this.themeTag('span', {'class': classes.join(' ')}, t.gettext(this.model.get('alias')));
      return this.model.set({title: tag});
    }
  });
  Cls.initClass();


  Cls = (Show.FilterList = class FilterList extends Show.List {
    static initClass() {
      this.prototype.childView = Show.FilterListItem;
    }
  });
  Cls.initClass();


  //# Filter option.

  Cls = (Show.OptionListItem = class OptionListItem extends Show.ListItem {
    static initClass() {
      this.prototype.triggers =
        {"click .filterable-option" : "filter:option:select"};
    }
    initialize() {
      const classes = ['option', 'option filterable-option'];
      if (this.model.get('active')) {
        classes.push('active');
      }
      const tag = this.themeTag('span', {'class': classes.join(' ')}, this.model.get('value'));
      return this.model.set({title: tag});
    }
  });
  Cls.initClass();

  Cls = (Show.OptionList = class OptionList extends App.Views.CompositeView {
    static initClass() {
      this.prototype.template = 'apps/filter/show/filter_options';
      this.prototype.activeValues = [];
      this.prototype.childView = Show.OptionListItem;
      this.prototype.childViewContainer = 'ul.selection-list';
      this.prototype.triggers =
        {'click .deselect-all': 'filter:option:deselectall'};
    }
    onRender() {
      //# hide filter search if < 10 items
      if (this.collection.length <= 10) {
        $('.options-search-wrapper', this.$el).addClass('hidden');
      }
      //# Filter options via search box.
      return $('.options-search', this.$el).filterList();
    }
  });
  Cls.initClass();


  //# Active Filters.

  Cls = (Show.ActiveListItem = class ActiveListItem extends Show.ListItem {
    static initClass() {
      this.prototype.triggers =
        {"click .filterable-remove" : "filter:option:remove"};
    }
    initialize() {
      const tooltip = t.gettext('Remove') + ' ' + this.model.escape('key') + ' ' + t.gettext('filter');
      const text = this.themeTag('span', {'class': 'text'}, this.model.get('values').join(', '));
      const tag = this.themeTag('span', {'class': 'filter-btn filterable-remove', title: tooltip}, text);
      return this.model.set({title: tag});
    }
  });
  Cls.initClass();

  Cls = (Show.ActiveNewListItem = class ActiveNewListItem extends Show.ListItem {
    static initClass() {
      this.prototype.triggers =
        {"click .filterable-add" : "filter:add"};
    }
    initialize() {
      const tag = this.themeTag('span', {'class': 'filter-btn filterable-add'}, t.gettext('Add filter'));
      return this.model.set({title: tag});
    }
  });
  Cls.initClass();

  Cls = (Show.ActiveList = class ActiveList extends Show.List {
    static initClass() {
      this.prototype.childView = Show.ActiveListItem;
      this.prototype.emptyView = Show.ActiveNewListItem;
      this.prototype.className = "active-list";
    }
  });
  Cls.initClass();


  //# Filters bar

  return (function() {
    Cls = (Show.FilterBar = class FilterBar extends App.Views.ItemView {
      static initClass() {
        this.prototype.template = 'apps/filter/show/filters_bar';
        this.prototype.className = "filters-active-bar";
        this.prototype.triggers =
          {'click .remove': 'filter:remove:all'};
      }
      onRender() {
        if (this.options.filters) {
          return $('.filters-active-all', this.$el).text( this.options.filters.join(', ') );
        }
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("HelpApp", function(HelpApp, App, Backbone, Marionette, $, _) {

  const Cls = (HelpApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "help"          : "helpOverview",
        "help/overview" : "helpOverview",
        "help/:id"      : "helpPage"
      };
    }
  });
  Cls.initClass();

  var API = {

    helpOverview() {
      return new App.HelpApp.Overview.Controller();
    },

    helpPage(id) {
      return new HelpApp.Show.Controller({
        id});
    },

    // Get a html page with jQuery ajax
    getPage(id, lang = 'en', callback) {
      const content = $.get(`lang/${lang}/${id}.html`);
      content.fail(function(error) {
        if (lang !== 'en') {
          return API.getPage(id, 'en', callback);
        }
      });
      content.done(data => callback(data));
      return content;
    },

    // Get second level nav
    getSubNav() {
      const collection = App.request("navMain:array:entities", this.getSideBarStructure());
      return App.request("navMain:collection:show", collection, t.gettext('Help topics'));
    },

    // Get second level nav structure
    // TODO: refactor into navMain
    getSideBarStructure() {
      return [
        {title: t.gettext('About'), path: 'help'},
        {title: t.gettext('Readme'), path: 'help/app-readme'},
        {title: t.gettext('Changelog'), path: 'help/app-changelog'},
        {title: t.gettext('Keyboard'), path: 'help/keybind-readme'},
        {title: t.gettext('Add-ons'), path: 'help/addons'},
        {title: t.gettext('Developers'), path: 'help/developers'},
        {title: t.gettext('Translations'), path: 'help/lang-readme'},
        {title: t.gettext('License'), path: 'help/license'}
      ];
    }
  };

  // Subnav for help
  App.reqres.setHandler('help:subnav', () => API.getSubNav());

  // Get a page via jQuery, use current language
  App.reqres.setHandler('help:page', function(id, callback) {
    const lang = config.getLocal('lang', 'en');
    return API.getPage(id, lang, callback);
  });

  //# Start the router.
  return App.on("before:start", () => new HelpApp.Router({
    controller: API}));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("HelpApp.Overview", function(Overview, App, Backbone, Marionette, $, _) {

  return Overview.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {

      // Load the page
      return App.request("help:page", 'help-overview', data => {

        this.layout = this.getLayoutView(data);
        this.listenTo(this.layout, "show", () => {
          this.getSideBar();
          return this.getPage(data);
        });

        // Render layout
        return App.regionContent.show(this.layout);
      });
    }

    getPage(data) {
      this.pageView = new Overview.Page({
        data});
      this.listenTo(this.pageView, "show", () => {
        return this.getReport();
      });

      return this.layout.regionContent.show(this.pageView);
    }

    getSideBar() {
      const subNav = App.request("help:subnav");
      return this.layout.regionSidebarFirst.show(subNav);
    }

    getLayoutView() {
      return new Overview.Layout();
    }

    getReport() {

      // jQuery obj for page view
      this.$pageView = this.pageView.$el;

      this.getReportChorusVersion();
      this.getReportKodiVersion();
      this.getReportWebsocketsActive();
      this.getReportLocalAudio();

      // We might have just called to early, bind to available event just in case.
      App.vent.on("sockets:available", () => {
        return this.getReportWebsocketsActive();
      });
      return App.vent.on("state:initialized", () => {
        return this.getReportKodiVersion();
      });
    }

    //
    // Callbacks for getting/setting report values below.
    // TODO: Refactor... Shouldn't be using jQuery to insert content
    //

    // Chorus version.
    getReportChorusVersion() {
      return $.get("addon.xml", data => {
        return $('.report-chorus-version > span', this.$pageView).text($('addon', data).attr('version'));
      });
    }

    // Kodi version
    getReportKodiVersion() {
      const state = App.request("state:kodi");
      const kodiVersion = state.getState('version');
      return $('.report-kodi-version > span', this.$pageView).text(kodiVersion.major + '.' + kodiVersion.minor);
    }

    // Web sockets.
    getReportWebsocketsActive() {
      const wsActive = App.request("sockets:active");
      const $ws = $('.report-websockets', this.$pageView);
      if (wsActive) {
        $('span', $ws).text(tr("Remote control is set up correctly"));
        return $ws.removeClass('warning');
      } else {
        $('span', $ws).html(tr("You need to 'Allow remote control' for Kodi. You can do that") + ' <a href="#settings/kodi/services">' + tr('here') + '</a>');
        return $ws.addClass('warning');
      }
    }

    // Local audio
    getReportLocalAudio() {
      const localAudio = soundManager.useHTML5Audio ? "HTML 5" : "Flash";
      return $('.report-local-audio > span', this.$pageView) .text(localAudio);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// View for the API Browser.
//
// @param [Object] This app object
// @param [Object] The full application object
// @param [Object] Backbone
// @param [Object] Marionette
// @param [Object] jQuery
// @param [Object] lodash (underscore)
//
this.Kodi.module("HelpApp.Overview", function(Overview, App, Backbone, Marionette, $, _) {

  let Cls = (Overview.Page = class Page extends App.Views.CompositeView {
    static initClass() {
      this.prototype.className = "help--overview";
      this.prototype.template = 'apps/help/overview/overview';
      this.prototype.tagName = "div";
    }
    onRender() {
      // Set the data/header.
      return $('.help--overview--header', this.$el).html(this.options.data);
    }
  });
  Cls.initClass();


  return (function() {
    Cls = (Overview.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
      static initClass() {
        this.prototype.className = "help--page help--overview page-wrapper";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("HelpApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  // Main controller
  return Show.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {

      // Load the page
      return App.request("help:page", options.id, data => {

        this.layout = this.getLayoutView(data);
        this.listenTo(this.layout, "show", () => {
          return this.getSideBar();
        });

        // Render layout
        App.regionContent.show(this.layout);

        // If a page view is overridden set that to the content.
        if (options.pageView) {
          return this.layout.regionContent.show(options.pageView);
        }
      });
    }

    getSideBar() {
      const subNav = App.request("help:subnav");
      return this.layout.regionSidebarFirst.show(subNav);
    }

    getLayoutView(data) {
      return new Show.Layout({
        data,
        pageView: this.options.pageView
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// View for the API Browser.
//
// @param [Object] This app object
// @param [Object] The full application object
// @param [Object] Backbone
// @param [Object] Marionette
// @param [Object] jQuery
// @param [Object] lodash (underscore)
//
this.Kodi.module("HelpApp.Show", (Show, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Show.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "help--page page-wrapper";
    }
    onRender() {
      // Set the data.
      return $(this.regionContent.el, this.$el).html(this.options.data);
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Images", function(Images, App, Backbone, Marionette, $, _) {

  var API = {

    imagesPath: 'images/',

    defaultFanartPath: 'fanart_default/',

    defaultFanartFiles: [
      'cans.jpg',
      'guitar.jpg',
      'speaker.jpg',
      'turntable.jpg',
      'amp.jpg',
      'concert.jpg',
      'tweeter.jpg',
    ],

    getDefaultThumbnail() {
      return API.imagesPath + 'thumbnail_default.png';
    },

    getRandomFanart() {
      const rand = helpers.global.getRandomInt(0, API.defaultFanartFiles.length - 1);
      const file = API.defaultFanartFiles[rand];
      const path = API.imagesPath + API.defaultFanartPath + file;
      return path;
    },

    parseRawPath(rawPath) {
      const path = config.getLocal('reverseProxy') ? 'image/' + encodeURIComponent(rawPath) : '/image/' + encodeURIComponent(rawPath);
      return path;
    },

    //# set background fanart, string to 'none' removes fanart
    setFanartBackground(path, region) {
      const $body = App.getRegion(region).$el;
      if (path !== 'none') {
        if (!path) {
          path = this.getRandomFanart();
        }
        return $body.css('background-image', 'url(' +  path + ')');
      } else {
        return $body.removeAttr('style');
      }
    },

    getImageUrl(rawPath, type = 'thumbnail', useFallback = true) {
      let path = '';
      if ((rawPath == null) || (rawPath === '')) {
        switch (type) {
          case 'fanart': path = API.getRandomFanart(); break;
          default: path = API.getDefaultThumbnail();
        }
      } else if (type === 'trailer') {
        path = API.getTrailerUrl(rawPath);
      } else {
        path = API.parseRawPath(rawPath);
      }
      return path;
    },

    getTrailerUrl(rawpath) {
      const trailer = helpers.url.parseTrailerUrl((rawpath));
      return trailer.img;
    }
  };

  //# Handler to set the background fanart pic.
  App.commands.setHandler("images:fanart:set", (path, region = 'regionFanart') => API.setFanartBackground(path, region));

  //# Handler to return a parsed image path.
  App.reqres.setHandler("images:path:get", (rawPath = '', type = 'thumbnail') => API.getImageUrl(rawPath, type));

  //# Handler to apply correct paths to a model, expects to be called
  //# on the model attributes, typically during a model.parse()
  return App.reqres.setHandler("images:path:entity", function(model) {
    if (model.thumbnail != null) {
      model.thumbnailOriginal = model.thumbnail;
      model.thumbnail = API.getImageUrl(model.thumbnail, 'thumbnail');
    }
    if (model.fanart != null) {
      model.fanartOriginal = model.fanart;
      model.fanart = API.getImageUrl(model.fanart, 'fanart');
    }
    if ((model.cast != null) && (model.cast.length > 0)) {
      for (var i in model.cast) {
        var person = model.cast[i];
        model.cast[i].thumbnail = API.getImageUrl(person.thumbnail, 'thumbnail');
      }
    }
    return model;
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("InputApp", function(InputApp, App, Backbone, Marionette, $, _) {


  const Cls = (InputApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes =
        {"remote"        : "remotePage"};
    }
  });
  Cls.initClass();


  const API = {

    initKeyBind() {
      return $(document).keydown(e => {
        return this.keyBind(e);
      });
    },

    //# The input controller
    inputController() {
      return App.request("command:kodi:controller", 'auto', 'Input');
    },

    //# Do an input command
    doInput(type) {
      return this.inputController().sendInput(type, []);
    },

    //# Do an action
    //# http://kodi.wiki/view/JSON-RPC_API/v6#Input.Action
    doAction(action) {
      return this.inputController().sendInput('ExecuteAction', [action]);
    },

    //# Send a player command.
    doCommand(command, params, callback) {
      return App.request('command:kodi:player', command, params, () => {
        return this.pollingUpdate(callback);
      });
    },

    //# Get the Kodi application controller
    appController() {
      return App.request("command:kodi:controller", 'auto', 'Application');
    },

    //# Wrapper for requesting a state update if no sockets
    pollingUpdate(callback) {
      if (!App.request('sockets:active')) {
        return App.request('state:kodi:update', callback);
      }
    },

    //# Toggle remote visibility and path
    toggleRemote(open = 'auto') {
      const $body = $('body');
      const rClass = 'section-remote';
      if (open === 'auto') {
        open = ($body.hasClass(rClass));
      }
      if (open) {
        window.history.back();
        return helpers.backscroll.scrollToLast();
      } else {
        helpers.backscroll.setLast();
        return App.navigate("remote", {trigger: true});
      }
    },

    //# Page callback, open remote and clear content.
    remotePage() {
      this.toggleRemote('auto');
      return App.regionContent.empty();
    },

    //# The input binds
    keyBind(e) {

      // Get settings
      const kodiControl = config.getLocal('keyboardControl') === 'kodi';
      const remotePage = $('body').hasClass('page-remote');

      //# Don't do anything if forms in use or if we have a local only setting
      if ($(e.target).is("input, textarea, select")) {
        return;
      }

      //# Don't do anything for white listed commands like CTRL, ALT, SHIFT, etc
      const whiteListCommands = [17, 16, 91, 18, 70];
      if (helpers.global.inArray(e.which, whiteListCommands)) {
        return;
      }

      // If no Kodi control and not on the remote page
      if (!kodiControl && !remotePage) {
        return;
      }

      // If all keyboard controls are for kodi or on the remote page
      if (kodiControl || remotePage) {
        e.preventDefault();
      }

      //# Get stateObj - consider changing this to be current and work with local too?
      const stateObj = App.request("state:kodi");

      //# Respond to key code
      switch (e.which) {
        case 37: case 72: // left, h
          return this.doInput("Left");
        case 38: case 75: // up, k
          return this.doInput("Up");
        case 39: case 76: // right, l
          return this.doInput("Right");
        case 40: case 74: // down, j
          return this.doInput("Down");
        case 8: // backspace
          return this.doInput("Back");
        case 13: // enter
          return this.doInput("Select");
        case 67: // c (context)
          return this.doInput("ContextMenu");
        case 107: case 187: case 61: // + (vol up)
          var vol = stateObj.getState('volume') + 5;
          return this.appController().setVolume(((vol > 100 ? 100 : Math.ceil(vol))));
        case 109: case 189: case 173: // - (vol down)
          vol = stateObj.getState('volume') - 5;
          return this.appController().setVolume(((vol < 0 ? 0 : Math.ceil(vol))));
        case 77: // m (mute)
          return this.appController().toggleMute();
        case 32: // spacebar (play/pause)
          return this.doCommand("PlayPause", "toggle");
        case 88: // x (stop)
          return this.doCommand("Stop");
        case 84: // t (toggle subtitles)
          return this.doAction("showsubtitles");
        case 9: // tab (close osd)
          return this.doAction("close");
        case 190: // > (next)
          return this.doCommand("GoTo", "next");
        case 188: // < (prev)
          return this.doCommand("GoTo", "previous");
        case 220: case 160: // Backslash, ^ (firefox) (fullscreen)
          return this.doAction("fullscreen");
        case 79: // o (osd)
          return this.doAction("osd");
        default:
      }
    } // return everything else here
  };


  App.commands.setHandler("input:textbox", msg => App.execute("ui:textinput:show", "Input required", {msg}, function(text) {
    API.inputController().sendText(text);
    return App.execute("notification:show", t.gettext('Sent text') + ' "' + text + '" ' + t.gettext('to Kodi'));
  }));

  App.commands.setHandler("input:textbox:close", () => App.execute("ui:modal:close"));

  App.commands.setHandler("input:send", action => API.doInput(action));

  App.commands.setHandler("input:remote:toggle", () => API.toggleRemote());

  App.commands.setHandler("input:action", action => API.doAction(action));

  App.commands.setHandler("input:resume", function(model, idKey) {
    const controller = new InputApp.Resume.Controller();
    return controller.resumePlay(model, idKey);
  });

  //# Startup tasks.
  App.addInitializer(function() {

    //# Render remote
    const controller = new InputApp.Remote.Controller();

    //# Bind to the keyboard inputs
    return API.initKeyBind();
  });

  //# Start the router.
  return App.on("before:start", () => new InputApp.Router({
    controller: API}));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("InputApp.Remote", function(Remote, App, Backbone, Marionette, $, _) {

  return Remote.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      //# Watch the shell and render when ready.
      return App.vent.on("shell:ready", options => {
        return this.getRemote();
      });
    }

    getRemote() {
      const view = new Remote.Control();
      this.listenTo(view, "remote:input", type => App.execute("input:send", type));
      this.listenTo(view, "remote:player", type => App.request('command:kodi:player', type, []));
      this.listenTo(view, "remote:info", function() {
        // If playing show osd
        if (App.request("state:kodi").isPlaying()) {
          return App.execute('input:action', 'osd');
        } else {
          return App.execute("input:send", 'Info');
        }
      });
      this.listenTo(view, "remote:power", () => {
        return this.getShutdownMenu();
      });
      App.regionRemote.show(view);

      //# Change the fanart when the state changes.
      return App.vent.on("state:changed", function(state) {
        const stateObj = App.request("state:current");
        if (stateObj.isPlayingItemChanged()) {
          const playingItem = stateObj.getPlaying('item');
          const fanart = App.request("images:path:get", playingItem.fanart, 'fanart');
          return $('#remote-background').css('background-image', 'url(' + playingItem.fanart + ')');
        }
      });
    }

    getShutdownMenu() {
      const system = App.request("command:kodi:controller", 'auto', 'System');
      return system.getProperties(function(props) {
        const actions = [];
        const optionalActions = ['shutdown', 'reboot', 'suspend', 'hibernate'];
        actions.push({id: 'quit', title: 'Quit Kodi'});
        for (var action of optionalActions) {
          var prop = 'can' + action;
          if (props[prop]) {
            actions.push({id: action, title: action});
          }
        }
        // Build modal with options
        const model = new Backbone.Model({id: 1, actions});
        const view = new Remote.System({model});
        const $content = view.render().$el;
        // Open modal and bind actions
        App.execute("ui:modal:show", tr('Shutdown menu'), $content, '', false, 'system');
        return App.listenTo(view, 'system:action', action => {
          switch (action) {
            case 'quit':
              App.request("command:kodi:controller", 'auto', 'Application').quit();
              break;
            case 'shutdown':
              system.shutdown();
              break;
            case 'reboot':
              system.reboot();
              break;
            case 'suspend':
              system.suspend();
              break;
            case 'hibernate':
              system.hibernate();
              break;
            default:
          }
              // nothing
          return App.execute("ui:modal:close");
        });
      });
    }
  };
});



;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("InputApp.Remote", function(Remote, App, Backbone, Marionette, $, _) {

  let Cls = (Remote.Control = class Control extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/input/remote/remote_control';
      this.prototype.events = {
        'click .input-button': 'inputClick',
        'click .player-button': 'playerClick',
        'click .close-remote': 'closeRemote'
      };
      this.prototype.triggers = {
        'click .power-button': 'remote:power',
        'click .info-button': 'remote:info'
      };
  
      Remote.Landing = class Landing extends App.Views.ItemView {};
    }

    inputClick(e) {
      const type = $(e.target).data('type');
      return this.trigger('remote:input', type);
    }

    playerClick(e) {
      const type = $(e.target).data('type');
      return this.trigger('remote:player', type);
    }

    closeRemote(e) {
      return App.execute("input:remote:toggle");
    }
  });
  Cls.initClass();


  return (function() {
    Cls = (Remote.System = class System extends App.Views.ItemView {
      static initClass() {
        this.prototype.template = 'apps/input/remote/system';
        this.prototype.className = 'system-menu';
        this.prototype.events =
          {'click li': 'doAction'};
      }
      doAction(e) {
        const action = $(e.target).data('action');
        return this.trigger('system:action', action);
      }
    });
    Cls.initClass();
    return Cls;
  })();
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("InputApp.Resume", (Resume, App, Backbone, Marionette, $, _) => Resume.Controller = class Controller extends App.Controllers.Base {

  //# Ask to resume playback if the model has a resume position
  //# Currently only supports Kodi playback
  resumePlay(model, idKey) {
    const stateObj = App.request("state:current");
    const title = t.gettext('Resume playback');
    const resume = model.get('resume');
    let percent = 0;
    const options = [];

    // If resume position position
    if ((parseInt(resume.position) > 0) && (stateObj.getPlayer() === 'kodi')) {
      // Get percent
      percent = helpers.global.getPercent(resume.position, resume.total);

      // Build strings
      const time_string = helpers.global.formatTime(helpers.global.secToTime(resume.position));
      const complete_string = helpers.global.round(percent, 0) + '% ' + t.gettext('complete');
      const resume_string = t.gettext('Resume from') + ' <strong>' + time_string + '</strong> <small>' + complete_string + '</small>';
      const start_string = t.gettext('Start from the beginning');

      // build options as an array of jQuery objects
      const items = [{title: resume_string, percent}, {title: start_string, percent: 0}];
      for (var item of items) {
        var $el = $('<span>')
        .attr('data-percent', item.percent)
        .html(item.title)
        .click(function(e){
          // Callback for option click
          return App.execute("command:video:play", model, idKey, $(this).data('percent'));
        });
        options.push($el);
      }

      // Open options in a modal
      return App.execute("ui:modal:options", title, options);
    } else {
      // No resume point or resume is 0%
      return App.execute("command:video:play", model, idKey, 0);
    }
  }

  initialize() {}
});
      // Something.
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// Controller for the API Browser.
//
// An app that allows you to get all the methods from the api
// and execute them
//
// @param [Object] This app object
// @param [Object] The full application object
// @param [Object] Backbone
// @param [Object] Marionette
// @param [Object] jQuery
// @param [Object] lodash (underscore)
//
this.Kodi.module("LabApp.apiBrowser", function(apiBrowser, App, Backbone, Marionette, $, _) {

  // Main controller
  return apiBrowser.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      const collection = App.request("introspect:entities");
      return App.execute("when:entity:fetched", collection, () => {
        collection.dictionary = App.request("introspect:dictionary");

        this.layout = this.getLayoutView(collection);

        this.listenTo(this.layout, "show", () => {
          this.renderList(collection);
          if (this.options.method) {
            return this.renderPage(this.options.method, collection);
          } else {
            return this.renderLanding();
          }
        });

        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new apiBrowser.Layout({
        collection});
    }

    renderList(collection) {
      const view = new apiBrowser.apiMethods({
        collection});
      this.listenTo(view, 'childview:lab:apibrowser:method:view', item => {
        return this.renderPage(item.model.get('id'), collection);
      });
      return this.layout.regionSidebarFirst.show(view);
    }

    renderPage(id, collection) {
      const model = App.request("introspect:entity", id, collection);
      const pageView = new apiBrowser.apiMethodPage({
        model});
      helpers.debug.msg(`Params/Returns for ${model.get('method')}:`, 'info', [model.get('params'), model.get('returns')]);
      this.listenTo(pageView, 'lab:apibrowser:execute', item => {
        const input = $('.api-method--params').val();
        const params = JSON.parse(input);
        const method = item.model.get('method');

        // Notify
        helpers.debug.msg(`Parameters for: ${method}`, 'info', params);

        // Execute the method
        const api = App.request("command:kodi:controller", "auto", "Commander");
        return api.singleCommand(method, params, response => {
          helpers.debug.msg(`Response for: ${method}`, 'info', response);
          const output = prettyPrint(response);
          return $('#api-result').html(output).prepend($('<h3>Response (check the console for more)</h3>'));
        });
      });

      App.navigate(`lab/api-browser/${model.get('method')}`);
      return this.layout.regionContent.show(pageView);
    }

    renderLanding() {
      const view = new apiBrowser.apiBrowserLanding();
      return this.layout.regionContent.show(view);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// View for the API Browser.
//
// @param [Object] This app object
// @param [Object] The full application object
// @param [Object] Backbone
// @param [Object] Marionette
// @param [Object] jQuery
// @param [Object] lodash (underscore)
//
this.Kodi.module("LabApp.apiBrowser", function(apiBrowser, App, Backbone, Marionette, $, _) {

  let Cls = (apiBrowser.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "api-browser--page page-wrapper";
    }
  });
  Cls.initClass();

  // A single api method item
  Cls = (apiBrowser.apiMethodItem = class apiMethodItem extends App.Views.ItemView {
    static initClass() {
      this.prototype.className = "api-browser--method";
      this.prototype.template = 'apps/lab/apiBrowser/api_method_item';
      this.prototype.tagName = "li";
      this.prototype.triggers =
        {'click .api-method--item' : 'lab:apibrowser:method:view'};
    }
  });
  Cls.initClass();

  // List of api methods
  Cls = (apiBrowser.apiMethods = class apiMethods extends App.Views.CompositeView {
    static initClass() {
      this.prototype.template = 'apps/lab/apiBrowser/api_method_list';
      this.prototype.childView = apiBrowser.apiMethodItem;
      this.prototype.childViewContainer = 'ul.items';
      this.prototype.tagName = "div";
      this.prototype.className = "api-browser--methods";
    }
    onRender() {
      return $('#api-search', this.$el).filterList({
        items: '.api-browser--methods .api-browser--method',
        textSelector: '.method'
      });
    }
  });
  Cls.initClass();

  // A single api page
  Cls = (apiBrowser.apiMethodPage = class apiMethodPage extends App.Views.ItemView {
    static initClass() {
      this.prototype.className = "api-browser--page";
      this.prototype.template = 'apps/lab/apiBrowser/api_method_page';
      this.prototype.tagName = "div";
      this.prototype.triggers =
        {'click #send-command' : 'lab:apibrowser:execute'};
      this.prototype.regions =
        {'apiResult' : '#api-result'};
    }
    onShow() {
      $('.api-method--params', this.$el).html(prettyPrint(this.model.get('params')));
      if (this.model.get('type') === 'method') {
        return $('.api-method--return', this.$el).html(prettyPrint(this.model.get('returns')));
      }
    }
  });
  Cls.initClass();

  // Api browser landing (home)
  return (function() {
    Cls = (apiBrowser.apiBrowserLanding = class apiBrowserLanding extends App.Views.ItemView {
      static initClass() {
        this.prototype.className = "api-browser--landing";
        this.prototype.template = 'apps/lab/apiBrowser/api_browser_landing';
        this.prototype.tagName = "div";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("LabApp.IconBrowser", (lab, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (lab.IconsPage = class IconsPage extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/lab/iconBrowser/icon_browser_page';
      this.prototype.tagName = "div";
      this.prototype.className = "icon-browser page";
    }
    onRender() {
      return (() => {
        const result = [];
        for (var type of ['material', 'custom']) {
          var $ctx = $('#icons-' + type, this.$el);
          var set = type + 'Icons';
          result.push((() => {
            const result1 = [];
            for (var icoClass in this.options[set]) {
              var name = this.options[set][icoClass];
              var $ico = $('<li><i class="' + icoClass + '"></i><span>' + name + '</span><small>' + icoClass + '</small></li>');
              result1.push($ctx.append($ico));
            }
            return result1;
          })());
        }
        return result;
      })();
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// View for the Lab.
//
// @param [Object] This app object
// @param [Object] The full application object
// @param [Object] Backbone
// @param [Object] Marionette
// @param [Object] jQuery
// @param [Object] lodash (underscore)
//
this.Kodi.module("LabApp.lab", function(lab, App, Backbone, Marionette, $, _) {

  // A single lab item
  let Cls = (lab.labItem = class labItem extends App.Views.ItemView {
    static initClass() {
      this.prototype.className = "lab--item";
      this.prototype.template = 'apps/lab/lab/lab_item';
      this.prototype.tagName = "div";
    }
  });
  Cls.initClass();

  // List of lab items
  return (function() {
    Cls = (lab.labItems = class labItems extends App.Views.CollectionView {
      static initClass() {
        this.prototype.tagName = "div";
        this.prototype.className = "lab--items page";
        this.prototype.childView = lab.labItem;
      }
      onRender() {
        this.$el.prepend($('<h3>').text( t.gettext('Experimental code, use at own risk') ));
        this.$el.prepend($('<h2>').text( t.gettext('The lab') ));
        return this.$el.addClass('page-secondary');
      }
    });
    Cls.initClass();
    return Cls;
  })();
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
// Lab App handles new experimental features.
//
// Each sub module should have its own folder with controller, view, etc.
// Global Lab features here.
//
// @param [Object] This app object
// @param [Object] The full application object
// @param [Object] Backbone
// @param [Object] Marionette
// @param [Object] jQuery
// @param [Object] lodash (underscore)
//
this.Kodi.module("LabApp", function(LabApp, App, Backbone, Marionette, $, _) {

  // Create our LabApp router.
  const Cls = (LabApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "lab" : "labLanding",
        "lab/api-browser"         : "apiBrowser",
        "lab/api-browser/:method" : "apiBrowser",
        "lab/screenshot"          : "screenShot",
        "lab/icon-browser"        : "iconBrowser"
      };
    }
  });
  Cls.initClass();

  // Lab API controller.
  const API = {

    labLanding() {
      const view = new LabApp.lab.labItems({
        collection: new App.Entities.NavMainCollection(this.labItems())});
      return App.regionContent.show(view);
    },

    // TODO Make dynamic, some sort of hook or registry.
    labItems() {
      return [
        {
          title: 'API browser',
          description: 'Execute any API command.',
          path: 'lab/api-browser'
        },
        {
          title: 'Screenshot',
          description: 'Take a screenshot of Kodi right now.',
          path: 'lab/screenshot'
        },
        {
          title: 'Icon browser',
          description: 'View all the icons available to Chorus.',
          path: 'lab/icon-browser'
        }
      ];
    },

    // Open the api explorer.
    apiBrowser(method = false){
      return new LabApp.apiBrowser.Controller({
        method});
    },

    screenShot() {
      App.execute("input:action", 'screenshot');
      App.execute("notification:show", t.gettext("Screenshot saved to your screenshots folder"));
      return App.navigate("#lab", {trigger: true});
    },

    iconBrowser() {
      return $.getJSON('lib/icons/mdi.json', mdiIcons => {
        return $.getJSON('lib/icons/icomoon.json', customIcons => {
          console.log(mdiIcons, customIcons);
          const view = new LabApp.IconBrowser.IconsPage({
            materialIcons: mdiIcons,
            customIcons
          });
          return App.regionContent.show(view);
        });
      });
    }
  };

  return App.on("before:start", () => new LabApp.Router({
    controller: API}));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("LandingApp", function(LandingApp, App, Backbone, Marionette, $, _) {

  const Cls = (LandingApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "music"               : "landingPage",
        "music/top"           : "landingPage",
        "movies/recent"       : "landingPage",
        "tvshows/recent"      : "landingPage",
        "music/genre/:filter" : "filteredPage"
      };
    }
  });
  Cls.initClass();

  var API = {

    //# This defines what we will see on each landing page
    //# Example of a complex filter using rules
    //# {"and": [{'operator': 'is', 'field': 'playcount', 'value': '0'}, {'operator': 'is', 'field': 'year', 'value': '2015'}]}
    landingSettings: {
      music: {
        subnavId: 'music',
        sections: [
          {
            title: 'Recently added albums',
            entity: 'album',
            sort: 'dateadded',
            order: 'descending',
            limit: 14,
            moreLink: 'music/albums?sort=dateadded&order=desc'
          },
          {
            title: 'Recently played albums',
            entity: 'album',
            sort: 'lastplayed',
            order: 'descending',
            limit: 14
          },
          {
            title: 'Random albums',
            entity: 'album',
            sort: 'random',
            order: 'descending',
            limit: 14,
            moreLink: 'music/albums?sort=random'
          }
        ]
      },
      musictop: {
        subnavId: 'music',
        sections: [
          {
            title: 'Top Albums',
            entity: 'album',
            sort: 'playcount',
            order: 'descending',
            limit: 56,
            filter: {'operator': 'greaterthan', 'field': 'playcount', 'value': '0'}
          },
          {
            title: 'Top Songs',
            entity: 'song',
            sort: 'playcount',
            order: 'descending',
            limit: 100,
            filter: {'operator': 'greaterthan', 'field': 'playcount', 'value': '0'}
          }
        ]
      },
      moviesrecent: {
        subnavId: 'movies/recent',
        sections: [
          {
            title: 'Continue watching',
            entity: 'movie',
            sort: 'lastplayed',
            order: 'descending',
            limit: 14,
            filter: {'operator': 'true', 'field': 'inprogress', 'value': ''},
            moreLink: 'movies?sort=dateadded&order=desc&inprogress=in progress'
          },
          {
            title: 'Recently added',
            entity: 'movie',
            sort: 'dateadded',
            order: 'descending',
            limit: 14,
            filter: {'operator': 'is', 'field': 'playcount', 'value': '0'},
            moreLink: 'movies?sort=dateadded&order=desc&unwatched=unwatched'
          },
          {
            title: 'Random movies',
            entity: 'movie',
            sort: 'random',
            order: 'descending',
            limit: 14,
            moreLink: 'movies?sort=random'
          }
        ]
      },
      tvshowsrecent: {
        subnavId: 'tvshows/recent',
        sections: [
          {
            title: 'Continue watching',
            entity: 'tvshow',
            sort: 'lastplayed',
            order: 'descending',
            limit: 14,
            filter: {'operator': 'true', 'field': 'inprogress', 'value': ''},
            moreLink: 'tvshows?sort=dateadded&order=desc&inprogress=in progress',
            preventSelect: true
          },
          {
            title: 'Recently added',
            entity: 'episode',
            sort: 'dateadded',
            order: 'descending',
            limit: 12,
            filter: {'operator': 'is', 'field': 'playcount', 'value': '0'}
          }
        ]
      }
    },

    //# Filtered sections require an argument passed and are used for pages such as genere
    //# Key name should be "arg0 + arg1", filter should be "arg2"
    //# Filter gets replaced in sections[i].filter.value and prepended to moreLink
    filteredSettings: {
      musicgenre: {
        subnavId: 'music',
        sections: [
          {
            title: '%1$s Artists',
            entity: 'artist',
            sort: 'title',
            order: 'ascending',
            limit: 500,
            filter: {'operator': 'is', 'field': 'genre', 'value': '[FILTER]'}
          },
          {
            title: '%1$s Albums',
            entity: 'album',
            sort: 'title',
            order: 'ascending',
            limit: 500,
            filter: {'operator': 'is', 'field': 'genre', 'value': '[FILTER]'}
          },
          {
            title: '%1$s Songs',
            entity: 'song',
            sort: 'title',
            order: 'ascending',
            limit: 1000,
            filter: {'operator': 'is', 'field': 'genre', 'value': '[FILTER]'}
          }
        ]
      }
    },


    landingPage() {
      const type = helpers.url.arg(0) + helpers.url.arg(1);
      const settings = API.landingSettings[type];
      return new LandingApp.Show.Controller({
        settings,
        filter: false
      });
    },

    filteredPage(filter) {
      const type = helpers.url.arg(0) + helpers.url.arg(1);
      const settings = API.filteredSettings[type];
      return new LandingApp.Show.Controller({
        settings,
        filter: decodeURIComponent(filter)
      });
    }
  };


  //# Register controller
  return App.on("before:start", () => new LandingApp.Router({
    controller: API}));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("LandingApp.Show", function(Show, App, Backbone, Marionette, $, _) {


  return Show.Controller = class Controller extends App.Controllers.Base {

    constructor(...args) {
      super(...args);
      this.getSections = this.getSections.bind(this);
      this.renderSection = this.renderSection.bind(this);
    }

    initialize(options) {
      this.fanarts = [];
      this.rendered = 0;
      this.settings = options.settings;
      this.layout = this.getLayoutView();
      $('body').addClass('landing-loading');
      this.listenTo(this.layout, "show", () => {
        this.content = this.getContentView();
        this.listenTo(this.content, "show", () => {
          window.scroll(0, 350);
          this.getSections(this.settings.sections);
          return this.getSubNav(this.settings.subnavId);
        });
        return this.layout.regionContent.show(this.content);
      });

      return App.regionContent.show(this.layout);
    }

    getLayoutView() {
      return new Show.Layout();
    }

    getContentView() {
      return new Show.Page();
    }

    getSubNav(subnavId) {
      const subNav = App.request("navMain:children:show", subnavId, 'Sections');
      return this.layout.regionSidebarFirst.show(subNav);
    }

    getSections(sections) {
      return (() => {
        const result = [];
        for (var i in sections) {
          var section = sections[i];
          section.idx = parseInt(i) + 1;
          result.push(this.getSection(section));
        }
        return result;
      })();
    }

    getSection(section) {
      section = this.addFilterValue(section);
      const opts = {
        sort: {method: section.sort, order: section.order},
        limit: {start: 0, end: section.limit},
        addFields: ['fanart'],
        cache: false,
        success: collection => {
          this.rendered++;
          if (collection.length > 0) {
            this.renderSection(section, collection);
            return this.getFanArts(collection);
          }
        }
      };
      if (section.filter) {
        opts.filter = section.filter;
      }
      return App.request(`${section.entity}:entities`, opts);
    }

    renderSection(section, collection) {
      const view = App.request(`${section.entity}:list:view`, collection, true);
      const setView = new Show.ListSet({
        section,
        filter: this.getOption('filter')
      });
      App.listenTo(setView, "show", () => {
        return setView.regionCollection.show(view);
      });
      App.listenTo(setView, 'landing:set:more', viewItem => App.navigate(viewItem.model.get('section').moreLink, {trigger: true}));
      if (this.content[`regionSection${section.idx}`]) {
        return this.content[`regionSection${section.idx}`].show(setView);
      }
    }

    addFilterValue(section) {
      const filterVal = this.getOption('filter');
      if (filterVal !== false) {
        if (section.filter && section.filter.value) {
          // TODO: Deal with complex nested rules that us 'and' or 'or'
          section.filter.value = filterVal;
        }
      }
      return section;
    }

    getFanArts(collection) {
      const $hero = $("#landing-hero");
      for (var item of collection.toJSON()) {
        if (item.fanart && (item.fanart !== '')) {
          this.fanarts.push(item);
        }
      }
      if ($hero.is(':visible') && (this.rendered === this.settings.sections.length) && (this.fanarts.length > 0)) {
        const randomModel = this.fanarts[Math.floor(Math.random() * this.fanarts.length)];
        $hero
          .css('background-image', 'url(' + randomModel.fanart + ')')
          .attr('href', '#' + randomModel.url).attr('title', randomModel.title);
        return $('body').removeClass('landing-loading');
      }
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("LandingApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  let Cls = (Show.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "landing-page";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Show.Page = class Page extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = "apps/landing/show/landing_page";
        this.prototype.className = "landing-content";
        this.prototype.regions = {
          regionHero: '#landing-hero',
          regionSection1: '#landing-section-1',
          regionSection2: '#landing-section-2',
          regionSection3: '#landing-section-3',
          regionSection4: '#landing-section-4',
          regionSection5: '#landing-section-5',
          regionSection6: '#landing-section-6'
        };
  
        (function() {
          Cls = (Show.ListSet = class ListSet extends App.Views.SetLayoutView {
            static initClass() {
              this.prototype.className = 'landing-set';
              this.prototype.triggers =
                {'click .more'     : 'landing:set:more'};
            }
            initialize() {
              this.setOptions();
              return this.createModel();
            }
            setOptions() {
              this.options.menu = {};
              if ((this.options.filter !== false) && this.options.section.title) {
                this.options.title = t.sprintf(tr(this.options.section.title), this.options.filter);
              } else if (this.options.section.title) {
                this.options.title = tr(this.options.section.title);
              }
              if (this.options.section.moreLink) {
                this.options.menu.more = tr('More like this');
              }
              if (this.options.section.preventSelect) {
                return this.options.noMenuDefault = true;
              }
            }
          });
          Cls.initClass();
          return Cls;
        })();
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("LoadingApp", function(LoadingApp, App, Backbone, Marionette, $, _) {

  const API = {

    getLoaderView(msgTextHtml = 'Just a sec...', inline = false) {
      return new LoadingApp.Show.Page({
        textHtml: msgTextHtml,
        // Inline is used when the loader is not full page
        inline
      });
    }
  };

  App.commands.setHandler("loading:show:view", function(region, msgTextHtml) {
    const view = API.getLoaderView(msgTextHtml);
    return region.show(view);
  });

  //# Replace whole page with loader.
  App.commands.setHandler("loading:show:page", () => App.execute("loading:show:view", App.regionContent));

  //# Get a loader view
  return App.reqres.setHandler("loading:get:view", (msgText, inline = true) => API.getLoaderView(msgText, inline));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("LoadingApp.Show", (Show, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Show.Page = class Page extends Backbone.Marionette.ItemView {
    static initClass() {
      this.prototype.template = "apps/loading/show/loading_page";
    }
    onRender() {
      return this.$el.find('h2').html(this.options.textHtml);
    }
    attributes() {
      if (this.options.inline) {
        return {
          class: 'loader-inline'
        };
      }
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("localPlaylistApp.List", function(List, App, Backbone, Marionette, $, _) {

  return List.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {
      const {
        id
      } = options;
      const playlists = App.request("localplaylist:entities");
      this.layout = this.getLayoutView(playlists);

      this.listenTo(this.layout, "show", () => {
        this.getListsView(playlists);
        return this.getItems(id);
      });

      return App.regionContent.show(this.layout);
    }

    //# Get the layout
    getLayoutView(collection) {
      return new List.ListLayout({
        collection});
    }

    //# Get the sidebar list
    getListsView(playlists) {
      this.sideLayout = new List.SideLayout();
      const view = new List.Lists({
        collection: playlists});
      App.listenTo(this.sideLayout, "show", () => {
        if (playlists.length > 0) {
          return this.sideLayout.regionLists.show(view);
        }
      });
      App.listenTo(this.sideLayout, 'lists:new', () => App.execute("localplaylist:newlist"));
      return this.layout.regionSidebarFirst.show(this.sideLayout);
    }

    //# Get items then render
    getItems(id) {
      const playlist = App.request("localplaylist:entity", id);
      const collection = App.request("localplaylist:item:entities", id);
      this.itemLayout = new List.Layout({
        list: playlist});
      App.listenTo(this.itemLayout, "show", () => {
        if (collection.length > 0) {
          const media = playlist.get('media');
          const view = App.request(`${media}:list:view`, collection, true);
          this.itemLayout.regionListItems.show(view);
          this.bindRemove(id, view);
          return this.initSortable(id, view);
        }
      });
      this.bindLayout(id);
      return this.layout.regionContent.show(this.itemLayout);
    }

    //# Binds to layout
    bindLayout(id) {
      const collection = App.request("localplaylist:item:entities", id);
      App.listenTo(this.itemLayout, 'list:clear', function() {
        App.execute("localplaylist:clear:entities", id);
        return App.execute("localplaylist:reload", id);
      });
      App.listenTo(this.itemLayout, 'list:delete', function() {
        App.execute("localplaylist:clear:entities", id);
        App.execute("localplaylist:remove:entity", id);
        return App.navigate("playlists", {trigger: true});
    });
      App.listenTo(this.itemLayout, 'list:rename', () => App.execute("localplaylist:rename", id));
      App.listenTo(this.itemLayout, 'list:play', function() {
        const kodiPlaylist = App.request("command:kodi:controller", 'audio', 'PlayList');
        return kodiPlaylist.playCollection(collection);
      });
      App.listenTo(this.itemLayout, 'list:localplay', function() {
        const localPlaylist = App.request("command:local:controller", 'audio', 'PlayList');
        return localPlaylist.playCollection(collection);
      });
      return App.listenTo(this.itemLayout, 'list:export', () => App.execute("playlist:export", collection));
    }

    //# Binds to items
    bindRemove(id, view) {
      return App.listenTo(view, 'childview:song:remove', (parent, viewItem) => {
        // Update the order, exclude removed item
        return this.updateOrder(id, view.$el, [parent.$el.data('id')]);
    });
    }

    //# Bind sortable
    initSortable(id, view) {
      const self = this;
      return $('tbody', view.$el).sortable({
        onEnd: e => {
          return self.updateOrder(id, this.el);
        }
      });
    }

    //# Rebuild the order of items after sort or item removal, excluded items
    //# will get removed from the collection
    updateOrder(playlistId, $ctx, exclude = []) {
      const order = [];
      let pos = 0;
      $('tr', $ctx).each(function(i, d) {
        const id = $(d).data('id');
        if (helpers.global.inArray(id, exclude)) {
          return $(d).remove();
        } else {
          order.push(id);
          $(d).data('id', pos);
          return pos++;
        }
      });
      return App.request("localplaylist:item:updateorder", playlistId, order);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("localPlaylistApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "local-playlist-list";
    }
  });
  Cls.initClass();

  Cls = (List.SideLayout = class SideLayout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/localPlaylist/list/playlist_sidebar_layout';
      this.prototype.tagName = 'div';
      this.prototype.className = 'side-inner';
      this.prototype.regions =
        {regionLists: '.current-lists'};
      this.prototype.triggers =
        {'click .new-list' : 'lists:new'};
    }
  });
  Cls.initClass();

  Cls = (List.List = class List extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/localPlaylist/list/playlist';
      this.prototype.tagName = "li";
    }
    initialize() {
      const path = helpers.url.get('playlist', this.model.get('id'));
      this.model.set({title: this.model.get('name'), path});
      if (path === helpers.url.path()) {
        return this.model.set({active: true});
      }
    }
  });
  Cls.initClass();

  Cls = (List.Lists = class Lists extends App.Views.CompositeView {
    static initClass() {
      this.prototype.template = 'apps/localPlaylist/list/playlist_list';
      this.prototype.childView = List.List;
      this.prototype.tagName = "div";
      this.prototype.childViewContainer = 'ul.lists';
    }
    onRender() {
      return $('h3', this.$el).text( t.gettext('Playlists') );
    }
  });
  Cls.initClass();

  Cls = (List.Selection = class Selection extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/localPlaylist/list/playlist';
      this.prototype.tagName = "li";
      this.prototype.triggers =
        {'click .item' : 'item:selected'};
    }
    initialize() {
      return this.model.set({title: this.model.get('name')});
    }
  });
  Cls.initClass();

  Cls = (List.SelectionList = class SelectionList extends App.Views.CompositeView {
    static initClass() {
      this.prototype.template = 'apps/localPlaylist/list/playlist_list';
      this.prototype.childView = List.Selection;
      this.prototype.tagName = "div";
      this.prototype.className = 'playlist-selection-list';
      this.prototype.childViewContainer = 'ul.lists';
    }
    onRender() {
      return $('h3', this.$el).text( t.gettext('Existing playlists') );
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.Layout = class Layout extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = 'apps/localPlaylist/list/playlist_layout';
        this.prototype.tagName = 'div';
        this.prototype.className = 'local-playlist';
        this.prototype.regions =
          {regionListItems: '.item-container'};
        this.prototype.triggers = {
          'click .local-playlist-header .rename' : 'list:rename',
          'click .local-playlist-header .clear' : 'list:clear',
          'click .local-playlist-header .delete' : 'list:delete',
          'click .local-playlist-header .play' : 'list:play',
          'click .local-playlist-header .localplay' : 'list:localplay',
          'click .local-playlist-header .export' : 'list:export'
        };
      }
      onRender() {
        if (this.options && this.options.list) {
          return $('h2', this.$el).text( this.options.list.get('name') );
        }
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("localPlaylistApp", function(localPlaylistApp, App, Backbone, Marionette, $, _) {

  const Cls = (localPlaylistApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "playlists"       : "list",
        "playlist/:id"   : "list"
      };
    }
  });
  Cls.initClass();


  /*
    Main functionality.
  */

  var API = {

    playlistNameMsg: 'Give your playlist a name',

    //# if no id, find the first list, else id is 0
    list(id) {
      if (id === null) {
        const lists = App.request("localplaylist:entities");
        const items = lists.getRawCollection();
        if (_.isEmpty(lists)) {
          id = 0;
        } else {
          const item = _.min(items, list => list.id);
          ({
            id
          } = item);
          App.navigate(helpers.url.get('playlist', id));
        }
      }
      return new localPlaylistApp.List.Controller({
        id});
    },

    //# Wrapper for adding to a new or existing list.
    addToList(entityType, id) {
      const playlists = App.request("localplaylist:entities");
      if (!playlists || (playlists.length === 0)) {
        return this.createNewList(entityType, id);
      } else {
        const view = new localPlaylistApp.List.SelectionList({
          collection: playlists});
        const $content = view.render().$el;
        //# New list button
        const $new = $('<button>').text( tr('Create a new list') ).addClass('btn btn-primary');
        $new.on('click', () => {
          return _.defer(() => API.createNewList(entityType, id));
        });
        //# Show the list of playlists.
        App.execute("ui:modal:show", tr('Add to playlist'), $content, $new);
        return App.listenTo(view, 'childview:item:selected', (list, item) => {
          return this.addToExistingList(item.model.get('id'), entityType, id);
        });
      }
    },

    //# Add to a known playlist
    addToExistingList(playlistId, entityType, ids) {
      //# Normalise ids is always an array but accepts a single id too
      if (!_.isArray(ids)) {
        ids = [ids];
      }
      if (helpers.global.inArray(entityType, ['albumid', 'artistid', 'songid'])) {
        // Get a custom collection of songs based on type and ids
        return App.request("song:custom:entities", entityType, ids, collection => {
          return this.addCollectionToList(collection, playlistId);
        });
      } else if (entityType === 'playlist') {
        //# Save current audio playlist
        const collection = App.request("playlist:kodi:entities", 'audio');
        return App.execute("when:entity:fetched", collection, () => {
          return this.addCollectionToList(collection, playlistId);
        });
      }
      else {}
    },
        //# TODO: movie/episode.

    //# Add the collection to the list
    addCollectionToList(collection, playlistId, notify = true) {
      App.request("localplaylist:item:add:entities", playlistId, collection);
      App.execute("ui:modal:close");
      if (notify === true) {
        return App.execute("notification:show", tr("Added to your playlist"));
      }
    },

    //# Create a new list
    createNewList(entityType, id) {
      return App.execute("ui:textinput:show", tr('Add a new playlist'), {msg: tr(API.playlistNameMsg)}, text => {
        if (text !== '') {
          const playlistId = App.request("localplaylist:add:entity", text, 'song');
          return this.addToExistingList(playlistId, entityType, id);
        }
      }
      , false);
    },

    //# Create a new empty list.
    createEmptyList() {
      return App.execute("ui:textinput:show", tr('Add a new playlist'), {msg: tr(API.playlistNameMsg)}, text => {
        if (text !== '') {
          const playlistId = App.request("localplaylist:add:entity", text, 'song');
          return App.navigate(`playlist/${playlistId}`, {trigger: true});
        }
    });
    },

    //# Rename a playlist.
    rename(id) {
      const listModel = App.request("localplaylist:entity", id);
      return App.execute("ui:textinput:show", tr('Rename playlist'), {msg: tr(API.playlistNameMsg), defaultVal: listModel.get('name')}, text => {
        listModel.set({name: text}).save();
        return API.list(id);
      });
    }
  };


  /*
    Listeners.
  */

  App.commands.setHandler("localplaylist:addentity", (entityType, id) => API.addToList(entityType, id));

  App.commands.setHandler("localplaylist:newlist", () => API.createEmptyList());

  App.commands.setHandler("localplaylist:reload", id => API.list(id));

  App.commands.setHandler("localplaylist:rename", id => API.rename(id));

  /*
    Init the router
  */

  return App.on("before:start", () => new localPlaylistApp.Router({
    controller: API}));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MovieApp.Edit", function(Edit, App, Backbone, Marionette, $, _) {

  return Edit.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      let form;
      this.model = this.getOption('model');

      const options = {
        titleHtml: '<span>' + tr('Edit') + '</span>' + this.model.escape('title'),
        form: this.getStructure(),
        formState: this.model.attributes,
        config: {
          attributes: {class: 'edit-form'},
          editForm: true,
          tabs: true,
          callback: (data, formView) => {
            this.setArt(data);
            return this.saveCallback(data, formView);
          }
        }
      };
      return form = App.request("form:popup:wrapper", options);
    }

    getStructure() {
      return [
        {
          title: 'General',
          id: 'general',
          children:[
            {id: 'title', title: tr('Title'), type: 'textfield'},
            {id: 'plotoutline', title: tr('Tagline'), type: 'textfield'},
            {id: 'plot', title: tr('Plot'), type: 'textarea'},
            {id: 'studio', title: tr('Studio'), type: 'textfield', format: 'array.string'},
            {id: 'year', title: tr('Year'), type: 'number', format: 'integer', attributes: {class: 'half-width', step: 1, min: 1000, max: 9999}},
            {id: 'mpaa', title: tr('Content rating'), type: 'textfield', attributes: {class: 'half-width'}},
            {id: 'rating', title: tr('Rating'), type: 'number', format: 'float', attributes: {class: 'half-width', step: 0.1, min: 0, max: 10}},
            {id: 'imdbnumber', title: tr('IMDb'), type: 'textfield', attributes: {class: 'half-width'}, suffix: '<div class="clearfix"></div>'},
            {id: 'sorttitle', title: tr('Sort title'), type: 'textfield'},
            {id: 'originaltitle', title: tr('Original title'), type: 'textfield'},
          ]
        },
        {
          title: 'Tags',
          id: 'tags',
          children:[
            {id: 'director', title: tr('Directors'), type: 'textfield', format: 'array.string'},
            {id: 'writer', title: tr('Writers'), type: 'textfield', format: 'array.string'},
            {id: 'genre', title: tr('Genres'), type: 'textfield', format: 'array.string'},
            {id: 'country', title: tr('Country'), type: 'textfield', format: 'array.string'},
            {id: 'set', title: tr('Set'), type: 'textfield'},
            {id: 'tag', title: tr('Tags'), type: 'textarea', format: 'array.string'},
          ]
        },
        {
          title: 'Trailer',
          id: 'trailers',
          children:[
            {
              id: 'trailer', title: tr('URL'), type: 'imageselect', attributes: {class: 'fanart-size'},
              description: t.sprintf(tr('This should be the play path for the trailer. Eg. %1$s'), 'plugin://plugin.video.youtube/?action=play_video&videoid=[YOUTUBE_ID]'),
              metadataImageHandler: 'youtube:trailer:entities', metadataLookupField: 'title'
            }
          ]
        },
        {
          title: 'Poster',
          id: 'poster',
          children:[
            {
              id: 'thumbnail', title: tr('URL'), type: 'imageselect', valueProperty: 'thumbnailOriginal', description: tr('Add an image via an external URL'),
              metadataImageHandler: 'themoviedb:movie:image:entities', metadataLookupField: 'imdbnumber'
            }
          ]
        },
        {
          title: 'Background',
          id: 'background',
          children:[
            {
              id: 'fanart', title: tr('URL'), type: 'imageselect', valueProperty: 'fanartOriginal', description: tr('Add an image via an external URL'),
              metadataImageHandler: 'themoviedb:movie:image:entities', metadataLookupField: 'imdbnumber'
            }
          ]
        },
        {
          title: 'Information',
          id: 'info',
          children:[
            {id: 'file', title: tr('File path'), type: 'textarea', attributes: {disabled: 'disabled', cols: 5}, format: 'prevent.submit'},
          ]
        }
      ];
    }

    //# Properly write the art map
    setArt(data) {
      const art = {};
      if ('fanart' in data) {
        art["fanart"] = data.fanart;
      }
      if ('thumbnail' in data) {
        art["poster"] = data.thumbnail;
        delete data.thumbnail;
      }
      return data["art"] = art;
    }

    //# Save the settings to Kodi
    saveCallback(data, formView) {
      const controller = App.request("command:kodi:controller", 'video', 'VideoLibrary');
      return controller.setMovieDetails(this.model.get('id'), data, () => {
        Kodi.vent.trigger('entity:kodi:update', this.model.get('uid'));
        return App.execute("notification:show", t.sprintf(tr("Updated %1$s details"), 'movie'));
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MovieApp.List", function(List, App, Backbone, Marionette, $, _) {

  var API = {

    getMoviesView(collection, set = false) {
      const viewName = set ? 'MoviesSet' : 'Movies';
      const view = new (List[viewName])({
        collection});
      API.bindTriggers(view);
      return view;
    },

    bindTriggers(view) {
      App.listenTo(view, 'childview:movie:play', (parent, viewItem) => App.execute('movie:action', 'play', viewItem));
      App.listenTo(view, 'childview:movie:add', (parent, viewItem) => App.execute('movie:action', 'add', viewItem));
      App.listenTo(view, 'childview:movie:localplay', (parent, viewItem) => App.execute('movie:action', 'localplay', viewItem));
      App.listenTo(view, 'childview:movie:download', (parent, viewItem) => App.execute('movie:action', 'download', viewItem));
      App.listenTo(view, 'childview:movie:watched', (parent, viewItem) => App.execute('movie:action:watched', parent, viewItem));
      return App.listenTo(view, 'childview:movie:edit', (parent, viewItem) => App.execute('movie:action', 'edit', viewItem));
    }
  };

  //# Main controller
  List.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      const collection = App.request("movie:entities");

      return App.execute("when:entity:fetched", collection, () => {

        //# Set available filters
        collection.availableFilters = this.getAvailableFilters();

        //# Top level menu path for filters
        collection.sectionId = 'movies/recent';

        //# If present set initial filter via url
        App.request('filter:init', this.getAvailableFilters());

        this.layout = this.getLayoutView(collection);

        this.listenTo(this.layout, "show", () => {
          this.renderList(collection);
          return this.getFiltersView(collection);
        });

        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new List.ListLayout({
        collection});
    }

    //# Available sort and filter options
    //# See filter_app.js for available options
    getAvailableFilters() {
      return {
        sort: ['title', 'year', 'dateadded', 'rating', 'random'],
        filter: ['year', 'genre', 'writer', 'director', 'cast', 'set', 'unwatched', 'watched', 'inprogress', 'mpaa', 'studio', 'thumbsUp', 'tag']
      };
    }

    //# Apply filter view and provide a handler for applying changes
    getFiltersView(collection) {
      const filters = App.request('filter:show', collection);
      this.layout.regionSidebarFirst.show(filters);
      //# Listen to when the filters change and re-render.
      return this.listenTo(filters, "filter:changed", () => {
        return this.renderList(collection);
      });
    }

    //# Get the list view with filters applied.
    renderList(collection) {
      App.execute("loading:show:view", this.layout.regionContent);
      const filteredCollection = App.request('filter:apply:entities', collection);
      const view = API.getMoviesView(filteredCollection);
      return this.layout.regionContent.show(view);
    }
  };

  //# handler for other modules to get a list view.
  return App.reqres.setHandler("movie:list:view", collection => API.getMoviesView(collection, true));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MovieApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "movie-list with-filters";
    }
  });
  Cls.initClass();

  Cls = (List.MovieTeaser = class MovieTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        "click .play"          : "movie:play",
        "click .watched"       : "movie:watched",
        "click .add"           : "movie:add",
        "click .localplay"     : "movie:localplay",
        "click .download"      : "movie:download",
        "click .edit"          : "movie:edit"
      };
    }
    initialize() {
      super.initialize(...arguments);
      this.setMeta();
      if (this.model != null) {
        return this.model.set( App.request('movie:action:items') );
      }
    }
    attributes() {
      return this.watchedAttributes('card');
    }
    setMeta() {
      if (this.model) {
        return this.model.set({
          labelHtml: this.model.get('label'),
          subtitleHtml: this.themeLink(this.model.get('year'), 'movies?year=' + this.model.get('year'))
        });
      }
    }
  });
  Cls.initClass();

  Cls = (List.Empty = class Empty extends App.Views.EmptyViewResults {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.className = "movie-empty-result";
    }
  });
  Cls.initClass();

  Cls = (List.Movies = class Movies extends App.Views.VirtualListView {
    static initClass() {
      this.prototype.childView = List.MovieTeaser;
      this.prototype.emptyView = List.Empty;
      this.prototype.tagName = "ul";
      this.prototype.className = "card-grid--tall";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.MoviesSet = class MoviesSet extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.MovieTeaser;
        this.prototype.emptyView = List.Empty;
        this.prototype.tagName = "ul";
        this.prototype.className = "card-grid--tall";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MovieApp", function(MovieApp, App, Backbone, Marionette, $, _) {

  const Cls = (MovieApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "movies"    : "list",
        "movie/:id" : "view"
      };
    }
  });
  Cls.initClass();

  const API = {

    list() {
      return new MovieApp.List.Controller();
    },

    view(id) {
      return new MovieApp.Show.Controller({
        id});
    },

    action(op, view) {
      const {
        model
      } = view;
      const playlist = App.request("command:kodi:controller", 'video', 'PlayList');
      const files = App.request("command:kodi:controller", 'video', 'Files');
      const videoLib = App.request("command:kodi:controller", 'video', 'VideoLibrary');
      switch (op) {
        case 'play':
          return App.execute("input:resume", model, 'movieid');
        case 'add':
          return playlist.add('movieid', model.get('movieid'));
        case 'localplay':
          return files.videoStream(model.get('file'), model.get('fanart'));
        case 'download':
          return files.downloadFile(model.get('file'));
        case 'toggleWatched':
          return videoLib.toggleWatched(model, 'auto');
        case 'edit':
          return App.execute('movie:edit', model);
        case 'refresh':
          return helpers.entities.refreshEntity(model, videoLib, 'refreshMovie');
        default:
      }
    }
  };
        //# nothing


  App.reqres.setHandler('movie:action:items', () => ({
    actions: {watched: tr('Watched'), thumbs: tr('Thumbs up')},
    menu: {add: tr('Queue in Kodi'), 'divider-1': '', download: tr('Download'), localplay: tr('Play in browser'), 'divider-2': '', edit: tr('Edit')}
  }));

  App.commands.setHandler('movie:action', (op, view) => API.action(op, view));

  App.commands.setHandler('movie:action:watched', function(parent, viewItem) {
    const op = parent.$el.hasClass('is-watched') ? 'unwatched' : 'watched';
    const progress = op === 'watched' ? 100 : 0;
    parent.$el.toggleClass('is-watched');
    helpers.entities.setProgress(parent.$el, progress);
    helpers.entities.setProgress(parent.$el.closest('.movie-show').find('.region-content-wrapper'), progress);
    return API.action('toggleWatched', viewItem);
  });

  App.commands.setHandler('movie:edit', function(model) {
    const loadedModel = App.request("movie:entity", model.get('id'));
    return App.execute("when:entity:fetched", loadedModel, () => {
      return new MovieApp.Edit.Controller({
        model: loadedModel});
    });
  });


  return App.on("before:start", () => new MovieApp.Router({
    controller: API}));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MovieApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  const API = {

    bindTriggers(view) {
      App.listenTo(view, 'movie:play', viewItem => App.execute('movie:action', 'play', viewItem));
      App.listenTo(view, 'movie:add', viewItem => App.execute('movie:action', 'add', viewItem));
      App.listenTo(view, 'movie:localplay', viewItem => App.execute('movie:action', 'localplay', viewItem));
      App.listenTo(view, 'movie:download', viewItem => App.execute('movie:action', 'download', viewItem));
      App.listenTo(view, 'toggle:watched', viewItem => App.execute('movie:action:watched', viewItem.view, viewItem.view));
      App.listenTo(view, 'movie:refresh', viewItem => App.execute('movie:action', 'refresh', viewItem));
      return App.listenTo(view, 'movie:edit', viewItem => App.execute('movie:edit', viewItem.model));
    },

    moreContent: [
      {
        title: 'More from %1$s',
        filter: 'set',
        key: 'set',
        type: 'string',
        pluck: false
      },
      {
        title: 'More %1$s movies',
        filter: 'genre',
        key: 'genre',
        type: 'array',
        pluck: false
      },
      {
        title: 'More movies starring %1$s',
        filter: 'actor',
        key: 'cast',
        type: 'array',
        pluck: 'name'
      },
      {
        title: 'Other movies released in %1$s',
        filter: 'year',
        key: 'year',
        type: 'string',
        pluck: false
      }
    ]
  };

  return Show.Controller = class Controller extends App.Controllers.Base {

    //# The Movie page.
    initialize(options) {
      const id = parseInt(options.id);
      const movie = App.request("movie:entity", id);
      //# Fetch the movie
      return App.execute("when:entity:fetched", movie, () => {
        //# Get the layout.
        this.layout = this.getLayoutView(movie);
        //# Listen to the show of our layout.
        this.listenTo(this.layout, "show", () => {
          this.getDetailsLayoutView(movie);
          return this.getContentView(movie);
        });
        //# Add the layout to content.
        return App.regionContent.show(this.layout);
      });
    }

    //# Get the base layout
    getLayoutView(movie) {
      return new Show.PageLayout({
        model: movie});
    }

    getContentView(movie) {
      this.contentLayout = new Show.Content({model: movie});
      this.listenTo(this.contentLayout, "movie:youtube", function(view) {
        const trailer = movie.get('mediaTrailer');
        return App.execute("ui:modal:youtube", movie.escape('title') + ' Trailer', trailer.id);
      });
      this.listenTo(this.contentLayout, 'show', () => {
        if (movie.get('cast').length > 0) {
          this.contentLayout.regionCast.show(this.getCast(movie));
        }
        return this.getMoreContent(movie);
      });
      return this.layout.regionContent.show(this.contentLayout);
    }

    getCast(movie) {
      return App.request('cast:list:view', movie.get('cast'), 'movies');
    }


    //# Build the details layout.
    getDetailsLayoutView(movie) {
      const headerLayout = new Show.HeaderLayout({model: movie});
      this.listenTo(headerLayout, "show", () => {
        const teaser = new Show.MovieTeaser({model: movie});
        API.bindTriggers(teaser);
        const detail = new Show.Details({model: movie});
        API.bindTriggers(detail);
        headerLayout.regionSide.show(teaser);
        return headerLayout.regionMeta.show(detail);
      });
      return this.layout.regionHeader.show(headerLayout);
    }

    getMoreContent(movie) {
      let idx = 0;
      return (() => {
        const result = [];
        for (var i in API.moreContent) {
        // Get the correct value to filter by
          var more = API.moreContent[i];
          var filterVal = false;
          if (more.type === 'array') {
            var filterVals = more.pluck ? _.pluck(movie.get(more.key), more.pluck) : movie.get(more.key);
            filterVals = _.shuffle(filterVals.slice(0, 4));
            filterVal = _.first(filterVals);
          } else {
            filterVal = movie.get(more.key);
          }

          // Built req options
          if (filterVal && (filterVal !== '')) {
            idx++;
            var opts = {
              limit: {start: 0, end: 6},
              cache: false,
              sort: {method: 'random', order: 'ascending'},
              filter: {},
              title: t.sprintf(tr(more.title), '<a href="#movies?' + more.key + '=' + _.escape(filterVal) + '">' + _.escape(filterVal) + '</a>'),
              idx
            };
            opts.filter[more.filter] = filterVal;

            // On get results
            opts.success = collection => {
              collection.remove(movie);
              if (collection.length > 0) {
                const view = new Show.Set({
                  set: collection.options.title});
                App.listenTo(view, "show", () => {
                  const listview = App.request("movie:list:view", collection);
                  return view.regionCollection.show(listview);
                });
                return this.contentLayout[`regionMore${collection.options.idx}`].show(view);
              }
            };

            // Fetch
            result.push(App.request("movie:entities", opts));
          } else {
            result.push(undefined);
          }
        }
        return result;
      })();
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MovieApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  let Cls = (Show.PageLayout = class PageLayout extends App.Views.LayoutWithHeaderView {
    static initClass() {
      this.prototype.className = 'movie-show detail-container';
    }
  });
  Cls.initClass();

  Cls = (Show.HeaderLayout = class HeaderLayout extends App.Views.LayoutDetailsHeaderView {
    static initClass() {
      this.prototype.className = 'movie-details';
    }
  });
  Cls.initClass();

  Cls = (Show.Details = class Details extends App.Views.DetailsItem {
    static initClass() {
      this.prototype.template = 'apps/movie/show/details_meta';
      this.prototype.triggers = {
        'click .play': 'movie:play',
        'click .add': 'movie:add',
        'click .stream': 'movie:localplay',
        'click .download': 'movie:download',
        'click .edit': 'movie:edit',
        'click .refresh': 'movie:refresh'
      };
    }
    attributes() {
      return this.watchedAttributes();
    }
  });
  Cls.initClass();

  Cls = (Show.MovieTeaser = class MovieTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.tagName = "div";
      this.prototype.triggers =
        {'click .play': 'movie:play'};
    }
    initialize() {
      return this.model.set({actions: {thumbs: tr('Thumbs up')}});
    }
    attributes() {
      return this.watchedAttributes('card-detail');
    }
  });
  Cls.initClass();

  Cls = (Show.Content = class Content extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/movie/show/content';
      this.prototype.className = "movie-content content-sections";
      this.prototype.triggers =
        {'click .youtube': 'movie:youtube'};
      this.prototype.regions = {
        regionCast: '.region-cast',
        regionMore1: '.region-more-1',
        regionMore2: '.region-more-2',
        regionMore3: '.region-more-3',
        regionMore4: '.region-more-4',
        regionMore5: '.region-more-5'
      };
      this.prototype.modelEvents =
        {'change': 'modelChange'};
    }
    modelChange() {
      this.render();
      return this.trigger('show');
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Show.Set = class Set extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = 'apps/movie/show/set';
        this.prototype.className = 'movie-set';
      }
      onRender() {
        if (this.options && this.options.set) {
            return $('h2.set-name', this.$el).html( this.options.set );
          }
      }
      regions() {
        return {regionCollection: '.collection-items'};
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MusicVideoApp.Edit", function(Edit, App, Backbone, Marionette, $, _) {

  return Edit.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      let form;
      this.model = this.getOption('model');
      const options = {
        titleHtml: '<span>' + tr('Edit') + '</span>' + this.model.escape('title'),
        form: this.getStructure(),
        formState: this.model.attributes,
        config: {
          attributes: {class: 'edit-form'},
          editForm: true,
          tabs: true,
          callback: (data, formView) => {
            return this.saveCallback(data, formView);
          }
        }
      };
      return form = App.request("form:popup:wrapper", options);
    }

    getStructure() {
      return [
        {
          title: 'General',
          id: 'general',
          children:[
            {id: 'title', title: tr('Title'), type: 'textfield'},
            {id: 'artist', title: tr('Artist'), type: 'textfield', format: 'array.string'},
            {id: 'album', title: tr('Album'), type: 'textfield'},
            {id: 'plot', title: tr('Plot'), type: 'textarea'},
            {id: 'studio', title: tr('Studio'), type: 'textfield', format: 'array.string'},
            {id: 'year', title: tr('Year'), type: 'number', format: 'integer', attributes: {class: 'half-width', step: 1, min: 0, max: 9999}},
            {id: 'rating', title: tr('Rating'), type: 'number', format: 'float', attributes: {class: 'half-width', step: 0.1, min: 0, max: 10}, suffix: '<div class="clearfix"></div>'},
          ]
        },
        {
          title: 'Tags',
          id: 'tags',
          children:[
            {id: 'director', title: tr('Directors'), type: 'textfield', format: 'array.string'},
            {id: 'genre', title: tr('Genres'), type: 'textfield', format: 'array.string'},
            {id: 'tag', title: tr('Tags'), type: 'textfield', format: 'array.string'},
          ]
        },
        {
          title: 'Poster',
          id: 'poster',
          children:[
            {
              id: 'thumbnail', title: tr('URL'), type: 'imageselect', valueProperty: 'thumbnailOriginal', description: tr('Add an image via an external URL'), attributes: {class: 'fanart-size'},
              metadataImageHandler: 'fanarttv:artist:image:entities', metadataLookupField: 'artist'
            }
          ]
        },
        {
          title: 'Background',
          id: 'background',
          children:[
            {
              id: 'fanart', title: tr('URL'), type: 'imageselect', valueProperty: 'fanartOriginal', description: tr('Add an image via an external URL'),
              metadataImageHandler: 'fanarttv:artist:image:entities', metadataLookupField: 'artist'
            }
          ]
        },
        {
          title: 'Information',
          id: 'info',
          children:[
            {id: 'file', title: tr('File path'), type: 'textarea', attributes: {disabled: 'disabled', cols: 5}, format: 'prevent.submit'},
          ]
        }
      ];
    }

    //# Save the settings to Kodi
    saveCallback(data, formView) {
      const controller = App.request("command:kodi:controller", 'audio', 'VideoLibrary');
      return controller.setMusicVideoDetails(this.model.get('id'), data, () => {
        Kodi.vent.trigger('entity:kodi:update', this.model.get('uid'));
        return Kodi.execute("notification:show", t.sprintf(tr("Updated %1$s details"), 'album'));
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MusicVideoApp.List", function(List, App, Backbone, Marionette, $, _) {

  var API = {

    bindTriggers(view) {
      App.listenTo(view, 'childview:musicvideo:play', (parent, viewItem) => App.execute('musicvideo:action', 'play', viewItem));
      App.listenTo(view, 'childview:musicvideo:add', (parent, viewItem) => App.execute('musicvideo:action', 'add', viewItem));
      App.listenTo(view, 'childview:musicvideo:localplay', (parent, viewItem) => App.execute('musicvideo:action', 'localplay', viewItem));
      App.listenTo(view, 'childview:musicvideo:download', (parent, viewItem) => App.execute('musicvideo:action', 'download', viewItem));
      App.listenTo(view, 'childview:musicvideo:edit', (parent, viewItem) => App.execute('musicvideo:edit', viewItem.model));
      return view;
    },

    getVideoList(collection) {
      const view = new List.Videos({
        collection});
      API.bindTriggers(view);
      return view;
    }
  };


  //# Main controller
  List.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      const collection = App.request("musicvideo:entities");
      return App.execute("when:entity:fetched", collection, () => {

        //# Set available filters
        collection.availableFilters = this.getAvailableFilters();

        //# Top level menu path for filters
        collection.sectionId = 'music';

        //# If present set initial filter via url
        App.request('filter:init', this.getAvailableFilters());

        this.layout = this.getLayoutView(collection);

        //# Render subviews on show
        this.listenTo(this.layout, "show", () => {
          this.renderList(collection);
          return this.getFiltersView(collection);
        });
        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new List.ListLayout({
        collection});
    }

    //# Available sort and filter options
    //# See filter_app.js for available options
    getAvailableFilters() {
      return {
        sort: ['label', 'year', 'artist', 'album'],
        filter: ['studio', 'director', 'artist', 'album', 'year']
      };
    }

    //# Apply filter view and provide a handler for applying changes
    getFiltersView(collection) {
      const filters = App.request('filter:show', collection);
      this.layout.regionSidebarFirst.show(filters);
      //# Listen to when the filters change and re-render.
      return this.listenTo(filters, "filter:changed", () => {
        return this.renderList(collection);
      });
    }

    //# Get the list view with filters applied.
    renderList(collection) {
      App.execute("loading:show:view", this.layout.regionContent);
      const filteredCollection = App.request('filter:apply:entities', collection);
      const view = API.getVideoList(filteredCollection);
      return this.layout.regionContent.show(view);
    }
  };


  //# handler for other modules to get a list view.
  return App.reqres.setHandler("musicvideo:list:view", collection => API.getVideoList(collection));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MusicVideoApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "musicvideo-list with-filters";
    }
  });
  Cls.initClass();

  Cls = (List.Teaser = class Teaser extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        "click .play"           : "musicvideo:play",
        "click .add"            : "musicvideo:add",
        'click .stream'         : 'musicvideo:localplay',
        'click .download'       : 'musicvideo:download',
        'click .edit'           : 'musicvideo:edit',
        'click .refresh'        : 'musicvideo:refresh'
      };
    }
    initialize() {
      super.initialize(...arguments);
      if (this.model != null) {
        this.setMeta();
        return this.model.set(App.request('musicvideo:action:items'));
      }
    }
    setMeta() {
      if (this.model) {
        const artist = this.model.get('artist') !== '' ? this.model.get('artist') : '&nbsp;';
        return this.model.set({subtitleHtml: this.themeLink(this.model.get('artist'), 'search/artist/' + artist)});
      }
    }
  });
  Cls.initClass();

  Cls = (List.Empty = class Empty extends App.Views.EmptyViewResults {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.className = "musicvideo-empty-result";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.Videos = class Videos extends App.Views.VirtualListView {
      static initClass() {
        this.prototype.childView = List.Teaser;
        this.prototype.emptyView = List.Empty;
        this.prototype.tagName = "ul";
        this.prototype.className = "card-grid--musicvideo";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MusicVideoApp", function(MusicVideoApp, App, Backbone, Marionette, $, _) {

  const Cls = (MusicVideoApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "music/videos"      : "list",
        "music/video/:id"   : "view"
      };
    }
  });
  Cls.initClass();

  const API = {

    list() {
      return new MusicVideoApp.List.Controller();
    },

    view(id) {
      return new MusicVideoApp.Show.Controller({
        id});
    },

    action(op, view) {
      const {
        model
      } = view;
      const playlist = App.request("command:kodi:controller", 'video', 'PlayList');
      const files = App.request("command:kodi:controller", 'video', 'Files');
      const videoLib = App.request("command:kodi:controller", 'video', 'VideoLibrary');
      // Action to do
      switch (op) {
        case 'play':
          return App.execute("input:resume", model, 'musicvideoid');
        case 'add':
          return playlist.add('musicvideoid', model.get('musicvideoid'));
        case 'localplay':
          return files.videoStream(model.get('file'), model.get('fanart'));
        case 'download':
          return files.downloadFile(model.get('file'));
        case 'refresh':
          return helpers.entities.refreshEntity(model, videoLib, 'refreshMusicVideo');
        default:
      }
    }
  };
          //# nothing


  App.on("before:start", () => new MusicVideoApp.Router({
    controller: API}));

  App.commands.setHandler('musicvideo:action', (op, model) => API.action(op, model));

  App.reqres.setHandler('musicvideo:action:items', () => ({
    actions: {thumbs: tr('Thumbs up')},

    menu: {
      'add': tr('Queue in Kodi'),
      'divider-1': '',
      'download': tr('Download'),
      'stream': tr('Play in browser'),
      'divider-2': '',
      'edit': tr('Edit')
    }
  }));

  return App.commands.setHandler('musicvideo:edit', function(model) {
    const loadedModel = App.request("musicvideo:entity", model.get('id'));
    return App.execute("when:entity:fetched", loadedModel, () => {
      return new MusicVideoApp.Edit.Controller({
        model: loadedModel});
    });
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MusicVideoApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  const API = {

    bindTriggers(view) {
      App.listenTo(view, 'musicvideo:play', viewItem => App.execute('musicvideo:action', 'play', viewItem));
      App.listenTo(view, 'musicvideo:add', viewItem => App.execute('musicvideo:action', 'add', viewItem));
      App.listenTo(view, 'musicvideo:localplay', viewItem => App.execute('musicvideo:action', 'localplay', viewItem));
      App.listenTo(view, 'musicvideo:download', viewItem => App.execute('musicvideo:action', 'download', viewItem));
      App.listenTo(view, 'musicvideo:edit', viewItem => App.execute('musicvideo:edit', viewItem.model));
      return view;
    }
  };


  //# When viewing a full page we call the controller
  return Show.Controller = class Controller extends App.Controllers.Base {

    //# The MusicVideo page.
    initialize(options) {
      const id = parseInt(options.id);
      const musicvideo = App.request("musicvideo:entity", id);
      //# Fetch the video
      return App.execute("when:entity:fetched", musicvideo, () => {
        //# Get the layout.
        this.layout = this.getLayoutView(musicvideo);
        //# Listen to the show of our layout.
        this.listenTo(this.layout, "show", () => {
          this.getDetailsLayoutView(musicvideo);
          return this.getRelatedVideos(musicvideo);
        });
        //# Add the layout to content.
        return App.regionContent.show(this.layout);
      });
    }

    //# Get the base layout
    getLayoutView(musicvideo) {
      return new Show.PageLayout({
        model: musicvideo});
    }

    //# Build the details layout.
    getDetailsLayoutView(musicvideo) {
      const headerLayout = new Show.HeaderLayout({model: musicvideo});
      this.listenTo(headerLayout, "show", () => {
        const teaser = new Show.DetailTeaser({model: musicvideo});
        API.bindTriggers(teaser);
        const detail = new Show.Details({model: musicvideo});
        this.listenTo(detail, "show", () => {
          return API.bindTriggers(detail);
        });
        headerLayout.regionSide.show(teaser);
        return headerLayout.regionMeta.show(detail);
      });
      return this.layout.regionHeader.show(headerLayout);
    }

    //# Get some extra vids from youtube.
    getRelatedVideos(musicvideo) {
      const title = tr('Related music videos from YouTube');
      const opts = {maxResults: 8};
      return App.execute('youtube:list:view', musicvideo.get('title') + ' ' + musicvideo.get('artist'), title, opts, view => {
        return this.layout.regionContent.show(view);
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("MusicVideoApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  let Cls = (Show.PageLayout = class PageLayout extends App.Views.LayoutWithHeaderView {
    static initClass() {
      this.prototype.className = 'musicvideo-show detail-container';
    }
  });
  Cls.initClass();

  Cls = (Show.HeaderLayout = class HeaderLayout extends App.Views.LayoutDetailsHeaderView {
    static initClass() {
      this.prototype.className = 'musicvideo-details';
    }
  });
  Cls.initClass();

  Cls = (Show.Details = class Details extends App.Views.DetailsItem {
    static initClass() {
      this.prototype.template = 'apps/musicvideo/show/details_meta';
      this.prototype.triggers = {
        "click .play"       : "musicvideo:play",
        "click .add"        : "musicvideo:add",
        "click .download"   : "musicvideo:download",
        "click .localplay"  : "musicvideo:localplay",
        "click .edit"       : "musicvideo:edit"
      };
    }
  });
  Cls.initClass();

  return (Show.DetailTeaser = class DetailTeaser extends App.MusicVideoApp.List.Teaser {
    attributes() {
      return this.watchedAttributes('card-detail');
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("NavMain", function(NavMain, App, Backbone, Marionette, $, _) {

  const API = {

    getNav() {
      const navStructure = App.request('navMain:entities');
      return new NavMain.List({
        collection: navStructure});
    },

    getNavChildren(path, title = 'default') {
      const navStructure = App.request('navMain:entities', path);
      if (title !== 'default') {
        navStructure.set({title: tr(title)});
      }
      return new NavMain.ItemList({
        model: navStructure});
    },

    getNavCollection(collection, title) {
      const navStructure = new App.Entities.NavMain({
        title,
        items: collection
      });
      return new NavMain.ItemList({
        model: navStructure});
    }
  };

  this.onStart = options => App.vent.on("shell:ready", options => {
    const nav = API.getNav();
    return App.regionNav.show(nav);
  });

  App.reqres.setHandler("navMain:children:show", (path, title = 'default') => API.getNavChildren(path, title));

  App.reqres.setHandler("navMain:collection:show", (collection, title = '') => API.getNavCollection(collection, title));

  return App.vent.on("navMain:refresh", function() {
    const nav = API.getNav();
    return App.regionNav.show(nav);
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("NavMain", function(NavMain, App, Backbone, Marionette, $, _) {

  let Cls = (NavMain.List = class List extends Backbone.Marionette.ItemView {
    static initClass() {
      this.prototype.template = "apps/navMain/show/navMain";
    }
  });
  Cls.initClass();

  Cls = (NavMain.Item = class Item extends Backbone.Marionette.ItemView {
    static initClass() {
      this.prototype.template = "apps/navMain/show/nav_item";
      this.prototype.tagName = "li";
    }
    initialize() {
      const classes = [];
      if (this.model.get('path') === helpers.url.path()) {
        classes.push('active');
      }
      const tag = this.themeLink(this.model.get('title'), this.model.get('path'), {'className': classes.join(' ')});
      return this.model.set({link: tag});
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (NavMain.ItemList = class ItemList extends App.Views.CompositeView {
      static initClass() {
        this.prototype.template = 'apps/navMain/show/nav_sub';
        this.prototype.childView = NavMain.Item;
        this.prototype.tagName = "div";
        this.prototype.childViewContainer = 'ul.items';
        this.prototype.className = "nav-sub";
      }
      initialize() {
        return this.collection = this.model.get('items');
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("NotificationsApp", function(NotificationApp, App, Backbone, Marionette, $, _) {

  const API =

    {notificationMinTimeOut: 5000};

  return App.commands.setHandler("notification:show", function(msg, severity = 'normal') {
    //# Average 100 characters takes 10 sec to read
    const timeout = msg.length < 50 ? API.notificationMinTimeOut : (msg.length * 100);
    //# Trigger a ui notification.
    return $.snackbar({
      content: msg,
      style: 'type-' + severity,
      timeout
    });
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlayerApp", function(PlayerApp, App, Backbone, Marionette, $, _) {

  var API = {

    //# Get the kodi play bar
    getPlayer(player) {
      return new PlayerApp.Show.Player({
        player});
    },

    //# Send a player command.
    doCommand(player, command, params, callback) {
      return App.request(`command:${player}:player`, command, params, () => {
        return this.pollingUpdate(callback);
      });
    },

    //# Get the Kodi application controller
    getAppController(player) {
      return App.request(`command:${player}:controller`, 'auto', 'Application');
    },

    //# Wrapper for requesting a state update if no sockets
    pollingUpdate(callback) {
      const stateObj = App.request("state:current");
      if (stateObj.getPlayer() === 'kodi') {
        if (!App.request('sockets:active')) {
          return App.request('state:kodi:update', callback);
        }
      }
      else {}
    },
        //# Local player state update.

    //# Listen to the player commands
    initPlayer(player, playerView) {
      this.initProgress(player);
      this.initVolume(player);
      App.vent.trigger("state:player:updated", player);
      const appController = this.getAppController(player);
      App.vent.on("state:initialized", () => {
        const stateObj = App.request("state:kodi");
        if (stateObj.isPlaying()) {
          this.timerStop();
          return this.timerStart();
        }
      });

      //# Buttons
      App.listenTo(playerView, "control:play", () => {
        return this.doCommand(player, 'PlayPause', 'toggle');
      });
      App.listenTo(playerView, "control:prev", () => {
        return this.doCommand(player, 'GoTo', 'previous');
      });
      App.listenTo(playerView, "control:next", () => {
        return this.doCommand(player, 'GoTo', 'next');
      });
      App.listenTo(playerView, "control:repeat", () => {
        return this.doCommand(player, 'SetRepeat', 'cycle');
      });
      App.listenTo(playerView, "control:shuffle", () => {
        return this.doCommand(player, 'SetShuffle', 'toggle');
      });
      App.listenTo(playerView, "control:mute", () => {
        return appController.toggleMute(() => {
          return this.pollingUpdate();
        });
      });
      App.listenTo(playerView, 'control:menu', () => App.execute("ui:playermenu", 'toggle'));

      //# Remote toggle
      if (player === 'kodi') {
        App.listenTo(playerView, "remote:toggle", () => {
          return App.execute("input:remote:toggle");
        });
      }

      const $playerCtx = $('#player-' + player);
      const $progress = $('.playing-progress', $playerCtx);
      if (player === 'kodi') {
        //# Kodi Slider Progress change
        $progress.on('change', function() {
          API.timerStop();
          return API.doCommand(player, 'Seek', {percentage: Math.round(this.vGet())}, () => API.timerStart());
        });
        $progress.on('slide', () => API.timerStop());
      } else {
        //# Local slider progress change
        $progress.on('change', function() {
          return API.doCommand(player, 'Seek', {percentage: Math.round(this.vGet())});
      });
      }

      //# Slider volume
      const $volume = $('.volume', $playerCtx);
      return $volume.on('change', function() {
        return appController.setVolume(Math.round(this.vGet()), () => API.pollingUpdate());
      });
    },

    //# Start virtual timer
    timerStart() {
      return App.playingTimerInterval = setTimeout(( () => {
        return this.timerUpdate();
      }
      ), 1000);
    },

    //# Stop virtual timer
    timerStop() {
      return clearTimeout(App.playingTimerInterval);
    },

    //# Update virtual timer.
    timerUpdate() {
      const stateObj = App.request("state:kodi");
      // stop existing timers and restart if playing
      this.timerStop();
      // is playing
      if (stateObj.isPlaying() && (stateObj.getPlaying('time') != null)) {
        // parse time
        const cur = helpers.global.timeToSec(stateObj.getPlaying('time')) + 1;
        const dur = helpers.global.timeToSec(stateObj.getPlaying('totaltime'));
        const percent = Math.ceil((cur / dur) * 100);
        const curTimeObj = helpers.global.secToTime(cur);
        // update cache with new time
        stateObj.setPlaying('time', curTimeObj);
        // update ui
        this.setProgress('kodi', percent, curTimeObj);
        // Restart timer
        return this.timerStart();
      }
    },

    //# Set the current player progress.
    setProgress(player, percent = 0, currentTime = 0) {
      const $playerCtx = $('#player-' + player);
      $('.playing-progress', $playerCtx).val(percent);
      const $cur = $('.playing-time-current', $playerCtx);
      return $cur.text(helpers.global.formatTime(currentTime));
    },

    //# Init progress.
    initProgress(player, percent = 0) {
      const $playerCtx = $('#player-' + player);
      return $('.playing-progress', $playerCtx).noUiSlider({
        start: percent,
        connect: 'upper',
        step: 1,
        range: {
          min: 0,
          max: 100
        }
      });
    },

    //# Init Volume.
    initVolume(player, percent = 50) {
      const $playerCtx = $('#player-' + player);
      return $('.volume', $playerCtx).noUiSlider({
        start: percent,
        connect: 'upper',
        step: 1,
        range: {
          min: 0,
          max: 100
        }
      });
    }
  };


  //# Kick of the player on shell ready.
  return this.onStart = function(options) {

    App.vent.on("shell:ready", options => {

      //# Kodi player
      App.kodiPlayer = API.getPlayer('kodi');
      App.listenTo(App.kodiPlayer, "show", function() {
        API.initPlayer('kodi', App.kodiPlayer);
        return App.execute("player:kodi:timer", 'start');
      });
      App.regionPlayerKodi.show(App.kodiPlayer);

      //# Local player
      App.localPlayer = API.getPlayer('local');
      App.listenTo(App.localPlayer, "show", () => API.initPlayer('local', App.localPlayer));
      return App.regionPlayerLocal.show(App.localPlayer);
    });

    //# Handler for the virtual timer.
    App.commands.setHandler('player:kodi:timer', function(state = 'start') {
      if (state === 'start') {
        return API.timerStart();
      } else if (state === 'stop') {
        return API.timerStop();
      } else if (state === 'update') {
        return API.timerUpdate();
      }
    });

    //# Handler for changing the local progress.
    App.commands.setHandler('player:local:progress:update', (percent, currentTime) => API.setProgress('local', percent, currentTime));

    //# Handler for changing the kodi progress.
    return App.commands.setHandler('player:kodi:progress:update', (percent, callback) => API.doCommand('kodi', 'Seek', {percentage: percent}, callback));
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlayerApp.Show", (Show, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Show.Player = class Player extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = "apps/player/show/player";

      this.prototype.regions = {
        regionProgress  : '.playing-progress',
        regionVolume    : '.volume',
        regionThumbnail : '.playing-thumb',
        regionTitle     : '.playing-title',
        regionSubtitle  : '.playing-subtitle',
        regionTimeCur   : '.playing-time-current',
        regionTimeDur   : '.playing-time-duration'
      };
      this.prototype.triggers = {
        'click .remote-toggle'    : 'remote:toggle',
        'click .control-prev'     : 'control:prev',
        'click .control-play'     : 'control:play',
        'click .control-next'     : 'control:next',
        'click .control-stop'     : 'control:stop',
        'click .control-mute'     : 'control:mute',
        'click .control-shuffle'  : 'control:shuffle',
        'click .control-repeat'   : 'control:repeat',
        'click .control-menu'     : 'control:menu'
      };
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp.List", function(List, App, Backbone, Marionette, $, _) {

  return List.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      //# Watch the shell and render when ready.
      return App.vent.on("shell:ready", options => {
        return this.getPlaylistBar();
      });
    }

    playlistController(player, media) {
      return App.request(`command:${player}:controller`, media, 'PlayList');
    }

    playerController(player, media) {
      return App.request(`command:${player}:controller`, media, 'Player');
    }

    playerCommand(player, command, params = []) {
      return App.request(`command:${player}:player`, command, params, () => App.request("state:kodi:update"));
    }

    stateObj() {
      return App.request("state:current");
    }

    getPlaylistBar() {
      this.layout = this.getLayout();

      this.listenTo(this.layout, "show", () => {
        //# Load the kodi audio list
        this.renderList('kodi', 'audio');
        this.renderList('local', 'audio');
        //# Set the initial active playlist
        return App.vent.on("state:initialized", () => {
          return this.changePlaylist(this.stateObj().getState('player'), this.stateObj().getState('media'));
        });
      });

      this.listenTo(this.layout, 'playlist:kodi:audio', () => {
        return this.changePlaylist('kodi', 'audio');
      });
      this.listenTo(this.layout, 'playlist:kodi:video', () => {
        return this.changePlaylist('kodi', 'video');
      });
      this.listenTo(this.layout, 'playlist:kodi', () => {
        this.stateObj().setPlayer('kodi');
        return this.renderList('kodi', 'audio');
      });
      this.listenTo(this.layout, 'playlist:local', () => {
        this.stateObj().setPlayer('local');
        return this.renderList('local', 'audio');
      });
      this.listenTo(this.layout, 'playlist:clear', () => {
        return this.playlistController(this.stateObj().getPlayer(), this.stateObj().getState('media')).clear();
      });
      this.listenTo(this.layout, 'playlist:refresh', () => {
        this.renderList(this.stateObj().getPlayer(), this.stateObj().getState('media'));
        return App.execute("notification:show", tr('Playlist refreshed'));
      });
      this.listenTo(this.layout, 'playlist:party', () => {
        return this.playerController(this.stateObj().getPlayer(), this.stateObj().getState('media')).setPartyMode('toggle', resp => {
          App.request("state:" + this.stateObj().getPlayer() + ":update");
          return App.execute("notification:show", t.sprintf(tr('%1$s party mode toggled'), this.stateObj().getPlayer()));
        });
      });
      this.listenTo(this.layout, 'playlist:save', () => {
        return App.execute("localplaylist:addentity", 'playlist');
      });

      //# Render the layout
      return App.regionPlaylist.show(this.layout);
    }

    getLayout() {
      return new List.Layout();
    }

    getList(collection) {
      return new List.Items({
        collection});
    }

    renderList(type, media) {
      let collection;
      this.layout.$el.removeClassStartsWith('media-').addClass('media-' + media);
      if (type === 'kodi') {
        //# Get the collection and controller for this list
        collection = App.request("playlist:list", type, media);
        //# When fetched.
        return App.execute("when:entity:fetched", collection, () => {
          //# render to layout.
          const listView = this.getList(collection);
          App.listenTo(listView, "show", () => {
            //# Bind actions
            this.bindActions(listView, type, media);
            //# Trigger content update
            return App.vent.trigger("state:content:updated", type, media);
          });
          return this.layout.kodiPlayList.show(listView);
        });
      } else {
        //# Get the local playlist collection
        collection = App.request("localplayer:get:entities");
        const listView = this.getList(collection);
        App.listenTo(listView, "show", () => {
          //# Bind actions
          this.bindActions(listView, type, media);
          //# Trigger content update
          return App.vent.trigger("state:content:updated", type, media);
        });
        return this.layout.localPlayList.show(listView);
      }
    }

    bindActions(listView, type, media) {
      //# Get the controller for this
      const playlist = this.playlistController(type, media);
      //# Listen to commands
      this.listenTo(listView, "childview:playlist:item:remove", (playlistView, item) => playlist.remove(item.model.get('position')));
      this.listenTo(listView, "childview:playlist:item:play", (playlistView, item) => playlist.playEntity('position', parseInt( item.model.get('position') )));
      return this.initSortable(type, media);
    }

    changePlaylist(player, media) {
      return this.renderList(player, media);
    }

    initSortable(type, media) {
      const $ctx = $('.' + type + '-playlist');
      const playlist = this.playlistController(type, media);
      return $('ul.playlist-items', $ctx).sortable({
        filter: '.row-playing,.row-paused',
        onEnd(e) {
          return playlist.moveItem($(e.item).data('type'), $(e.item).data('id'), e.oldIndex, e.newIndex);
        }
      });
    }

    //# If playing item isn't visible already, scroll to it
    focusPlaying(type, media) {
      if (config.getLocal('playlistFocusPlaying', true)) {
        const $playing = $('.' + type + '-playlist .row-playing');
        if ($playing.length > 0) {
          return $playing.get(0).scrollIntoView();
        }
      }
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.Layout = class Layout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = "apps/playlist/list/playlist_bar";
      this.prototype.tagName = "div";
      this.prototype.className = "playlist-bar";
      this.prototype.regions = {
        kodiPlayList: '.kodi-playlist',
        localPlayList: '.local-playlist'
      };
      this.prototype.triggers = {
        'click .kodi-playlists .media-toggle .video'  :  'playlist:kodi:video',
        'click .kodi-playlists .media-toggle .audio'  :  'playlist:kodi:audio',
        'click .player-toggle .kodi'                  :  'playlist:kodi',
        'click .player-toggle .local'                 :  'playlist:local',
        'click .clear-playlist'                       :  'playlist:clear',
        'click .refresh-playlist'                     :  'playlist:refresh',
        'click .party-mode'                           :  'playlist:party',
        'click .save-playlist'                        :  'playlist:save'
      };
      this.prototype.events =
        {'click .playlist-menu a': 'menuClick'};
    }
    menuClick(e) {
      return e.preventDefault();
    }
  });
  Cls.initClass();

  Cls = (List.Item = class Item extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = "apps/playlist/list/playlist_item";
      this.prototype.tagName = "li";
      this.prototype.triggers = {
        "click .remove" : "playlist:item:remove",
        "click .play" : "playlist:item:play"
      };
      this.prototype.events =
        {"click .thumbs" : "toggleThumbs"};
    }
    initialize() {
      let subtitle = '';
      switch (this.model.get('type')) {
        case 'song':
          subtitle = this.model.get('artist') ? this.model.get('artist').join(', ') : '';
          break;
        default:
          subtitle = '';
      }
      return this.model.set({subtitle});
    }
    attributes() {
      const classes = ['item', 'pos-' + this.model.get('position'), 'plitem-' + this.model.get('type') + '-' + this.model.get('id')];
      if (this.model.get('canThumbsUp') && App.request('thumbsup:check', this.model)) {
        classes.push('thumbs-up');
      }
      return {
        class: classes.join(' '),
        'data-type': this.model.get('type'),
        'data-id': this.model.get('id'),
        'data-pos': this.model.get('position')
      };
    }
    toggleThumbs() {
      App.request("thumbsup:toggle:entity", this.model);
      this.$el.toggleClass('thumbs-up');
      return $('.item-' + this.model.get('type') + '-' + this.model.get('id')).toggleClass('thumbs-up');
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.Items = class Items extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.Item;
        this.prototype.tagName = "ul";
        this.prototype.className = "playlist-items";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});




;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp.LocalParty", function(LocalParty, App, Backbone, Marionette, $, _) {

  const API = {

    getController() {
      return new LocalParty.Manager();
    }
  };

  //# Local playlist Partymode.
  LocalParty.Manager = class Manager extends App.Controllers.Base {

    //# Init
    initialize(options) {
      this.stateObj = App.request("state:local");
      return this.localPlaylist = App.request("command:local:controller", 'audio', 'PlayList');
    }

    //# Get the list
    fillGlasses(callback) {
      // Set state to partymode.
      this.stateObj.setPlaying('partymode', true);
      // Get 10 songs
      return this.getSongs(10, collection => {
        //# Clear playlist
        return this.localPlaylist.clear(() => {
          //# Add songs to playlist and play
          this.localPlaylist.playCollection(collection);
          if (callback) {
            return callback(true);
          }
        });
      });
    }

    //# Add one more song and remove first song
    topUpGlasses() {
      // Get new last song
      return this.getSongs(1, collection => {
        // Remove first song
        return this.localPlaylist.remove(0, () => {
          // Add new last song
          return this.localPlaylist.addCollection(collection);
        });
      });
    }

    //# Get the songs to play
    getSongs(limit, callback) {
      const options = {
        sort: {method: 'random', order: 'ascending'},
        limit: {start: 0, end: limit},
        cache: false,
        success(result) {
          return callback(result);
        }
      };
      return App.request("song:entities", options);
    }

    //# Disable party mode.
    leaveParty(callback) {
      this.stateObj.setPlaying('partymode', false);
      if (callback) {
        return callback(true);
      }
    }

    //# Is party mode active
    isPartyMode() {
      return this.stateObj.getPlaying('partymode', false);
    }
  };


  //# Enable, disable or toggle party mode
  App.commands.setHandler('playlist:local:partymode', function(op = 'toggle', callback) {
    const manager = API.getController();
    if (op === 'toggle') {
      op = !manager.isPartyMode();
    }
    if (op === true) {
      manager.fillGlasses(callback);
    } else {
      manager.leaveParty(callback);
    }
    return App.vent.trigger("state:local:changed");
  });

  //# Listen to local song finished
  return App.vent.on("state:local:next", function() {
    const manager = API.getController();
    if (manager.isPartyMode()) {
      return manager.topUpGlasses();
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp.M3u", function(M3u, App, Backbone, Marionette, $, _) {

  return M3u.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {
      const List = this.getList(options.collection);
      return App.regionOffscreen.show(List);
    }

    //# Get the list
    getList(collection) {
      return new M3u.List({
        collection});
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp.M3u", (M3u, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (M3u.List = class List extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/playlist/m3u/list';
      this.prototype.tagName = "pre";
      this.prototype.className = "m3u-export";
    }
    onRender() {
      const content = this.$el.text();
      // TODO: Don't get filename from the dom!
      const filename = $('.local-playlist-header h2').html() + ".m3u";
      return helpers.global.saveFileText(content, filename);
    }
  });
  Cls.initClass();
  return Cls;
})());

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp", function(PlaylistApp, App, Backbone, Marionette, $, _) {

  const Cls = (PlaylistApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes =
        {"playlist"    : "list"};
    }
  });
  Cls.initClass();

  const API = {

    list() {
      //# Show the search form (for mobile)
      return new PlaylistApp.Show.Controller();
    },

    export(collection) {
      return new PlaylistApp.M3u.Controller({
        collection});
    },

    type: 'kodi',
    media: 'audio',

    setContext(type = 'kodi', media = 'audio') {
      this.type = type;
      return this.media = media;
    },

    getController() {
      return App.request(`command:${this.type}:controller`, this.media, 'PlayList');
    },

    getPlaylistItems() {
      return App.request(`playlist:${this.type}:entities`, this.media);
    }
  };


  App.reqres.setHandler("playlist:list", function(type, media) {
    API.setContext(type, media);
    return API.getPlaylistItems();
  });

  App.commands.setHandler("playlist:export", collection => API.export(collection));



  App.on("before:start", () => new PlaylistApp.Router({
    controller: API}));


  return App.addInitializer(function() {
    const controller = new PlaylistApp.List.Controller();

    //# Triggers for other modules to refresh th playlist
    App.commands.setHandler("playlist:refresh", (type, media) => controller.renderList(type, media));

    // Trigger on item changed
    return App.vent.on("state:kodi:playing:updated", stateObj => controller.focusPlaying(stateObj.getState('player'), stateObj.getPlaying()));
  });
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  return (Show.Controller = class Controller extends App.Controllers.Base {

    //# The search landing page.
    initialize(options) {
      this.landing = this.getLanding();
      return App.regionContent.show(this.landing);
    }


    //# Get the base layout
    getLanding() {
      return new Show.Landing();
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PlaylistApp.Show", (Show, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Show.Landing = class Landing extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/playlist/show/landing';
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PVR.ChannelList", function(List, App, Backbone, Marionette, $, _) {


  //# Main controller
  return List.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {
      const collection = App.request("channel:entities", options.group);

      //# When fetched.
      return App.execute("when:entity:fetched", collection, () => {

        //# Get and setup the layout
        this.layout = this.getLayoutView(collection);
        this.listenTo(this.layout, "show", () => {
          this.renderChannels(collection);
          return this.getSubNav();
        });

        //# Render the layout
        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new List.Layout({
        collection});
    }

    renderChannels(collection) {
      const view = new List.ChannelList({
        collection});
      this.listenTo(view, 'childview:channel:play', function(parent, child) {
        const player = App.request("command:kodi:controller", 'auto', 'Player');
        return player.playEntity('channelid', child.model.get('id'), {},  () => {});
      });
          //# update state?
      this.listenTo(view, 'childview:channel:record', function(parent, child) {
        const pvr = App.request("command:kodi:controller", 'auto', 'PVR');
        return pvr.setRecord(child.model.get('id'), {}, () => App.execute("notification:show", tr("Channel recording toggled")));
      });
      return this.layout.regionContent.show(view);
    }

    getSubNav() {
      const subNav = App.request("navMain:children:show", 'pvr/tv', 'PVR');
      return this.layout.regionSidebarFirst.show(subNav);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PVR.ChannelList", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "pvr-page";
    }
  });
  Cls.initClass();

  Cls = (List.ChannelTeaser = class ChannelTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.triggers = {
        "click .play"       : "channel:play",
        "click .record"     : "channel:record"
      };
    }
    initialize() {
      super.initialize(...arguments);
      if (this.model != null) {
        return this.model.set({subtitle: this.model.get('broadcastnow').title});
      }
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.ChannelList = class ChannelList extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.ChannelTeaser;
        this.prototype.tagName = "ul";
        this.prototype.className = "card-grid--square";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PVR", function(PVR, App, Backbone, Marionette, $, _) {

  const Cls = (PVR.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "pvr/tv"          : "tv",
        "pvr/radio"       : "radio",
        "pvr/recordings"  : "recordings"
      };
    }
  });
  Cls.initClass();

  const API = {

    tv() {
      return new PVR.ChannelList.Controller({
        group: 'alltv'});
    },

    radio() {
      return new PVR.ChannelList.Controller({
        group: 'allradio'});
    },

    recordings() {
      return new PVR.RecordingList.Controller();
    }
  };


  return App.on("before:start", () => new PVR.Router({
    controller: API}));
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PVR.RecordingList", function(List, App, Backbone, Marionette, $, _) {

  //# Main controller
  return List.Controller = class Controller extends App.Controllers.Base {

    initialize(options) {
      const collection = App.request("recording:entities", options.group);

      //# When fetched.
      return App.execute("when:entity:fetched", collection, () => {
        collection.sortCollection('starttime', 'desc');

        //# Get and setup the layout
        this.layout = this.getLayoutView(collection);
        this.listenTo(this.layout, "show", () => {
          this.renderChannels(collection);
          return this.getSubNav();
        });

        //# Render the layout
        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(collection) {
      return new List.Layout({
        collection});
    }

    renderChannels(collection) {
      const view = new List.RecordingList({
        collection});
      this.listenTo(view, 'childview:recording:play', function(parent, child) {
        if (child.model.get('player') === 'video') {
          return App.execute("input:resume", child.model, 'file');
        } else {
          const playlist = App.request("command:kodi:controller", child.model.get('player'), 'PlayList');
          return playlist.play('file', child.model.get('file'));
        }
      });
      return this.layout.regionContent.show(view);
    }

    getSubNav() {
      const subNav = App.request("navMain:children:show", 'pvr/tv', 'PVR');
      return this.layout.regionSidebarFirst.show(subNav);
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("PVR.RecordingList", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "pvr-page";
    }
  });
  Cls.initClass();

  Cls = (List.RecordingTeaser = class RecordingTeaser extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/pvr/recordingList/recording';
      this.prototype.tagName = "li";
      this.prototype.className = 'pvr-card card';
      this.prototype.triggers =
        {"click .play"       : "recording:play"};
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.RecordingList = class RecordingList extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.RecordingTeaser;
        this.prototype.tagName = "ul";
        this.prototype.className = "recordings";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SearchApp.List", (List, App, Backbone, Marionette, $, _) => //# Main controller
(function() {
  const Cls = (List.Controller = class Controller extends App.Controllers.Base {
    constructor(...args) {
      super(...args);
      this.getLoader = this.getLoader.bind(this);
      this.updateProgress = this.updateProgress.bind(this);
    }

    static initClass() {

      this.prototype.maxItemsCombinedSearch = 21;

      this.prototype.allEntities = ['movie', 'tvshow', 'artist', 'album', 'song', 'musicvideo'];

      this.prototype.searchFieldMap = {
        artist: 'artist',
        album: 'album',
        song: 'title',
        movie: 'title',
        tvshow: 'title',
        musicvideo: 'title'
      };

      this.prototype.entityTitles =
        {musicvideo: 'music video'};

      this.prototype.entityPreventSelect =
        ['tvshow'];
    }

    initialize() {
      this.pageLayout = this.getPageLayout();
      this.layout = this.getLayout();
      this.processed = [];
      this.processedItems = 0;
      this.addonSearches = App.request("addon:search:enabled");
      App.execute("selected:clear:items");
      const media = this.getOption('media');
      if (media === 'all') {
        this.entities = this.allEntities;
      } else {
        this.entities = [media];
      }
      this.listenTo(this.layout, "show", () => {
        //# Add the loader
        this.getLoader();
        //# Do a search for each entity
        return this.entities.map((entity) =>
          helpers.global.inArray(entity, this.allEntities) ?
            this.getResultMedia(entity)
          :
            this.getResultAddon(entity));
      });
      this.listenTo(this.pageLayout, "show", () => {
        this.pageLayout.regionContent.show(this.layout);
        return this.pageLayout.regionSidebarFirst.show(this.getSidebar());
      });
      return App.regionContent.show(this.pageLayout);
    }

    getPageLayout() {
      return new List.PageLayout();
    }

    getLayout() {
      return new List.ListLayout();
    }

    //# Get and build the sidebar links
    getSidebar() {
      let media;
      const medias = [{id: 'all', title: 'all media'}];
      for (media of this.allEntities) {
        medias.push({
          id: media,
          title: this.getTitle(media) + 's'
        });
      }
      const opts = {
        links: {media: medias, addon: this.addonSearches},
        query: this.getOption('query')
      };
      return new List.Sidebar(opts);
    }

    //# Get the loader which indicates remaining sets to search
    getLoader() {
      // Get items left to process
      const toProcess = _.difference(this.entities, this.processed);
      // Replace addon ids with title
      for (var i in toProcess) {
        var name = toProcess[i];
        var addon = _.findWhere(this.addonSearches, {id: name});
        toProcess[parseInt(i)] = addon ? addon.title : name + 's';
      }
      // Build the loading search text
      const searchNames = helpers.global.arrayToSentence(toProcess, false);
      const query = helpers.global.arrayToSentence([this.getOption('query')], false);
      const text = t.gettext('Searching for') + ' ' + query + ' ' + t.gettext('in') + ' ' + searchNames;
      return App.execute("loading:show:view", this.layout.loadingSet, text);
    }

    //# Get local library results
    getResultMedia(entity) {
      const query = this.getOption('query');
      const limit = {start: 0};
      if (this.getOption('media') === 'all') {
        limit.end = this.maxItemsCombinedSearch;
      }
      const opts = {
        limits: limit,
        filter: {'operator': 'contains', 'field': this.searchFieldMap[entity], 'value': query},
        success: loaded => {
          // If result
          if (loaded.length > 0) {
            this.processedItems = this.processedItems + loaded.length;
            // See if we need more
            let more = false;
            if (loaded.length === this.maxItemsCombinedSearch) {
              more = true;
              loaded.first(20);
            }
            // Get the result view
            const view = App.request(`${entity}:list:view`, loaded, true);
            // Wrap it in a set view container and add a title
            const setView = new List.ListSet({
              entity,
              more,
              query,
              title: this.getTitle(entity) + 's',
              noMenuDefault: helpers.global.inArray(entity, this.entityPreventSelect)
            });
            App.listenTo(setView, "show", () => {
              return setView.regionCollection.show(view);
            });
            //# Add to layout
            this.layout[`${entity}Set`].show(setView);
          }
          return this.updateProgress(entity);
        }
      };
      return App.request(`${entity}:entities`, opts);
    }

    //# Get addon results
    getResultAddon(addonId) {
      const addonSearch = _.findWhere(this.addonSearches, {id: addonId});
      const opts = {
        file: addonSearch.url.replace('[QUERY]', this.getOption('query')),
        media: addonSearch.media,
        addonId: addonSearch.id,
        success: fullCollection => {
          let i = 0;
          const typeCollection = App.request("file:parsed:entities", fullCollection);
          for (var type of ['file', 'directory']) {
            var collection = typeCollection[type];
            // If result
            if (collection.length > 0) {
              i++;
              this.processedItems = this.processedItems + collection.length;
              var filesView = App.request("browser:" + type + ":view", collection);
              var setView = new List.ListSet({
                entity: addonSearch.title,
                title: i === 1 ? addonSearch.title : '',
                more: false,
                query: this.getOption('query'),
                noMenuDefault: true
              });
              App.listenTo(setView, "show", () => {
                return setView.regionResult.show(filesView);
              });
              this.layout.appendAddonView(addonId + type, setView);
            }
          }
          return this.updateProgress(addonId);
        }
      };
      return App.request("file:entities", opts);
    }

    //# Get title for an entity
    getTitle(entity) {
      const title = this.entityTitles[entity] ? this.entityTitles[entity] : entity;
      return title;
    }

    //# Update the progress of the search
    updateProgress(done) {
      if (done != null) {
        this.processed.push(done);
      }
      this.getLoader();
      if (this.processed.length === this.entities.length) {
        this.layout.loadingSet.$el.empty();
        if (this.processedItems === 0) {
          return this.pageLayout.regionContent.$el.html('<h2 class="search-no-result">' + tr('No results found') + '</h2>');
        }
      }
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS205: Consider reworking code to avoid use of IIFEs
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SearchApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.PageLayout = class PageLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "search-page-layout";
    }
  });
  Cls.initClass();

  Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/search/list/search_layout';
      this.prototype.className = "search-page";
      this.prototype.regions = {
        artistSet: '.entity-set-artist',
        albumSet:  '.entity-set-album',
        songSet:   '.entity-set-song',
        movieSet:  '.entity-set-movie',
        tvshowSet: '.entity-set-tvshow',
        musicvideoSet: '.entity-set-musicvideo',
        loadingSet: '.entity-set-loading'
      };
  
      (function() {
        Cls = (List.ListSet = class ListSet extends App.Views.SetLayoutView {
          static initClass() {
            this.prototype.className = "search-set landing-set";
          }
          initialize() {
            this.setOptions();
            return this.createModel();
          }
          setOptions() {
            if (this.options.more && this.options.query) {
              return this.options.more = this.themeLink(t.gettext('Show more'), 'search/' + this.options.entity + '/' + this.options.query);
            }
          }
        });
        Cls.initClass();
        return Cls;
      })();
    }
    // Allow dynamically adding multiple addon views to a region
    appendAddonView(addonId, addonView) {
      const addonViewId = 'addonSet_' + addonId.split('.').join('_');
      $('.entity-set-addons', this.$el).append('<div id="' + addonViewId+ '">');
      this.regionManager.addRegion(addonViewId, '#' + addonViewId);
      return this[addonViewId].show(addonView);
    }
  });
  Cls.initClass();


  //# List of sidebar links for media and addons
  return (function() {
    Cls = (List.Sidebar = class Sidebar extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = 'apps/search/list/search_sidebar';
        this.prototype.className = "search-sidebar";
      }
      onRender() {
        const query = encodeURIComponent(this.options.query);
        return (() => {
          const result = [];
          for (var type in this.options.links) {
            var links = this.options.links[type];
            if (links.length === 0) {
              result.push($('.sidebar-section-' + type, this.$el).remove());
            } else {
              var $list = $('.search-' + type + '-links', this.$el);
              result.push((() => {
                const result1 = [];
                for (var item of links) {
                  var active = helpers.url.arg(1) === item.id ? 'active' : '';
                  var link = this.themeLink(t.gettext(item.title), 'search/' + item.id + '/' + query, {className: active});
                  result1.push($list.append(this.themeTag('li', {}, link)));
                }
                return result1;
              })());
            }
          }
          return result;
        })();
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SearchApp", function(SearchApp, App, Backbone, Marionette, $, _) {

  const Cls = (SearchApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "search"        : "view",
        "search/:media/:query"  : "list"
      };
    }
  });
  Cls.initClass();

  var API = {

    keyUpTimeout: 2000,

    //# Search urls used for external searches
    externalSearchUrls: {
      google     : 'https://www.google.com/webhp?#q=[QUERY]',
      imdb       : 'http://www.imdb.com/find?s=all&q=[QUERY]',
      tmdb       : 'https://www.themoviedb.org/search?query=[QUERY]',
      tvdb       : 'http://thetvdb.com/?searchseriesid=&tab=listseries&function=Search&string=[QUERY]',
      soundcloud : 'https://soundcloud.com/search?q=[QUERY]',
      youtube    : 'https://www.youtube.com/results?search_query=[QUERY]'
    },

    list(media, query) {
      App.navigate(`search/${media}/${query}`);
      $('#search').val(query);
      return new SearchApp.List.Controller({
        query,
        media
      });
    },

    view() {
      //# Show the search form (for mobile)
      return new SearchApp.Show.Controller();
    },

    searchBind() {
      return $('#search').on('keyup', function(e) {
        $('#search-region').removeClass('pre-search');
        const val = $('#search').val();
        const media = helpers.url.arg(0) === 'search' ? helpers.url.arg(1) : 'all';
        clearTimeout(App.searchAllTimeout);
        // If enter key
        if (e.which === 13) {
          return API.list(media, val);
        } else {
          $('#search-region').addClass('pre-search');
          // Start search in @keyUpTimeout
          return App.searchAllTimeout = setTimeout(( function() {
            $('#search-region').removeClass('pre-search');
            return API.list(media, val);
          }), API.keyUpTimeout);
        }
      });
    }
  };


  //# Do an internal or external search
  App.commands.setHandler('search:go', function(type, query, provider = 'all') {
    if (type === 'internal') {
      return App.navigate(`search/${provider}/${query}`, {trigger: true});
    } else if (API.externalSearchUrls[provider]) {
      const url = API.externalSearchUrls[provider].replace('[QUERY]', encodeURIComponent(query));
      return window.open(url);
    }
  });


  App.on("before:start", () => new SearchApp.Router({
    controller: API}));

  //# Bind to the search box.
  return App.addInitializer(() => App.vent.on("shell:ready", () => API.searchBind()));
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SearchApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  return (Show.Controller = class Controller extends App.Controllers.Base {

    //# The search landing page.
    initialize(options) {
      this.landing = this.getLanding();

      // Focus search input.
      this.listenTo(this.landing, "show", () => {
        return $('#search').focus();
      });

      // Show landing.
      return App.regionContent.show(this.landing);
    }


    //# Get the base layout.
    getLanding() {
      return new Show.Landing();
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SearchApp.Show", (Show, App, Backbone, Marionette, $, _) => (function() {
  const Cls = (Show.Landing = class Landing extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/search/show/landing';
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Selected", function(Selected, App, Backbone, Marionette, $, _) {

  //# The Selected.List object handles what is currently selected and
  //# methods relating to selected actions.
  const Cls = (Selected.List = class List extends Marionette.Object {
    static initClass() {
  
      this.prototype.items = [];
      this.prototype.media = '';
      this.prototype.type = '';
    }

    // Get raw items
    getItems() {
      return this.items;
    }

    // Get all playable items as a collection
    getCollection(callback) {
      // Music
      if (helpers.global.inArray(this.type, ['song', 'artist', 'album'])) {
        const ids = _.pluck(this.items, 'id');
        const idProp = this.type + 'id';
        return App.request("song:custom:entities", idProp, ids, collection => callback(collection));
      } else {
        // Video
        const collection = App.request(this.type + ":build:collection", this.items);
        return callback(collection);
      }
    }

    // Add or remove a model from items
    updateItems(op, model) {
      // Remove from items first
      this.items = _.filter(this.items, item => item.uid !== model.uid);
      if (op === 'add') {
        this.items.push(model);
        this.type = model.type;
        this.media = helpers.global.inArray(this.type, ['song', 'album', 'artist']) ? 'audio' : 'video';
      }
      this.updateUi();
      return this;
    }

    // Clear all items in the list
    clearItems() {
      this.items = [];
      this.updateUi();
      return this;
    }

    setMedia(media) {
      this.media = media;
      return this;
    }

    getType() {
      return this.type;
    }

    getMedia() {
      return this.media;
    }

    // Update the count in the selected action area, toggle visibility and and media class
    updateUi() {
      const selectedText = this.items.length + ' ' + t.ngettext("item selected", "items selected", this.items.length);
      $('#selected-count').text(selectedText);
      const $selectedRegion = $('#selected-region');
      $selectedRegion.removeClassStartsWith('media-');
      $selectedRegion.addClass('media-' + this.media);
      if (this.items.length === 0) {
        $selectedRegion.hide();
        return $('.selected').removeClass('selected');
      } else {
        return $selectedRegion.show();
      }
    }
  });
  Cls.initClass();


  // Add an instance of the selected object to the app
  App.addInitializer(() => App.selected = new Selected.List);


  //# Handler to get items
  App.reqres.setHandler("selected:get:items", () => App.selected.getItems());

  //# Handler to get media
  App.reqres.setHandler("selected:get:media", () => App.selected.getMedia());

  //# Handler to update items
  App.commands.setHandler("selected:update:items", (op, model) => App.selected.updateItems(op, model));

  //# Handler to clear items
  App.commands.setHandler("selected:clear:items", () => App.selected.clearItems());

  //# Handler to clear items
  App.commands.setHandler("selected:set:media", media => App.selected.setMedia(media));

  //# Handler to Kodi play
  App.commands.setHandler("selected:action:play", () => App.selected.getCollection(function(collection) {
    const kodiPlaylist = App.request("command:kodi:controller", App.selected.getMedia(), 'PlayList');
    kodiPlaylist.playCollection(collection);
    return App.selected.clearItems();
  }));

  //# Handler to Kodi add
  App.commands.setHandler("selected:action:add", () => App.selected.getCollection(function(collection) {
    const kodiPlaylist = App.request("command:kodi:controller", App.selected.getMedia(), 'PlayList');
    kodiPlaylist.addCollection(collection);
    return App.selected.clearItems();
  }));

  //# Handler to local add
  return App.commands.setHandler("selected:action:localadd", function() {
    const items = App.selected.getItems();
    const ids = _.pluck(items, 'id');
    const idProp = App.selected.getType() + 'id';
    App.execute("localplaylist:addentity", idProp, ids);
    return App.selected.clearItems();
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp", function(SettingsApp, App, Backbone, Marionette, $, _) {

  const Cls = (SettingsApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "settings/web"    : "local",
        "settings/kodi"   : "kodi",
        "settings/kodi/:section" : "kodi",
        "settings/addons" : "addons",
        "settings/nav" : "navMain",
        "settings/search" : "search"
      };
    }
  });
  Cls.initClass();

  var API = {

    subNavId: 'settings/web',

    local() {
      return new SettingsApp.Show.Local.Controller();
    },

    addons() {
      return new SettingsApp.Show.Addons.Controller();
    },

    navMain() {
      return new SettingsApp.Show.navMain.Controller();
    },

    search() {
      return new SettingsApp.Show.Search.Controller();
    },

    kodi(section, category) {
      return new SettingsApp.Show.Kodi.Controller({
        section,
        category
      });
    },

    getSubNav() {
      const collection = App.request("settings:kodi:entities", {type: 'sections'});
      const sidebarView = new SettingsApp.Show.Sidebar();

      // On sidebar show.
      App.listenTo(sidebarView, "show", () => {

        // Get Kodi settings menu.
        App.execute("when:entity:fetched", collection, () => {
          const kodiSettingsView = App.request("navMain:collection:show", collection, t.gettext('Kodi settings'));
          return sidebarView.regionKodiNav.show(kodiSettingsView);
        });

        // Get Local/Web settings menu.
        const settingsNavView = App.request("navMain:children:show", API.subNavId, 'General');
        return sidebarView.regionLocalNav.show(settingsNavView);
      });

      return sidebarView;
    }
  };


  App.on("before:start", () => new SettingsApp.Router({
    controller: API}));

  return App.reqres.setHandler('settings:subnav', () => API.getSubNav());
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show.Base", function(SettingsBase, App, Backbone, Marionette, $, _) {

  return SettingsBase.Controller = class Controller extends App.Controllers.Base {

    initialize() {

      //# Get and setup the layout
      this.layout = this.getLayoutView();
      this.listenTo(this.layout, "show", () => {
        this.getSubNav();
        return this.getForm();
      });

      //# Render the layout
      return App.regionContent.show(this.layout);
    }

    getLayoutView() {
      return new App.SettingsApp.Show.Layout();
    }

    getSubNav() {
      const subNav = App.request('settings:subnav');
      return this.layout.regionSidebarFirst.show(subNav);
    }

    // Builds the form and adds it to the layout
    getForm() {
      return this.getCollection(collection => {
        const options = {
          form: this.getStructure(collection),
          formState: [],
          config: {
            attributes: {class: 'settings-form'},
            callback: (formState, formView) => {
              return this.saveCallback(formState, formView);
            },
            onShow: () => {
              return this.onReady();
            }
          }
        };
        const form = App.request("form:wrapper", options);
        return this.layout.regionContent.show(form);
      });
    }


    //# Override the following methods in your sub class ##

    // Callback gets passed the collection to process
    getCollection(callback) {
      // Return a collection of items
      const res = {};
      return callback(res);
    }

    // Passed the collection and returns form structure
    getStructure(collection) {
      // Return a form structure
      return [];
    }

    // Save only changed values
    saveCallback(formState, formView) {}
      // Processes the form state and save the changes

    // Called when form is rendered
    onReady() {
      // Bind onto any form elements added.
      return this.layout;
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show.Addons", function(Addons, App, Backbone, Marionette, $, _) {

  return Addons.Controller = class Controller extends App.Controllers.Base {

    initialize() {

      //# Get and setup the layout
      this.layout = this.getLayoutView();
      this.listenTo(this.layout, "show", () => {
        this.getSubNav();
        return this.getForm();
      });

      //# Render the layout
      return App.regionContent.show(this.layout);
    }

    getLayoutView() {
      return new App.SettingsApp.Show.Layout();
    }

    getSubNav() {
      const subNav = App.request('settings:subnav');
      return this.layout.regionSidebarFirst.show(subNav);
    }

    // Get the addon controller
    addonController() {
      return App.request("command:kodi:controller", 'auto', 'AddOn');
    }

    getAllAddons(callback) {
      return this.addonController().getAllAddons(callback);
    }

    getForm() {
      return this.getAllAddons(addons => {
        const options = {
          form: this.getStructure(addons),
          formState: [],
          config: {
            attributes: {class: 'settings-form'},
            callback: (data, formView) => {
              return this.saveCallback(data, formView);
            }
          }
        };
        const form = App.request("form:wrapper", options);
        return this.layout.regionContent.show(form);
      });
    }

    getStructure(addons) {
      let i;
      const form = [];
      const types = [];
      for (i in addons) {
        var addon = addons[i];
        types[addon.type] = true;
      }
      for (var type in types) {
        // Parse addons into checkboxes.
        var enabled = types[type];
        var elements = _.where(addons, {type});
        for (i in elements) {
          var el = elements[i];
          elements[i] = $.extend(el, {
            id: el.addonid,
            name: el.addonid,
            type: 'checkbox',
            defaultValue: el.enabled,
            title: el.name
          });
        }
        // Create fieldsets.
        form.push({
          title: type,
          id: type,
          children: elements
        });
      }
      return form;
    }


    // Save only changed values
    saveCallback(data, formView) {
      const updating = [];
      return this.getAllAddons(function(addons) {
        let key;
        for (key in addons) {
          var addon = addons[key];
          var {
            addonid
          } = addon;
          // If form data differs from kodi
          if (addon.enabled === !data[addonid]) {
            updating[addonid] = data[addonid];
          }
        }

        // Update all changed keys
        const commander = App.request("command:kodi:controller", 'auto', 'Commander');
        const commands = [];
        for (key in updating) {
          var val = updating[key];
          commands.push({method: 'Addons.SetAddonEnabled', params: [key, val]});
        }
        return commander.multipleCommands(commands, resp => {
          // Notify.
          return Kodi.execute("notification:show", 'Toggled ' + commands.length + ' addons');
        });
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show.Kodi", (Kodi, App, Backbone, Marionette, $, _) => (function() {
  let API = undefined;
  const Cls = (Kodi.Controller = class Controller extends App.Controllers.Base {
    static initClass() {

      API = {

        // To turn an addon text field into a select with a list of available addons
        // Key is the setting id, Val is the type of addon (see #settings/addons)
        optionLookups: {
          'lookandfeel.skin': 'xbmc.gui.skin',
          'locale.language': 'kodi.resource.language',
          'screensaver.mode': 'xbmc.ui.screensaver',
          'musiclibrary.albumsscraper' : 'xbmc.metadata.scraper.albums',
          'musiclibrary.artistsscraper' : 'xbmc.metadata.scraper.artists',
          'musicplayer.visualisation' : 'xbmc.player.musicviz',
          'services.webskin' : 'xbmc.webinterface', // No don't go...
          'subtitles.tv' : 'xbmc.subtitle.module',
          'subtitles.movie' : 'xbmc.subtitle.module',
          'audiocds.encoder' : 'xbmc.audioencoder'
        },

        // Enabled actions, A trigger must be supplied for each
        actionLookups: {
          "musiclibrary.cleanup" : "command:kodi:audio:clean",
          "videolibrary.cleanup" : "command:kodi:video:clean"
        },

        // Turn the returned options into form friendly select options.
        parseOptions(options) {
          const out = {};
          $(options).each((i, option) => out[option.value] = option.label);
          return out;
        },

        // Not ideal solution to vague labels introduced in v17+
        labelRewrites(item) {
          if (item.id.lastIndexOf('videolibrary', 0) === 0) {
            item.title += ' (video)';
          }
          if (item.id.lastIndexOf('musiclibrary', 0) === 0) {
            item.title += ' (music)';
          }
          return item;
        }
      };
    }

    initialize(options) {

      // Get and setup the layout
      this.layout = this.getLayoutView();
      this.listenTo(this.layout, "show", () => {
        this.getSubNav();
        if (options.section) {
          return this.getSettingsForm(options.section);
        }
      });

      // Render the layout
      return App.regionContent.show(this.layout);
    }

    getLayoutView() {
      return new App.SettingsApp.Show.Layout();
    }

    getSubNav() {
      const subNav = App.request('settings:subnav');
      return this.layout.regionSidebarFirst.show(subNav);
    }

    getSettingsForm(section) {
      const formStructure = [];

      // Get the category collection
      const categoryCollection = App.request("settings:kodi:entities", {type: 'categories', section});
      return App.execute("when:entity:fetched", categoryCollection, () => {

        // Do a multi lookup to get all settings for this section.
        const categoryNames = categoryCollection.pluck("id");
        const categories = categoryCollection.toJSON();
        return App.request("settings:kodi:filtered:entities", {
          type: 'settings',
          section,
          categories: categoryNames,

          // Category settings fetched.
          callback: categorySettings => {
            // Build a fieldset for each section
            $(categories).each((i, category) => {
              // only if not empty.
              const items = this.mapSettingsToElements(categorySettings[category.id]);
              if (items.length > 0) {
                return formStructure.push({
                  title: category.title,
                  id: category.id,
                  children: items
                });
              }
          });

            // Render the form
            return this.getForm(section, formStructure);
          }
        }
        );
      });
    }


    getForm(section, formStructure) {
      const options = {
        form: formStructure,
        config: {
          attributes: {class: 'settings-form'},
          callback: (data, formView) => {
            return this.saveCallback(data, formView);
          }
        }
      };
      const form = App.request("form:wrapper", options);
      return this.layout.regionContent.show(form);
    }

    // Turn a group of addon types into an array for form options
    getAddonOptions(elId, value) {
      const mappedType = API.optionLookups[elId];
      const options = [];
      const lookup = {};
      if (mappedType) {
        const addons = App.request('addon:enabled:addons');
        const filteredAddons = _.where(addons, {type: mappedType});
        for (var i in filteredAddons) {
          // Key by addon id, Value is name
          var addon = filteredAddons[i];
          options.push({value: addon.addonid, label: addon.name});
          lookup[addon.addonid] = true;
        }
        // If value isn't in the options, we add it
        if (!lookup[value]) {
          options.push({value, label: value});
        }
        return options;
      }
      return false;
    }

    // Map Kodi types to form types in the web form
    mapSettingsToElements(items) {
      const elements = [];

      // For each setting.
      $(items).each((i, item) => {
        let options;
        let type = null;

        // Get type
        switch (item.type) {
          case 'boolean':
            type = 'checkbox';
            break;
          case 'path':
            type = 'textfield';
            break;
          case 'addon':
            options = this.getAddonOptions(item.id, item.value);
            if (options) {
              item.options = options;
            } else {
              type = 'textfield';
            }
            break;
          case 'integer':
            type = 'textfield';
            break;
          case 'string':
            type = 'textfield';
            break;
          case 'action':
            if (API.actionLookups[item.id]) {
              type = 'button';
              item.value = item.label;
              item.trigger = API.actionLookups[item.id];
            } else {
              type = 'hide';
            }
            break;
          default:
            type = 'hide';
        }

        if (item.options) {
          type = 'select';
          item.options = API.parseOptions(item.options);
        }

        // Update vague labels
        item = API.labelRewrites(item);

        if (type === 'hide') {
          return console.log('no setting to field mapping for: ' + item.type + ' -> ' + item.id);
        } else {
          item.type = type;
          item.defaultValue = item.value;

          // add to elements
          return elements.push(item);
        }
      });

      return elements;
    }

    saveCallback(data, formView) {
      return App.execute("settings:kodi:save:entities", data, resp => {
        App.execute("notification:show", t.gettext("Saved Kodi settings"));
        App.vent.trigger("config:local:updated", {});
        return App.vent.trigger("config:kodi:updated", data);
      });
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show.Kodi", function(Kodi, App, Backbone, Marionette, $, _) {});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show.Local", function(Local, App, Backbone, Marionette, $, _) {

  return Local.Controller = class Controller extends App.Controllers.Base {

    initialize() {

      //# Get and setup the layout

      this.layout = this.getLayoutView();
      this.listenTo(this.layout, "show", () => {
        this.getSubNav();
        return this.getForm();
      });

      //# Render the layout
      return App.regionContent.show(this.layout);
    }

    getLayoutView() {
      return new App.SettingsApp.Show.Layout();
    }

    getSubNav() {
      const subNav = App.request('settings:subnav');
      return this.layout.regionSidebarFirst.show(subNav);
    }

    getForm() {
      const options = {
        form: this.getStructure(),
        formState: this.getState(),
        config: {
          attributes: {class: 'settings-form'},
          callback: (data, formView) => {
            return this.saveCallback(data, formView);
          }
        }
      };
      const form = App.request("form:wrapper", options);
      return this.layout.regionContent.show(form);
    }

    getStructure() {
      return [
        {
          title: 'General options',
          id: 'general',
          children:[
            {id: 'lang', title: tr("Language"), type: 'select', options: helpers.translate.getLanguages(), defaultValue: 'en', description: tr('Preferred language, need to refresh browser to take effect')},
            {id: 'defaultPlayer', title: tr("Default player"), type: 'select', options: {auto: 'Auto', kodi: 'Kodi', local: 'Local'}, defaultValue: 'auto', description: tr('Which player to start with')},
            {id: 'keyboardControl', title: tr("Keyboard controls"), type: 'select', options: {kodi: 'Kodi', local: 'Browser', both: 'Both'}, defaultValue: 'kodi', description: tr('In Chorus, will you keyboard control Kodi, the browser or both') + '. <a href="#help/keybind-readme">' + tr('Learn more') + '</a>'}
          ]
        },
        {
          title: 'List options',
          id: 'list',
          children:[
            {id: 'ignoreArticle', title: tr("Ignore article"), type: 'checkbox', defaultValue: true, description: tr("Ignore articles (terms such as 'The' and 'A') when sorting lists")},
            {id: 'albumArtistsOnly', title: tr("Album artists only"), type: 'checkbox', defaultValue: true, description: tr('When listing artists should we only see artists with albums or all artists found. Warning: turning this off can impact performance with large libraries')},
            {id: 'playlistFocusPlaying', title: tr("Focus playlist on playing"), type: 'checkbox', defaultValue: true, description: tr('Automatically scroll the playlist to the current playing item. This happens whenever the playing item is changed')}
          ]
        },
        {
          title: 'Appearance',
          id: 'appearance',
          children:[
            {id: 'vibrantHeaders', title: tr("Vibrant headers"), type: 'checkbox', defaultValue: true, description: tr("Use colourful headers for media pages")},
            {id: 'disableThumbs', title: tr("Disable Thumbs Up"), type: 'checkbox', defaultValue: false, description: t.sprintf(tr("Remove the thumbs up button from media. Note: you may also want to remove the menu item from the %1$s"), '<a href="#settings/nav">' + tr('Main Nav') + '</a>')},
            {id: 'showDeviceName', title: tr("Show device name"), type: 'checkbox', defaultValue: false, description: tr("Show the Kodi device name in the header of Chorus")}
          ]
        },
        {
          title: 'Advanced options',
          id: 'advanced',
          children:[
            {id: 'socketsPort', title: tr("Websockets port"), type: 'textfield', defaultValue: '9090', description: "9090 " + tr("is the default")},
            {id: 'socketsHost', title: tr("Websockets host"), type: 'textfield', defaultValue: 'auto', description: tr("The hostname used for websockets connection. Set to 'auto' to use the current hostname.")},
            {id: 'pollInterval', title: tr("Poll interval"), type: 'select', defaultValue: '10000', options: {'5000': "5 " + tr('sec'), '10000': "10 " + tr('sec'), '30000': "30 " + tr('sec'), '60000': "60 " + tr('sec')}, description: tr("How often do I poll for updates from Kodi (Only applies when websockets inactive)")},
            {id: 'kodiSettingsLevel', title: tr("Kodi settings level"), type: 'select', defaultValue: 'standard', options: {'standard': 'Standard', 'advanced': 'Advanced', 'expert': 'Expert'}, description: tr('Advanced setting level is recommended for those who know what they are doing.')},
            {id: 'reverseProxy', title: tr("Reverse proxy support"), type: 'checkbox', defaultValue: false, description: tr('Enable support for reverse proxying.')},
            {id: 'refreshIgnoreNFO', title: tr("Refresh Ignore NFO"), type: 'checkbox', defaultValue: true, description: tr('Ignore local NFO files when manually refreshing media.')}
          ]
        },
        {
          title: 'API Keys',
          id: 'apikeys',
          children:[
            {id: 'apiKeyTMDB', title: tr("The Movie DB"), type: 'textfield', defaultValue: '', description: tr("Set your personal API key")},
            {id: 'apiKeyFanartTv', title: tr("FanartTV"), type: 'textfield', defaultValue: '', description: tr("Set your personal API key")},
            {id: 'apiKeyYouTube', title: tr("YouTube"), type: 'textfield', defaultValue: '', description: tr("Set your personal API key")}
          ]
        }
      ];
    }

    //# Get settings from local storage
    getState() {
      return config.get('app', 'config:local', config.static);
    }

    //# Save the settings to local storage.
    saveCallback(data, formView) {
      // Save to local storage
      config.set('app', 'config:local', data);
      // Update current session
      config.static = _.extend(config.static, config.get('app', 'config:local', config.static));
      // Notify.
      Kodi.vent.trigger("config:local:updated", config.static);
      return Kodi.execute("notification:show", tr("Web Settings saved."));
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show.navMain", function(NavMain, App, Backbone, Marionette, $, _) {

  //# There is a lot of jQuery'ing happening in this file, if you require the same functionality
  //# again (draggable lists) you should abstract it in a nicer way
  return NavMain.Controller = class Controller extends App.SettingsApp.Show.Base.Controller {

    // Callback gets passed the collection to process
    constructor(...args) {
      super(...args);
      this.onReady = this.onReady.bind(this);
    }

    getCollection(callback) {
      const collection = App.request('navMain:entities');
      return $.getJSON('lib/icons/mdi.json', iconList => callback({
        collection,
        icons: iconList
      }));
    }

    // Passed the collection and returns form structure
    getStructure(data) {
      this.data = data;
      // Form header/intro
      const defaults = ' <a class="nav-restore-defaults">' + t.gettext('Click here restore defaults') + '</a>';
      const iconLink = '<a href="#lab/icon-browser">icons</a>';
      const form = [{
        title: t.gettext('Main Menu Structure'),
        id: 'intro',
        children: [{
          id: 'intro-text',
          type: 'markup',
          markup: t.sprintf(tr('Here you can change the title, url and %1$s for menu items. You can also remove, re-order and add new items.'), iconLink) + defaults
        }
        ]
      }
      ];
      // Return a form structure
      const object = data.collection.getRawCollection();
      for (var i in object) {
        var item = object[i];
        item.weight = i;
        var row = this.getRow(item, data.icons);
        form.push(row);
      }
      form.push({
        id: 'add-another',
        class: 'add-another-wrapper',
        children: [
          {type: 'button', value: 'Add another', id: 'add-another'}
        ]
      });
      return form;
    }

    // Save only changed values
    saveCallback(formState, formView) {
      // Parse the elements into items
      const items = [];
      for (var i in formState.title) {
        var item = formState.title[i];
        items.push({
          title: formState.title[i],
          path: formState.path[i],
          icon: formState.icon[i],
          weight: formState.weight[i],
          id: formState.id[i],
          parent: 0
        });
      }
      // Save items, refresh page and show notification
      App.request("navMain:update:entities", items);
      App.vent.trigger("navMain:refresh");
      return Kodi.execute("notification:show", t.gettext('Menu updated'));
    }

    // The form has been rendered
    onReady() {
      const self = this;
      const $ctx = this.layout.regionContent.$el;
      $('.settings-form').addClass('settings-form-draggable');
      this.binds();

      // Add another button callback
      $('#form-edit-add-another', $ctx).click(function(e) {
        e.preventDefault();
        const blank = {weight: $(".nav-item-row").length + 1, title: '', path: '', icon: 'mdi-action-extension'};
        const row = self.getRow(blank);
        const formView = App.request("form:render:items", [row]);
        $(this).closest('.add-another-wrapper').before(formView.render().$el);
        return self.binds();
      });

      // Reordering and dragging (large screen only)
      if ($(window).width() > config.getLocal('largeBreakpoint')) {
        $('.form-groups', $ctx).sortable({
          draggable: ".draggable-row",
          onEnd(e) {
            return $('input[id^="form-edit-weight-"]', e.target).each((i, d) => $(d).attr('value', i));
          }
        });
      }

      // Reset default link
      return $('.nav-restore-defaults', $ctx).on("click", e => {
        e.preventDefault();
        App.request("navMain:update:defaults");
        this.initialize();
        return App.vent.trigger("navMain:refresh");
      });
    }

    // Things to refresh after render
    binds() {
      const $ctx = $('.settings-form');
      $('select[id^="form-edit-icon"]', $ctx).once('icon-changer').on("change", function(e) {
        return $(this).closest('.group-parent', $ctx).find('i').first().attr('class', $(this).val());
      });
      $('.remove-item', $ctx).on("click", function(e) {
        return $(this).closest('.group-parent', $ctx).remove();
      });
      return $.material.init();
    }

    // Get the form structure for a row
    getRow(item) {
      const {
        icons
      } = this.data;
      const i = item.weight;
      const icon = '<i class="' + item.icon + '"></i>';
      return {
        id: 'item-' + item.weight,
        class: 'nav-item-row draggable-row',
        children: [
          {id: 'title-' + i, name: 'title[]', type: 'textfield', title: 'Title', defaultValue: item.title},
          {id: 'path-' + i, name: 'path[]', type: 'textfield', title: 'Url', defaultValue: item.path},
          {id: 'icon-' + i, name: 'icon[]', type: 'select', titleHtml: 'Icon' + icon, defaultValue: item.icon, options: icons},
          {id: 'weight-' + i, name: 'weight[]', type: 'hidden', title: '', defaultValue: i},
          {id: 'id-' + i, name: 'id[]', type: 'hidden', title: '', defaultValue: (1000 + i)},
          {id: 'remove-' + i, type: 'markup', markup: '<span class="remove-item">&times;</span>'}
        ]
      };
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show.Search", function(Search, App, Backbone, Marionette, $, _) {

  return Search.Controller = class Controller extends App.SettingsApp.Show.Base.Controller {

    // Callback gets passed the collection to process
    constructor(...args) {
      super(...args);
      this.onReady = this.onReady.bind(this);
    }

    getCollection(callback) {
      this.collection = App.request('searchAddons:entities');
      return callback(this.collection);
    }

    // Passed the collection and returns form structure
    getStructure(data) {
      this.data = data;
      // Form header/intro
      const form = [{
        title: t.gettext('Custom Add-on search'),
        id: 'intro',
        children: [{
          id: 'intro-text',
          type: 'markup',
          markup: t.sprintf(tr("Add custom add-on searches"), '<a href="#help/addons">' + tr('Add-ons help page') + '</a>')
        }
        ]
      }
      ];
      // Return a form structure
      const items = this.collection.toJSON();
      if (items.length === 0) {
        items.push(this.getBlank(items.length));
      }
      for (var i in items) {
        var item = items[i];
        item.weight = i;
        var row = this.getRow(item);
        form.push(row);
      }
      form.push({
        id: 'add-another',
        class: 'add-another-wrapper',
        children: [
          {type: 'button', value: 'Add another', id: 'add-another'}
        ]
      });
      return form;
    }

    // Save only changed values
    saveCallback(formState, formView) {
      // Parse the elements into items
      const items = [];
      for (var i in formState.title) {
        var item = formState.title[i];
        items.push({
          title: formState.title[i],
          url: formState.url[i],
          media: formState.media[i],
          weight: formState.weight[i],
          id: formState.id[i]
        });
      }
      // Save items, refresh page and show notification
      App.request("searchAddons:update:entities", items);
      return Kodi.execute("notification:show", t.gettext('Custom Addon search updated'));
    }

    // The form has been rendered
    onReady() {
      const self = this;
      const $ctx = this.layout.regionContent.$el;
      $('.settings-form').addClass('settings-form-draggable');
      this.binds();

      // Reordering and dragging (large screen only)
      if ($(window).width() > config.getLocal('largeBreakpoint')) {
        $('.form-groups', $ctx).sortable({
          draggable: ".draggable-row",
          onEnd(e) {
            return $('input[id^="form-edit-weight-"]', e.target).each((i, d) => $(d).attr('value', i));
          }
        });
      }

      // Add another button callback
      $('#form-edit-add-another', $ctx).click(function(e) {
        e.preventDefault();
        const blank = self.getBlank($(".item-row").length);
        const row = self.getRow(blank);
        const formView = App.request("form:render:items", [row]);
        $(this).closest('.add-another-wrapper').before(formView.render().$el);
        return self.binds();
      });

      // Reset default link
      return $('.restore-defaults', $ctx).on("click", e => {});
    }
        // this should clear all.

    getBlank(weight) {
      return {weight, title: '', url: '', media: 'music'};
    }

    // Things to refresh after render
    binds() {
      const $ctx = $('.settings-form');
      $('.remove-item', $ctx).on("click", function(e) {
        return $(this).closest('.group-parent', $ctx).remove();
      });
      return $.material.init();
    }

    // Get the form structure for a row
    getRow(item) {
      const i = item.weight;
      return {
        id: 'item-' + item.weight,
        class: 'item-row draggable-row',
        children: [
          {id: 'title-' + i, name: 'title[]', type: 'textfield', title: 'Title', defaultValue: item.title},
          {id: 'url-' + i, name: 'url[]', type: 'textfield', title: 'Url', defaultValue: item.url},
          {id: 'media-' + i, name: 'media[]', type: 'select', title: 'Media', defaultValue: item.media, options: {music: 'Music', video: 'Video'}},
          {id: 'weight-' + i, name: 'weight[]', type: 'hidden', title: '', defaultValue: i},
          {id: 'id-' + i, name: 'id[]', type: 'hidden', title: '', defaultValue: 'custom.addon.' + i},
          {id: 'remove-' + i, type: 'markup', markup: '<span class="remove-item">&times;</span>'}
        ]
      };
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SettingsApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  let Cls = (Show.Layout = class Layout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "settings-page";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Show.Sidebar = class Sidebar extends App.Views.LayoutView {
      static initClass() {
        this.prototype.className = "settings-sidebar";
        this.prototype.template = "apps/settings/show/settings_sidebar";
        this.prototype.tagName = "div";
        this.prototype.regions = {
          regionKodiNav: '.kodi-nav',
          regionLocalNav: '.local-nav'
        };
      }
    });
    Cls.initClass();
    return Cls;
  })();
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Shell", function(Shell, App, Backbone, Marionette, $, _) {

  const Cls = (Shell.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        ""        : "homePage",
        "home"    : "homePage"
      };
    }
  });
  Cls.initClass();


  const API = {

    homePage() {
      const home = new Shell.HomepageLayout();
      App.regionContent.show(home);
      this.setFanart();
      //# Change the fanart when the state changes.
      App.vent.on("state:changed", state => {
        const stateObj = App.request("state:current");
        if (stateObj.isPlayingItemChanged() && (helpers.url.arg(0) === '')) {
          return this.setFanart();
        }
      });
      //# Ensure background removed when we leave.
      return App.listenTo(home, "destroy", () => {
        return App.execute("images:fanart:set", 'none');
      });
    },

    setFanart() {
      const stateObj = App.request("state:current");
      if (stateObj != null) {
        const playingItem = stateObj.getPlaying('item');
        return App.execute("images:fanart:set", playingItem.fanart);
      } else {
        return App.execute("images:fanart:set");
      }
    },

    //# Render the shell.
    renderLayout() {

      //# Render Shell and assign its regions to the app.
      const shellLayout = new Shell.Layout();
      App.root.show( shellLayout );
      App.addRegions(shellLayout.regions);

      //# Kick of loading.
      App.execute("loading:show:page");

      //# Set title.
      this.setAppTitle();

      //# Get playlist state.
      let playlistState = config.get('app', 'shell:playlist:state', 'open');
      if (playlistState === 'closed') {
        this.alterRegionClasses('add', "shell-playlist-closed");
      }

      //# Update config options
      this.configUpdated();
      App.vent.on("config:local:updated", data => {
        return this.configUpdated();
      });

      //# Listen for active filtering
      App.vent.on("filter:filtering:start", () => {
        return this.alterRegionClasses('add', "filters-loading");
      });
      App.vent.on("filter:filtering:stop", () => {
        return this.alterRegionClasses('remove', "filters-loading");
      });

      //# Listen for changes to the playlist state.
      App.listenTo(shellLayout, "shell:playlist:toggle", (child, args) => {
        playlistState = config.get('app', 'shell:playlist:state', 'open');
        const state = playlistState === 'open' ? 'closed' : 'open';
        config.set('app', 'shell:playlist:state', state);
        return this.alterRegionClasses('toggle', "shell-playlist-closed");
      });

      //# Listen to reconnect.
      App.listenTo(shellLayout, "shell:reconnect", () => {
        return App.execute('shell:reconnect');
      });

      //# Additional listeners
      this.bindListenersContextMenu(shellLayout);
      return this.bindListenersSelectedMenu(shellLayout);
    },


    //# Alter region classes.
    alterRegionClasses(op, classes, region = 'root') {
      const $body = App.getRegion(region).$el;
      const action = `${op}Class`;
      return $body[action](classes);
    },

    //# Config updated. We might need to add or remove some shell classes.
    configUpdated() {
      //# Are thumbs disabled.
      const disableThumbs = config.getLocal('disableThumbs', false);
      const disableThumbsClassOp = disableThumbs === true ? 'add' : 'remove';
      this.alterRegionClasses(disableThumbsClassOp, 'disable-thumbs');
      return this.setAppTitle();
    },

    //# Set app title.
    setAppTitle() {
      App.getRegion('regionTitle').$el.text('');
      if (config.getLocal('showDeviceName', false) === true) {
        const settingsController = App.request("command:kodi:controller", 'auto', 'Settings');
        return settingsController.getSettingValue('services.devicename', title => App.getRegion('regionTitle').$el.text(title));
      }
    },

    // Shell listeners for context menu.
    bindListenersContextMenu(shellLayout) {
      // Library
      App.listenTo(shellLayout, "shell:audio:scan", () => App.request("command:kodi:controller", 'auto', 'AudioLibrary').scan());
      App.listenTo(shellLayout, "shell:video:scan", () => App.request("command:kodi:controller", 'auto', 'VideoLibrary').scan());
      // Pages
      App.listenTo(shellLayout, "shell:goto:lab", () => App.navigate("#lab", {trigger: true}));
      App.listenTo(shellLayout, "shell:about", () => App.navigate("#help", {trigger: true}));
      // Input box
      return App.listenTo(shellLayout, "shell:send:input", () => App.execute("input:textbox", ''));
    },

    // Shell listeners for selected menu
    bindListenersSelectedMenu(shellLayout) {
      App.listenTo(shellLayout, "shell:selected:play", () => App.execute("selected:action:play"));
      App.listenTo(shellLayout, "shell:selected:add", () => App.execute("selected:action:add"));
      return App.listenTo(shellLayout, "shell:selected:localadd", () => App.execute("selected:action:localadd"));
    }
  };


  //# On start
  App.addInitializer(() => App.commands.setHandler("shell:view:ready", function() {

      //# Render components.
    API.renderLayout();

    //# Shell Router
    new Shell.Router({
      controller: API});

    //# Tell everyone, shell is ready.
    App.vent.trigger("shell:ready");

    //# Add, Remove, Toggle classes on body.
    return App.commands.setHandler("body:state", (op, state) => API.alterRegionClasses(op, state));
  }));


  //# Attempt Kodi reconnect
  App.commands.setHandler('shell:reconnect', function() {
    API.alterRegionClasses('add', 'reconnecting');
    return helpers.connection.reconnect(function() {
      // Success.
      API.alterRegionClasses('remove', 'lost-connection');
      return API.alterRegionClasses('remove', 'reconnecting');
    });
  });




  //# Kodi disconnected
  return App.commands.setHandler('shell:disconnect', function() {
    API.alterRegionClasses('add', 'lost-connection');
    API.alterRegionClasses('remove', 'reconnecting');
    return helpers.connection.disconnect(function() {});
  });
});
      // Kodi disconnect.
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("Shell", function(Shell, App, Backbone, Marionette, $, _) {

  let Cls = (Shell.Layout = class Layout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = "apps/shell/show/shell";
  
      this.prototype.regions = {
        regionNav: '#nav-bar',
        regionContent: '#content',
        regionSidebarFirst: '#sidebar-first',
        regionPlaylist: '#playlist-bar',
        regionTitle: '#page-title .title',
        regionTitleContext: '#page-title .context',
        regionFanart: '#fanart',
        regionPlayerKodi: '#player-kodi',
        regionPlayerLocal: '#player-local',
        regionModal: '#modal-window',
        regionModalTitle: '.modal-title',
        regionModalBody: '.modal-body',
        regionModalFooter: '.modal-footer',
        regionRemote: '#remote',
        regionSearch: '#search-region',
        regionTitle: '#page-title .title',
        regionOffscreen: '#offscreen'
      };
  
      this.prototype.triggers = {
        "click .playlist-toggle-open": "shell:playlist:toggle",
        "click .audio-scan": "shell:audio:scan",
        "click .video-scan": "shell:video:scan",
        "click .goto-lab": "shell:goto:lab",
        "click .send-input": "shell:send:input",
        "click .about": "shell:about",
        "click .selected-play": "shell:selected:play",
        "click .selected-add": "shell:selected:add",
        "click .selected-localadd": "shell:selected:localadd",
        "click .reconnect": "shell:reconnect"
      };
  
      this.prototype.events =
        {"click .player-menu > li": "closePlayerMenu"};
    }

    closePlayerMenu() {
      return App.execute("ui:playermenu", 'close');
    }
  });
  Cls.initClass();


  Cls = (Shell.HomepageLayout = class HomepageLayout extends Backbone.Marionette.LayoutView {
    static initClass() {
      this.prototype.template = "apps/shell/show/homepage";
    }
  });
  Cls.initClass();

  return App.execute("shell:view:ready");
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SongApp.Edit", function(Edit, App, Backbone, Marionette, $, _) {

  return Edit.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      let form;
      this.model = this.getOption('model');
      const options = {
        titleHtml: '<span>' + tr('Edit') + '</span>' + this.model.escape('title'),
        form: this.getStructure(),
        formState: this.model.attributes,
        config: {
          attributes: {class: 'edit-form'},
          editForm: true,
          tabs: true,
          callback: (data, formView) => {
            return this.saveCallback(data, formView);
          }
        }
      };
      return form = App.request("form:popup:wrapper", options);
    }

    getStructure() {
      return [
        {
          title: 'General',
          id: 'general',
          children:[
            {id: 'title', title: tr('Title'), type: 'textfield'},
            {id: 'artist', title: tr('Artist'), type: 'textfield', format: 'array.string'},
            {id: 'albumartist', title: tr('Album artist'), type: 'textfield', format: 'array.string'},
            {id: 'album', title: tr('Album'), type: 'textfield'},
            {id: 'year', title: tr('Year'), type: 'number', format: 'integer', attributes: {class: 'half-width', step: 1, min: 1000, max: 9999}},
            {id: 'rating', title: tr('Rating'), type: 'number', format: 'float', attributes: {class: 'half-width', step: 0.1, min: 0, max: 10}, suffix: '<div class="clearfix"></div>'},
            {id: 'track', title: tr('Track'), type: 'textfield', format: 'integer', attributes: {class: 'half-width'}},
            {id: 'disc', title: tr('Disc'), type: 'textfield', format: 'integer', attributes: {class: 'half-width'}, suffix: '<div class="clearfix"></div>'}
          ]
        },
        {
          title: 'Tags',
          id: 'tags',
          children:[
            {id: 'genre', title: tr('Genres'), type: 'textfield', format: 'array.string'},
          ]
        },
        {
          title: 'Information',
          id: 'info',
          children:[
            {id: 'file', title: tr('File path'), type: 'textarea', attributes: {disabled: 'disabled', cols: 5}, format: 'prevent.submit'},
          ]
        }
      ];
    }

    //# Save the settings to Kodi
    saveCallback(data, formView) {
      const controller = App.request("command:kodi:controller", 'audio', 'AudioLibrary');
      return controller.setSongDetails(this.model.get('id'), data, () => {
        Kodi.vent.trigger('entity:kodi:update', this.model.get('uid'));
        return Kodi.execute("notification:show", t.sprintf(tr("Updated %1$s details"), 'song'));
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SongApp.List", function(List, App, Backbone, Marionette, $, _) {

  const API = {

    //# Render the song view and attach to triggers
    getSongsView(songs, verbose = false) {
      this.songsView = new List.Songs({
        collection: songs,
        verbose
      });

      //# Triggers/Actions on a song
      App.listenTo(this.songsView, 'childview:song:play', (list, item) => {
        return this.playSong(item.model.get('songid'));
      });
      App.listenTo(this.songsView, 'childview:song:add', (list, item) => {
        return this.addSong(item.model.get('songid'));
      });
      App.listenTo(this.songsView, 'childview:song:localadd', (list, item) => {
        return this.localAddSong(item.model.get('songid'));
      });
      App.listenTo(this.songsView, 'childview:song:localplay', (list, item) => {
        return this.localPlaySong(item.model.get('songid'));
      });
      App.listenTo(this.songsView, 'childview:song:download', (list, item) => {
        return this.downloadSong(item.model);
      });
      App.listenTo(this.songsView, 'childview:song:musicvideo', (list, item) => {
        return App.execute("youtube:search:popup", item.model.get('label') + ' ' + item.model.get('artist'));
      });
      App.listenTo(this.songsView, 'childview:song:edit', (parent, item) => App.execute('song:edit', item.model));

      //# Potentially one of the songs could be playing so trigger a content state update
      App.listenTo(this.songsView, "show", () => App.vent.trigger("state:content:updated"));

      return this.songsView;
    },

    //# Play a tune
    playSong(songId) {
      return App.execute("command:audio:play", 'songid', songId);
    },

    //# Add a song to the list
    addSong(songId) {
      return App.execute("command:audio:add", 'songid', songId);
    },
      // playlist = App.request "command:kodi:controller", 'audio', 'PlayList'
      // playlist.add 'songid', songId

    //# Add the song to a local playlist
    localAddSong(songId) {
      return App.execute("localplaylist:addentity", 'songid', songId);
    },

    //# play the song locally
    localPlaySong(songId) {
      const localPlaylist = App.request("command:local:controller", 'audio', 'PlayList');
      return localPlaylist.play('songid', songId);
    },

    //# Download the song
    downloadSong(model) {
      const files = App.request("command:kodi:controller", 'video', 'Files');
      return files.downloadFile(model.get('file'));
    }
  };

  //# handler for other modules to get a songs view.
  return App.reqres.setHandler("song:list:view", (songs, verbose = false) => API.getSongsView(songs, verbose));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SongApp.List", function(List, App, Backbone, Marionette, $, _) {

  //# Single song row
  let Cls = (List.Song = class Song extends App.Views.ItemView {
    static initClass() {
      this.prototype.template = 'apps/song/list/song';
      this.prototype.tagName = "tr";
  
      this.prototype.triggers = {
        "click .play"            : "song:play",
        "dblclick .song-title"   : "song:play",
        "click .add"             : "song:add",
        "click .song-localadd"   : "song:localadd",
        "click .song-download"   : "song:download",
        "click .song-localplay"  : "song:localplay",
        "click .song-musicvideo" : "song:musicvideo",
        "click .song-remove"     : "song:remove",
        "click .song-edit"            : "song:edit"
      };
  
      this.prototype.events = {
        "click .dropdown > i": "populateModelMenu",
        "click .thumbs" : "toggleThumbs",
        "click": "toggleSelect"
      };
  
      //# This triggers a re-render on model update
      this.prototype.modelEvents =
        {'change': 'render'};
    }
    initialize() {
      super.initialize(...arguments);
      if (this.model) {
        const duration = helpers.global.secToTime(this.model.get('duration'));
        const menu = {
          'song-localadd': 'Add to playlist',
          'song-download': 'Download song',
          'song-localplay': 'Play in browser',
          'song-musicvideo': 'Music video',
          'divider' : '',
          'song-edit': 'Edit'
        };
        return this.model.set({displayDuration: helpers.global.formatTime(duration), menu});
      }
    }

    toggleThumbs() {
      App.request("thumbsup:toggle:entity", this.model);
      this.$el.toggleClass('thumbs-up');
      return $('.plitem-' + this.model.get('type') + '-' + this.model.get('id')).toggleClass('thumbs-up');
    }

    attributes() {
      if (this.model) {
        const classes = ['song', 'table-row', 'can-play', 'item-' + this.model.get('uid')];
        if (App.request("thumbsup:check", this.model)) {
          classes.push('thumbs-up');
        }
        return {
          'class': classes.join(' '),
          'data-id': this.model.id
        };
      }
    }

    onShow() {
      return this.menuBlur();
    }

    onRender() {
      return this.$el.data('model', this.model);
    }
  });
  Cls.initClass();


  //# Song list
  return (function() {
    Cls = (List.Songs = class Songs extends App.Views.VirtualListView {
      static initClass() {
        this.prototype.childView = List.Song;
        this.prototype.placeHolderViewName = 'SongViewPlaceholder';
        this.prototype.cardSelector = '.song';
        this.prototype.preload = 40;
        this.prototype.tagName = "table";
      }
      attributes() {
        const verbose = this.options.verbose ? 'verbose' : 'basic';
        return {
          class: 'songs-table table table-hover ' + verbose
        };
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("SongApp", (SongApp, App, Backbone, Marionette, $, _) => App.commands.setHandler('song:edit', function(model) {
  const loadedModel = App.request("song:entity", model.get('songid'));
  return App.execute("when:entity:fetched", loadedModel, () => {
    return new SongApp.Edit.Controller({
      model: loadedModel});
  });
}));

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("StateApp", (StateApp, App, Backbone, Marionette, $, _) => //# This outlines the common structure and helpers to be shared
//# between the Kodi and local player states.
(function() {
  const Cls = (StateApp.Base = class Base extends Marionette.Object {
    static initClass() {

      this.prototype.instanceSettings = {};

      this.prototype.state = {
        player: 'kodi',
        media: 'audio',
        volume: 50,
        lastVolume: 50, //# used for toggling mute
        muted: false,
        shuffled: false,
        repeat: 'off', // 'off'/'one'/'all'
        version: {major: 15, minor: 0}
      };

      this.prototype.playing = {
        playing: false, // false = stopped, true = playing or paused
        paused: false,
        playState: '', // playing or paused
        item: {},
        media: 'audio',
        itemChanged: false, // if the item has changed since last check
        latPlaying: '', // What was playing last time we checked
        canrepeat: true,
        canseek: true,
        canshuffle: true,
        partymode: false,
        percentage: 0,
        playlistid: 0,
        position: 0,
        speed: 0, // 1 is playing, 0 is paused
        time: {
          hours: 0,
          milliseconds: 0,
          minutes: 0,
          seconds: 0
        },
        totaltime: {
          hours: 0,
          milliseconds: 0,
          minutes: 0,
          seconds: 0
        }
      };

      this.prototype.defaultPlayingItem = {
        thumbnail: '',
        fanart: '',
        id: 0,
        songid: 0,
        episodeid: 0,
        album: '',
        albumid: '',
        duration: 0,
        type: 'song'
      };
    }

    getState(key = 'all') {
      if (key === 'all') {
        return this.state;
      } else {
        return this.state[key];
      }
    }

    setState(key, value) {
      return this.state[key] = value;
    }

    getPlaying(key = 'all') {
      const ret = this.playing;
      if (ret.item.length === 0) {
        ret.item = this.defaultPlayingItem;
      }
      if (key === 'all') {
        return this.playing;
      } else {
        return this.playing[key];
      }
    }

    setPlaying(key, value) {
      return this.playing[key] = value;
    }

    isPlaying(media = 'auto'){
      if (media === 'auto') {
        return this.getPlaying('playing');
      } else {
        return (media === this.getState('media')) && this.getPlaying('playing');
      }
    }

    isPlayingItemChanged() {
      return this.getPlaying('itemChanged');
    }

    doCallback(callback, resp) {
      if (typeof callback === 'function') {
        return callback(resp);
      }
    }

    getCurrentState(callback) {}
      //# Override in extending module

    getCachedState() {
      return {state: this.state, playing: this.playing};
    }

    setPlayer(player = 'kodi') {
      const $body = App.getRegion('root').$el;
      $body.removeClassStartsWith('active-player-').addClass('active-player-' + player);
      config.set('state', 'lastplayer', player);
      return config.set('app', 'state:lastplayer', player);
    }

    getPlayer() {
      let player = 'kodi';
      const $body = App.getRegion('root').$el;
      if ($body.hasClass('active-player-local')) {
        player = 'local';
      }
      return player;
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("StateApp.Kodi", (StateApp, App, Backbone, Marionette, $, _) => //# Kodi state object
(function() {
  const Cls = (StateApp.State = class State extends App.StateApp.Base {
    static initClass() {

      this.prototype.playerController = {};
      this.prototype.applicationController = {};
      this.prototype.playlistApi = {};
    }

    initialize() {
      this.state = _.extend({}, this.state);
      this.playing = _.extend({}, this.playing);
      this.setState('player', 'kodi');
      this.playerController = App.request("command:kodi:controller", 'auto', 'Player');
      this.applicationController = App.request("command:kodi:controller", 'auto', 'Application');
      this.playlistApi = App.request("playlist:kodi:entity:api");
      //# Add a listener for others to trigger an update
      App.reqres.setHandler("state:kodi:update", callback => {
        return this.getCurrentState(callback);
      });
      //# Add a listener for others to trigger an update
      return App.reqres.setHandler("state:kodi:get", () => {
        return this.getCachedState();
      });
    }

    getCurrentState(callback) {
      return this.applicationController.getProperties(properties => {
        this.setState('volume', properties.volume);
        this.setState('muted', properties.muted);
        this.setState('version', properties.version);
        //# Stop the timer before an update
        App.reqres.setHandler('player:kodi:timer', 'stop');
        //# Get playing data and parse it
        return this.playerController.getPlaying(playing => {
          if (playing) {
            //# Mark basic playing info
            this.setPlaying('playing', true);
            this.setPlaying('paused', (playing.properties.speed === 0));
            this.setPlaying('playState', (playing.properties.speed === 0 ? 'paused' : 'playing'));
            //# Standard map
            const autoMap = ['canrepeat', 'canseek', 'canshuffle', 'partymode', 'percentage', 'playlistid', 'position', 'speed', 'time', 'totaltime'];
            for (var key of autoMap) {
              if (playing.properties[key] != null) {
                this.setPlaying(key, playing.properties[key]);
              }
            }
            this.setState('shuffled',  playing.properties.shuffled);
            this.setState('repeat',  playing.properties.repeat);
            //# Media type
            const media = this.playerController.playerIdToName(playing.properties.playlistid);
            if (media) {
              this.setState('media', media);
            }
            //# Item changed?
            if (playing.item.file !== this.getPlaying('lastPlaying')) {
              this.setPlaying('itemChanged', true);
              App.vent.trigger("state:kodi:itemchanged", this.getCachedState());
            } else {
              this.setPlaying('itemChanged', false);
            }
            this.setPlaying('lastPlaying', playing.item.file);
            //# Playing item
            this.setPlaying('item', this.parseItem(playing.item, {media, playlistid: playing.properties.playlistid}));
            //# Start the timer up again
            App.reqres.setHandler('player:kodi:timer', 'start');
          } else {
            //# Not playing
            this.setPlaying('playing', false);
            this.setPlaying('paused', false);
            this.setPlaying('item', this.defaultPlayingItem);
            this.setPlaying('lstPlaying', '');
          }
          //# Tell others something might have changed in the app state
          App.vent.trigger("state:kodi:changed", this.getCachedState());
          App.vent.trigger("state:changed");
          //# Return callback called with saved state
          return this.doCallback(callback, this.getCachedState());
        });
      });
    }

    //# Parse a playing item fixing the url and image
    parseItem(model, options) {
      model = this.playlistApi.parseItem(model, options);
      model = App.request("images:path:entity", model);
      model.url = helpers.url.get(model.type, model.id);
      model.url = helpers.url.playlistUrl(model);
      return model;
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("StateApp.Kodi", (StateApp, App, Backbone, Marionette, $, _) => //# Deal with notifications from Kodi
(function() {
  const Cls = (StateApp.Notifications = class Notifications extends App.StateApp.Base {
    static initClass() {

      this.prototype.wsActive = false;
      this.prototype.wsObj = {};
    }

    getConnection() {
      const host = config.getLocal('socketsHost');
      const socketPath = config.getLocal('jsonRpcEndpoint');
      const socketPort = config.getLocal('socketsPort');
      const socketHost = host === 'auto' ? location.hostname : host;
      const protocol = helpers.url.isSecureProtocol() ? "wss" : "ws";
      return `${protocol}://${socketHost}:${socketPort}/${socketPath}?kodi`;
    }

    initialize() {

      if (window.WebSocket) {

        const ws = new WebSocket(this.getConnection());

        ws.onopen = e => {
          //# Do an initial update prior to setting sockets to active
          //# TODO: update state.
          //# Websockets is working!
          helpers.debug.msg("Websockets Active");
          this.wsActive = true;
          return App.vent.trigger("sockets:available");
        };

        ws.onerror = resp => {
          helpers.debug.msg(this.socketConnectionErrorMsg(), "warning", resp);
          this.wsActive = false;
          return App.vent.trigger("sockets:unavailable");
        };

        ws.onmessage = resp => {
          return this.messageReceived(resp);
        };

        ws.onclose = resp => {
          helpers.debug.msg("Websockets Closed", "warning", resp);
          this.wsActive = false;
          App.execute("notification:show", tr("Lost websocket connection"));
          // Schedule an attempt at a reconnect to web sockets in 60 secs
          return setTimeout(function() {
            App.execute("notification:show", tr("Attempting websockets reconnect"));
            return App.execute('state:ws:init');
          }
          , 60000);
        };

      } else {
        //# Sockets not available
        const msg = "Your browser doesn't support websockets! Get with the times and update your browser.";
        helpers.debug.msg(t.gettext(msg), "warning", resp);
        App.vent.trigger("sockets:unavailable");
      }

      return App.reqres.setHandler("sockets:active", () => {
        return this.wsActive;
      });
    }

    //# Return the data from a response
    parseResponse(resp) {
      return jQuery.parseJSON(resp.data);
    }

    //# Deal with a message.
    messageReceived(resp) {
      const data = this.parseResponse(resp);
      return this.onMessage(data);
    }

    socketConnectionErrorMsg() {
      const msg = "Failed to connect to websockets";
      return t.gettext(msg);
    }

    //# Force a state refresh
    refreshStateNow(callback) {
      App.vent.trigger("state:kodi:changed", this.getCachedState());
      //# Do a full lookup 1s later, calling this immediately returns
      //# old data. TODO: Not robust, fix!
      return setTimeout(( () => {
        return App.request("state:kodi:update", state => {
          if (callback) {
            return callback(state);
          }
      });
      }
      ), 1000);
    }

    //# An item in the library has been updated, trigger a model refresh
    onLibraryUpdate(data) {
      // This feels like a bug (different structure for audio vs video) and might be fixed one day
      const model = data.params.data.item ? data.params.data.item : data.params.data;
      //# Trigger a update of model in ui
      model.uid = helpers.entities.createUid(model, model.type);
      App.vent.trigger('entity:kodi:update', model.uid);
      //# Episode updates might affect parent show and happen in bulk, so we defer a show update after 2 seconds.
      if (model.type === 'episode') {
        clearTimeout(App.episodeRecheckTimeout);
        return App.episodeRecheckTimeout = setTimeout(() => App.request('episode:entity', model.id, {success(epModel) {
          return App.vent.trigger('entity:kodi:update', 'tvshow-' + epModel.get('tvshowid'));
        }
        })
        , 2000);
      }
    }

    //# Deal with message responses.
    onMessage(data) {

      // Action based on method
      switch (data.method) {

        // playback started
        case 'Player.OnPlay':
          this.setPlaying('paused', false);
          this.setPlaying('playState', 'playing');
          App.execute("player:kodi:timer", 'start');
          this.refreshStateNow();
          break;

        // playback started
        case 'Player.OnResume':
          this.setPlaying('paused', false);
          this.setPlaying('playState', 'playing');
          App.execute("player:kodi:timer", 'start');
          this.refreshStateNow();
          break;

        // playback stopped
        case 'Player.OnStop':
          this.setPlaying('playing', false);
          App.execute("player:kodi:timer", 'stop');
          this.refreshStateNow();
          break;

        // e.g. shuffled, repeat, partymode
        case 'Player.OnPropertyChanged':
          this.refreshStateNow();
          break;

        // playback pause
        case 'Player.OnPause':
          this.setPlaying('paused', true);
          this.setPlaying('playState', 'paused');
          App.execute("player:kodi:timer", 'stop');
          this.refreshStateNow();
          break;

        // progress changed
        case 'Player.OnSeek':
          App.execute("player:kodi:timer", 'stop');
          this.refreshStateNow(() => App.execute("player:kodi:timer", 'start'));
          break;

        // list cleared, add, remove, use a timeout to prevent slowdown on bulk add
        case 'Playlist.OnClear': case 'Playlist.OnAdd': case 'Playlist.OnRemove':
          clearTimeout(App.playlistUpdateTimeout);
          App.playlistUpdateTimeout = setTimeout(e => {
            const playerController = App.request("command:kodi:controller", 'auto', 'Player');
            App.execute("playlist:refresh", 'kodi', playerController.playerIdToName(data.params.data.playlistid));
            return this.refreshStateNow();
          }
          , 500);
          break;

        // volume change
        case 'Application.OnVolumeChanged':
          App.request("state:kodi").getCurrentState();
          break;

        // Video Library scan
        case 'VideoLibrary.OnScanStarted':
          App.execute("notification:show", t.gettext("Video library scan started"));
          break;

        // Video Library scan end
        case 'VideoLibrary.OnScanFinished':
          App.execute("notification:show", t.gettext("Video library scan complete"));
          //# Clear video caches
          Backbone.fetchCache.clearItem('MovieCollection');
          Backbone.fetchCache.clearItem('TVShowCollection');
          break;

        // Audio Library scan
        case 'AudioLibrary.OnScanStarted':
          App.execute("notification:show", t.gettext("Audio library scan started"));
          break;

        // Audio Library scan end
        case 'AudioLibrary.OnScanFinished':
          App.execute("notification:show", t.gettext("Audio library scan complete"));
          //# Clear audio caches
          Backbone.fetchCache.clearItem('AlbumCollection');
          Backbone.fetchCache.clearItem('ArtistCollection');
          break;

        // Audio Library clean start
        case 'AudioLibrary.OnCleanStarted':
          App.execute("notification:show", t.gettext("Audio library clean started"));
          break;

        // Audio Library clean stop
        case 'AudioLibrary.OnCleanFinished':
          App.execute("notification:show", t.gettext("Audio library clean finished"));
          break;

        // Video Library clean start
        case 'VideoLibrary.OnCleanStarted':
          App.execute("notification:show", t.gettext("Video library clean started"));
          break;

        // Video Library clean stop
        case 'VideoLibrary.OnCleanFinished':
          App.execute("notification:show", t.gettext("Video library clean finished"));
          break;

        // Audio Library update
        case 'AudioLibrary.OnUpdate': case 'VideoLibrary.OnUpdate':
          this.onLibraryUpdate(data);
          break;

        // Input box has opened
        case 'Input.OnInputRequested':
          App.execute("input:textbox", '');
          var wait = 60;
          // We set a timeout for {wait} seconds for a fallback for no input
          // this is to prevent an open dialog preventing api requests
          // Instead of encouraging entering random shizzle how about it's just cancelled and a message saying why?
          App.inputTimeout = setTimeout((function() {
            const wotd = '<a href="http://goo.gl/PGE7wg" target="_blank">word of the day</a>';
            const msg = t.sprintf(tr(
              "%1$d seconds ago, an input dialog opened in Kodi and it is still open! To prevent " +
              "a mainframe implosion, you should probably give me some text. I don't really care what it " +
              "is at this point, why not be creative? Do you have a %2$s? I won't tell..."), wait, wotd
            );
            App.execute("input:textbox", msg);
          }), 1000 * wait);
          break;

        // Input box has closed
        case 'Input.OnInputFinished':
          clearTimeout(App.inputTimeout);
          App.execute("input:textbox:close");
          break;

        // Kodi shutdown
        case 'System.OnQuit':
          App.execute("notification:show", t.gettext("Kodi has quit"));
          App.execute("shell:disconnect");
          break;

        // Kodi wake or restart
        case 'System.OnWake': case 'System.OnRestart':
          App.execute("shell:reconnect");
          break;

        default:
      }
          //# do nothing.
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("StateApp.Kodi", (StateApp, App, Backbone, Marionette, $, _) => //# Poll for updates when websockets unavailable
//# As we need instance properties, for reference the instance is `App.kodiPolling`
(function() {
  const Cls = (StateApp.Polling = class Polling extends App.StateApp.Base {
    static initClass() {

      this.prototype.commander = {};
      this.prototype.checkInterval = 10000; //# 10 sec
      this.prototype.currentInterval = '';
      this.prototype.timeoutObj = {};
      this.prototype.failures = 0;
      this.prototype.maxFailures = 100;
    }

    initialize() {
      //# Set the current interval to default
      const interval = config.getLocal('pollInterval');
      this.checkInterval = parseInt(interval);
      return this.currentInterval = this.checkInterval;
    }

    startPolling() {
      return this.update();
    }

    //# The polling call.
    updateState() {
      const stateObj = App.request("state:kodi");
      return stateObj.getCurrentState();
    }

    //# As most of this is called out of context, we are calling everything
    //# around the timeout in the global instance scope.
    update() {
      if (config.getLocal('connected', true) === false) {
        return;
      }
      if (App.kodiPolling.failures < App.kodiPolling.maxFailures) {
        App.kodiPolling.updateState();
        //# Set the timeout.
        return App.kodiPolling.timeout = setTimeout(App.kodiPolling.ping, App.kodiPolling.currentInterval);
      } else {
        //# We have exceeded the failure count, probably dead!
        App.execute("notification:show", t.gettext("Unable to communicate with Kodi in a long time. I think it's dead Jim!"));
        return App.execute("shell:disconnect");
      }
    }

    //# Do a ping and deal with the results.
    ping() {
      const commander = App.request("command:kodi:controller", 'auto', 'Commander');
      commander.setOptions({
        timeout: 5000,
        error() {
          return App.kodiPolling.failure();
        }
      });
      commander.onError = function() {};
        //# replace current error handler so we don't pollute the console.
      return commander.sendCommand('Ping', [], () => App.kodiPolling.alive());
    }

    alive() {
      App.kodiPolling.failures = 0; // reset failures
      App.kodiPolling.currentInterval = App.kodiPolling.checkInterval; // reset interval
      return App.kodiPolling.update(); //# update again
    }

    failure() {
      App.kodiPolling.failures++;
      //# Increment the check interval the more failures we get
      if (App.kodiPolling.failures > 10) {
        App.kodiPolling.currentInterval = App.kodiPolling.checkInterval * 5;
      }
      if (App.kodiPolling.failures > 20) {
        App.kodiPolling.currentInterval = App.kodiPolling.checkInterval * 10;
      }
      if (App.kodiPolling.failures > 30) {
        App.kodiPolling.currentInterval = App.kodiPolling.checkInterval * 30;
      }
      return App.kodiPolling.update();
    }
  });
  Cls.initClass();
  return Cls;
})()); //# update again


;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("StateApp.Local", function(StateApp, App, Backbone, Marionette, $, _) {

  //# Local state object.
  return (StateApp.State = class State extends App.StateApp.Base {

    initialize() {
      this.state = _.extend({}, this.state);
      this.playing = _.extend({}, this.playing);
      this.setState('player', 'local');
      this.setState('currentPlaybackId', 'browser-none');
      this.setState('localPlay', false);

      //# Add a listener for others to trigger an update
      App.reqres.setHandler("state:local:update", callback => {
        return this.getCurrentState(callback);
      });
      //# Add a listener for others to trigger an update
      return App.reqres.setHandler("state:local:get", () => {
        return this.getCachedState();
      });
    }

    getCurrentState(callback) {
      //# Update from local player.

      return this.doCallback(callback, this.getCachedState());
    }
  });
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("StateApp", function(StateApp, App, Backbone, Marionette, $, _) {


  var API = {

    setState(player = 'kodi') {
      this.setBodyClasses(player);
      this.setPlayingContent(player);
      this.setPlayerPlaying(player);
      this.setAppProperties(player);
      return this.setTitle(player);
    },

    playerClass(className, player) {
      return player + '-' + className;
    },

    //# Set app level body state classes
    setBodyClasses(player) {
      const stateObj = App.request("state:" + player);
      const $body = App.getRegion('root').$el;
      //# Remove All
      $body.removeClassStartsWith(player + '-');
      //# Add based on state properties
      const newClasses = [];
      newClasses.push(( 'shuffled-' + (stateObj.getState('shuffled') ? 'on' : 'off')  ));
      newClasses.push(( 'partymode-' + (stateObj.getPlaying('partymode') ? 'on' : 'off')  ));
      newClasses.push(( 'mute-' + (stateObj.getState('muted') ? 'on' : 'off')  ));
      newClasses.push(( 'repeat-' + stateObj.getState('repeat') ));
      newClasses.push(( 'media-' + stateObj.getState('media') ));
      if (stateObj.isPlaying()) {
        newClasses.push(( stateObj.getPlaying('playState') ));
      } else {
        newClasses.push(('not-playing'));
      }
//      $body.removeClass('local-partymode-on')
      return newClasses.map((c) =>
        $body.addClass(this.playerClass(c, player)));
    },

    //# Set playing rows in content.
    setPlayingContent(player) {
      const stateObj = App.request("state:" + player);
      const $playlistCtx = $('.media-' + stateObj.getState('media') + ' .' + player + '-playlist');
      $('.can-play').removeClassStartsWith(player + '-row-');
      $('.item', $playlistCtx).removeClassStartsWith('row-');
      if (stateObj.isPlaying()) {
        const item = stateObj.getPlaying('item');
        const playState = stateObj.getPlaying('playState');
        //# library item
        const className = '.item-' + item.uid;
        $(className).addClass( this.playerClass('row-' + playState, player) );
        //# playlist item
        const $plItem = $('.pos-' + stateObj.getPlaying('position'), $playlistCtx).addClass( 'row-' + playState );
        //# force playing item thumb and title @see http://forum.kodi.tv/showthread.php?tid=300522
        if ($plItem.data('type') === 'file') {
          $('.thumb', $plItem).css("background-image", "url('" + item.thumbnail + "')");
          $('.title', $plItem).html(helpers.entities.playingLink(item));
        }
        return App.vent.trigger("state:" + player + ":playing:updated", stateObj);
      }
    },

    //# Set the now playing info in the player
    setPlayerPlaying(player) {
      const stateObj = App.request("state:" + player);
      const $playerCtx = $('#player-' + player);
      const $title = $('.playing-title', $playerCtx);
      const $subtitle = $('.playing-subtitle', $playerCtx);
      const $dur = $('.playing-time-duration', $playerCtx);
      const $img = $('.playing-thumb', $playerCtx);
      if (stateObj.isPlaying()) {
        const item = stateObj.getPlaying('item');
        $title.html(helpers.entities.playingLink(item));
        $subtitle.html(helpers.entities.getSubtitle(item));
        $dur.text(helpers.global.formatTime(stateObj.getPlaying('totaltime')));
        return $img.css("background-image", "url('" + item.thumbnail + "')");
      } else {
        $title.html(t.gettext('Nothing playing'));
        $subtitle.html('');
        $dur.text('0');
        return $img.attr('src', App.request("images:path:get"));
      }
    },


    setAppProperties(player) {
      const stateObj = App.request("state:" + player);
      const $playerCtx = $('#player-' + player);
      return $('.volume', $playerCtx).val(stateObj.getState('volume'));
    },

    setTitle(player) {
      if (player === 'kodi') {
        const stateObj = App.request("state:" + player);
        if (stateObj.isPlaying() && (stateObj.getPlaying('playState') === 'playing')) {
          return helpers.global.appTitle(stateObj.getPlaying('item'));
        } else {
          return helpers.global.appTitle();
        }
      }
    },

    //# Get the most appropriate player on first load.
    getDefaultPlayer() {
      let player = config.getLocal('defaultPlayer', 'auto');
      if (player === 'auto') {
        player = config.get('app', 'state:lastplayer', 'kodi');
      }
      return player;
    },

    //# Kick off all things kodi statewise
    initKodiState() {

      //# Set initial state
      App.kodiState = new StateApp.Kodi.State();
      App.localState = new StateApp.Local.State();

      //# Set the initial active player
      App.kodiState.setPlayer(this.getDefaultPlayer());

      //# Load up the Kodi state
      App.kodiState.getCurrentState(function(state) {
        API.setState('kodi');

        //# Attach sockets and polling (if req).
        App.kodiSockets = new StateApp.Kodi.Notifications();
        App.kodiPolling =  new StateApp.Kodi.Polling();

        //# Sockets unavailable, start polling.
        App.vent.on("sockets:unavailable", () => App.kodiPolling.startPolling());

        //# Playlist is available, set its state
        App.vent.on("playlist:rendered", () => App.request("playlist:refresh", App.kodiState.getState('player'), App.kodiState.getState('media')));

        //# Some new content has been rendered with a potential to be playing
        App.vent.on("state:content:updated", function() {
          API.setPlayingContent('kodi');
          return API.setPlayingContent('local');
        });

        //# Some kodi data has changed or needs updating.
        App.vent.on("state:kodi:changed", state => API.setState('kodi'));

        //# Some local data has changed or needs updating.
        App.vent.on("state:local:changed", state => API.setState('local'));

        //# Player data requires updating
        App.vent.on("state:player:updated", player => API.setPlayerPlaying(player));

        return App.vent.trigger("state:initialized");
      });


      //# Everything should use the state object.
      App.reqres.setHandler("state:kodi", () => App.kodiState);
      App.reqres.setHandler("state:local", () => App.localState);

      //# Everything should use the state object.
      App.reqres.setHandler("state:current", function() {
        const stateObj = App.kodiState.getPlayer() === 'kodi' ? App.kodiState : App.localState;
        return stateObj;
      });

      // Reconnect websockets.
      App.commands.setHandler('state:ws:init', () => App.kodiSockets = new StateApp.Kodi.Notifications());

      //# Let things know the state object is now available
      return App.vent.trigger("state:changed");
    }
  };



  //# Startup tasks.
  return App.addInitializer(() => //# Kodi state.
  API.initKodiState());
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ThumbsApp.List", (List, App, Backbone, Marionette, $, _) => //# Main controller
(function() {
  const Cls = (List.Controller = class Controller extends App.Controllers.Base {
    static initClass() {

      this.prototype.entityTitles =
        {musicvideo: 'music video'};
    }

    initialize() {
      this.layout = this.getLayout();
      const entities = ['song', 'artist', 'album', 'tvshow', 'movie', 'episode', 'musicvideo'];

      this.listenTo(this.layout, "show", () => {
        //# Do a search for each entity
        return entities.map((entity) =>
          this.getResult(entity));
      });
      return App.regionContent.show(this.layout);
    }

    getLayout() {
      return new List.ListLayout();
    }

    getResult(entity) {
      const query = this.getOption('query');
      const limit = this.getOption('media') === 'all' ? 'limit' : 'all';
      const loaded = App.request("thumbsup:get:entities", entity);
      //# If result
      if (loaded.length > 0) {
        //# Get the result view
        const view = App.request(`${entity}:list:view`, loaded, true);
        //# Wrap it in a set view container and add a title
        const setView = new List.ListSet({
          entity: this.getTitle(entity)});
        App.listenTo(setView, "show", () => {
          return setView.regionResult.show(view);
        });
        //# Add to layout
        return this.layout[`${entity}Set`].show(setView);
      }
    }

    //# Get title for an entity
    getTitle(entity) {
      const title = this.entityTitles[entity] ? this.entityTitles[entity] : entity;
      return title;
    }
  });
  Cls.initClass();
  return Cls;
})());
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ThumbsApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutView {
    static initClass() {
      this.prototype.template = 'apps/thumbs/list/thumbs_layout';
      this.prototype.className = "thumbs-page set-page";
      this.prototype.regions = {
        artistSet: '.entity-set-artist',
        albumSet:  '.entity-set-album',
        songSet:   '.entity-set-song',
        movieSet:  '.entity-set-movie',
        tvshowSet: '.entity-set-tvshow',
        episodeSet: '.entity-set-episode',
        musicvideoSet: '.entity-set-musicvideo'
      };
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.ListSet = class ListSet extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = 'apps/thumbs/list/thumbs_set';
        this.prototype.className = "thumbs-set";
        this.prototype.regions =
          {regionResult: '.set-results'};
      }
      onRender() {
        if (this.options) {
          if (this.options.entity) {
            return $('h2.set-header', this.$el).text( t.gettext( this.options.entity + 's'  ) );
          }
        }
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("ThumbsApp", function(ThumbsApp, App, Backbone, Marionette, $, _) {

  const Cls = (ThumbsApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes =
        {"thumbsup"        : "list"};
    }
  });
  Cls.initClass();

  const API = {
    list() {
      return new ThumbsApp.List.Controller();
    }
  };

  return App.on("before:start", () => new ThumbsApp.Router({
    controller: API}));
});

;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.EditEpisode", function(Edit, App, Backbone, Marionette, $, _) {

  return Edit.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      let form;
      this.model = this.getOption('model');
      const options = {
        titleHtml: '<span>' + tr('Edit') + '</span>' + this.model.escape('showtitle') + ' - ' + this.model.escape('title') + ' (S' + this.model.escape('season') + ' E' + this.model.escape('episode') + ')',
        form: this.getStructure(),
        formState: this.model.attributes,
        config: {
          attributes: {class: 'edit-form'},
          editForm: true,
          tabs: true,
          callback: (data, formView) => {
            return this.saveCallback(data, formView);
          }
        }
      };
      return form = App.request("form:popup:wrapper", options);
    }

    getStructure() {
      return [
        {
          title: 'General',
          id: 'general',
          children:[
            {id: 'title', title: tr('Title'), type: 'textfield'},
            {id: 'plot', title: tr('Plot'), type: 'textarea'},
            {id: 'rating', title: tr('Rating'), type: 'number', format: 'float', attributes: {class: 'half-width', step: 0.1, min: 0, max: 10}},
            {id: 'firstaired', title: tr('First aired'), type: 'date', attributes: {class: 'half-width'}, suffix: '<div class="clearfix"></div>'},
            {id: 'originaltitle', title: tr('Original title'), type: 'textfield'},
          ]
        },
        {
          title: 'Tags',
          id: 'tags',
          children:[
            {id: 'director', title: tr('Directors'), type: 'textfield', format: 'array.string'},
            {id: 'writer', title: tr('Writers'), type: 'textfield', format: 'array.string'},
          ]
        },
        {
          title: 'Information',
          id: 'info',
          children:[
            {id: 'file', title: tr('File path'), type: 'textarea', attributes: {disabled: 'disabled', cols: 5}, format: 'prevent.submit'},
          ]
        }
      ];
    }

    //# Save the settings to Kodi
    saveCallback(data, formView) {
      const controller = App.request("command:kodi:controller", 'video', 'VideoLibrary');
      return controller.setEpisodeDetails(this.model.get('id'), data, () => {
        Kodi.vent.trigger('entity:kodi:update', this.model.get('uid'));
        return Kodi.execute("notification:show", t.sprintf(tr("Updated %1$s details"), 'episode'));
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.EditShow", function(Edit, App, Backbone, Marionette, $, _) {

  return Edit.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      let form;
      this.model = this.getOption('model');
      const options = {
        titleHtml: '<span>' + tr('Edit') + '</span>' + this.model.escape('title'),
        form: this.getStructure(),
        formState: this.model.attributes,
        config: {
          attributes: {class: 'edit-form'},
          editForm: true,
          tabs: true,
          callback: (data, formView) => {
            this.setArt(data);
            return this.saveCallback(data, formView);
          }
        }
      };
      return form = App.request("form:popup:wrapper", options);
    }

    getStructure() {
      return [
        {
          title: 'General',
          id: 'general',
          children:[
            {id: 'title', title: tr('Title'), type: 'textfield'},
            {id: 'plot', title: tr('Plot'), type: 'textarea'},
            {id: 'studio', title: tr('Studio'), type: 'textfield', format: 'array.string'},
            {id: 'mpaa', title: tr('Content rating'), type: 'textfield', attributes: {class: 'half-width'}},
            {id: 'premiered', title: tr('Premiered'), type: 'date', attributes: {class: 'half-width'}, suffix: '<div class="clearfix"></div>'},
            {id: 'rating', title: tr('Rating'), type: 'number', format: 'float', attributes: {class: 'half-width', step: 0.1, min: 0, max: 10}},
            {id: 'imdbnumber', title: tr('IMDb'), type: 'textfield', attributes: {class: 'half-width'}, suffix: '<div class="clearfix"></div>'},
            {id: 'sorttitle', title: tr('Sort title'), type: 'textfield'},
            {id: 'originaltitle', title: tr('Original title'), type: 'textfield'},
          ]
        },
        {
          title: 'Tags',
          id: 'tags',
          children:[
            {id: 'genre', title: tr('Genres'), type: 'textfield', format: 'array.string'},
            {id: 'tag', title: tr('Tags'), type: 'textarea', format: 'array.string'},
          ]
        },
        {
          title: 'Poster',
          id: 'poster',
          children:[
            {
              id: 'thumbnail', title: tr('URL'), type: 'imageselect', valueProperty: 'thumbnailOriginal', description: tr('Add an image via an external URL'),
              metadataImageHandler: 'themoviedb:tv:image:entities', metadataLookupField: 'imdbnumber'
            }
          ]
        },
        {
          title: 'Background',
          id: 'background',
          children:[
            {
              id: 'fanart', title: tr('URL'), type: 'imageselect', valueProperty: 'fanartOriginal', description: tr('Add an image via an external URL'),
              metadataImageHandler: 'themoviedb:tv:image:entities', metadataLookupField: 'imdbnumber'
            }
          ]
        }
      ];
    }

    //# Properly write the art map
    setArt(data) {
      const art = {};
      if ('fanart' in data) {
        art["fanart"] = data.fanart;
      }
      if ('thumbnail' in data) {
        art["poster"] = data.thumbnail;
        delete data.thumbnail;
      }
      return data["art"] = art;
    }

    //# Save the settings to Kodi
    saveCallback(data, formView) {
      const controller = App.request("command:kodi:controller", 'video', 'VideoLibrary');
      return controller.setTVShowDetails(this.model.get('id'), data, () => {
        Kodi.vent.trigger('entity:kodi:update', this.model.get('uid'));
        return Kodi.execute("notification:show", t.sprintf(tr("Updated %1$s details"), 'tvshow'));
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.Episode", function(Episode, App, Backbone, Marionette, $, _) {

  const API = {

    //# Includes triggers for lists.
    getEpisodeList(collection) {
      const view = new Episode.Episodes({
        collection});
      App.listenTo(view, 'childview:episode:play', (parent, viewItem) => App.execute('episode:action', 'play', viewItem));
      App.listenTo(view, 'childview:episode:add', (parent, viewItem) => App.execute('episode:action', 'add', viewItem));
      App.listenTo(view, 'childview:episode:localplay', (parent, viewItem) => App.execute('episode:action', 'localplay', viewItem));
      App.listenTo(view, 'childview:episode:download', (parent, viewItem) => App.execute('episode:action', 'download', viewItem));
      App.listenTo(view, 'childview:episode:watched', (parent, viewItem) => App.execute('episode:action:watched', parent, viewItem));
      App.listenTo(view, 'childview:episode:goto:season', (parent, viewItem) => App.execute('episode:action', 'gotoSeason', viewItem));
      App.listenTo(view, 'childview:episode:edit', (parent, viewItem) => App.execute('episode:edit', viewItem.model));
      return view;
    },

    //# triggers for full view.
    bindTriggers(view) {
      App.listenTo(view, 'episode:play', viewItem => App.execute('episode:action', 'play', viewItem));
      App.listenTo(view, 'episode:add', viewItem => App.execute('episode:action', 'add', viewItem));
      App.listenTo(view, 'episode:localplay', viewItem => App.execute('episode:action', 'localplay', viewItem));
      App.listenTo(view, 'episode:download', viewItem => App.execute('episode:action', 'download', viewItem));
      App.listenTo(view, 'toggle:watched', viewItem => App.execute('episode:action:watched', viewItem.view, viewItem.view));
      App.listenTo(view, 'episode:refresh', viewItem => App.execute('episode:action', 'refresh', viewItem));
      return App.listenTo(view, 'episode:edit', viewItem => App.execute('episode:edit', viewItem.model));
    }
  };


  //# Main controller
  Episode.Controller = class Controller extends App.Controllers.Base {

    //# The TVShow page.
    initialize(options) {
      const id = parseInt(options.id);
      const seasonId = parseInt(options.season);
      const episodeId = parseInt(options.episodeid);

      //# Fetch the tvshow
      const episode = App.request("episode:entity", episodeId);
      return App.execute("when:entity:fetched", episode, () => {
        //# Get the layout.
        this.layout = this.getLayoutView(episode);

        //# Listen to the show of our layout.
        this.listenTo(this.layout, "show", () => {
          this.getDetailsLayoutView(episode);
          return this.getContentView(episode);
        });

        //# Add the layout to content.
        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(episode) {
      return new Episode.PageLayout({
        model: episode});
    }

    //# Build the details layout.
    getDetailsLayoutView(episode) {
      const headerLayout = new Episode.HeaderLayout({model: episode});
      this.listenTo(headerLayout, "show", () => {
        const teaser = new Episode.EpisodeDetailTeaser({model: episode});
        const detail = new Episode.Details({model: episode});
        API.bindTriggers(detail);
        headerLayout.regionSide.show(teaser);
        return headerLayout.regionMeta.show(detail);
      });
      return this.layout.regionHeader.show(headerLayout);
    }

    getContentView(episode) {
      this.contentLayout = new Episode.Content({model: episode});
      App.listenTo(this.contentLayout, 'show', () => {
        if (episode.get('cast').length > 0) {
          this.contentLayout.regionCast.show(this.getCast(episode));
        }
        return this.getSeason(episode);
      });
      return this.layout.regionContent.show(this.contentLayout);
    }

    getCast(episode) {
      return App.request('cast:list:view', episode.get('cast'), 'tvshows');
    }

    getSeason(episode) {
      const collection = App.request("episode:tvshow:entities", episode.get('tvshowid'), episode.get('season'));
      return App.execute("when:entity:fetched", collection, () => {
        collection.sortCollection('episode', 'asc');
        const view = App.request("episode:list:view", collection);
        return this.contentLayout.regionSeason.show(view);
      });
    }
  };


  //# handler for other modules to get a list view.
  return App.reqres.setHandler("episode:list:view", collection => API.getEpisodeList(collection));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS207: Consider shorter variations of null checks
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.Episode", function(Episode, App, Backbone, Marionette, $, _) {


  let Cls = (Episode.EpisodeTeaser = class EpisodeTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        "click .play"        : "episode:play",
        "click .watched"     : "episode:watched",
        "click .add"         : "episode:add",
        "click .localplay"   : "episode:localplay",
        "click .download"    : "episode:download",
        "click .goto-season" : "episode:goto:season",
        "click .edit"        : "episode:edit"
      };
    }
    initialize() {
      super.initialize(...arguments);
      if (this.model != null) {
        this.setMeta();
        return this.model.set(App.request('episode:action:items'));
      }
    }
    attributes() {
      return this.watchedAttributes('card');
    }
    setMeta() {
      const epNum = this.themeTag('span', {class: 'ep-num'}, this.model.escape('season') + 'x' + this.model.escape('episode') + ' ');
      const epNumFull = this.themeTag('span', {class: 'ep-num-full'}, t.gettext('Episode') + ' ' + this.model.escape('episode'));
      const showLink = this.themeLink(this.model.escape('showtitle') + ' ', 'tvshow/' + this.model.escape('tvshowid'), {className: 'show-name'});
      const subTitleTip = this.model.escape('firstaired') ? {title: tr('First aired') + ': ' + this.model.escape('firstaired')} : {};
      return this.model.set({
        labelHtml: epNum + this.model.get('title'),
        subtitleHtml: this.themeTag('div', subTitleTip, showLink + epNumFull)
      });
    }
  });
  Cls.initClass();


  Cls = (Episode.Empty = class Empty extends App.Views.EmptyViewResults {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.className = "episode-empty-result";
    }
  });
  Cls.initClass();

  Cls = (Episode.Episodes = class Episodes extends App.Views.CollectionView {
    static initClass() {
      this.prototype.childView = Episode.EpisodeTeaser;
      this.prototype.emptyView = Episode.Empty;
      this.prototype.tagName = "ul";
      this.prototype.className = "card-grid--episode";
    }
  });
  Cls.initClass();


  Cls = (Episode.PageLayout = class PageLayout extends App.Views.LayoutWithHeaderView {
    static initClass() {
      this.prototype.className = 'episode-show detail-container';
    }
  });
  Cls.initClass();

  Cls = (Episode.HeaderLayout = class HeaderLayout extends App.Views.LayoutDetailsHeaderView {
    static initClass() {
      this.prototype.className = 'episode-details';
    }
  });
  Cls.initClass();

  Cls = (Episode.Details = class Details extends App.Views.DetailsItem {
    static initClass() {
      this.prototype.template = 'apps/tvshow/episode/details_meta';
      this.prototype.triggers = {
        'click .play': 'episode:play',
        'click .add': 'episode:add',
        'click .stream': 'episode:localplay',
        'click .download': 'episode:download',
        'click .edit': 'episode:edit',
        'click .refresh': 'episode:refresh'
      };
    }
    attributes() {
      return this.watchedAttributes();
    }
  });
  Cls.initClass();

  Cls = (Episode.EpisodeDetailTeaser = class EpisodeDetailTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.tagName = "div";
      this.prototype.triggers =
        {"click .menu" : "episode-menu:clicked"};
    }
    initialize() {
      return this.model.set({actions: {thumbs: tr('Thumbs up')}});
    }
    attributes() {
      return this.watchedAttributes('card-detail');
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Episode.Content = class Content extends App.Views.LayoutView {
      static initClass() {
        this.prototype.template = 'apps/tvshow/episode/content';
        this.prototype.className = "episode-content content-sections";
        this.prototype.regions = {
          regionCast: '.region-cast',
          regionSeason: '.region-season'
        };
        this.prototype.modelEvents =
          {'change': 'modelChange'};
      }
      modelChange() {
        this.render();
        return this.trigger('show');
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.List", function(List, App, Backbone, Marionette, $, _) {

  var API = {

    getTVShowsList(tvshows, set = false) {
      const viewName = set ? 'TVShowsSet' : 'TVShows';
      const view = new (List[viewName])({
        collection: tvshows});
      API.bindTriggers(view);
      return view;
    },

    bindTriggers(view) {
      App.listenTo(view, 'childview:tvshow:play', (parent, viewItem) => App.execute('tvshow:action', 'play', viewItem));
      App.listenTo(view, 'childview:tvshow:add', (parent, viewItem) => App.execute('tvshow:action', 'add', viewItem));
      App.listenTo(view, 'childview:tvshow:watched', (parent, viewItem) => App.execute('tvshow:action:watched', parent, viewItem));
      return App.listenTo(view, 'childview:tvshow:edit', (parent, viewItem) => App.execute('tvshow:edit', viewItem.model));
    }
  };

  //# Main controller
  List.Controller = class Controller extends App.Controllers.Base {

    initialize() {
      const collection = App.request("tvshow:entities");

      //# Set available filters
      collection.availableFilters = this.getAvailableFilters();

      //# Top level menu path for filters
      collection.sectionId = 'tvshows/recent';

      //# If present set initial filter via url
      App.request('filter:init', this.getAvailableFilters());

      //# When fetched.
      return App.execute("when:entity:fetched", collection, () => {


        //# Get and setup the layout
        this.layout = this.getLayoutView(collection);
        this.listenTo(this.layout, "show", () => {
          this.getFiltersView(collection);
          return this.renderList(collection);
        });

        //# Render the layout
        return App.regionContent.show(this.layout);
      });
    }

    getLayoutView(tvshows) {
      return new List.ListLayout({
        collection: tvshows});
    }


    //# Available sort and filter options
    //# See filter_app.js for available options
    getAvailableFilters() {
      return {
        sort: ['title', 'year', 'dateadded', 'rating', 'random'],
        filter: ['year', 'genre', 'unwatched', 'inprogress', 'cast', 'mpaa', 'studio', 'thumbsUp', 'tag']
      };
    }

    //# Apply filter view and provide a handler for applying changes
    getFiltersView(collection) {
      const filters = App.request('filter:show', collection);
      this.layout.regionSidebarFirst.show(filters);
      //# Listen to when the filters change and re-render.
      return this.listenTo(filters, "filter:changed", () => {
        return this.renderList(collection);
      });
    }

    //# Get the list view with filters applied.
    renderList(collection) {
      App.execute("loading:show:view", this.layout.regionContent);
      const filteredCollection = App.request('filter:apply:entities', collection);
      const view = API.getTVShowsList(filteredCollection);
      return this.layout.regionContent.show(view);
    }
  };


  //# handler for other modules to get a list view.
  return App.reqres.setHandler("tvshow:list:view", collection => API.getTVShowsList(collection, true));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.List", function(List, App, Backbone, Marionette, $, _) {

  let Cls = (List.ListLayout = class ListLayout extends App.Views.LayoutWithSidebarFirstView {
    static initClass() {
      this.prototype.className = "tvshow-list with-filters";
    }
  });
  Cls.initClass();

  Cls = (List.TVShowTeaser = class TVShowTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        "click .play"       : "tvshow:play",
        "click .watched"    : "tvshow:watched",
        "click .add"        : "tvshow:add",
        "click .edit"       : "tvshow:edit"
      };
    }
    initialize() {
      super.initialize(...arguments);
      this.setMeta();
      return this.model.set( App.request('tvshow:action:items') );
    }
    attributes() {
      return this.watchedAttributes('card tv-show prevent-select');
    }
    setMeta() {
      if (this.model) {
        return this.model.set({
          subtitle: this.model.get('rating')});
      }
    }
  });
  Cls.initClass();

  Cls = (List.Empty = class Empty extends App.Views.EmptyViewResults {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.className = "tvshow-empty-result";
    }
  });
  Cls.initClass();

  Cls = (List.TVShows = class TVShows extends App.Views.VirtualListView {
    static initClass() {
      this.prototype.childView = List.TVShowTeaser;
      this.prototype.emptyView = List.Empty;
      this.prototype.tagName = "ul";
      this.prototype.className = "card-grid--tall";
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (List.TVShowsSet = class TVShowsSet extends App.Views.CollectionView {
      static initClass() {
        this.prototype.childView = List.TVShowTeaser;
        this.prototype.emptyView = List.Empty;
        this.prototype.tagName = "ul";
        this.prototype.className = "card-grid--tall";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.Season", function(Season, App, Backbone, Marionette, $, _) {

  const API = {

    getSeasonList(collection) {
      const view = new Season.Seasons({
        collection});
      return view;
    },

    bindTriggers(view) {
      App.listenTo(view, 'season:play', view => App.execute('tvshow:action', 'play', view));
      App.listenTo(view, 'season:add', view => App.execute('tvshow:action', 'add', view));
      return App.listenTo(view, 'toggle:watched', view => App.execute('tvshow:action:watched', view.view, view.view, true));
    },

    mergeSeasonDetails(tvshow, season, seasons) {
      const mergeAttributes = ['season', 'thumbnail', 'episode', 'unwatched', 'playcount', 'progress', 'watchedepisodes'];
      const attributes = {seasons, type: 'season'};
      for (var prop of mergeAttributes) {
        attributes[prop] = season.get(prop);
      }
      tvshow.set(attributes);
      return tvshow;
    }
  };


  //# Main controller
  Season.Controller = class Controller extends App.Controllers.Base {

    //# The TVShow page.
    initialize(options) {
      const id = parseInt(options.id);
      const seasonId = parseInt(options.season);

      //# Fetch the tvshow
      let tvshow = App.request("tvshow:entity", id);
      return App.execute("when:entity:fetched", tvshow, () => {

        //# Fetch the seasons
        const seasons = App.request("season:entities", tvshow.get('id'));
        return App.execute("when:entity:fetched", seasons, () => {
          //# Merge current season
          const season = seasons.findWhere({season: seasonId});
          tvshow = API.mergeSeasonDetails(tvshow, season, seasons);

          //# Get the layout.
          this.layout = this.getLayoutView(tvshow);

          //# Listen to the show of our layout.
          this.listenTo(this.layout, "show", () => {
            this.getDetailsLayoutView(tvshow);
            return this.getEpisodes(tvshow, seasonId);
          });

          //# Add the layout to content.
          return App.regionContent.show(this.layout);
        });
      });
    }

    getLayoutView(tvshow) {
      return new Season.PageLayout({
        model: tvshow});
    }

    //# Build the details layout.
    getDetailsLayoutView(tvshow) {
        const headerLayout = new Season.HeaderLayout({model: tvshow});
        this.listenTo(headerLayout, "show", () => {
          const teaser = new Season.SeasonDetailTeaser({model: tvshow});
          const detail = new Season.Details({model: tvshow});
          API.bindTriggers(detail);
          headerLayout.regionSide.show(teaser);
          return headerLayout.regionMeta.show(detail);
        });
        return this.layout.regionHeader.show(headerLayout);
      }

    //# Get the episodes
    getEpisodes(tvshow, seasonId) {
      const collection = App.request("episode:tvshow:entities", tvshow.get('tvshowid'), seasonId);
      return App.execute("when:entity:fetched", collection, () => {
        collection.sortCollection('episode', 'asc');
        const view = App.request("episode:list:view", collection);
        return this.layout.regionContent.show(view);
      });
    }
  };


  //# handler for other modules to get a list view.
  return App.reqres.setHandler("season:list:view", collection => API.getSeasonList(collection));
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.Season", function(Season, App, Backbone, Marionette, $, _) {


  let Cls = (Season.SeasonTeaser = class SeasonTeaser extends App.Views.CardView {
    static initClass() {
      this.prototype.triggers = {
        "click .play"       : "season:play",
        "click .watched"    : "season:watched",
        "click .add"        : "season:add"
      };
    }
    initialize() {
      super.initialize(...arguments);
      const subtitle = this.model.get('episode') + ' ' + tr('episodes');
      this.model.set({subtitle});
      this.model.set( App.request('tvshow:action:items') );
      return this.model.set({label: tr('Season') + ' ' + this.model.get('season')});
    }
    attributes() {
      return this.watchedAttributes('card tv-season prevent-select');
    }
  });
  Cls.initClass();

  Cls = (Season.Empty = class Empty extends App.Views.EmptyViewResults {
    static initClass() {
      this.prototype.tagName = "li";
      this.prototype.className = "season-empty-result";
    }
  });
  Cls.initClass();

  Cls = (Season.Seasons = class Seasons extends App.Views.CollectionView {
    static initClass() {
      this.prototype.childView = Season.SeasonTeaser;
      this.prototype.emptyView = Season.Empty;
      this.prototype.tagName = "ul";
      this.prototype.className = "card-grid--tall";
    }
  });
  Cls.initClass();


  Cls = (Season.PageLayout = class PageLayout extends App.Views.LayoutWithHeaderView {
    static initClass() {
      this.prototype.className = 'season-show tv-collection detail-container';
    }
  });
  Cls.initClass();

  Cls = (Season.HeaderLayout = class HeaderLayout extends App.Views.LayoutDetailsHeaderView {
    static initClass() {
      this.prototype.className = 'season-details';
    }
  });
  Cls.initClass();

  Cls = (Season.Details = class Details extends App.Views.DetailsItem {
    static initClass() {
      this.prototype.template = 'apps/tvshow/season/details_meta';
      this.prototype.triggers = {
        "click .play"       : "season:play",
        "click .add"        : "season:add"
      };
    }
    attributes() {
      return this.watchedAttributes('details-meta');
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Season.SeasonDetailTeaser = class SeasonDetailTeaser extends App.Views.CardView {
      static initClass() {
        this.prototype.tagName = "div";
        this.prototype.className = "card-detail";
      }
    });
    Cls.initClass();
    return Cls;
  })();
});


;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  const API = {

    bindTriggersTVShow(view) {
      App.listenTo(view, 'tvshow:play', view => App.execute('tvshow:action', 'play', view));
      App.listenTo(view, 'tvshow:add', view => App.execute('tvshow:action', 'add', view));
      App.listenTo(view, 'toggle:watched', view => App.execute('tvshow:action:watched', view.view, view.view, true));
      App.listenTo(view, 'tvshow:refresh', view => App.execute('tvshow:action', 'refresh', view));
      App.listenTo(view, 'tvshow:refresh:episodes', view => App.execute('tvshow:action', 'refreshEpisodes', view));
      return App.listenTo(view, 'tvshow:edit', view => App.execute('tvshow:edit', view.model));
    },

    bindTriggersTVSeason(view) {
      App.listenTo(view, 'childview:season:play', (parent, viewItem) => App.execute('tvshow:action', 'play', viewItem));
      App.listenTo(view, 'childview:season:add', (parent, viewItem) => App.execute('tvshow:action', 'add', viewItem));
      return App.listenTo(view, 'childview:season:watched', (parent, viewItem) => App.execute('tvshow:action:watched', parent, viewItem, false));
    }
  };

  return Show.Controller = class Controller extends App.Controllers.Base {

    //# The TVShow page.
    initialize(options) {
      const id = parseInt(options.id);
      const tvshow = App.request("tvshow:entity", id);
      //# Fetch the tvshow
      return App.execute("when:entity:fetched", tvshow, () => {
        //# Get the layout.
        this.layout = this.getLayoutView(tvshow);
        //# Ensure background removed when we leave.
        this.listenTo(this.layout, "destroy", () => {
          return App.execute("images:fanart:set", 'none');
        });
        //# Listen to the show of our layout.
        this.listenTo(this.layout, "show", () => {
          this.getDetailsLayoutView(tvshow);
          return this.getSeasons(tvshow);
        });
        //# Add the layout to content.
        return App.regionContent.show(this.layout);
      });
    }

    //# Get the base layout
    getLayoutView(tvshow) {
      return new Show.PageLayout({
        model: tvshow});
    }

    //# Build the details layout.
    getDetailsLayoutView(tvshow) {
      const headerLayout = new Show.HeaderLayout({model: tvshow});
      this.listenTo(headerLayout, "show", () => {
        const teaser = new Show.TVShowTeaser({model: tvshow});
        const detail = new Show.Details({model: tvshow});
        API.bindTriggersTVShow(detail);
        API.bindTriggersTVShow(teaser);
        headerLayout.regionSide.show(teaser);
        return headerLayout.regionMeta.show(detail);
      });
      return this.layout.regionHeader.show(headerLayout);
    }

    getSeasons(tvshow) {
      const collection = App.request("season:entities", tvshow.get('tvshowid'));
      return App.execute("when:entity:fetched", collection, () => {
        const view = App.request("season:list:view", collection);
        API.bindTriggersTVSeason(view);
        if (this.layout.regionContent) {
          this.layout.regionContent.show(view);
          // On update to show, reload seasons
          return App.vent.on('entity:kodi:update', uid => {
            if (tvshow.get('uid') === uid) {
              return this.getSeasons(tvshow);
            }
          });
        }
      });
    }
  };
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp.Show", function(Show, App, Backbone, Marionette, $, _) {

  let Cls = (Show.PageLayout = class PageLayout extends App.Views.LayoutWithHeaderView {
    static initClass() {
      this.prototype.className = 'tvshow-show tv-collection detail-container';
    }
  });
  Cls.initClass();

  Cls = (Show.HeaderLayout = class HeaderLayout extends App.Views.LayoutDetailsHeaderView {
    static initClass() {
      this.prototype.className = 'tvshow-details';
    }
  });
  Cls.initClass();

  Cls = (Show.Details = class Details extends App.Views.DetailsItem {
    static initClass() {
      this.prototype.template = 'apps/tvshow/show/details_meta';
      this.prototype.triggers = {
        "click .play"               : "tvshow:play",
        "click .add"                : "tvshow:add",
        "click .edit"               : "tvshow:edit",
        "click .refresh"            : "tvshow:refresh",
        "click .refresh-episodes"   : "tvshow:refresh:episodes"
      };
    }
    attributes() {
      return this.watchedAttributes('details-meta');
    }
  });
  Cls.initClass();

  return (function() {
    Cls = (Show.TVShowTeaser = class TVShowTeaser extends App.Views.CardView {
      static initClass() {
        this.prototype.tagName = "div";
        this.prototype.triggers =
          {"click .play"       : "tvshow:play"};
      }
      initialize() {
          return this.model.set({actions: {thumbs: tr('Thumbs up')}});
        }
      attributes() {
        return this.watchedAttributes('card-detail');
      }
    });
    Cls.initClass();
    return Cls;
  })();
});
;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS206: Consider reworking classes to avoid initClass
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("TVShowApp", function(TVShowApp, App, Backbone, Marionette, $, _) {

  const Cls = (TVShowApp.Router = class Router extends App.Router.Base {
    static initClass() {
      this.prototype.appRoutes = {
        "tvshows"                             : "list",
        "tvshow/:tvshowid"                    : "view",
        "tvshow/:tvshowid/:season"            : "season",
        "tvshow/:tvshowid/:season/:episodeid" : "episode"
      };
    }
  });
  Cls.initClass();

  var API = {

    list() {
      return new TVShowApp.List.Controller();
    },

    view(tvshowid) {
      return new TVShowApp.Show.Controller({
        id: tvshowid});
    },

    season(tvshowid, season) {
      return new TVShowApp.Season.Controller({
        id: tvshowid,
        season
      });
    },

    episode(tvshowid, season, episodeid) {
      return new TVShowApp.Episode.Controller({
        id: tvshowid,
        season,
        episodeid
      });
    },

    toggleWatched(model, season = 'all', op) {
      return API.getAllEpisodesCollection(model.get('tvshowid'), season, function(collection) {
        const videoLib = App.request("command:kodi:controller", 'video', 'VideoLibrary');
        return videoLib.toggleWatchedCollection(collection, op);
      });
    },

    toggleWatchedUiState($el, setChildren = true) {
      const op = $el.hasClass('is-watched') ? 'unwatched' : 'watched';
      const classOp = op === 'watched' ? 'addClass' : 'removeClass';
      const progress = op === 'watched' ? 100 : 0;
      $el[classOp]('is-watched');
      helpers.entities.setProgress($el, progress);
      const $layout = $el.closest('.tv-collection');
      // If on a TV show or season page we also need set progress and watched on child collection
      if (setChildren) {
        $layout.find('.region-content .card')[classOp]('is-watched');
        helpers.entities.setProgress($layout, progress);
      }
      // Update the unwatched episodes
      const unwatched = parseInt($layout.find('.episode-total').text()) - $layout.find('.region-content .is-watched').length;
      $layout.find('.episode-unwatched').text(unwatched);
      return $layout;
    },

    getAllEpisodesCollection(tvshowid, season, callback) {
      const collectionAll = App.request("episode:tvshow:entities", tvshowid, season);
      return App.execute("when:entity:fetched", collectionAll, () => {
        return callback(collectionAll);
      });
    },

    episodeAction(op, view) {
      const {
        model
      } = view;
      const playlist = App.request("command:kodi:controller", 'video', 'PlayList');
      const files = App.request("command:kodi:controller", 'video', 'Files');
      const videoLib = App.request("command:kodi:controller", 'video', 'VideoLibrary');
      // Action to do
      switch (op) {
        case 'play':
          return App.execute("input:resume", model, 'episodeid');
        case 'add':
          return playlist.add('episodeid', model.get('episodeid'));
        case 'localplay':
          return files.videoStream(model.get('file'), model.get('fanart'));
        case 'download':
          return files.downloadFile(model.get('file'));
        case 'toggleWatched':
          return videoLib.toggleWatched(model, 'auto');
        case 'gotoSeason':
          return App.navigate("#tvshow/" + model.get('tvshowid') + '/' + model.get('season'), {trigger: true});
        case 'refresh':
          return helpers.entities.refreshEntity(model, videoLib, 'refreshEpisode');
        default:
      }
    },
          //# nothing

    tvShowAction(op, view) {
      const {
        model
      } = view;
      const playlist = App.request("command:kodi:controller", 'video', 'PlayList');
      const season = model.get('type') === 'season' ? model.get('season') : 'all';
      const videoLib = App.request("command:kodi:controller", 'video', 'VideoLibrary');
      switch (op) {
        case 'play':
          return API.getAllEpisodesCollection(model.get('tvshowid'), season, collection => playlist.playCollection(collection));
        case 'add':
          return API.getAllEpisodesCollection(model.get('tvshowid'), season, collection => playlist.addCollection(collection));
        case 'watched':
          return API.toggleWatched(model, season, op);
        case 'unwatched':
          return API.toggleWatched(model, season, op);
        case 'edit':
          return App.execute('tvshow:edit', model);
        case 'refresh':
          return helpers.entities.refreshEntity(model, videoLib, 'refreshTVShow');
        case 'refreshEpisodes':
          return helpers.entities.refreshEntity(model, videoLib, 'refreshTVShow', {refreshepisodes: true});
        default:
      }
    }
  };
          //# nothing

  App.commands.setHandler('episode:action', (op, view) => API.episodeAction(op, view));

  App.commands.setHandler('tvshow:action', (op, view) => API.tvShowAction(op, view));

  App.reqres.setHandler('episode:action:items', () => ({
    actions: {watched: tr('Watched'), thumbs: tr('Thumbs up')},

    menu: {
      'add': tr('Queue in Kodi'),
      'divider-1': '',
      'download': tr('Download'),
      'localplay': tr('Play in browser'),
      'divider-2': '',
      'goto-season': tr('Go to season'),
      'divider-3': '',
      'edit': tr('Edit')
    }
  }));

  App.reqres.setHandler('tvshow:action:items', () => ({
    actions: {watched: tr('Watched'), thumbs: tr('Thumbs up')},
    menu: {add: tr('Queue in Kodi'), 'divider-': '', 'edit': tr('Edit')}
  }));

  App.commands.setHandler('tvshow:action:watched', function(parent, viewItem, setChildren = false) {
    let msg;
    const op = parent.$el.hasClass('is-watched') ? 'unwatched' : 'watched';
    if (viewItem.model.get('type') === 'season') {
      msg = tr('Set all episodes for this season as') + ' ' + tr(op);
    } else {
      msg = tr('Set all episodes for this TV show as') + ' ' + tr(op);
    }
    return App.execute("ui:modal:confirm", tr('Are you sure?'), msg, function() {
      API.toggleWatchedUiState(parent.$el, setChildren);
      return API.tvShowAction(op, viewItem);
    });
  });

  App.commands.setHandler('episode:action:watched', function(parent, viewItem) {
    API.toggleWatchedUiState(parent.$el, false);
    return API.episodeAction('toggleWatched', viewItem);
  });

  App.commands.setHandler('tvshow:edit', function(model) {
    const loadedModel = App.request("tvshow:entity", model.get('id'));
    return App.execute("when:entity:fetched", loadedModel, () => {
      return new TVShowApp.EditShow.Controller({
        model: loadedModel});
    });
  });

  App.commands.setHandler('episode:edit', function(model) {
    const loadedModel = App.request("episode:entity", model.get('id'));
    return App.execute("when:entity:fetched", loadedModel, () => {
      return new TVShowApp.EditEpisode.Controller({
        model: loadedModel});
    });
  });


  return App.on("before:start", () => new TVShowApp.Router({
    controller: API}));
});


;// TODO: This file was created by bulk-decaffeinate.
// Sanity-check the conversion and remove this comment.
/*
 * decaffeinate suggestions:
 * DS102: Remove unnecessary code created because of implicit returns
 * DS208: Avoid top-level this
 * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md
 */
this.Kodi.module("UiApp", function(UiApp, App, Backbone, Marionette, $, _) {

  //# TODO: Clean this up, it is a bit messy and needs some better abstraction.

  var API = {

    openModal(titleHtml, msgHtml, open = true, style = '') {
      //# Get the modal parts
      const $title = App.getRegion('regionModalTitle').$el;
      const $body = App.getRegion('regionModalBody').$el;
      const $modal = App.getRegion('regionModal').$el;
      $modal.removeClassStartsWith('style-');
      $modal.addClass('style-' + style);
      //# Populate its content
      $title.html(titleHtml);
      $body.html(msgHtml);
      //# Open model
      if (open) {
        $modal.modal();
      }
      $modal.on('hidden.bs.modal', e => $body.html(''));
      return $modal;
    },

    closeModal() {
      App.getRegion('regionModal').$el.modal('hide');
      return $('.modal-body').html('');
    },

    closeModalButton(text = 'close') {
      return API.getButton(t.gettext(text), 'default').on('click', () => API.closeModal());
    },

    getModalButtonContainer() {
      return App.getRegion('regionModalFooter').$el.empty();
    },

    getButton(text, type = 'primary') {
      return $('<button>').addClass('btn btn-' + type).text(text);
    },

    defaultButtons(callback) {
      const $ok = API.getButton(t.gettext('ok'), 'primary').on('click', function() {
        if (callback) {
          callback();
        }
        return API.closeModal();
      });
      return API.getModalButtonContainer()
        .append(API.closeModalButton())
        .append($ok);
    },

    confirmButtons(callback) {
      const $ok = API.getButton(t.gettext('yes'), 'primary').on('click', function() {
        if (callback) {
          callback();
        }
        return API.closeModal();
      });
      return API.getModalButtonContainer()
      .append(API.closeModalButton('no'))
      .append($ok);
    },

    //# Toggle player menu state.
    playerMenu(op = 'toggle') {
      const $el = $('.player-menu-wrapper');
      const openClass = 'opened';
      switch (op) {
        case 'open':
          return $el.addClass(openClass);
        case 'close':
          return $el.removeClass(openClass);
        default:
          return $el.toggleClass(openClass);
      }
    },

    //# Open a options modal.
    //# options is an object with a title and items, items is an array of single objects with
    //# a title and callback key. when the option is clicked the callback is called.
    //# Options are HTML (must be pre-escaped).
    buildOptions(options) {
      if (options.length === 0) {
        return;
      }
      const $wrap = $('<ul>').addClass('modal-options options-list');
      const $option = $('<li>');
      for (var option of options) {
        var $newOption = $option.clone();
        $newOption.html(option);
        $newOption.click(function(e) {
          API.closeModal();
          return $(this).closest('ul').find('li, span').unbind('click');
        });
        $wrap.append($newOption);
      }
      return $wrap;
    }
  };

  //# Open a text input modal window, callback receives the entered text.
  //# Options properties: {msgHtml: 'string', open: 'bool', defaultVal: 'string'}
  App.commands.setHandler("ui:textinput:show", function(title, options = {}, callback) {
    const msg = options.msg ? options.msg : '';
    const open = options.open ? true : false;
    const val = options.defaultVal ? options.defaultVal : '';
    const $input = $('<input>', {id: 'text-input', class: 'form-control', type: 'text', value: val}).on('keyup', function(e) {
      if ((e.keyCode === 13) && callback) {
        callback( $('#text-input').val() );
        return API.closeModal();
      }
    });
    const $msg = $('<p>').text(msg);
    API.defaultButtons(() => callback($('#text-input').val()));
    API.openModal(title, $msg, callback, open);
    const el = App.getRegion('regionModalBody').$el.append($input.wrap('<div class="form-control-wrapper"></div>'));
    setTimeout(() => el.find('input').first().focus()
    , 200);
    return $.material.init();
  });

  App.commands.setHandler("ui:modal:close", () => API.closeModal());

  //# Open a confirm modal
  App.commands.setHandler("ui:modal:confirm", function(titleHtml, msgHtml = '', callback) {
    API.confirmButtons(() => callback(true));
    return API.openModal(titleHtml, msgHtml, true, 'confirm');
  });

  //# Open a modal window
  App.commands.setHandler("ui:modal:show", function(titleHtml, msgHtml = '', footerHtml = '', closeButton = false, style = '') {
    API.getModalButtonContainer().html(footerHtml);
    if (closeButton) {
      API.getModalButtonContainer().prepend(API.closeModalButton());
    }
    return API.openModal(titleHtml, msgHtml, true, style);
  });

  //# Open a form modal window
  App.commands.setHandler("ui:modal:form:show", (titleHtml, msgHtml = '', style = 'form') => API.openModal(titleHtml, msgHtml, true, style));

  //# Close a modal window
  App.commands.setHandler("ui:modal:close", () => API.closeModal());

  //# Open a youtube video in a modal
  App.commands.setHandler("ui:modal:youtube", function(titleHtml, videoid) {
    API.getModalButtonContainer().html('');
    const msgHtml = '<iframe width="560" height="315" src="https://www.youtube.com/embed/' + videoid + '?rel=0&amp;showinfo=0&amp;autoplay=1" frameborder="0" allowfullscreen></iframe>';
    return API.openModal(titleHtml, msgHtml, true, 'video');
  });

  //# Open an options modal
  App.commands.setHandler("ui:modal:options", function(titleHtml, items) {
    const $options = API.buildOptions(items);
    return API.openModal(titleHtml, $options, true, 'options');
  });

  //# Toggle player menu
  App.commands.setHandler("ui:playermenu", op => API.playerMenu(op));

  //# Bind closing the f#@kn dropdown on item click
  App.commands.setHandler("ui:dropdown:bind:close", $el => $el.on("click", '.dropdown-menu li, .dropdown-menu a', e => $(e.target).closest('.dropdown-menu').parent().removeClass('open').trigger('hide.bs.dropdown')));

  //# When shell ready.
  return App.vent.on("shell:ready", options => {
    //# Close player menu on anywhere click
    return $('html').on('click', () => API.playerMenu('close'));
  });
});
